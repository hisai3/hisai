<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HEXO 搭建博客</title>
      <link href="/hisai3.github.io/2023/01/14/HEXO%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/"/>
      <url>/hisai3.github.io/2023/01/14/HEXO%20%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<h3 id="Butterfly主题修改"><a href="#Butterfly主题修改" class="headerlink" title="Butterfly主题修改"></a><a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly主题</a>修改</h3><ol><li>在目录<code>theme</code>中下载 <a href="https://hexo.io/themes/">hexo主题</a>  <a href="https://zhuanlan.zhihu.com/p/491537945">推荐主题</a></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jerryc127/hexo-theme-butterfly.git</span><br></pre></td></tr></table></figure><ol start="2"><li>修改站点配置文件<code>_config.yml</code>, 把主题修改为 <code>hexo-theme-butterfly</code> 安装的主题文件名（注意theme: 要有空格隔开）</li></ol><p>更改主题后启动服务器，界面显如下字符:</p><p><code>extends includes/layout.pug block content include includes/recent-posts.pug include includes/partial</code></p><p><strong>执行如下命令</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-renderer-jade hexo-generator-feed hexo-generator-sitemap hexo-browsersync hexo-generator-archive</span><br></pre></td></tr></table></figure><p>清除缓存</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure><p>生成静态文件即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><h3 id="配置修改"><a href="#配置修改" class="headerlink" title="配置修改"></a>配置修改</h3><ul><li><p><a href="https://sanshui.vip/2022/12/06/butterfly%E4%B8%BB%E9%A2%98%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE3/">三水个人博客-自定义样式</a></p></li><li><p><a href="https://www.guole.fun/posts/butterfly-custom/#%E6%96%87%E7%AB%A0%E7%B4%A0%E6%9D%90">Guo Le-自定义样式</a></p></li><li><p><a href="https://blog.csdn.net/qq_38157825/article/details/112783083">Butterfly主题安装文档(三)之主题配置2</a></p></li></ul><p><strong>网页背景渐变</strong> 可以直接在配置文件 <code>hexo-theme-butterfly</code> 中设置 <code>background </code> </p><ul><li>纯渐变</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#web_bg</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">-webkit-linear-gradient</span>(</span><br><span class="line">    <span class="number">0deg</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">247</span>, <span class="number">149</span>, <span class="number">51</span>, <span class="number">0.1</span>) <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">243</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">0.1</span>) <span class="number">15%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">239</span>, <span class="number">78</span>, <span class="number">123</span>, <span class="number">0.1</span>) <span class="number">30%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">161</span>, <span class="number">102</span>, <span class="number">171</span>, <span class="number">0.1</span>) <span class="number">44%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">80</span>, <span class="number">115</span>, <span class="number">184</span>, <span class="number">0.1</span>) <span class="number">58%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">16</span>, <span class="number">152</span>, <span class="number">173</span>, <span class="number">0.1</span>) <span class="number">72%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">179</span>, <span class="number">155</span>, <span class="number">0.1</span>) <span class="number">86%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">109</span>, <span class="number">186</span>, <span class="number">130</span>, <span class="number">0.1</span>) <span class="number">100%</span></span><br><span class="line">  );</span><br></pre></td></tr></table></figure><ul><li>背景加渐变</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#web_bg</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;https://ae01.alicdn.com/kf/H5662031fbf344418aa2c8bf74c68826eV.png&#x27;</span>),</span><br><span class="line">    <span class="built_in">-moz-linear-gradient</span>(<span class="number">45deg</span>, <span class="number">#6dd0f2</span> <span class="number">15%</span>, <span class="number">#f59abe</span> <span class="number">85%</span>);</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;https://ae01.alicdn.com/kf/H5662031fbf344418aa2c8bf74c68826eV.png&#x27;</span>),</span><br><span class="line">    <span class="built_in">-webkit-linear-gradient</span>(<span class="number">45deg</span>, <span class="number">#6dd0f2</span> <span class="number">15%</span>, <span class="number">#f59abe</span> <span class="number">85%</span>);</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;https://ae01.alicdn.com/kf/H5662031fbf344418aa2c8bf74c68826eV.png&#x27;</span>),</span><br><span class="line">    <span class="built_in">-ms-linear-gradient</span>(<span class="number">45deg</span>, <span class="number">#6dd0f2</span> <span class="number">15%</span>, <span class="number">#f59abe</span> <span class="number">85%</span>);</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;https://ae01.alicdn.com/kf/H5662031fbf344418aa2c8bf74c68826eV.png&#x27;</span>),</span><br><span class="line">    <span class="built_in">linear-gradient</span>(<span class="number">45deg</span>, <span class="number">#6dd0f2</span> <span class="number">15%</span>, <span class="number">#f59abe</span> <span class="number">85%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#web_bg</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;https://ae01.alicdn.com/kf/H18a4b998752a4ae68b8e85d432a5aef0l.png&#x27;</span>),</span><br><span class="line">    <span class="built_in">linear-gradient</span>(</span><br><span class="line">      <span class="number">60deg</span>,</span><br><span class="line">      <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">165</span>, <span class="number">150</span>, <span class="number">0.5</span>) <span class="number">5%</span>,</span><br><span class="line">      <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">228</span>, <span class="number">255</span>, <span class="number">0.35</span>)</span><br><span class="line">    ),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">&#x27;https://ae01.alicdn.com/kf/H21b5f6b8496141a1979a33666e1074d9x.jpg&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义样式"><a href="#自定义样式" class="headerlink" title="自定义样式"></a>自定义样式</h3><h4 id="新建-custom-css-放在-public-css-文件中-网上都是放到主题包中的-source-css-但没法打包到-public-中"><a href="#新建-custom-css-放在-public-css-文件中-网上都是放到主题包中的-source-css-但没法打包到-public-中" class="headerlink" title="新建 custom.css  放在 public/css 文件中 !! (网上都是放到主题包中的 source/css, 但没法打包到 public 中)"></a>新建 <code>custom.css</code>  放在 <code>public/css</code> 文件中 !! (<strong>网上都是放到主题包中的 <code>source/css</code>, 但没法打包到 <code>public</code> 中</strong>)</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.layout_post</span> &gt; <span class="selector-id">#post</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#aside_content</span> <span class="selector-class">.card-widget</span>,</span><br><span class="line"><span class="selector-id">#recent-posts</span>&gt;<span class="selector-class">.recent-post-item</span>,</span><br><span class="line"><span class="selector-class">.layout_page</span>&gt;<span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">:not</span>(<span class="selector-class">.recent-posts</span>),</span><br><span class="line"><span class="selector-class">.layout_post</span>&gt;<span class="selector-id">#page</span>,</span><br><span class="line"><span class="selector-class">.layout_post</span>&gt;<span class="selector-id">#post</span>,</span><br><span class="line"><span class="selector-class">.read-mode</span> <span class="selector-class">.layout_post</span>&gt;<span class="selector-id">#post</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attr">--card-bg</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0.8</span>);</span><br><span class="line">  <span class="attr">--card-hover-box-shadow</span>: <span class="number">0</span> <span class="number">3px</span> <span class="number">8px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">7</span>,<span class="number">17</span>,<span class="number">27</span>,<span class="number">0.2</span>);</span><br><span class="line">  <span class="attr">--guole-main</span>: <span class="number">#49b1f5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span> &#123;</span><br><span class="line">  <span class="attr">--card-bg</span>: <span class="built_in">rgba</span>(<span class="number">13</span>,<span class="number">13</span>,<span class="number">13</span>,<span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#footer</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h1</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ef50a8</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h2</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fb7061</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h3</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffbf00</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h4</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a9e000</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h5</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#57c850</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h6</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#5ec1e0</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h1</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h2</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h3</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h4</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h5</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h6</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">animation</span>: ccc <span class="number">1.6s</span> linear infinite;</span><br><span class="line">  <span class="attribute">animation</span>: ccc <span class="number">1.6s</span> linear infinite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 代码块样式 */</span></span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">figure</span><span class="selector-class">.highlight</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">7px</span>;</span><br><span class="line">  -webkit-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">10px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">144</span>,<span class="number">164</span>,<span class="number">174</span>,<span class="number">0.4</span>);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">10px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">144</span>,<span class="number">164</span>,<span class="number">174</span>,<span class="number">0.4</span>);</span><br><span class="line">  -webkit-<span class="attribute">transform</span>: <span class="built_in">translateZ</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">figure</span><span class="selector-class">.highlight</span> <span class="selector-class">.highlight-tools</span> <span class="selector-class">.code-lang</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">75px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">figure</span><span class="selector-class">.highlight</span> <span class="selector-class">.highlight-tools</span> <span class="selector-class">.expand</span> &#123;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">figure</span><span class="selector-class">.highlight</span> <span class="selector-class">.highlight-tools</span> <span class="selector-class">.expand</span> ~ <span class="selector-class">.copy-button</span> &#123;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">2.1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">figure</span><span class="selector-class">.highlight</span> <span class="selector-class">.highlight-tools</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fc625d</span>;</span><br><span class="line">  -webkit-<span class="attribute">box-shadow</span>: <span class="number">20px</span> <span class="number">0</span> <span class="number">#fdbc40</span>, <span class="number">40px</span> <span class="number">0</span> <span class="number">#35cd4b</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">20px</span> <span class="number">0</span> <span class="number">#fdbc40</span>, <span class="number">40px</span> <span class="number">0</span> <span class="number">#35cd4b</span>;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 目录-当前节点 */</span></span><br><span class="line"><span class="selector-id">#aside-content</span> <span class="selector-id">#card-toc</span> <span class="selector-class">.toc-content</span> <span class="selector-class">.toc-link</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--guole-main);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-moz-keyframes</span> ccc &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">1turn</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">1turn</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> ccc &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">1turn</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">1turn</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-o-keyframes</span> ccc &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">1turn</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">1turn</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> ccc &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    -webkit-<span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">1turn</span>);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">1turn</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在 <code>hexo-theme-butterfly.yml</code>  中 <code>inject</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inject</span></span><br><span class="line"><span class="comment"># Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span></span><br><span class="line"><span class="comment"># 插入代码到头部 &lt;/head&gt; 之前 和 底部 &lt;/body&gt; 之前</span></span><br><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/hisai/css/custom.css&quot;&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="comment"># - &lt;script src=&quot;xxxx&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><h4 id="解决-custom-css-无法自动打包到-public中"><a href="#解决-custom-css-无法自动打包到-public中" class="headerlink" title="解决 custom.css 无法自动打包到 public中"></a>解决 <code>custom.css</code> 无法自动打包到 <code>public</code>中</h4><ul><li>新建 <code>themes\hexo-theme-butterfly\source\css\custom.styl</code></li><li>将 <code>custom.css</code> 转 <code>custom.styl</code>   <a href="https://www.zhangxinxu.com/jq/stylus/keyframes.php">css转stylus在线工具</a> (转换可能不太准，要确认一下<a href="https://www.stylus-lang.cn/docs/keyframes.html">stylus语法</a>) </li><li>在 <code>source\css\index</code> 中加上  @import ‘custom’</li></ul><p>转换后的样式 <code>custom.styl</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文章页背景</span></span><br><span class="line"><span class="selector-class">.layout_post</span></span><br><span class="line">  &amp; &gt; <span class="selector-id">#post</span></span><br><span class="line">    <span class="attribute">background</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">8</span>)</span><br><span class="line"><span class="comment">// 所有页面背景</span></span><br><span class="line"><span class="selector-id">#aside_content</span> <span class="selector-class">.card-widget</span>,</span><br><span class="line">#recent-posts&gt;<span class="selector-class">.recent-post-item</span>,</span><br><span class="line">.layout_page&gt;<span class="selector-tag">div</span><span class="selector-pseudo">:first-child</span><span class="selector-pseudo">:not</span>(.recent-posts),</span><br><span class="line">.layout_post&gt;<span class="selector-id">#page</span>,</span><br><span class="line">.layout_post&gt;<span class="selector-id">#post</span>,</span><br><span class="line"><span class="selector-class">.read-mode</span> .layout_post&gt;<span class="selector-id">#post</span></span><br><span class="line">  <span class="attribute">background</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 侧边卡片的透明度</span></span><br><span class="line"><span class="selector-pseudo">:root</span></span><br><span class="line">  <span class="attr">--card-bg</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">8</span>)</span><br><span class="line">  <span class="attr">--card-hover-box-shadow</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">8px</span> <span class="number">6px</span> <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">17</span>, <span class="number">27</span>, <span class="number">0.2</span>)</span><br><span class="line">  <span class="attr">--guole-main</span> <span class="number">#49b1f5</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&#x27;dark&#x27;</span>]</span></span><br><span class="line">  <span class="attr">--card-bg</span> <span class="built_in">rgba</span>(<span class="number">13</span>, <span class="number">13</span>, <span class="number">13</span>, .<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页脚透明</span></span><br><span class="line"><span class="selector-id">#footer</span></span><br><span class="line">  <span class="attribute">background</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 文章页H1-H6图标样式效果</span></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h1</span><span class="selector-pseudo">::before</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ef50a8</span> ;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h2</span><span class="selector-pseudo">::before</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fb7061</span> ;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h3</span><span class="selector-pseudo">::before</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffbf00</span> ;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h4</span><span class="selector-pseudo">::before</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#a9e000</span> ;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h5</span><span class="selector-pseudo">::before</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#57c850</span> ;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h6</span><span class="selector-pseudo">::before</span></span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#5ec1e0</span> ;</span><br><span class="line">  <span class="attribute">margin-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 小风车旋转</span></span><br><span class="line"><span class="selector-tag">h1</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h2</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h3</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h4</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h5</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-tag">h6</span><span class="selector-pseudo">::before</span></span><br><span class="line">  -webkit-<span class="attribute">animation</span> ccc <span class="number">1.6s</span> linear infinite</span><br><span class="line">  <span class="attribute">animation</span> ccc <span class="number">1.6s</span> linear infinite</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 代码块样式 */</span></span><br><span class="line"><span class="selector-id">#article-container</span></span><br><span class="line">  <span class="selector-tag">figure</span></span><br><span class="line">    &amp;<span class="selector-class">.highlight</span></span><br><span class="line">      <span class="attribute">border-radius</span> <span class="number">7px</span></span><br><span class="line">      -webkit-<span class="attribute">box-shadow</span> <span class="number">0</span> <span class="number">5px</span> <span class="number">10px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">144</span>, <span class="number">164</span>, <span class="number">174</span>, .<span class="number">4</span>)</span><br><span class="line">      <span class="attribute">box-shadow</span> <span class="number">0</span> <span class="number">5px</span> <span class="number">10px</span> <span class="number">0</span> <span class="built_in">rgba</span>(<span class="number">144</span>, <span class="number">164</span>, <span class="number">174</span>, .<span class="number">4</span>)</span><br><span class="line">      -webkit-<span class="attribute">transform</span> <span class="built_in">translateZ</span>(<span class="number">0</span>)</span><br><span class="line">      <span class="selector-class">.highlight-tools</span></span><br><span class="line">        <span class="selector-class">.code-lang</span></span><br><span class="line">          <span class="attribute">left</span> <span class="number">75px</span></span><br><span class="line">        <span class="selector-class">.expand</span></span><br><span class="line">          <span class="attribute">right</span> <span class="number">0</span></span><br><span class="line">          &amp; ~ <span class="selector-class">.copy-button</span></span><br><span class="line">            <span class="attribute">right</span> <span class="number">2.1em</span></span><br><span class="line">        <span class="selector-pseudo">&amp;:after</span></span><br><span class="line">          <span class="attribute">position</span> absolute</span><br><span class="line">          <span class="attribute">left</span> <span class="number">14px</span></span><br><span class="line">          <span class="attribute">width</span> <span class="number">12px</span></span><br><span class="line">          <span class="attribute">height</span> <span class="number">12px</span></span><br><span class="line">          <span class="attribute">border-radius</span> <span class="number">50%</span></span><br><span class="line">          <span class="attribute">background</span> <span class="number">#fc625d</span></span><br><span class="line">          -webkit-<span class="attribute">box-shadow</span> <span class="number">20px</span> <span class="number">0</span> <span class="number">#fdbc40</span>, <span class="number">40px</span> <span class="number">0</span> <span class="number">#35cd4b</span></span><br><span class="line">          <span class="attribute">box-shadow</span> <span class="number">20px</span> <span class="number">0</span> <span class="number">#fdbc40</span>, <span class="number">40px</span> <span class="number">0</span> <span class="number">#35cd4b</span></span><br><span class="line">          <span class="attribute">content</span> <span class="string">&#x27; &#x27;</span></span><br><span class="line"><span class="comment">/* 目录-当前节点 */</span></span><br><span class="line"><span class="selector-id">#aside-content</span></span><br><span class="line">  <span class="selector-id">#card-toc</span></span><br><span class="line">    <span class="selector-class">.toc-content</span></span><br><span class="line">      <span class="selector-class">.toc-link</span></span><br><span class="line">        &amp;<span class="selector-class">.active</span></span><br><span class="line">          <span class="attribute">background-color</span> <span class="built_in">var</span>(--guole-main)</span><br><span class="line">          <span class="attribute">border-radius</span> <span class="number">8px</span></span><br><span class="line"><span class="comment">/* 不需要前缀 keyframes放最后 否则打包之后的css有问题 */</span></span><br><span class="line"><span class="keyword">@keyframes</span> ccc</span><br><span class="line">  <span class="number">0%</span></span><br><span class="line">    -webkit-<span class="attribute">transform</span> <span class="built_in">rotate</span>(<span class="number">0deg</span>)</span><br><span class="line">    <span class="attribute">transform</span> <span class="built_in">rotate</span>(<span class="number">0deg</span>)</span><br><span class="line">  <span class="number">100%</span></span><br><span class="line">    -webkit-<span class="attribute">transform</span> <span class="built_in">rotate</span>(-<span class="number">1turn</span>)</span><br><span class="line">    <span class="attribute">transform</span> <span class="built_in">rotate</span>(-<span class="number">1turn</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="页面（写作）"><a href="#页面（写作）" class="headerlink" title="页面（写作）"></a>页面（写作）</h3><h4 id="新建-标签-和分类-页面"><a href="#新建-标签-和分类-页面" class="headerlink" title="新建 标签 和分类 页面"></a>新建 <strong>标签</strong> 和<strong>分类</strong> 页面</h4><ul><li>只要在 source 文件夹下新建.md文件，并且文章前面按如下格式表明所属分类和标签就行：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">自学编程成功概率有多少可能</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2017-05-26 19:57:47</span></span><br><span class="line"><span class="attr">tags:</span> [<span class="string">编程</span>,<span class="string">感悟</span>]</span><br><span class="line"><span class="attr">categories:</span> <span class="string">技术</span> </span><br></pre></td></tr></table></figure><ul><li>先根目录输入命令 <code>hexo new page categories</code> 会自动新建 categorier 文件夹并生成一个index.md文件，里面的代码为：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019-01-30 23:10:51</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">categories</span> <span class="comment"># 手动添加 否则侧边栏的个人信息中的分类进入页面没有内容</span></span><br></pre></td></tr></table></figure><p>同理，「标签」也一样 <code>hexo new page tags</code> 生成 tags 文件夹，其中会自动生成一个index.md文件,代码为：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019-01-30 23:14:51</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">tags</span> <span class="comment"># 手动添加 否则侧边栏的个人信息中的标签进入页面没有内容</span></span><br></pre></td></tr></table></figure><ul><li>然后 我们发表文章使用「tags」「categories」只需在文章开头添加如下代码：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">利用GitHub和HEXO免费搭建个人博客高级</span> <span class="string">美化篇</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019-01-29 22:58:56</span></span><br><span class="line"><span class="attr">tags:</span> [<span class="string">hexo建站</span>,<span class="string">hexo部署</span>,<span class="string">github部署</span>,<span class="string">个人博客</span>]      <span class="comment">#添加的标签</span></span><br><span class="line"><span class="attr">categories:</span> <span class="string">hexo博客</span>                              <span class="comment">#添加的分类</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><h4 id="gitee防盗链图片无法显示"><a href="#gitee防盗链图片无法显示" class="headerlink" title="gitee防盗链图片无法显示"></a>gitee防盗链图片无法显示</h4><p><strong>添加标签只能针对img  背景图还是不能  只能换个云服务做图床</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;referrer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;no-referrer&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">referrer</span>=<span class="string">&quot;no-referrer|origin|unsafe-url&quot;</span> <span class="attr">src</span>=<span class="string">&quot;&#123;item.src&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/zzcyeah/p/anti-leech.html">防盗链</a></p><p><strong>① 图片少量时，可以将图片统一放在<font color="red"><code>source/images</code></font>文件夹中，通过<code>![替代文字](/images/image.jpg)</code>来访问。</strong></p><p><strong>② 打开站点配置文件，设置<code>post_asset_folder</code>为<code>true</code>。运行<code>npm install hexo-asset-image –save</code>，安装上传图片的插件。安装完成后，再运行<code>hexo new xxx</code>来生成md文件时，<code>/source/_posts</code>文件夹内除了<code>xxx.md</code>文件还有一个同名的文件夹，这个文件夹用来存放博文中用到的图片，引用图片时通过正常语法<code>![替代文字](xxx.png)</code>引用。</strong></p><h4 id="报错-Context-Dump"><a href="#报错-Context-Dump" class="headerlink" title="报错 Context Dump"></a>报错 Context Dump</h4><p>因为文章中出现里写了<code>&#123;&#123;&#125;&#125;</code> <a href="https://so.csdn.net/so/search?q=hexo&spm=1001.2101.3001.7020">hexo</a> 的文章渲染使用的是 <code>Nunjucks</code> ，因为在使用<code>mathjax</code>公式，造成了<code>&#123; &#123;</code>重叠，而它会在生成文章时将那几个大括号识别成自己的语法，这样就会报错。</p><p><strong>用空格隔开就好</strong>；</p><h4 id="hexo语法"><a href="#hexo语法" class="headerlink" title="hexo语法"></a>hexo语法</h4><h5 id="带颜色的引用"><a href="#带颜色的引用" class="headerlink" title="带颜色的引用"></a>带颜色的引用</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note class_name %&#125; 文字内容 (md class_name supported) &#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary %&#125; 文字内容 (md primary supported) &#123;% endnote %&#125;</span><br><span class="line">&#123;% note default %&#125; 文字内容 (md default supported) &#123;% endnote %&#125;</span><br><span class="line">&#123;% note success %&#125; 文字内容 (md success supported) &#123;% endnote %&#125;</span><br><span class="line">&#123;% note info %&#125; 文字内容 (md info supported) &#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning %&#125; 文字内容 (md warning supported) &#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger %&#125; 文字内容 (md danger supported) &#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>展示效果</p><div class="note class_name flat"><p>文字内容 (md class_name supported) </p></div><div class="note primary flat"><p>文字内容 (md primary supported) </p></div><div class="note default flat"><p>文字内容 (md default supported) </p></div><div class="note success flat"><p>文字内容 (md success supported) </p></div><div class="note info flat"><p>文字内容 (md info supported) </p></div><div class="note warning flat"><p>文字内容 (md warning supported) </p></div><div class="note danger flat"><p>文字内容 (md danger supported) </p></div><h5 id="图标-可以在Font-Awesome官网查找ICO图标，然后通过class方法添加。"><a href="#图标-可以在Font-Awesome官网查找ICO图标，然后通过class方法添加。" class="headerlink" title="图标 可以在Font Awesome官网查找ICO图标，然后通过class方法添加。"></a>图标 <strong>可以在<a href="https://fontawesome.com/v4.7.0/icons/">Font Awesome官网</a>查找ICO图标，然后通过class方法添加。</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; 铅笔</span><br><span class="line">&lt;i class=&quot;fa fa-cloud-upload&quot;&gt;&lt;/i&gt; 上传</span><br><span class="line">&lt;i class=&quot;fa fa-download&quot;&gt;&lt;/i&gt; 下载</span><br><span class="line">&lt;i class=&quot;fa fa-download fa-lg&quot;&gt;&lt;/i&gt; 下载变大 33%</span><br><span class="line">&lt;i class=&quot;fa fa-download fa-2x&quot;&gt;&lt;/i&gt; 下载两倍大</span><br></pre></td></tr></table></figure><p>展示效果</p><p><i class="fa fa-pencil"></i> 铅笔</p><p><i class="fa fa-cloud-upload"></i> 上传</p><p><i class="fa fa-download"></i> 下载</p><p><i class="fa fa-download fa-lg"></i> 下载变大 33%</p><p><i class="fa fa-download fa-2x"></i> 下载两倍大</p><h5 id="设置文字颜色"><a href="#设置文字颜色" class="headerlink" title="设置文字颜色"></a>设置文字颜色</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;font color=&quot;red&quot;&gt;&lt;big&gt;测试内容&lt;/big&gt;&lt;/font&gt;</span><br><span class="line">&lt;font color=&quot;#0000FF&quot;&gt;测试内容&lt;/font&gt;</span><br><span class="line">&lt;span style=&#x27;padding: 1px 4px;color:#26c6da;background-color: rgba(77,208,225,.08);border-radius:4px&#x27;&gt;蓝绿色？&lt;/span&gt;</span><br><span class="line">&lt;span style=&#x27;padding: 1px 4px;color:#ff502c;background-color: #fff5f5;border-radius:4px&#x27;&gt;红色&lt;/span&gt;</span><br></pre></td></tr></table></figure><p>展示效果</p><p><font color="red"><big>测试内容</big></font></p><p><font color="#0000FF">测试内容</font></p><p><span style='padding: 1px 4px;color:#26c6da;background-color: rgba(77,208,225,.08);border-radius:4px'>蓝绿色？</span></p><p><span style='padding: 1px 4px;color:#ff502c;background-color: #fff5f5;border-radius:4px'>红色</span></p><h5 id="居中和右对齐"><a href="#居中和右对齐" class="headerlink" title="居中和右对齐"></a>居中和右对齐</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;center&gt;内容居中&lt;/center&gt;</span><br><span class="line">&lt;div style=&quot;text-align:right&quot;&gt;内容右对齐&lt;/div&gt;</span><br><span class="line">&lt;div align=&quot;left&quot;&gt; 左对齐！&lt;/div&gt;</span><br><span class="line">&lt;div align=&quot;center&quot;&gt;居中对齐！&lt;/div&gt;</span><br><span class="line">&lt;div align=&quot;right&quot;&gt;右对齐！&lt;/div&gt;</span><br><span class="line">&lt;div align=&quot;justify &quot;&gt;伸展行 文字间隔！&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>展示效果</p><center>内容居中</center><div style="text-align:right">内容右对齐</div><div align="left"> 左对齐！</div><div align="center">居中对齐！</div><div align="right">右对齐！</div><div align="justify ">伸展行 文字间隔！</div><h5 id="选项卡"><a href="#选项卡" class="headerlink" title="选项卡"></a>选项卡</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs 选项卡, 2 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**这是选项卡 1** 呵呵哈哈哈哈哈哈</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**这是选项卡 2** 额。。。</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line">**这是选项卡 3** 哇，你找到我了！</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>展示效果</p><div class="tabs" id="选项卡"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#选项卡-1">选项卡 1</button></li><li class="tab active"><button type="button" data-href="#选项卡-2">选项卡 2</button></li><li class="tab"><button type="button" data-href="#选项卡-3">选项卡 3</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="选项卡-1"><p><strong>这是选项卡 1</strong> 呵呵哈哈哈哈哈哈</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="选项卡-2"><p><strong>这是选项卡 2</strong> 额。。。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="选项卡-3"><p><strong>这是选项卡 3</strong> 哇，你找到我了！</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p><a href="https://hexo.io/zh-cn/docs/github-pages">部署  github + hexo</a></p><h4 id="一、github-创建仓库-（部署之后访问-https-hisai3-github-io-仓库名-）"><a href="#一、github-创建仓库-（部署之后访问-https-hisai3-github-io-仓库名-）" class="headerlink" title="一、github 创建仓库 （部署之后访问 https://hisai3.github.io/仓库名/）"></a>一、<code>github</code> 创建仓库 （<strong>部署之后访问</strong> <a href="https://hisai3.github.io/%E4%BB%93%E5%BA%93%E5%90%8D/%EF%BC%89">https://hisai3.github.io/仓库名/）</a></h4><blockquote><p>github 提交超时 使用ssh</p></blockquote><ul><li><strong>ssh-keygen -t rsa -C “邮箱”</strong></li></ul><p><img src="https://gitee.com/hisai/image-bed/raw/master/hexo-blog/gen-sshkey.png" alt="shhkey-gen"></p><ul><li><strong>cat ~&#x2F;.ssh&#x2F;id_rsa.pub</strong>  获取sshkey</li></ul><p><img src="https://gitee.com/hisai/image-bed/raw/master/hexo-blog/get-sshkey.png" alt="shhkey-get"></p><ul><li>github添加sshkey</li></ul><p><img src="https://gitee.com/hisai/image-bed/raw/master/hexo-blog/github-sshkey.png" alt="github-sshkey"></p><h4 id="二、修改-github-pages"><a href="#二、修改-github-pages" class="headerlink" title="二、修改 github pages"></a>二、修改 <code>github pages</code></h4><p><img src="https://gitee.com/hisai/image-bed/raw/master/hexo-blog/github-pages.png" alt="github-pages"></p><h4 id="三、修改配置文件-config-yml"><a href="#三、修改配置文件-config-yml" class="headerlink" title="三、修改配置文件 _config.yml"></a>三、修改配置文件 <code>_config.yml</code></h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">&#x27;git&#x27;</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:hisai3/hisai.git</span> </span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure><h4 id="四、部署提交"><a href="#四、部署提交" class="headerlink" title="四、部署提交"></a>四、部署提交</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清缓存 (修改配置 或者 页面不刷新使用)</span></span><br><span class="line">hexo clean</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建public</span></span><br><span class="line">hexo g</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发布</span></span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p><strong>部署之后需要等待一下 刷新</strong></p><h3 id="theme主题备份上传失败"><a href="#theme主题备份上传失败" class="headerlink" title="theme主题备份上传失败"></a>theme主题备份上传失败</h3><p>现象： 讲整个博客项目提交到git上，发现主题包只剩下一个空文件夹</p><p>解决：</p><ol><li>将主题包中的 .git 文件移出，放置桌面</li><li>清缓存 git rm –cached themes&#x2F;主题包名</li><li>重新执行 git 提交代码命令</li><li>最后将 .git 文件放回主题包中</li></ol><p>可以先复制一份用于blog, 需要更新就先pull再跟复制的合并，否则每次都要重复上面的操作</p><h3 id="批量添加文章头部"><a href="#批量添加文章头部" class="headerlink" title="批量添加文章头部"></a>批量添加文章头部</h3><h4 id="1、将脚本放到需要处理的文件夹中执行即可"><a href="#1、将脚本放到需要处理的文件夹中执行即可" class="headerlink" title="1、将脚本放到需要处理的文件夹中执行即可"></a>1、将脚本放到需要处理的文件夹中执行即可</h4><h4 id="2、规则以当前文章的路径上一级为分类和标签"><a href="#2、规则以当前文章的路径上一级为分类和标签" class="headerlink" title="2、规则以当前文章的路径上一级为分类和标签"></a>2、规则以当前文章的路径上一级为分类和标签</h4><blockquote><p>当前文章路径：…..&#x2F;Vue&#x2F;指令.md</p><p>title: 指令</p><p>categories: Vue </p><p>tags: Vue </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> join = path.<span class="property">join</span></span><br><span class="line"><span class="keyword">const</span> regx = <span class="regexp">/\.md$/</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="title function_">join</span>(__dirname, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isFold</span> = fileName =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !fs.<span class="title function_">lstatSync</span>(fileName).<span class="title function_">isFile</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getFoldName</span> (str) &#123;</span><br><span class="line">  <span class="keyword">return</span> str.<span class="title function_">substring</span>(str.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;\\&quot;</span>) + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cates = []</span><br><span class="line"><span class="keyword">const</span> tree = &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDirs</span> (_path) &#123;</span><br><span class="line">  <span class="keyword">const</span> paths = fs.<span class="title function_">readdirSync</span>(_path)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function"><span class="params">fileName</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> p = <span class="title function_">join</span>(_path, fileName)</span><br><span class="line">      <span class="keyword">const</span> check = <span class="title function_">isFold</span>(p)</span><br><span class="line">      <span class="keyword">if</span> (check) &#123;</span><br><span class="line">        cates.<span class="title function_">push</span>(fileName)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> data = &#123;</span><br><span class="line">        <span class="attr">parent</span>: _path,</span><br><span class="line">        <span class="attr">parentName</span>: check ? <span class="string">&#x27;&#x27;</span> : <span class="title function_">getFoldName</span>(_path),</span><br><span class="line">        <span class="attr">path</span>: p,</span><br><span class="line">        <span class="attr">fileName</span>: fileName.<span class="title function_">substring</span>(<span class="number">0</span>, fileName.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>)),</span><br><span class="line">        <span class="attr">ext</span>: check ? <span class="string">&#x27;&#x27;</span> : fileName.<span class="title function_">substring</span>(fileName.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>)),</span><br><span class="line">        <span class="attr">isFold</span>: check</span><br><span class="line">      &#125;</span><br><span class="line">      tree[p] = data</span><br><span class="line">      <span class="keyword">return</span> data</span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="keyword">if</span> (paths &amp;&amp; paths.<span class="property">length</span>) &#123;</span><br><span class="line">    paths.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">isFold</span>)</span><br><span class="line">      .<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">getDirs</span>(item.<span class="property">path</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getDirs</span>(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getTime</span> () &#123;</span><br><span class="line">  <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="keyword">var</span> Y = time.<span class="title function_">getFullYear</span>();</span><br><span class="line">  <span class="keyword">var</span> M = time.<span class="title function_">getMonth</span>();</span><br><span class="line">  M = (M + <span class="number">1</span>) &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + (M + <span class="number">1</span>) : (M + <span class="number">1</span>);  <span class="comment">//这里月份加1的原因是因为月份是从0开始的，0-11月，加1让月份从1-12月区间。</span></span><br><span class="line">  <span class="keyword">var</span> d = time.<span class="title function_">getDate</span>();</span><br><span class="line">  d = d &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + d : d;</span><br><span class="line">  <span class="keyword">var</span> h = time.<span class="title function_">getHours</span>();</span><br><span class="line">  h = h &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + h : h;</span><br><span class="line">  <span class="keyword">var</span> m = time.<span class="title function_">getMinutes</span>();</span><br><span class="line">  m = m &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + m : m;</span><br><span class="line">  <span class="keyword">var</span> s = time.<span class="title function_">getSeconds</span>();</span><br><span class="line">  s = m &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + m : m;</span><br><span class="line">  <span class="keyword">return</span> Y + <span class="string">&quot;-&quot;</span> + M + <span class="string">&quot;-&quot;</span> + d + <span class="string">&quot; &quot;</span> + h + <span class="string">&quot;:&quot;</span> + m + <span class="string">&quot;:&quot;</span> + s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> tree) &#123;</span><br><span class="line">  <span class="keyword">const</span> d = tree[key]</span><br><span class="line">  <span class="keyword">if</span> (!d.<span class="property">isFold</span> &amp;&amp; regx.<span class="title function_">test</span>(d.<span class="property">ext</span>)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = fs.<span class="title function_">readFileSync</span>(d.<span class="property">path</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> str = <span class="string">`</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">title: <span class="subst">$&#123;d.fileName&#125;</span></span></span><br><span class="line"><span class="string">date: <span class="subst">$&#123;getTime()&#125;</span></span></span><br><span class="line"><span class="string">description: <span class="subst">$&#123;d.fileName&#125;</span></span></span><br><span class="line"><span class="string">categories: <span class="subst">$&#123;d.parentName&#125;</span></span></span><br><span class="line"><span class="string">tags: [<span class="subst">$&#123;d.parentName&#125;</span>]</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="subst">$&#123;data&#125;</span></span></span><br><span class="line"><span class="string">      `</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;readdirSync&#x27;</span>, str);</span><br><span class="line">      fs.<span class="title function_">writeFile</span>(d.<span class="property">path</span>, str, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;write ok&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;readdirSync----error&#x27;</span>, err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Css响应式布局grid</title>
      <link href="/hisai3.github.io/2023/01/14/Css%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80grid/"/>
      <url>/hisai3.github.io/2023/01/14/Css%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80grid/</url>
      
        <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/69809343">一行css代码搞定响应式布局</a><br><a href="https://juejin.cn/post/6854573220306255880">掘金</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">      <span class="attribute">display</span>: grid;</span><br><span class="line">      <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">      <span class="comment">/* 三列固定100px宽度 */</span></span><br><span class="line">      <span class="comment">/* grid-template-columns: 100px 100px 100px; */</span></span><br><span class="line">      <span class="comment">/* 三列自适应撑满 */</span></span><br><span class="line">      <span class="comment">/* grid-template-columns: 1fr 1fr 1fr; */</span></span><br><span class="line">      <span class="comment">/* 三列固定100px宽度 */</span></span><br><span class="line">      <span class="comment">/* grid-template-columns: repeat(3, 100px); */</span></span><br><span class="line">      <span class="comment">/* auto-fit自适应数量的列固定100px宽度 */</span></span><br><span class="line">      <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fit, <span class="number">100px</span>);</span><br><span class="line">      <span class="attribute">grid-template-rows</span>: <span class="number">50px</span> <span class="number">50px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.container</span> <span class="selector-tag">div</span> &#123;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>以上可以做到flex的基础布局</p></blockquote><blockquote><p>现在，栅格将会根据容器的宽度调整其数量。它会尝试在容器中容纳尽可能多的 100px 宽的列。但如果我们将所有列硬写为 100px，我们将永远没法获得所需的弹性，因为它们很难填充整个宽度。网格通常在右侧留有空白。</p></blockquote><p><strong>minmax()</strong></p><blockquote><p>我们需要minmax()。我们将 100px 替换为 minmax(100px, 1fr)，代码如下：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-gap</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fit, <span class="built_in">minmax</span>(<span class="number">100px</span>, <span class="number">1</span>fr));</span><br><span class="line">    <span class="attribute">grid-template-rows</span>: <span class="built_in">repeat</span>(<span class="number">2</span>, <span class="number">100px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 最终达到一个默认撑满, 当页面缩小, 元素会宽度会压缩, 最小为100px, 之后换行 */</span></span><br></pre></td></tr></table></figure><blockquote><p><code>minmax()</code>函数定义的范围大于或等于 min， 小于或等于 max。</p></blockquote><p><strong>注意:</strong> 跟<code>flex</code> + <code>minwidth</code> 的区别在于，换行后，换行的元素会<strong>撑满</strong>, 而 <code>grid</code> 的会以<strong>最小宽度</strong>存在</p>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Echarts</title>
      <link href="/hisai3.github.io/2023/01/14/Echarts/"/>
      <url>/hisai3.github.io/2023/01/14/Echarts/</url>
      
        <content type="html"><![CDATA[<p><a href="https://echarts.apache.org/examples/zh/editor.html?c=line-simple">复制代码查看</a></p><h4 id="柱状图-bar"><a href="#柱状图-bar" class="headerlink" title="柱状图 bar"></a>柱状图 bar</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> option = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">legend</span>: &#123;</span><br><span class="line">      <span class="attr">data</span>: [<span class="string">&#x27;访客数&#x27;</span>] <span class="comment">// 图例 需要在series中的数据有对应的 name === &#x27;访客数&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: [<span class="string">&#x27;董事局&#x27;</span>, <span class="string">&#x27;360事项&#x27;</span>, <span class="string">&#x27;经营班子&#x27;</span>, <span class="string">&#x27;费用发包&#x27;</span>, <span class="string">&#x27;职能事项&#x27;</span>, <span class="string">&#x27;节点类&#x27;</span>, <span class="string">&#x27;对账类&#x27;</span>, <span class="string">&#x27;其它&#x27;</span>],</span><br><span class="line">    <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">      <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">      <span class="attr">interval</span>: <span class="number">0</span>, <span class="comment">// x轴刻度过多间隔 interval 显示</span></span><br><span class="line">      <span class="attr">rotate</span>: <span class="number">40</span> <span class="comment">// 倾斜</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">    <span class="attr">max</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">      <span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125;%&#x27;</span> <span class="comment">// 自定义y轴文字</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">axisTick</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>: <span class="literal">false</span> <span class="comment">// 不显示坐标轴刻度线 xy同理</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">axisLine</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>: <span class="literal">false</span> <span class="comment">// 不显示坐标轴线 xy同理</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">splitLine</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>: <span class="literal">true</span>, <span class="comment">// 是否显示y轴的栅格线 横向</span></span><br><span class="line">      <span class="attr">lineStyle</span>: &#123; <span class="comment">// y轴的栅格线样式</span></span><br><span class="line">        <span class="attr">color</span>: <span class="string">&#x27;#e0e6f1&#x27;</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;solid&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>: <span class="literal">false</span> <span class="comment">// 不显示坐标轴上的文字 xy同理</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">grid</span>: &#123; <span class="comment">// 图表中间网格大小 （调整图表是否盛满盒子）</span></span><br><span class="line">    <span class="attr">left</span>: <span class="string">&#x27;10%&#x27;</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="string">&#x27;5%&#x27;</span>,</span><br><span class="line">    <span class="attr">bottom</span>: <span class="string">&#x27;30px&#x27;</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;80%&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">tooltip</span>: &#123; <span class="comment">// 鼠标移入显示的提示内容</span></span><br><span class="line">    <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,</span><br><span class="line">    <span class="attr">borderColor</span>: <span class="string">&#x27;#eee&#x27;</span>,</span><br><span class="line">    <span class="attr">borderWidth</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">padding</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="title function_">formatter</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="comment">// data 当前鼠标指向的series中data的值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;span&gt;自定义内容&lt;/span&gt;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;访客数&#x27;</span>, <span class="comment">// 对应 legend 图例</span></span><br><span class="line">      <span class="attr">data</span>: [],</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">      <span class="attr">barWidth</span>: <span class="number">25</span>, <span class="comment">// 柱子宽度</span></span><br><span class="line">      <span class="attr">label</span>: &#123; <span class="comment">// 柱子上方的提示内容</span></span><br><span class="line">        <span class="attr">formatter</span>: <span class="string">&#x27;&#123;c&#125;%&#x27;</span>, <span class="comment">// 自定义内容</span></span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>, <span class="comment">// 开启显示</span></span><br><span class="line">        <span class="attr">position</span>: <span class="string">&#x27;top&#x27;</span>, <span class="comment">// 在上方显示</span></span><br><span class="line">        <span class="attr">distance</span>: <span class="number">5</span>, <span class="comment">// 距离图形元素的距离。当 position 为字符描述值（如 &#x27;top&#x27;、&#x27;insideRight&#x27;）时候有效。</span></span><br><span class="line">        <span class="attr">verticalAlign</span>: <span class="string">&#x27;middle&#x27;</span>,</span><br><span class="line">        <span class="attr">textStyle</span>: &#123;</span><br><span class="line">          <span class="comment">// 数值样式</span></span><br><span class="line">          <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">          <span class="attr">fontSize</span>: <span class="number">12</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="饼图-pie"><a href="#饼图-pie" class="headerlink" title="饼图 pie"></a>饼图 pie</h4><p><a href="https://echarts.apache.org/examples/zh/editor.html?c=line-simple">复制代码查看</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> optionC = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">tooltip</span>: &#123;</span><br><span class="line">    <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123; <span class="comment">// 第一个series是中心原提示主要控制是两个series的radius</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;总工单&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="number">0</span>, <span class="string">&#x27;35%&#x27;</span>],</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123; <span class="comment">// 饼图中每一个饼块的样式</span></span><br><span class="line">        <span class="attr">borderWidth</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">borderColor</span>: <span class="string">&#x27;#eee&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">tooltip</span>: &#123; <span class="comment">// 移入提示</span></span><br><span class="line">        <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">hoverAnimation</span>: <span class="literal">false</span>,  <span class="comment">// 移入高亮</span></span><br><span class="line">      <span class="attr">label</span>: &#123; <span class="comment">// 饼块的提示内容</span></span><br><span class="line">        <span class="attr">normal</span>: &#123;</span><br><span class="line">          <span class="attr">position</span>: <span class="string">&#x27;inner&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">labelLine</span>: &#123; <span class="comment">// 饼块的线</span></span><br><span class="line">        <span class="attr">normal</span>: &#123;</span><br><span class="line">          <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">animation</span>: <span class="literal">false</span>,  <span class="comment">// 初始动画</span></span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">          <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">            <span class="attr">normal</span>: &#123;</span><br><span class="line">              <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">label</span>: &#123;</span><br><span class="line">            <span class="attr">normal</span>: &#123;</span><br><span class="line">              <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">position</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">              <span class="attr">textStyle</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;#f8f8f8&#x27;</span>,</span><br><span class="line">                <span class="attr">fontSize</span>: <span class="number">20</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="comment">// formatter: &#x27;&#123;a|&#123;b&#125;&#125;\n&#123;hr|&#125;\n&#123;per|&#123;d&#125;&#125;</span></span><br><span class="line">              <span class="attr">formatter</span>: <span class="string">&#x27;&#123;name|&#123;a&#125;&#125;\n&#123;value|&#123;c&#125;&#125;&#x27;</span>,  <span class="comment">// 自定义内容</span></span><br><span class="line">              <span class="attr">rich</span>: &#123;</span><br><span class="line">                <span class="attr">name</span>: &#123;</span><br><span class="line">                  <span class="attr">color</span>: <span class="string">&#x27;#999999&#x27;</span>,</span><br><span class="line">                  <span class="attr">fontSize</span>: <span class="number">11</span>,</span><br><span class="line">                  <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">value</span>: &#123;</span><br><span class="line">                  <span class="attr">width</span>: <span class="string">&#x27;100%&#x27;</span>,</span><br><span class="line">                  <span class="attr">fontSize</span>: <span class="number">14</span>,</span><br><span class="line">                  <span class="attr">fontWeight</span>: <span class="number">700</span>,</span><br><span class="line">                  <span class="attr">color</span>: <span class="string">&#x27;#000&#x27;</span>,</span><br><span class="line">                  <span class="attr">padding</span>: <span class="number">5</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">tooltip</span>: &#123; <span class="comment">// 鼠标移入显示的提示内容</span></span><br><span class="line">        <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span>,</span><br><span class="line">        <span class="attr">borderColor</span>: <span class="string">&#x27;#eee&#x27;</span>,</span><br><span class="line">        <span class="attr">borderWidth</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">padding</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="title function_">formatter</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="comment">// data 当前鼠标指向的series中data的值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;span&gt;自定义内容&lt;/span&gt;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="string">&#x27;40%&#x27;</span>, <span class="string">&#x27;60%&#x27;</span>],</span><br><span class="line">      <span class="attr">data</span>: [],</span><br><span class="line">      <span class="attr">emphasis</span>: &#123;</span><br><span class="line">        <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">          <span class="attr">shadowBlur</span>: <span class="number">10</span>,</span><br><span class="line">          <span class="attr">shadowOffsetX</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">alignTo</span>: <span class="string">&#x27;edge&#x27;</span>, <span class="comment">// 实例： https://echarts.apache.org/examples/zh/editor.html?c=pie-labelLine-adjust</span></span><br><span class="line">        <span class="attr">minMargin</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">edgeDistance</span>: <span class="number">20</span>, <span class="comment">// </span></span><br><span class="line">        <span class="attr">lineHeight</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="comment">// formatter: &#x27;&#123;a|&#123;a&#125;&#125;&#123;abg|&#125;\n&#123;hr|&#125;\n  &#123;b|&#123;b&#125;：&#125;&#123;c&#125;  &#123;per|&#123;d&#125;%&#125;  &#x27;,</span></span><br><span class="line">        <span class="comment">// formatter: &#x27;&#123;a|&#123;b&#125;&#125;\n&#123;hr|&#125;\n&#123;per|&#123;d&#125;&#125;&#x27;,</span></span><br><span class="line">        <span class="comment">// formatter: &#x27;&#123;name|&#123;b&#125;&#125;\n&#123;time|&#123;c&#125;&#125;&#x27;,</span></span><br><span class="line">        <span class="title function_">formatter</span>(<span class="params">params</span>) &#123;</span><br><span class="line">          <span class="comment">// console.log(&#x27;params--&gt;&gt;&gt;&gt;&#x27;, params.name, params.value)</span></span><br><span class="line">          <span class="keyword">const</span> isOver = params.<span class="property">name</span> === <span class="string">&#x27;逾期未完成&#x27;</span></span><br><span class="line">          <span class="keyword">return</span> <span class="string">`&#123;<span class="subst">$&#123;isOver ? <span class="string">&#x27;ra&#x27;</span> : <span class="string">&#x27;a&#x27;</span>&#125;</span>|<span class="subst">$&#123;params.name&#125;</span>&#125;\n&#123;hr|&#125;\n&#123;<span class="subst">$&#123;isOver ? <span class="string">&#x27;rper&#x27;</span> : <span class="string">&#x27;per&#x27;</span>&#125;</span>|<span class="subst">$&#123;params.value&#125;</span>&#125;`</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">rich</span>: &#123;</span><br><span class="line">          <span class="attr">ra</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#ff0606&#x27;</span>,</span><br><span class="line">            <span class="attr">fontSize</span>: <span class="number">13</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">a</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#999999&#x27;</span>,</span><br><span class="line">            <span class="attr">fontSize</span>: <span class="number">13</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">hr</span>: &#123;</span><br><span class="line">            <span class="attr">width</span>: <span class="string">&#x27;100%&#x27;</span>,</span><br><span class="line">            <span class="attr">height</span>: <span class="number">0</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">per</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#000000&#x27;</span>,</span><br><span class="line">            <span class="attr">fontSize</span>: <span class="number">18</span>,</span><br><span class="line">            <span class="attr">fontWeight</span>: <span class="number">600</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">rper</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#ff0606&#x27;</span>,</span><br><span class="line">            <span class="attr">fontSize</span>: <span class="number">18</span>,</span><br><span class="line">            <span class="attr">fontWeight</span>: <span class="number">600</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">labelLine</span>: &#123;</span><br><span class="line">        <span class="attr">length</span>: <span class="number">15</span>,</span><br><span class="line">        <span class="attr">length2</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">maxSurfaceAngle</span>: <span class="number">80</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">labelLayout</span>: <span class="keyword">function</span> (<span class="params">params</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> isLeft = params.<span class="property">labelRect</span>.<span class="property">x</span> &lt; myChart.<span class="title function_">getWidth</span>() / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">const</span> points = params.<span class="property">labelLinePoints</span>;</span><br><span class="line">        <span class="comment">// Update the end point.</span></span><br><span class="line">        points[<span class="number">2</span>][<span class="number">0</span>] = isLeft</span><br><span class="line">          ? params.<span class="property">labelRect</span>.<span class="property">x</span></span><br><span class="line">          : params.<span class="property">labelRect</span>.<span class="property">x</span> + params.<span class="property">labelRect</span>.<span class="property">width</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">labelLinePoints</span>: points</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="环形进度条"><a href="#环形进度条" class="headerlink" title="环形进度条"></a>环形进度条</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">legend</span>: &#123;</span><br><span class="line">    <span class="attr">orient</span>: <span class="string">&#x27;vertical&#x27;</span>,</span><br><span class="line">    <span class="attr">x</span>: <span class="string">&#x27;left&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;访问来源&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="number">0</span>, <span class="string">&#x27;38%&#x27;</span>], </span><br><span class="line">      <span class="attr">hoverAnimation</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">normal</span>: &#123;</span><br><span class="line">          <span class="attr">position</span>: <span class="string">&#x27;inner&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">labelLine</span>: &#123;</span><br><span class="line">        <span class="attr">normal</span>: &#123;</span><br><span class="line">          <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">animation</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">value</span>: <span class="number">100</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="number">24</span> + <span class="string">&#x27;%&#x27;</span>,</span><br><span class="line">          <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">            <span class="attr">normal</span>: &#123;</span><br><span class="line">              <span class="attr">color</span>: <span class="string">&#x27;#6a5acd&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">label</span>: &#123;</span><br><span class="line">            <span class="attr">normal</span>: &#123;</span><br><span class="line">              <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="attr">position</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">              <span class="attr">textStyle</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;#f8f8f8&#x27;</span>,</span><br><span class="line">                <span class="attr">fontSize</span>: <span class="number">20</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">      <span class="attr">radius</span>: [<span class="string">&#x27;40%&#x27;</span>, <span class="string">&#x27;43%&#x27;</span>],</span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">normal</span>: &#123;</span><br><span class="line">          <span class="attr">color</span>: <span class="string">&#x27;#6a5acd&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">labelLine</span>: &#123;</span><br><span class="line">        <span class="attr">normal</span>: &#123;</span><br><span class="line">          <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">hoverAnimation</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">animationEasing</span>: <span class="string">&#x27;cubicOut&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">value</span>: <span class="number">24</span>,</span><br><span class="line">          <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">            <span class="attr">emphasis</span>: &#123;</span><br><span class="line">              <span class="attr">color</span>: <span class="string">&#x27;#6a5acd&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">value</span>: <span class="number">100</span> - <span class="number">24</span>,</span><br><span class="line">          <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">            <span class="attr">normal</span>: &#123;</span><br><span class="line">              <span class="attr">color</span>: <span class="string">&#x27;#d3d3d3&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Echarts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Echarts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS 常用工具</title>
      <link href="/hisai3.github.io/2023/01/14/JS%20%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
      <url>/hisai3.github.io/2023/01/14/JS%20%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="JS-常用工具"><a href="#JS-常用工具" class="headerlink" title="JS 常用工具"></a>JS 常用工具</h1><p><a href="https://juejin.cn/post/6844904090313424903">一坨校验</a></p><h3 id="时间处理"><a href="#时间处理" class="headerlink" title="时间处理"></a>时间处理</h3><h5 id="格式化时间"><a href="#格式化时间" class="headerlink" title="格式化时间"></a>格式化时间</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">formatDate</span>(<span class="params">date, fmt</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/(y+)/</span>.<span class="title function_">test</span>(fmt)) &#123;</span><br><span class="line">    fmt = fmt.<span class="title function_">replace</span>(</span><br><span class="line">      <span class="title class_">RegExp</span>.<span class="property">$1</span>,</span><br><span class="line">      (date.<span class="title function_">getFullYear</span>() + <span class="string">&#x27;&#x27;</span>).<span class="title function_">substr</span>(<span class="number">4</span> - <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> o = &#123;</span><br><span class="line">    <span class="string">&#x27;M+&#x27;</span>: date.<span class="title function_">getMonth</span>() + <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;d+&#x27;</span>: date.<span class="title function_">getDate</span>(),</span><br><span class="line">    <span class="string">&#x27;h+&#x27;</span>: date.<span class="title function_">getHours</span>(),</span><br><span class="line">    <span class="string">&#x27;m+&#x27;</span>: date.<span class="title function_">getMinutes</span>(),</span><br><span class="line">    <span class="string">&#x27;s+&#x27;</span>: date.<span class="title function_">getSeconds</span>(),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> o) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`(<span class="subst">$&#123;k&#125;</span>)`</span>).<span class="title function_">test</span>(fmt)) &#123;</span><br><span class="line">      <span class="keyword">let</span> str = o[k] + <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      fmt = fmt.<span class="title function_">replace</span>(</span><br><span class="line">        <span class="title class_">RegExp</span>.<span class="property">$1</span>,</span><br><span class="line">        <span class="title class_">RegExp</span>.<span class="property">$1</span>.<span class="property">length</span> === <span class="number">1</span> ? str : (<span class="string">&#x27;00&#x27;</span> + str).<span class="title function_">substr</span>(str.<span class="property">length</span>)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fmt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">formatDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&#x27;yyyy-MM-dd hh:mm:ss&#x27;</span>);</span><br><span class="line"><span class="title function_">formatDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&#x27;yyyy-MM-dd&#x27;</span>);</span><br><span class="line"><span class="title function_">formatDate</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&#x27;hh:mm:ss&#x27;</span>);</span><br></pre></td></tr></table></figure><h5 id="获取前x天的日期"><a href="#获取前x天的日期" class="headerlink" title="获取前x天的日期"></a>获取前x天的日期</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getDateBeforeNow</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line"><span class="keyword">const</span> day = now.<span class="title function_">getDate</span>()</span><br><span class="line">    <span class="keyword">return</span> now.<span class="title function_">setDate</span>(day - val)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="获取当年指定月最后一日"><a href="#获取当年指定月最后一日" class="headerlink" title="获取当年指定月最后一日"></a>获取当年指定月最后一日</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如若获取第一天 new Date(year, m - 1, 1)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLastDate</span>(<span class="params">m</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> year = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getFullYear</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(year, m, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="获取本周的开始、结束日期-（周一到周日）"><a href="#获取本周的开始、结束日期-（周一到周日）" class="headerlink" title="获取本周的开始、结束日期 （周一到周日）"></a>获取本周的开始、结束日期 （周一到周日）</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getWeekStartAndEnd</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">start</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(now.<span class="title function_">setDate</span>(now.<span class="title function_">getDate</span>() - now.<span class="title function_">getDay</span>() + <span class="number">1</span>)),</span><br><span class="line">        <span class="attr">end</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(now.<span class="title function_">setDate</span>(now.<span class="title function_">getDate</span>() - now.<span class="title function_">getDay</span>() + <span class="number">7</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id=""><a href="#" class="headerlink" title=""></a></h5><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><h5 id="操作URL查询参数"><a href="#操作URL查询参数" class="headerlink" title="操作URL查询参数"></a>操作URL查询参数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(location.<span class="property">search</span>.<span class="title function_">replace</span>(<span class="regexp">/\?/ig</span>, <span class="string">&quot;&quot;</span>)); </span><br><span class="line"><span class="comment">// location.search = &quot;?name=young&amp;sex=male&quot;</span></span><br><span class="line">params.<span class="title function_">has</span>(<span class="string">&quot;young&quot;</span>); <span class="comment">// true</span></span><br><span class="line">params.<span class="title function_">get</span>(<span class="string">&quot;sex&quot;</span>); <span class="comment">// &quot;male&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryString</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;(^|&amp;)&#x27;</span> + name + <span class="string">&#x27;=([^&amp;]*)(&amp;|$)&#x27;</span>, <span class="string">&#x27;i&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> r = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substr</span>(<span class="number">1</span>).<span class="title function_">match</span>(reg);</span><br><span class="line">  <span class="keyword">if</span> (r != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">unescape</span>(r[<span class="number">2</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="序列化参数"><a href="#序列化参数" class="headerlink" title="序列化参数"></a>序列化参数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * object转化成url拼接样式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> obj 需要转化的参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">objToUrl</span> = obj =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> obj)&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj.<span class="title function_">hasOwnProperty</span>(i)) &#123;</span><br><span class="line">            arr.<span class="title function_">push</span>(<span class="built_in">encodeURIComponent</span>(i) + <span class="string">&quot;=&quot;</span> + <span class="built_in">encodeURIComponent</span>(obj[i]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">join</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line"><span class="title function_">objToUrl</span>(&#123;<span class="attr">name</span>:<span class="string">&#x27;hehe&#x27;</span>,<span class="attr">age</span>:<span class="number">10</span>&#125;)</span><br></pre></td></tr></table></figure><h5 id="反序列化参数"><a href="#反序列化参数" class="headerlink" title="反序列化参数"></a>反序列化参数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * url转化成object拼接样式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 需要转化的参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">urlToObj</span> = url =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> string = url.<span class="title function_">split</span>(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> res = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;string.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> str = string[i].<span class="title function_">split</span>(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(str[<span class="number">0</span>]!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">            res[str[<span class="number">0</span>]]=str[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line"><span class="comment">// 无法处理链接 只能先接触参数部分</span></span><br><span class="line"><span class="title function_">urlToObj</span>(<span class="string">&quot;a=1&amp;b=2&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="string">&quot;http://www.baidu.com?name=elephant&amp;age=25&amp;sex=male&amp;num=100&quot;</span></span><br><span class="line"><span class="comment">// 返回参数对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">queryURLParams</span>(<span class="params">url</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> pattern = <span class="regexp">/(\w+)=(\w+)/ig</span>; <span class="comment">//定义正则表达式</span></span><br><span class="line"><span class="keyword">let</span> parames = &#123;&#125;; <span class="comment">// 定义参数对象</span></span><br><span class="line">url.<span class="title function_">replace</span>(pattern, <span class="function">(<span class="params">$, $<span class="number">1</span>, $<span class="number">2</span></span>) =&gt;</span> &#123;</span><br><span class="line">  parames[$<span class="number">1</span>] = $<span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">return</span> parames;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以获取链接上所有的参数  包括hash 不会存在返回 &#123;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">queryURLParams</span>(url))</span><br></pre></td></tr></table></figure><h5 id="防抖"><a href="#防抖" class="headerlink" title="防抖"></a>防抖</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params">func, wait, immediate</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> timeout, result;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> context = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">var</span> args = <span class="variable language_">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span> (timeout) <span class="built_in">clearTimeout</span>(timeout);</span><br><span class="line">        <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">            <span class="keyword">var</span> callNow = !timeout;</span><br><span class="line">            timeout = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                timeout = <span class="literal">null</span></span><br><span class="line">            &#125;, wait);</span><br><span class="line">            <span class="keyword">if</span> (callNow) result = func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            timeout = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">            &#125;, wait);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="节流"><a href="#节流" class="headerlink" title="节流"></a>节流</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">throttle</span>(<span class="params">func,wait</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> context, args, timeout;</span><br><span class="line">    <span class="keyword">var</span> tag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        context = <span class="variable language_">this</span>;</span><br><span class="line">        args = <span class="variable language_">arguments</span>;</span><br><span class="line">        <span class="keyword">if</span>(!timeout)&#123;</span><br><span class="line">            timeout = <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                timeout = <span class="literal">null</span>;</span><br><span class="line">                func.<span class="title function_">apply</span>(context, args);</span><br><span class="line">            &#125;, wait)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首次会执行</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">throttle2</span>(<span class="params">fn,delay=<span class="number">100</span></span>)&#123;</span><br><span class="line"><span class="keyword">let</span> last = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">let</span> curr = +<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">if</span>(curr - last &gt; delay)&#123;</span><br><span class="line">fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>,<span class="variable language_">arguments</span>);</span><br><span class="line">last = curr;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="格式化金钱"><a href="#格式化金钱" class="headerlink" title="格式化金钱"></a>格式化金钱</h5><ol><li>正则</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">ThousandNum</span> = num =&gt; num.<span class="title function_">toString</span>().<span class="title function_">replace</span>(<span class="regexp">/\B(?=(\d&#123;3&#125;)+(?!\d))/g</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> money = <span class="title class_">ThousandNum</span>(<span class="number">20190214</span>);</span><br><span class="line"><span class="comment">// money =&gt; &quot;20,190,214&quot;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>web API<br><code>toLocaleString</code> 返回这个数字在特定语言环境下的字符串表示</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">12345</span>;</span><br><span class="line">num.<span class="title function_">toLocaleString</span>(); <span class="comment">// &quot;12,345&quot;，注意有个千分位逗号</span></span><br><span class="line">num.<span class="title function_">toString</span>();       <span class="comment">// &quot;12345&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用locales参数 缩写的语言代码或这些代码组成的数组</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">1234567890</span>;</span><br><span class="line">num.<span class="title function_">toLocaleString</span>(<span class="string">&#x27;zh-Hans-CN-u-nu-hanidec&#x27;</span>); <span class="comment">// &quot;一,二三四,五六七,八九〇&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用options参数 指定了一些附加的样式属性</span></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">123456.789</span>;</span><br><span class="line">num.<span class="title function_">toLocaleString</span>(<span class="string">&#x27;de-DE&#x27;</span>, &#123; <span class="attr">style</span>: <span class="string">&#x27;currency&#x27;</span>, <span class="attr">currency</span>: <span class="string">&#x27;EUR&#x27;</span> &#125;); <span class="comment">// &quot;123.456,79 €&quot;</span></span><br></pre></td></tr></table></figure><h5 id="格式化电话号码"><a href="#格式化电话号码" class="headerlink" title="格式化电话号码"></a>格式化电话号码</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mobile = <span class="string">&#x27;18379836654&#x27;</span> </span><br><span class="line"><span class="keyword">let</span> mobileReg = <span class="regexp">/(?=(\d&#123;4&#125;)+$)/g</span> </span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mobile.<span class="title function_">replace</span>(mobileReg, <span class="string">&#x27;-&#x27;</span>)) <span class="comment">// 183-7983-6654</span></span><br></pre></td></tr></table></figure><h5 id="去除前后空格"><a href="#去除前后空格" class="headerlink" title="去除前后空格"></a>去除前后空格</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">trim1</span> = (<span class="params">str</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/^\s*|\s*$/g</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">// 或者 str.replace(/^\s*(.*?)\s*$/g, &#x27;$1&#x27;)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> string = <span class="string">&#x27;   hello medium   &#x27;</span></span><br><span class="line"><span class="keyword">const</span> noSpaceString = <span class="string">&#x27;hello medium&#x27;</span></span><br><span class="line"><span class="keyword">const</span> trimString = <span class="title function_">trim1</span>(string)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(string)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(trimString, trimString === noSpaceString) <span class="comment">// hello medium true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(string)</span><br></pre></td></tr></table></figure><h5 id="生成随机ID"><a href="#生成随机ID" class="headerlink" title="生成随机ID"></a>生成随机ID</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">RandomId</span> = len =&gt; <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">3</span>, len);</span><br><span class="line"><span class="keyword">const</span> id = <span class="title class_">RandomId</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">// id =&gt; &quot;jg7zpgiqva&quot;</span></span><br></pre></td></tr></table></figure><h5 id="生成星级评分"><a href="#生成星级评分" class="headerlink" title="生成星级评分"></a>生成星级评分</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">StartScore</span> = rate =&gt; <span class="string">&quot;★★★★★☆☆☆☆☆&quot;</span>.<span class="title function_">slice</span>(<span class="number">5</span> - rate, <span class="number">10</span> - rate);</span><br><span class="line"><span class="keyword">const</span> start = <span class="title class_">StartScore</span>(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// start =&gt; &quot;★★★&quot;</span></span><br></pre></td></tr></table></figure><h5 id="精确小数"><a href="#精确小数" class="headerlink" title="精确小数"></a>精确小数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">RoundNum</span> = (<span class="params">num, decimal</span>) =&gt; <span class="title class_">Math</span>.<span class="title function_">round</span>(num * <span class="number">10</span> ** decimal) / <span class="number">10</span> ** decimal;</span><br><span class="line"><span class="keyword">const</span> num = <span class="title class_">RoundNum</span>(<span class="number">1.69</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h5 id="生成范围随机数"><a href="#生成范围随机数" class="headerlink" title="生成范围随机数"></a>生成范围随机数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">RandomNum</span> = (<span class="params">min, max</span>) =&gt; <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max - min + <span class="number">1</span>)) + min;</span><br><span class="line"><span class="keyword">const</span> num = <span class="title class_">RandomNum</span>(<span class="number">1</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure><h5 id="判断数据类型"><a href="#判断数据类型" class="headerlink" title="判断数据类型"></a>判断数据类型</h5><blockquote><p>可判断类型：undefined、null、string、number、boolean、array、object、symbol、date、regexp、function、asyncfunction、arguments、set、map、weakset、weakmap</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isDataType</span>(<span class="params">data, type</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dataType = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(data).<span class="title function_">replace</span>(<span class="regexp">/\[object (\w+)\]/</span>, <span class="string">&quot;$1&quot;</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line">    <span class="keyword">return</span> type ? dataType === type : dataType;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">isDataType</span>(<span class="string">&quot;young&quot;</span>); <span class="comment">// &quot;string&quot;</span></span><br><span class="line"><span class="title function_">isDataType</span>(<span class="number">20190214</span>); <span class="comment">// &quot;number&quot;</span></span><br><span class="line"><span class="title function_">isDataType</span>(<span class="literal">true</span>); <span class="comment">// &quot;boolean&quot;</span></span><br><span class="line"><span class="title function_">isDataType</span>([], <span class="string">&quot;array&quot;</span>); <span class="comment">// true</span></span><br><span class="line"><span class="title function_">isDataType</span>(&#123;&#125;, <span class="string">&quot;array&quot;</span>); <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h5 id="过滤空值"><a href="#过滤空值" class="headerlink" title="过滤空值"></a>过滤空值</h5><blockquote><p>空值：undefined、null、””、0、false、NaN</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="literal">undefined</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>, <span class="number">0</span>, <span class="literal">false</span>, <span class="title class_">NaN</span>, <span class="number">1</span>, <span class="number">2</span>].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>);</span><br><span class="line"><span class="comment">// arr =&gt; [1, 2]</span></span><br></pre></td></tr></table></figure><h5 id="一次性函数"><a href="#一次性函数" class="headerlink" title="一次性函数"></a>一次性函数</h5><blockquote><p>适用于运行一些只需执行一次的初始化代码</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">    <span class="title class_">Func</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;y&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Func</span>() <span class="comment">// x</span></span><br><span class="line"><span class="title class_">Func</span>() <span class="comment">// y</span></span><br><span class="line"><span class="title class_">Func</span>() <span class="comment">// y</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h5 id="惰性载入函数"><a href="#惰性载入函数" class="headerlink" title="惰性载入函数"></a>惰性载入函数</h5><blockquote><p>函数内判断分支较多较复杂时可大大节约资源开销</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (a === b) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;y&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 换成</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Func</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (a === b) &#123;</span><br><span class="line">        <span class="title class_">Func</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title class_">Func</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;y&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Func</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="优雅处理Async-x2F-Await参数"><a href="#优雅处理Async-x2F-Await参数" class="headerlink" title="优雅处理Async&#x2F;Await参数"></a>优雅处理Async&#x2F;Await参数</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">AsyncTo</span>(<span class="params">promise</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> promise.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> [<span class="literal">null</span>, data]).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> [err]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [err, res] = <span class="keyword">await</span> <span class="title class_">AsyncTo</span>(<span class="title class_">Func</span>());</span><br></pre></td></tr></table></figure><h5 id="过滤XSS"><a href="#过滤XSS" class="headerlink" title="过滤XSS"></a>过滤XSS</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">FilterXss</span>(<span class="params">content</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> elem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    elem.<span class="property">innerText</span> = content;</span><br><span class="line">    <span class="keyword">const</span> result = elem.<span class="property">innerHTML</span>;</span><br><span class="line">    elem = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="显示全部DOM边框"><a href="#显示全部DOM边框" class="headerlink" title="显示全部DOM边框"></a>显示全部DOM边框</h5><blockquote><p>调试页面元素边界时使用</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[].<span class="property">forEach</span>.<span class="title function_">call</span>($$(<span class="string">&quot;*&quot;</span>), <span class="function"><span class="params">dom</span> =&gt;</span> &#123;</span><br><span class="line">    dom.<span class="property">style</span>.<span class="property">outline</span> = <span class="string">&quot;1px solid #&quot;</span> + (~~(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (<span class="number">1</span> &lt;&lt; <span class="number">24</span>))).<span class="title function_">toString</span>(<span class="number">16</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">[].<span class="property">forEach</span>.<span class="title function_">call</span>($$(<span class="string">&quot;*&quot;</span>), <span class="function"><span class="params">dom</span> =&gt;</span> &#123;</span><br><span class="line">    dom.<span class="property">style</span>.<span class="property">outline</span> = <span class="string">&quot;unset&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="自适应页面"><a href="#自适应页面" class="headerlink" title="自适应页面"></a>自适应页面</h5><blockquote><p>页面基于一张设计图但需做多款机型自适应，元素尺寸使用<code>rem</code>进行设置</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">AutoResponse</span>(<span class="params">width = <span class="number">750</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> target = <span class="variable language_">document</span>.<span class="property">documentElement</span>;</span><br><span class="line">    target.<span class="property">clientWidth</span> &gt;= <span class="number">600</span></span><br><span class="line">        ? (target.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&quot;80px&quot;</span>)</span><br><span class="line">        : (target.<span class="property">style</span>.<span class="property">fontSize</span> = target.<span class="property">clientWidth</span> / width * <span class="number">100</span> + <span class="string">&quot;px&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS常用工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Loading 动画</title>
      <link href="/hisai3.github.io/2023/01/14/Loading%20%E5%8A%A8%E7%94%BB/"/>
      <url>/hisai3.github.io/2023/01/14/Loading%20%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<p>小功能</p><h3 id="Loading-动画"><a href="#Loading-动画" class="headerlink" title="Loading 动画"></a>Loading 动画</h3><h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">  &lt;style&gt;</span><br><span class="line">    div &#123;</span><br><span class="line">      display: inline-block;</span><br><span class="line">      width: 10px;</span><br><span class="line">      height: 20px;</span><br><span class="line">      border: 1px solid #eee;</span><br><span class="line">      animation: show 2s infinite cubic-bezier(0.075, 0.82, 0.165, 1);</span><br><span class="line">    &#125;</span><br><span class="line">/* 1.关键在于延迟 */</span><br><span class="line">    div:nth-child(1) &#123;</span><br><span class="line">      animation-delay: -1.0s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    div:nth-child(2) &#123;</span><br><span class="line">      animation-delay: -0.8s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    div:nth-child(3) &#123;</span><br><span class="line">      animation-delay: -0.7s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    div:nth-child(4) &#123;</span><br><span class="line">      animation-delay: -0.6s;</span><br><span class="line">    &#125;</span><br><span class="line">/* 2.其次在于每帧 */</span><br><span class="line">    @keyframes show &#123;</span><br><span class="line">      0% &#123;</span><br><span class="line">        transform: scaleY(0.4);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      25% &#123;</span><br><span class="line">        transform: scaleY(1.0);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      50% &#123;</span><br><span class="line">        transform: scaleY(0.4);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      75% &#123;</span><br><span class="line">        transform: scaleY(0.4);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      100% &#123;</span><br><span class="line">        transform: scaleY(0.4);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;&lt;/div&gt;</span><br><span class="line">  &lt;div&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h4 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.loading3</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>:<span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>:<span class="number">50px</span> auto;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>:relative;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.circle</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>:absolute;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">top</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>:<span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.circle</span> <span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>:<span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>:<span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>:inline-block;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background</span>:<span class="number">#67CF22</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>:absolute;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation</span>: mycircle <span class="number">1.2s</span> infinite ease-in-out;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation</span>: mycircle <span class="number">1.2s</span> infinite ease-in-out;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-fill-mode</span>:both;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-fill-mode</span>:both;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle2</span>&#123;</span></span><br><span class="line"><span class="language-css">           -webkit-<span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(<span class="number">45deg</span>);</span></span><br><span class="line"><span class="language-css">           <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(<span class="number">45deg</span>);</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle3</span>&#123;</span></span><br><span class="line"><span class="language-css">           -webkit-<span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(<span class="number">90deg</span>);</span></span><br><span class="line"><span class="language-css">           <span class="attribute">transform</span>: <span class="built_in">rotateZ</span>(<span class="number">90deg</span>);</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle</span>&gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">top</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle</span>&gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>)&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">top</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">right</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle</span>&gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>)&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">right</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">bottom</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle</span>&gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>)&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">bottom</span>:<span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle2</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">1.1s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">1.1s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle3</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">1.0s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">1.0s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle1</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.9s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.9s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle2</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.8s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.8s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle3</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.7s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.7s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle1</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.6s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.6s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle2</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.7s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.7s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle3</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.4s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.4s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle1</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.3s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.3s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle2</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.2s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.2s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="selector-class">.circle3</span> &gt;<span class="selector-tag">span</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>)&#123;</span></span><br><span class="line"><span class="language-css">            -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.1s</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">animation-delay</span>: -<span class="number">0.1s</span>;</span></span><br><span class="line"><span class="language-css">       &#125;</span></span><br><span class="line"><span class="language-css">       <span class="keyword">@-webkit-keyframes</span> mycircle&#123;</span></span><br><span class="line"><span class="language-css">            <span class="number">0%</span>&#123;<span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">0.0</span>);&#125;</span></span><br><span class="line"><span class="language-css">            <span class="number">40%</span>&#123;<span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">1.0</span>);&#125;</span></span><br><span class="line"><span class="language-css">            <span class="number">80%</span>&#123;<span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">0.0</span>);&#125;</span></span><br><span class="line"><span class="language-css">            <span class="number">100%</span>&#123;<span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">0.0</span>);&#125;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="keyword">@keyframes</span> mycircle&#123;</span></span><br><span class="line"><span class="language-css">            <span class="number">0%</span>&#123;<span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">0.0</span>);&#125;</span></span><br><span class="line"><span class="language-css">            <span class="number">40%</span>&#123;<span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">1.0</span>);&#125;</span></span><br><span class="line"><span class="language-css">            <span class="number">80%</span>&#123;<span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">0.0</span>);&#125;</span></span><br><span class="line"><span class="language-css">            <span class="number">100%</span>&#123;<span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">0.0</span>);&#125;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">       </span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loading3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;circle circle1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;circle circle2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;circle circle3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.loading4</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">width</span>: <span class="number">150px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.loading4</span>&gt;<span class="selector-tag">div</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">width</span>: <span class="number">18px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">height</span>: <span class="number">18px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">border-radius</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">display</span>: inline-block;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">background-color</span>: <span class="number">#67CF22</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      -webkit-<span class="attribute">animation</span>: three <span class="number">1.4s</span> infinite ease-in-out;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">animation</span>: three <span class="number">1.4s</span> infinite ease-in-out;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      -webkit-<span class="attribute">animation-fill-mode</span>: both;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">animation-fill-mode</span>: both;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.loading4</span> <span class="selector-class">.three1</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.30s</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">animation-delay</span>: -<span class="number">0.30s</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-class">.loading4</span> <span class="selector-class">.three2</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      -webkit-<span class="attribute">animation-delay</span>: -<span class="number">0.15s</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="attribute">animation-delay</span>: -<span class="number">0.15s</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="keyword">@-webkit-keyframes</span> three &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="number">0%</span>,</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="number">80%</span>,</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="number">100%</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        -webkit-<span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0.0</span>)</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="number">40%</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        -webkit-<span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.0</span>)</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="keyword">@keyframes</span> three &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="number">0%</span>,</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="number">80%</span>,</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="number">100%</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        -webkit-<span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0.0</span>)</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      <span class="number">40%</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        -webkit-<span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.0</span>)</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loading4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;three1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;three2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;three3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> css3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Problem</title>
      <link href="/hisai3.github.io/2023/01/14/Problem/"/>
      <url>/hisai3.github.io/2023/01/14/Problem/</url>
      
        <content type="html"><![CDATA[<h5 id="flex布局"><a href="#flex布局" class="headerlink" title="flex布局"></a>flex布局</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>123<span class="tag">&lt;/<span class="name">i</span>&gt;</span>电话预定<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>最终显示123在上文本在下，可以 display: flex;<br>        flex-direction: column;这就可以让a标签中的文本和img的垂直显示的效果</p><p>原因：<em><strong>在flex布局中，文本也算是子项！！！</strong></em><br>可以把 i 标签改为块级元素，用margin居中</p><h5 id="响应式布局！！的关键：媒体查询（c3支持）响应式布局为了适配pc端和移动端的"><a href="#响应式布局！！的关键：媒体查询（c3支持）响应式布局为了适配pc端和移动端的" class="headerlink" title="响应式布局！！的关键：媒体查询（c3支持）响应式布局为了适配pc端和移动端的?"></a>响应式布局！！的关键：媒体查询（c3支持）响应式布局为了适配pc端和移动端的?</h5><p>在响应式布局中不能使用flex布局<br>能根据屏幕宽度的不同，去加载对应的css代码段</p><p>语法：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span>(<span class="attribute">width</span>:<span class="number">800px</span>)&#123;</span><br><span class="line"><span class="comment">/*只有width：800px可以改，其他不变*/</span></span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">        <span class="attribute">background</span>：<span class="selector-id">#000</span>；</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span>(<span class="attribute">min-width</span>:<span class="number">800px</span>)&#123;</span><br><span class="line"><span class="comment">/*屏幕宽大于800px时执行*/</span></span><br><span class="line">    <span class="selector-tag">body</span>&#123;</span><br><span class="line">        <span class="attribute">background</span>：<span class="selector-id">#000</span>；</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span>(<span class="attribute">min-width</span>:<span class="number">800px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">900px</span>)&#123;</span><br><span class="line"><span class="comment">/*屏幕宽大于800px,小于900px时执行*/</span></span><br><span class="line">    <span class="selector-tag">body</span>&#123;</span><br><span class="line">        <span class="attribute">background</span>：<span class="selector-id">#000</span>；</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Array-高阶函数"><a href="#Array-高阶函数" class="headerlink" title="Array 高阶函数"></a>Array 高阶函数</h4><ol><li><p><strong>forEach(遍历)</strong></p><p> forEach() 方法用于调用数组的每个元素，并将元素传递给回调函数。(没有返回值，将数组遍历)</p><p> 注意: forEach() 对于空数组是不会执行回调函数的。</p><p> 回调函数参数：</p><p> currentValue  必需。当前元素；</p><p> index  可选。当前元素的索引值；</p><p> arr  可选。当前元素所属的数组对象。</p></li><li><p><strong>filter(过滤，返回新数组)</strong></p><p> filter() 方法创建一个新的数组，新数组中的元素是通过检查指定数组中符合条件的所有元素。</p><p> 注意： filter() 不会对空数组进行检测。</p><p> 注意： filter() 不会改变原始数组。</p><p> 回调函数参数：</p><p> currentValue  必需。当前元素； </p><p> index  可选。当前元素的索引值； </p><p> arr  可选。当前元素所属的数组对象。</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ages = [<span class="number">32</span>, <span class="number">33</span>, <span class="number">16</span>, <span class="number">40</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ages.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> item &gt; <span class="number">18</span>;<span class="comment">//返回判断条件为真的数组元素</span></span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">//输出[32,33,40]</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p><strong>map(映射，返回新数组)</strong></p><p> map() 方法返回一个新数组，数组中的元素为原始数组元素调用函数处理后的值。</p><p> map() 方法按照原始数组元素顺序依次处理元素。</p><p> 注意： map() 不会对空数组进行检测。</p><p> 注意： map() 不会改变原始数组。</p><p> 回调函数参数：</p><p> currentValue  必需。当前元素； </p><p> index  可选。当前元素的索引值； </p><p> arr  可选。当前元素所属的数组对象。</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">65</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">4</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(numbers.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> item * <span class="number">10</span>;</span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">//输出[650,440,120,40]</span></span><br></pre></td></tr></table></figure><pre><code>**es5手动实现一下**</code></pre> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">myMap</span>(<span class="params">cb, obj</span>)&#123;</span><br><span class="line">    <span class="comment">// map()不会对空数组进行检测</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">length</span> == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//不改变原数组，不暴露原数组给调用者</span></span><br><span class="line">    <span class="keyword">var</span> _this = <span class="variable language_">this</span>.<span class="title function_">slice</span>();</span><br><span class="line">        <span class="keyword">var</span> arr = [];</span><br><span class="line">        <span class="comment">//如果第二个参数没传，默认是全局对象</span></span><br><span class="line">        obj ? <span class="literal">null</span> : obj = <span class="variable language_">window</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;_this.<span class="property">length</span>; i++)&#123;</span><br><span class="line">        arr.<span class="title function_">push</span>(cb.<span class="title function_">call</span>(obj, _this[i], i, _this));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myMap</span> = myMap;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="string">``</span><span class="string">`   </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">4. **every(判断是否全部元素符合条件，返回布尔值)**</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    every() 方法用于检测数组所有元素是否都符合指定条件（通过函数提供）。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    every() 方法使用指定函数检测数组中的所有元素：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    如果数组中检测到有一个元素不满足，则整个表达式返回 false ，且剩余的元素不会再进行检测。</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    如果所有元素都满足条件，则返回 true。</span></span><br><span class="line"><span class="string">    注意： every() 不会对空数组进行检测。</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    注意： every() 不会改变原始数组。</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    回调函数参数：</span></span><br><span class="line"><span class="string">    currentValue  必需。当前元素；</span></span><br><span class="line"><span class="string">    index  可选。当前元素的索引值；</span></span><br><span class="line"><span class="string">    arr  可选。当前元素所属的数组对象。</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="variable constant_">JS</span></span><br><span class="line"><span class="keyword">var</span> ages = [<span class="number">32</span>, <span class="number">33</span>, <span class="number">16</span>, <span class="number">40</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ages.<span class="title function_">every</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> item &gt; <span class="number">18</span>;</span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">//输出false</span></span><br></pre></td></tr></table></figure><ol start="5"><li><p><strong>reduce(累加)</strong><br> reduce() 方法接收一个函数作为累加器，数组中的每个值（从左到右）开始缩减，最终计算为一个值。</p><p> reduce() 可以作为一个高阶函数，用于函数的 compose。</p><p> 注意: reduce() 对于空数组是不会执行回调函数的。</p><p> 回调函数参数：<br> total  必需。初始值, 或者计算结束后的返回值；<br> currentValue  必需。当前元素；<br> index  可选。当前元素的索引值；<br> arr  可选。当前元素所属的数组对象。</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [&#123;<span class="attr">price</span>:<span class="number">30</span>,<span class="attr">count</span>:<span class="number">2</span>&#125;,&#123;<span class="attr">price</span>:<span class="number">40</span>,<span class="attr">count</span>:<span class="number">3</span>&#125;,&#123;<span class="attr">price</span>:<span class="number">50</span>,<span class="attr">count</span>:<span class="number">5</span>&#125;];</span><br><span class="line"><span class="comment">//当数组元素为引用类型时需要注意</span></span><br><span class="line"><span class="keyword">var</span> sum = arr.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> x.<span class="property">price</span>*x.<span class="property">count</span> + y.<span class="property">price</span>*y.<span class="property">count</span>;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum)</span><br><span class="line"><span class="comment">//输出NaN</span></span><br><span class="line"><span class="comment">//正确应该为</span></span><br><span class="line"><span class="keyword">var</span> sum = arr.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">x,y</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> x + y.<span class="property">price</span>*y.<span class="property">count</span>;</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum)</span><br><span class="line"><span class="comment">//输出430</span></span><br></pre></td></tr></table></figure><p><strong>es5手动实现一下</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">myReduce</span>(<span class="params">cb, initValue</span>)&#123;</span><br><span class="line">    <span class="comment">//不对空数组进行检测</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">length</span> == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//不改变原数组，不暴露原数组给调用者</span></span><br><span class="line">        <span class="keyword">var</span> arr = <span class="variable language_">this</span>.<span class="title function_">slice</span>();</span><br><span class="line">        <span class="keyword">var</span> startIndex = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//如果有传第二个参数，则从索引为0开始遍历，否则initValue = arr[0]从索引为1开始遍历</span></span><br><span class="line">        initValue ? startIndex = <span class="number">0</span> : initValue = arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=startIndex; i&lt;arr.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            initValue = <span class="title function_">cb</span>(initValue, arr[i], i, arr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> initValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myReduce</span> = myReduce;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><ol start="6"><li><p><strong>some(判断是否含有符合条件的元素，返回布尔值)</strong></p><p> some() 方法用于检测数组中的元素是否满足指定条件（函数提供）。</p><p> some() 方法会依次执行数组的每个元素：</p><p> 如果有一个元素满足条件，则表达式返回true , 剩余的元素不会再执行检测。<br> 如果没有满足条件的元素，则返回false。</p><p> 注意： some() 不会对空数组进行检测。</p><p> 注意： some() 不会改变原始数组。</p><p> 回调函数参数：<br> currentValue  必需。当前元素；<br> index  可选。当前元素的索引值；<br> arr  可选。当前元素所属的数组对象。</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ages = [<span class="number">3</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">20</span>];</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ages.<span class="title function_">some</span>(<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> item &gt; <span class="number">28</span>;</span><br><span class="line">&#125;))</span><br><span class="line"><span class="comment">//输出false</span></span><br></pre></td></tr></table></figure><h4 id="node-一些脚本"><a href="#node-一些脚本" class="headerlink" title="node 一些脚本"></a>node 一些脚本</h4><h4 id="深度读取文件内的所有文件名"><a href="#深度读取文件内的所有文件名" class="headerlink" title="深度读取文件内的所有文件名"></a>深度读取文件内的所有文件名</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> join = path.<span class="property">join</span></span><br><span class="line"><span class="keyword">const</span> regx = <span class="regexp">/\.vue$/</span></span><br><span class="line"><span class="keyword">const</span> lessRegx = <span class="regexp">/\.less$/</span></span><br><span class="line"><span class="keyword">let</span> url = <span class="title function_">join</span>(__dirname, <span class="string">&#x27;/views&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDirs</span>(<span class="params">path</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> dirs = []</span><br><span class="line"><span class="keyword">let</span> files = fs.<span class="title function_">readdirSync</span>(path)</span><br><span class="line"><span class="comment">// console.log(files);</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="keyword">if</span>(lessRegx.<span class="title function_">test</span>(files[i])) <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">if</span> (!regx.<span class="title function_">test</span>(files[i])) &#123;</span><br><span class="line"><span class="keyword">let</span> nextUrl = <span class="title function_">join</span>(path, <span class="string">`/<span class="subst">$&#123;files[i]&#125;</span>`</span>)</span><br><span class="line"><span class="comment">// console.log(nextUrl, &#x27;false&#x27;);</span></span><br><span class="line">dirs = [...dirs, ...<span class="title function_">getDirs</span>(nextUrl)]</span><br><span class="line"><span class="comment">// console.log(files[i], &#x27;files============&#x27;)</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// console.log(files[i], &#x27;true&#x27;);</span></span><br><span class="line">dirs.<span class="title function_">push</span>(files[i])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> dirs</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(regx.test(&#x27;Login.vue&#x27;),&#x27;+++&#x27;)</span></span><br><span class="line"><span class="title function_">getDirs</span>(url)</span><br><span class="line"><span class="comment">// console.log(getDirs(url))</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="处理a链接下载视频，txt等文件会自动打开的问题"><a href="#处理a链接下载视频，txt等文件会自动打开的问题" class="headerlink" title="处理a链接下载视频，txt等文件会自动打开的问题"></a>处理a链接下载视频，txt等文件会自动打开的问题</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 关键部分后端设置响应头proxyResponse.headers[&#x27;Content-Disposition&#x27;] = &#x27;attachment;filename=test.mp4&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用到代理是因为视频的链接是在腾讯云无法设置  需要转发一下</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> postData = querystring.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">  <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;你好世界&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  <span class="attr">hostname</span>: <span class="string">&#x27;1500002279.vod2.myqcloud.com&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">80</span>,</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/6c9892fcvodcq1500002279/e2b9bed05285890809008953732/f0.mp4&#x27;</span>,</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  <span class="comment">// headers: &#123;</span></span><br><span class="line">  <span class="comment">//   &#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;,</span></span><br><span class="line">  <span class="comment">//   &#x27;Content-Length&#x27;: Buffer.byteLength(postData)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Access-Control-Allow-Method&#x27;</span>, <span class="string">&#x27;GET,POST&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>)</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/getVideo&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> proxy = http.<span class="title function_">request</span>(options, <span class="function">(<span class="params">proxyResponse</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`状态码: <span class="subst">$&#123;res.statusCode&#125;</span>`</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`响应头: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(res.headers)&#125;</span>`</span>);</span><br><span class="line">      <span class="comment">// res.setEncoding(&#x27;utf8&#x27;);</span></span><br><span class="line">      proxyResponse.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// console.log(`响应主体: $&#123;chunk&#125;`);</span></span><br><span class="line">        res.<span class="title function_">write</span>(chunk, <span class="string">&#x27;binary&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">      proxyResponse.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;响应中已无数据&#x27;</span>);</span><br><span class="line">        res.<span class="title function_">end</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">      proxyResponse.<span class="property">headers</span>[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment;filename=test.mp4&#x27;</span></span><br><span class="line">      res.<span class="title function_">writeHead</span>(proxyResponse.<span class="property">statusCode</span>, proxyResponse.<span class="property">headers</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    proxy.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`请求遇到问题: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//data只有当请求体数据进来时才会触发</span></span><br><span class="line">    <span class="comment">//尽管没有请求体数据进来，data还是要写，否则不会触发end事件</span></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">chunk</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;in request length:&#x27;</span>, chunk.<span class="property">length</span>);</span><br><span class="line">      proxy.<span class="title function_">write</span>(chunk, <span class="string">&#x27;binary&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//向proxy发送求情，这里end方法必须被调用才能发起代理请求</span></span><br><span class="line">      <span class="comment">//所有的客户端请求都需要通过end来发起</span></span><br><span class="line">      proxy.<span class="title function_">end</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.<span class="property">url</span> === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    <span class="title function_">readStaticFile</span>(res)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.<span class="property">url</span> === <span class="string">&#x27;/favicon.ico&#x27;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;error url&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8090</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">readStaticFile</span>(<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="comment">// 读取对应路径的文件</span></span><br><span class="line">  fs.<span class="title function_">readFile</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;index.html&#x27;</span>), <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 找不到文件则返回404</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&quot;404&quot;</span>);</span><br><span class="line">    <span class="comment">// res.end来返回上面读取的内容</span></span><br><span class="line">    res.<span class="title function_">end</span>(data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过a链接直接访问接口即可--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;down&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://localhost:8090/getVideo&quot;</span>&gt;</span>下载1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="整理-node-sass-安装失败的原因及解决办法"><a href="#整理-node-sass-安装失败的原因及解决办法" class="headerlink" title="整理 node-sass 安装失败的原因及解决办法"></a>整理 node-sass 安装失败的原因及解决办法</h4><p>直接使用 <code>cnpm</code> 或者使用淘宝镜像源</p><blockquote><p>npm i node-sass –sass_binary_site&#x3D;<a href="https://npm.taobao.org/mirrors/node-sass/">https://npm.taobao.org/mirrors/node-sass/</a></p></blockquote><p>全局镜像</p><blockquote><p>npm config set sass_binary_site <a href="https://npm.taobao.org/mirrors/node-sass/">https://npm.taobao.org/mirrors/node-sass/</a></p></blockquote><p>也可以设置系统环境变量的方式。示例<br>linux、mac 下</p><blockquote><p>SASS_BINARY_SITE&#x3D;<a href="https://npm.taobao.org/mirrors/node-sass/">https://npm.taobao.org/mirrors/node-sass/</a> npm install node-sass</p></blockquote><p> window 下</p><blockquote><p>set SASS_BINARY_SITE&#x3D;<a href="https://npm.taobao.org/mirrors/node-sass/">https://npm.taobao.org/mirrors/node-sass/</a> &amp;&amp; npm install node-sass</p></blockquote><p><strong>注意：</strong> 安装失败后重装需要先 <code>uninstall</code> 再安装</p><h4 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h4><blockquote><p>使用qs  get请求传数组</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span></span><br><span class="line">request.<span class="title function_">get</span>(<span class="string">&#x27;/standingBook/workOrderPlan/pageList&#x27;</span>, &#123;</span><br><span class="line">    params,</span><br><span class="line">    <span class="attr">paramsSerializer</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> qs.<span class="title function_">stringify</span>(data, &#123; <span class="attr">arrayFormat</span>: <span class="string">&#x27;repeat&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><code>Content-Type&#39;: &#39;application/x-www-form-urlencoded; charset=UTF-8</code> 参数格式 a&#x3D;1&amp;b&#x3D;2</p></blockquote><p><img src="https://gitee.com/hisai/image-bed/raw/master/axios-format/forn-urlcode.jpg" alt="image"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span></span><br><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api.esac&#125;</span>/uniformExchangeDetails/getCleanTotalNum`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: qs.<span class="title function_">stringify</span>(data, &#123; <span class="attr">indices</span>: <span class="literal">false</span> &#125;)，</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">`Content-Type&#x27;: &#x27;application/x-www-form-urlencoded; charset=UTF-8`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><blockquote><p><code>multipart/form-data</code> 参数格式 <strong>多用于文件上传使用</strong> <code>new FormData()</code><br><img src="https://gitee.com/hisai/image-bed/raw/master/axios-format/formdata.jpg" alt="image"></p></blockquote><blockquote><p><code>json</code> </p></blockquote><p><img src="https://gitee.com/hisai/image-bed/raw/master/axios-format/json.jpg" alt="image"></p><h4 id="跨页面通信"><a href="#跨页面通信" class="headerlink" title="跨页面通信"></a>跨页面通信</h4><p><strong>1. 回调函数</strong></p><p><code>index1.html</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">cb</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;回调&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;index2.html&#x27;</span>, <span class="string">&#x27;_blank&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>index2.html</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">opener</span>.<span class="property">cb</span> &amp;&amp; <span class="variable language_">window</span>.<span class="property">opener</span>.<span class="title function_">cb</span>()</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">close</span>()</span><br></pre></td></tr></table></figure><p><strong>2. postmessage</strong></p><p><code>index1.html</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">&#123; data, origin, source &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (origin !== <span class="variable language_">window</span>.<span class="property">loaction</span>.<span class="property">host</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;index2.html&#x27;</span>, <span class="string">&#x27;_blank&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>index2.html</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;&#125;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">opener</span>.<span class="title function_">postMessage</span>(data, <span class="variable language_">window</span>.<span class="property">opener</span>.<span class="property">loaction</span>.<span class="property">origin</span>)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">close</span>()</span><br></pre></td></tr></table></figure><p><strong>3. storage 通过监听本地存储实现</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">addEventListener</span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;storage&quot;</span>, handleStorage, <span class="literal">false</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">attachEvent</span>(<span class="string">&quot;onstorage&quot;</span>, handleStorage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4. vue $bus</strong></p><ol><li>新建<code>modules.js</code></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vue</span></span><br></pre></td></tr></table></figure><p><code>index1.html</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> middleUtils <span class="keyword">from</span> <span class="string">&#x27;./middleUtil.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line">middleUtils.$on(<span class="string">&#x27;getData&#x27;</span>,  <span class="function">(<span class="params">data</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到消息&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>index2.html</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> middleUtils <span class="keyword">from</span> <span class="string">&#x27;./middleUtil.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line">middleUtils.$emit(<span class="string">&#x27;getData&#x27;</span>,<span class="string">&#x27;data&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="iframe-通信-（postmessage）"><a href="#iframe-通信-（postmessage）" class="headerlink" title="iframe 通信 （postmessage）"></a>iframe 通信 （postmessage）</h4><p><code>index1.html</code> 子页面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">parent</span>.<span class="title function_">postMessage</span>(</span><br><span class="line">    &#123; <span class="attr">code</span>: <span class="number">0</span>, <span class="attr">msg</span>: <span class="string">&quot;修改成功&quot;</span>, <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">allData</span> &#125;,</span><br><span class="line">    <span class="string">&quot;*&quot;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>index2.html</code> 父级页面（引入iframe）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">iframe</span>.<span class="property">contentWindow</span>.<span class="property">parent</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// console.log(&#x27;onMessage--&gt;&gt;&#x27;, data)</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> axios </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scss</title>
      <link href="/hisai3.github.io/2023/01/14/Scss/"/>
      <url>/hisai3.github.io/2023/01/14/Scss/</url>
      
        <content type="html"><![CDATA[<h2 id="Scss"><a href="#Scss" class="headerlink" title="Scss"></a>Scss</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>scss定义变量很简单就是加个 $ ,可以写在{} 内也可以不写，代表着全局变量和局部变量</p><p><strong>项目中想全局使用需要配置</strong></p><blockquote><ol><li>使用 <code>sass-resources-loader</code></li><li><a href="https://github.com/staven630/vue-cli4-config#log">vue-cli中配置scss全局变量</a></li></ol></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$width</span>:<span class="number">5px</span>;</span><br><span class="line"><span class="selector-class">.main</span>&#123;</span><br><span class="line">    <span class="variable">$heigth</span>：<span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">width</span>:<span class="variable">$width</span>;</span><br><span class="line">    <span class="selector-class">.child</span>&#123;</span><br><span class="line">        heigth:heigth;</span><br><span class="line">        <span class="attribute">width</span>:<span class="variable">$width</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="插值语句"><a href="#插值语句" class="headerlink" title="插值语句"></a>插值语句</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$name</span>: foo;</span><br><span class="line"><span class="variable">$attr</span>: border;</span><br><span class="line"><span class="selector-tag">p</span>.#&#123;<span class="variable">$name</span>&#125; &#123;</span><br><span class="line">  #&#123;<span class="variable">$attr</span>&#125;-<span class="attribute">color</span>: blue;</span><br><span class="line">  <span class="variable">$font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="variable">$line-height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">font</span>: #&#123;<span class="variable">$font-size</span>&#125;/#&#123;<span class="variable">$line-height</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="map-get-amp-maps"><a href="#map-get-amp-maps" class="headerlink" title="map-get()  &amp; maps"></a>map-get()  &amp; maps</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maps</span></span><br><span class="line"><span class="variable">$social-colors</span>: (</span><br><span class="line">    dribble: <span class="number">#ea4c89</span>,</span><br><span class="line">    facebook: <span class="number">#3b5998</span>,</span><br><span class="line">    github: <span class="number">#171515</span>,</span><br><span class="line">    google: <span class="number">#db4437</span>,</span><br><span class="line">    twitter: <span class="number">#55acee</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设要获取 facebook 键值对应的值 #3b5998，我们就可以使用 map-get() 函数来实现：</span></span><br><span class="line"><span class="selector-class">.btn-dribble</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">map-get</span>(<span class="variable">$social-colors</span>,facebook);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译后</span></span><br><span class="line"><span class="selector-class">.btn-dribble</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#3b5998</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="extend-指令"><a href="#extend-指令" class="headerlink" title="@extend 指令"></a>@extend 指令</h3><p><strong>在编译的时候，scss会在合并样式的时候，避免重复的css</strong></p><blockquote><p> % 占位符: 编译结果 % 实际时使用 extend 继承的类</p></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.error</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="keyword">@extend</span> .error;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line"><span class="selector-class">.error</span>, <span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果.error 只是用于extend, 可以用 % 占位符</span></span><br><span class="line">%error &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="keyword">@extend</span> %error;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果 .seriousError 替代了 %error</span></span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#f00</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fdd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.seriousError</span> &#123;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="each指令"><a href="#each指令" class="headerlink" title="@each指令"></a>@each指令</h3><p><strong>动态生成类名</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$colors</span>: (</span><br><span class="line">  blue: <span class="number">#008fff</span>,</span><br><span class="line">  grey: <span class="number">#909299</span>,</span><br><span class="line">  orange: <span class="number">#fa8c16</span>,</span><br><span class="line">  red: <span class="number">#fe5951</span>,</span><br><span class="line">  green: <span class="number">#2ac66a</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">@each</span> <span class="variable">$name</span>, <span class="variable">$color</span> in <span class="variable">$colors</span> &#123;</span><br><span class="line">     &amp;.#&#123;<span class="variable">$name</span>&#125; &#123;</span><br><span class="line">       <span class="selector-class">.label</span> &#123;</span><br><span class="line">         &amp;<span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">           <span class="attribute">background-color</span>: <span class="variable">$color</span>;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.</span></span><br><span class="line"><span class="keyword">@each</span> <span class="variable">$var</span> in(left,center,right)&#123;</span><br><span class="line">    <span class="selector-class">.text-</span>#&#123;<span class="variable">$var</span>&#125;&#123;</span><br><span class="line"><span class="attribute">text-align</span>:<span class="variable">$var</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.text-left</span>&#123;</span><br><span class="line">    <span class="attribute">text-align</span><span class="selector-pseudo">:left</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text-center</span>&#123;</span><br><span class="line">    <span class="attribute">text-align</span>:center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text-right</span>&#123;</span><br><span class="line">    <span class="attribute">text-align</span><span class="selector-pseudo">:right</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mixin指令"><a href="#mixin指令" class="headerlink" title="@mixin指令"></a>@mixin指令</h3><p><strong>生成不同方向的三角形</strong></p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个三角的函数 实现不同方向的三角加兼容ie6</span></span><br><span class="line"><span class="comment">//第一个参数传入方向</span></span><br><span class="line"><span class="comment">//第二个参数传入大小</span></span><br><span class="line"><span class="comment">//第三个参数传入颜色</span></span><br><span class="line"><span class="comment">//注意:传入参数中间必须逗号分隔</span></span><br><span class="line"><span class="keyword">@mixin</span> triangle(<span class="variable">$x</span>, <span class="variable">$y</span>:<span class="number">10px</span>, <span class="variable">$z</span>:white )&#123;</span><br><span class="line">    <span class="keyword">@if</span> <span class="variable">$x</span> == <span class="string">&quot;top&quot;</span>&#123;</span><br><span class="line">        <span class="attribute">border-width</span>: <span class="variable">$y</span>;</span><br><span class="line">        <span class="attribute">border-color</span>:transparent transparent <span class="variable">$z</span> transparent;</span><br><span class="line">        <span class="attribute">border-style</span>: dashed dashed solid dashed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@else</span> if <span class="variable">$x</span> == <span class="string">&quot;bottom&quot;</span>&#123;</span><br><span class="line">        <span class="attribute">border-width</span>: <span class="variable">$y</span>;</span><br><span class="line">        <span class="attribute">border-color</span>: <span class="variable">$z</span> transparent transparent transparent;</span><br><span class="line">        <span class="attribute">border-style</span>: solid dashed dashed dashed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@else</span> if <span class="variable">$x</span> == <span class="string">&quot;left&quot;</span>&#123;</span><br><span class="line">        <span class="attribute">border-width</span>: <span class="variable">$y</span>;</span><br><span class="line">        <span class="attribute">border-color</span>:transparent <span class="variable">$z</span> transparent transparent;</span><br><span class="line">        <span class="attribute">border-style</span>: dashed solid dashed dashed;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@else</span> if <span class="variable">$x</span> == <span class="string">&quot;right&quot;</span>&#123;</span><br><span class="line">        <span class="attribute">border-width</span>: <span class="variable">$y</span>;</span><br><span class="line">        <span class="attribute">border-color</span>:transparent transparent transparent <span class="variable">$z</span>;</span><br><span class="line">        <span class="attribute">border-style</span>: dashed dashed dashed solid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="keyword">@include</span> triangle(right, <span class="number">200px</span>, red);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="变量拼接"><a href="#变量拼接" class="headerlink" title="变量拼接"></a>变量拼接</h3><p><code>#&#123;$animal&#125;</code>表示变量，后面直接连接想要的字符串</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sass style</span></span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line"><span class="variable">$animal-list</span>: puma, sea-slug, egret, salamander;</span><br><span class="line"><span class="keyword">@each</span> <span class="variable">$animal</span> in <span class="variable">$animal-list</span> &#123;</span><br><span class="line">  .#&#123;<span class="variable">$animal</span>&#125;-<span class="attribute">icon</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/#&#123;$animal&#125;.png&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//css style</span></span><br><span class="line"><span class="comment">//-------------------------------</span></span><br><span class="line"><span class="selector-class">.puma-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/puma.png&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sea-slug-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/sea-slug.png&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.egret-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/egret.png&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.salamander-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/salamander.png&#x27;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="主题色"><a href="#主题色" class="headerlink" title="主题色"></a>主题色</h3><blockquote><p>方案一</p></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成主题类名</span></span><br><span class="line"><span class="keyword">@mixin</span> theme(<span class="variable">$name</span>, <span class="variable">$color</span>) &#123;</span><br><span class="line">    <span class="selector-class">.theme-</span>#&#123;<span class="variable">$name</span>&#125; &#123;</span><br><span class="line">        <span class="selector-class">.theme-color-</span>#&#123;<span class="variable">$name</span>&#125; &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="variable">$color</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.theme-border-color-</span>#&#123;<span class="variable">$name</span>&#125; &#123;</span><br><span class="line">            <span class="attribute">border-color</span>: <span class="variable">$color</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.theme-bgcolor-</span>#&#123;<span class="variable">$name</span>&#125; &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="variable">$color</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题色</span></span><br><span class="line"><span class="variable">$theme-list</span>: (</span><br><span class="line">  blue: <span class="variable">$theme-color-blue</span>,</span><br><span class="line">  grey: <span class="variable">$theme-color-grey</span>,</span><br><span class="line">  orange: <span class="variable">$theme-color-orange</span>,</span><br><span class="line">  red: <span class="variable">$theme-color-red</span>,</span><br><span class="line">  green: <span class="variable">$theme-color-green</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 循环生成不同主题</span></span><br><span class="line"><span class="keyword">@echo</span> <span class="variable">$name</span>, <span class="variable">$color</span> in <span class="variable">$theme-list</span> &#123;</span><br><span class="line">    <span class="keyword">@includes</span> theme(<span class="variable">$name</span>, <span class="variable">$color</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>方案二</p></blockquote><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img_base_url</span>: <span class="string">&quot;./&quot;</span>;</span><br><span class="line"><span class="variable">$img_time</span>: <span class="string">&quot;Snipaste_2021-12-07_22-42-45.png&quot;</span>;</span><br><span class="line"><span class="variable">$themes</span>: (</span><br><span class="line">    light: (</span><br><span class="line">        //字体</span><br><span class="line">        base_color: <span class="number">#414141</span>,</span><br><span class="line">        font_color2: white,</span><br><span class="line">        </span><br><span class="line">        //背景</span><br><span class="line">        base_bg_color: <span class="number">#fff</span>,</span><br><span class="line">        background_color2: <span class="number">#f0f2f5</span>,</span><br><span class="line">        background_color3: red,</span><br><span class="line">        background_color4: <span class="number">#2674e7</span>,</span><br><span class="line">        </span><br><span class="line">        //边框</span><br><span class="line">        base_border_color: <span class="number">#3d414a</span>,</span><br><span class="line">        bgurl: <span class="built_in">url</span>(<span class="string">&#x27;./Snipaste_2021-12-07_22-42-45.png&#x27;</span>),</span><br><span class="line"></span><br><span class="line">        icon_time: <span class="built_in">url</span>(<span class="string">&#x27;#&#123;$img_base_url&#125;#&#123;$img_time&#125;&#x27;</span>)</span><br><span class="line">    ),</span><br><span class="line">    </span><br><span class="line">    dark: (</span><br><span class="line">        //字体</span><br><span class="line">        base_color: <span class="number">#a7a7a7</span>,</span><br><span class="line">        font_color2: white,</span><br><span class="line">        </span><br><span class="line">        //背景</span><br><span class="line">        base_bg_color: <span class="number">#1b2531</span>,</span><br><span class="line">        background_color2: <span class="number">#283142</span>,</span><br><span class="line">        background_color3: <span class="number">#1e6ceb</span>,</span><br><span class="line">        background_color4: <span class="number">#323e4e</span>,</span><br><span class="line">    </span><br><span class="line">        //边框</span><br><span class="line">        base_border_color: <span class="number">#3d414a</span>,</span><br><span class="line">        bgurl: <span class="built_in">url</span>(<span class="string">&#x27;./Snipaste_2021-12-07_22-42-45.png&#x27;</span>),</span><br><span class="line">        icon_time: <span class="built_in">url</span>(<span class="string">&#x27;#&#123;$img_base_url&#125;#&#123;$img_time&#125;&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历主题map</span></span><br><span class="line"><span class="keyword">@mixin</span> themeify &#123;</span><br><span class="line">    <span class="keyword">@each</span> <span class="variable">$theme-name</span>, <span class="variable">$theme-map</span> in <span class="variable">$themes</span> &#123;</span><br><span class="line">        <span class="comment">//!global 把局部变量强升为全局变量</span></span><br><span class="line">        <span class="variable">$theme-map</span>: <span class="variable">$theme-map</span> !global;</span><br><span class="line">        <span class="comment">//判断html的data-theme的属性值  #&#123;&#125;是sass的插值表达式</span></span><br><span class="line">        <span class="comment">//&amp; sass嵌套里的父容器标识   @content是混合器插槽，像vue的slot</span></span><br><span class="line">        <span class="selector-attr">[data-theme=<span class="string">&quot;#&#123;$theme-name&#125;&quot;</span>]</span> &amp; &#123;</span><br><span class="line">            <span class="keyword">@content</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明一个根据Key获取颜色的function</span></span><br><span class="line"><span class="keyword">@function</span> themed(<span class="variable">$key</span>) &#123;</span><br><span class="line">    <span class="keyword">@return</span> map-get(<span class="variable">$theme-map</span>, <span class="variable">$key</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取背景颜色</span></span><br><span class="line"><span class="keyword">@mixin</span> background_<span class="attribute">color</span>(<span class="variable">$color</span>: <span class="string">&quot;base_bg_color&quot;</span>, <span class="variable">$important</span>: false) &#123;</span><br><span class="line">    <span class="keyword">@include</span> themeify &#123;</span><br><span class="line">        <span class="keyword">@if</span> <span class="variable">$important</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="built_in">themed</span>(<span class="variable">$color</span>) <span class="meta">!important</span>;</span><br><span class="line">        &#125; <span class="keyword">@else</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: <span class="built_in">themed</span>(<span class="variable">$color</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="keyword">@content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取字体颜色</span></span><br><span class="line"><span class="keyword">@mixin</span> font_<span class="attribute">color</span>(<span class="variable">$color</span>: <span class="string">&quot;base_color&quot;</span>, <span class="variable">$important</span>: false) &#123;</span><br><span class="line">    <span class="keyword">@include</span> themeify &#123;</span><br><span class="line">        <span class="keyword">@if</span> <span class="variable">$important</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="built_in">themed</span>(<span class="variable">$color</span>) <span class="meta">!important</span>;</span><br><span class="line">        &#125; <span class="keyword">@else</span> &#123;</span><br><span class="line">            <span class="attribute">color</span>: <span class="built_in">themed</span>(<span class="variable">$color</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="keyword">@content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取边框颜色</span></span><br><span class="line"><span class="keyword">@mixin</span> border_<span class="attribute">color</span>(<span class="variable">$color</span>: <span class="string">&quot;base_border_color&quot;</span>, <span class="variable">$important</span>: false) &#123;</span><br><span class="line">    <span class="keyword">@include</span> themeify &#123;</span><br><span class="line">        <span class="keyword">@if</span> <span class="variable">$important</span> &#123;</span><br><span class="line">            <span class="attribute">border-color</span>: <span class="built_in">themed</span>(<span class="variable">$color</span>) <span class="meta">!important</span>;</span><br><span class="line">        &#125; <span class="keyword">@else</span> &#123;</span><br><span class="line">            <span class="attribute">border-color</span>: <span class="built_in">themed</span>(<span class="variable">$color</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="keyword">@content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取背景图</span></span><br><span class="line"><span class="keyword">@mixin</span> bg_image(<span class="variable">$url</span>, <span class="variable">$important</span>: false) &#123;</span><br><span class="line">    <span class="keyword">@include</span> themeify &#123;</span><br><span class="line">        <span class="keyword">@if</span> <span class="variable">$important</span> &#123;</span><br><span class="line">            <span class="attribute">background-image</span>: <span class="built_in">themed</span>(<span class="variable">$url</span>) <span class="meta">!important</span>;</span><br><span class="line">        &#125; <span class="keyword">@else</span> &#123;</span><br><span class="line">            <span class="attribute">background-image</span>: <span class="built_in">themed</span>(<span class="variable">$url</span>);</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="keyword">@content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .box2 会替代 %bg-color</span></span><br><span class="line">%bg-<span class="attribute">color</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> background_<span class="attribute">color</span>()</span><br><span class="line">&#125;</span><br><span class="line">.bd-color &#123;</span><br><span class="line">    <span class="keyword">@include</span> bg_image(<span class="string">&#x27;icon_time&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">.box2 &#123;</span><br><span class="line">    <span class="keyword">@include</span> font_<span class="attribute">color</span>();</span><br><span class="line">    <span class="keyword">@extend</span> %bg-color;</span><br><span class="line">    <span class="keyword">@extend</span> .bd-color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="selector-class">.common-util</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">18px</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多次 include 编译会有很多重复的类（不会编译出&quot;,&quot;选择器, 最好使用 @extend）</span></span><br><span class="line">    <span class="keyword">@include</span> font_<span class="attribute">color</span>(<span class="string">&quot;font_color1&quot;</span>);</span><br><span class="line">    <span class="keyword">@include</span> background_<span class="attribute">color</span>(<span class="string">&quot;background_color1&quot;</span>);</span><br><span class="line">    <span class="keyword">@include</span> border_<span class="attribute">color</span>(<span class="string">&quot;border_color1&quot;</span>);</span><br><span class="line">    <span class="comment">// extend</span></span><br><span class="line">    <span class="comment">// @extend .bg-color;</span></span><br><span class="line">    <span class="comment">// @extend .bd-color;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bg-color</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> background_<span class="attribute">color</span>(<span class="string">&quot;background_color1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bd-color</span> &#123;</span><br><span class="line">    <span class="keyword">@include</span> border_<span class="attribute">color</span>(<span class="string">&quot;border_color1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方案三</p><p><code>webpack-theme-color-replacer</code></p><p><a href="https://www.npmjs.com/package/webpack-theme-color-replacer/v/1.2.17">npm</a><br><a href="https://www.cnblogs.com/jiaoshou/p/16178580.html">参考1</a><br><a href="https://blog.csdn.net/pnjtvxcp/article/details/108141255">参考2</a><br><a href="https://www.jianshu.com/p/10a9fe676145">element-ui</a><br><a href="https://blog.csdn.net/qq_39172655/article/details/123006896">ant-design-vue</a></p><blockquote><p>npm i -D webpack-theme-color-replacer</p></blockquote><p><code>vue.config.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeColorReplacer</span> = <span class="built_in">require</span>(<span class="string">&#x27;webpack-theme-color-replacer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">configureWebpack</span>: <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThemeColorReplacer</span>(&#123;</span><br><span class="line"><span class="comment">// 需要提取到css文件的颜色数组（可以传入多个颜色值），支持rgb和hsl,也就是换肤改变颜色的变量</span></span><br><span class="line"> <span class="attr">matchColors</span>: [<span class="string">&#x27;#9564ca&#x27;</span>],</span><br><span class="line"><span class="comment">//可选.输出css文件名，支持[contenthash]和[hash]</span></span><br><span class="line"><span class="attr">fileName</span>: <span class="string">&#x27;css/theme-colors-[contenthash:8].css&#x27;</span>,</span><br><span class="line"> <span class="comment">// 可选的。将 css 文本注入 js 文件，不再需要下载 `theme-colors-xxx.css`。</span></span><br><span class="line"><span class="attr">injectCss</span>: <span class="literal">true</span>, </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模板内修改主题</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item-0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// const client = require(&#x27;webpack-theme-color-replacer/client&#x27;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> client <span class="keyword">from</span> <span class="string">&quot;webpack-theme-color-replacer/client&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 这里就直接5秒后换色了，模拟了用户点击一次换肤的过程</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">changeThemeColor</span>(<span class="string">&#x27;#69af23&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">5000</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置css新值，点击换肤时候会获取到新的颜色值，然后调用这个方法就行了</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeThemeColor</span>(<span class="params">newColor</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// newColors必须是个数组形式，数组长度一定要和配置中的matchColors长度一致，否则缺少的颜色就会出现问题</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// sass里的lighten貌似是使用hsl颜色增加亮度。 varyColor.js   里面的lighten、darke其实是将当前颜色与白色进行混合，与element-ui的色系一致。</span></span></span><br><span class="line"><span class="language-javascript">      client.<span class="property">changer</span>.<span class="title function_">changeColor</span>(&#123; <span class="attr">newColors</span>: [<span class="string">&#x27;&#x27;</span>+newColor] &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 基础色</span><br><span class="line">$color: #9564ca;</span><br><span class="line">.item&#123;</span><br><span class="line">  height: 30px;</span><br><span class="line">  margin-top: 4px;</span><br><span class="line">&#125;</span><br><span class="line">.item-0 &#123;</span><br><span class="line">  background: $color; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> Scss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue插槽</title>
      <link href="/hisai3.github.io/2023/01/14/Vue%E6%8F%92%E6%A7%BD/"/>
      <url>/hisai3.github.io/2023/01/14/Vue%E6%8F%92%E6%A7%BD/</url>
      
        <content type="html"><![CDATA[<h2 id="Vue插槽"><a href="#Vue插槽" class="headerlink" title="Vue插槽"></a>Vue插槽</h2><p>定义 <code>navigation-link </code>组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span>啦啦啦啦啦了--这是默认内容<span class="tag">&lt;/<span class="name">slot</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">navigation-link</span> <span class="attr">url</span>=<span class="string">&quot;/profile&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 添加一个 Font Awesome 图标 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  Your Profile</span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation-link</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 如果 &lt;navigation-link&gt; 没有包含一个 &lt;slot&gt; 元素，则该组件起始标签和结束标签之间的任何内容都会被抛弃。 --&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>具名插槽</p><p>定义 <code>&lt;base-layout&gt;</code>  组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 我们希望把页头放这里 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name 默认为 default --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 我们希望把页脚放这里 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>向具名插槽提供内容，可以在一个 <code>&lt;template&gt;</code> 元素上使用 <code>v-slot</code> 指令，并以 <code>v-slot</code> 的参数的形式提供其名称</p><p><strong>v-slot 只能添加在 <template> 上</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">base-layout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Here might be a page title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 任何没有被包裹在带有 v-slot 的 &lt;template&gt; 中的内容都会被视为默认插槽的内容。 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>A paragraph for the main content.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>And another one.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">base-layout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>作用域插槽</p><p>定义<code>&lt;current-user&gt;</code> 组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span>&#123;&#123; user.lastName &#125;&#125;<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">current-user</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- user 实在current-user 中定义的 在父组件使用时无法获取 --&gt;</span></span><br><span class="line">  &#123;&#123; user.firstName &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">current-user</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 解决： 修改子组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">v-bind:user</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; user.lastName &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 解决： 使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">current-user</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span>=<span class="string">&quot;slotProps&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; slotProps.user.firstName &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">current-user</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>v-slot</strong> 必须在template上使用</p><p><strong>slot-scope</strong> 可以不在template上使用</p><h4 id="在render-中使用slot"><a href="#在render-中使用slot" class="headerlink" title="在render 中使用slot"></a>在render 中使用slot</h4><p><strong>使用场景:</strong> 在二次封装<code>u-table组件</code>时，多表头的<strong>递归列</strong>中的<code>slot</code>只能使用到第一层</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scopedSlots 的使用相当于在调用组件时插入插槽的实际内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// $scopedSlots 相当于作用域插槽参数即slot绑定的数据  前提时在调用组件时有使用slot</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;CusColumn&#x27;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">column</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">treeNode</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; column, treeNode &#125; = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getChild</span> = (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> data.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !item.<span class="property">isShow</span> ? (</span><br><span class="line">          <span class="language-xml"><span class="tag">&lt;<span class="name">u-table-column</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">prop</span>=<span class="string">&#123;</span> <span class="attr">item.prop</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">label</span>=<span class="string">&#123;</span> <span class="attr">item.label</span> === <span class="string">&#x27;-&#x27;</span> ? &#x27;<span class="attr">完成时间</span>&#x27; <span class="attr">:</span> <span class="attr">item.label</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">align</span>=<span class="string">&#123;</span> <span class="attr">item.align</span> || &#x27;<span class="attr">center</span>&#x27; &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">fixed</span>=<span class="string">&#123;</span> <span class="attr">item.fixed</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">width</span>=<span class="string">&#123;</span> <span class="attr">item.width</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">min-width</span>=<span class="string">&#123;</span> <span class="attr">item.mWidth</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">treeNode</span>=<span class="string">&#123;</span> <span class="attr">treeNode</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">show-overflow-tooltip</span>=<span class="string">&#123;</span> <span class="attr">true</span> &#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">scopedSlots</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">default:</span> (&#123; <span class="attr">row</span>, $<span class="attr">index</span>, <span class="attr">column</span> &#125;) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                return item.isTemplate &amp;&amp; this.$scopedSlots[item.prop]</span></span><br><span class="line"><span class="language-xml">                  ? this.$scopedSlots[item.prop](&#123; row, $index, column &#125;)</span></span><br><span class="line"><span class="language-xml">                  : (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#123;item.prop&#125;</span>&gt;</span>&#123; row[item.prop] &#125;<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                  )</span></span><br><span class="line"><span class="language-xml">              &#125;</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            &#123;</span></span><br><span class="line"><span class="language-xml">              ...getChild(item.children || [])</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">u-table-column</span>&gt;</span></span></span><br><span class="line">        ) : <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getChild</span>([column])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>解析</p><p>父组件设置 slot</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="keyword">const</span> slotName = <span class="string">&#x27;topbar&#x27;</span> || <span class="string">&#x27;default&#x27;</span></span><br><span class="line">   <span class="keyword">const</span> scopeSlotChild = <span class="variable language_">this</span>.<span class="property">$slots</span>[slotName]</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> &#123; scopeSlotChild &#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">   )</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>父组件设置 slot-scope</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> scopedSlots = &#123;</span><br><span class="line">        <span class="comment">// 默认插槽</span></span><br><span class="line">        <span class="attr">default</span>: <span class="function"><span class="params">slotProps</span> =&gt;</span> [ <span class="language-xml"><span class="tag">&lt;<span class="name">Cmp</span> <span class="attr">slotprops</span>=<span class="string">&#123;slotprops&#125;</span> /&gt;</span></span> ],</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 具名插槽</span></span><br><span class="line">        <span class="attr">footer</span>:  <span class="function"><span class="params">slotProps</span> =&gt;</span> [ <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">slotprops</span>=<span class="string">&#123;slotprops&#125;</span> /&gt;</span></span> ]</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>子组件获取 slotProps</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent </span><br><span class="line">    &#123; ...&#123;</span><br><span class="line">         <span class="attr">scopedSlots</span>: &#123;</span><br><span class="line">            <span class="attr">default</span>: <span class="function"><span class="params">scope</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;this.scope.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&gt;</span><br><span class="line">&lt;/parent&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue指令 v-model</title>
      <link href="/hisai3.github.io/2023/01/14/Vue%E6%8C%87%E4%BB%A4%20v-model/"/>
      <url>/hisai3.github.io/2023/01/14/Vue%E6%8C%87%E4%BB%A4%20v-model/</url>
      
        <content type="html"><![CDATA[<h2 id="Vue指令-v-model"><a href="#Vue指令-v-model" class="headerlink" title="Vue指令 v-model"></a>Vue指令 v-model</h2><p>Vue自定义组件使用 <code>v-model</code></p><ol><li>方式一 v-model 的本质 <code>value</code>属性  <code>input</code>事件</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">tabs</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> []</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">value</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">onChange</span>(<span class="params">index</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;input&#x27;</span>, index)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父组件中使用</span></span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">tab</span> <span class="attr">v-model</span>=<span class="string">&quot;current&quot;</span> /&gt;</span></span></span><br><span class="line">     </span><br></pre></td></tr></table></figure><ol start="2"><li>官方文档提供方法</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">model</span>: &#123;</span><br><span class="line">    <span class="attr">prop</span>: <span class="string">&#x27;checked&#x27;</span>, <span class="comment">// 设置响应属性</span></span><br><span class="line">    <span class="attr">event</span>: <span class="string">&#x27;change&#x27;</span>  <span class="comment">// 必须派发一个‘event’定义的事件</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">checked</span>: <span class="title class_">Boolean</span> <span class="comment">// 必须有 model.prop 定义的属性</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">onChange</span>(<span class="params">index</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;change&#x27;</span>, index)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 父组件中使用</span></span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">tab</span> <span class="attr">v-model</span>=<span class="string">&quot;current&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Vue指令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Echarts Y轴配置</title>
      <link href="/hisai3.github.io/2023/01/14/Y%E8%BD%B4%E9%85%8D%E7%BD%AE/"/>
      <url>/hisai3.github.io/2023/01/14/Y%E8%BD%B4%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>单位, <span class="comment">// 名称</span></span><br><span class="line">    <span class="attr">show</span>: <span class="literal">true</span>,    <span class="comment">// 是否显示 y 轴</span></span><br><span class="line">    <span class="attr">position</span>: <span class="string">&#x27;top&#x27;</span>,    <span class="comment">// y 轴的位置（&#x27;top&#x27;，&#x27;bottom&#x27;） </span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,    <span class="comment">// 坐标轴类型</span></span><br><span class="line">    <span class="attr">nameLocation</span>: <span class="string">&#x27;end&#x27;</span>,     <span class="comment">// 坐标轴名称显示位置</span></span><br><span class="line">    <span class="attr">nameGap</span>: <span class="number">15</span>,     <span class="comment">// 坐标轴名称与轴线之间的距离</span></span><br><span class="line">    <span class="attr">nameRotate</span>: <span class="number">10</span>,    <span class="comment">// 坐标轴名字旋转，角度值</span></span><br><span class="line">    <span class="attr">inverse</span>: <span class="literal">false</span>,    <span class="comment">// 是否是反向坐标轴</span></span><br><span class="line">    <span class="attr">nameTextStyle</span>: &#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="string">&#x27;#333&#x27;</span>,     <span class="comment">// 坐标轴名称的颜色</span></span><br><span class="line">        <span class="attr">fontStyle</span>: <span class="string">&#x27;normal&#x27;</span>,    <span class="comment">// 文字字体的风格（&#x27;normal&#x27;，无样式；&#x27;italic&#x27;，斜体；&#x27;oblique&#x27;，倾斜字体） </span></span><br><span class="line">        <span class="attr">fontWeight</span>: <span class="string">&#x27;normal&#x27;</span>,    <span class="comment">// 文字字体的粗细（&#x27;normal&#x27;，无样式；&#x27;bold&#x27;，加粗；&#x27;bolder&#x27;，加粗的基础上再加粗；&#x27;lighter&#x27;，变细；数字定义粗细也可以，取值范围100至700）</span></span><br><span class="line">        <span class="attr">fontSize</span>: <span class="string">&#x27;20&#x27;</span>,    <span class="comment">// 文字字体大小</span></span><br><span class="line">        <span class="attr">align</span>: <span class="string">&#x27;left&#x27;</span>,     <span class="comment">// 文字水平对齐方式，默认自动（&#x27;left&#x27;，&#x27;center&#x27;，&#x27;right&#x27;）</span></span><br><span class="line">        <span class="attr">verticalAlign</span>: <span class="string">&#x27;left&#x27;</span>,    <span class="comment">// 文字垂直对齐方式，默认自动（&#x27;top&#x27;，&#x27;middle&#x27;，&#x27;bottom&#x27;</span></span><br><span class="line">        <span class="attr">lineHeight</span>: <span class="string">&#x27;50&#x27;</span>,    <span class="comment">// 行高 ）</span></span><br><span class="line">        <span class="attr">backgroundColor</span>: <span class="string">&#x27;red&#x27;</span>,    <span class="comment">// 文字块背景色，例：&#x27;#123234&#x27;, &#x27;red&#x27;, &#x27;rgba(0,23,11,0.3)&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">axisLine</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,    <span class="comment">// 是否显示坐标轴轴线</span></span><br><span class="line">        <span class="attr">symbol</span>: [<span class="string">&#x27;none&#x27;</span>, <span class="string">&#x27;arrow&#x27;</span>],     <span class="comment">// 轴线两端箭头，两个值，none表示没有箭头，arrow表示有箭头</span></span><br><span class="line">        <span class="attr">symbolSize</span>: [<span class="number">10</span>, <span class="number">15</span>],     <span class="comment">// 轴线两端箭头大小，数值一表示宽度，数值二表示高度</span></span><br><span class="line">        <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#333&#x27;</span>,    <span class="comment">// 坐标轴线线的颜色</span></span><br><span class="line">            <span class="attr">width</span>: <span class="string">&#x27;5&#x27;</span>,    <span class="comment">// 坐标轴线线宽</span></span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;solid&#x27;</span>,     <span class="comment">// 坐标轴线线的类型（&#x27;solid&#x27;，实线类型；&#x27;dashed&#x27;，虚线类型；&#x27;dotted&#x27;,点状类型）</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">axisTick</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,    <span class="comment">// 是否显示坐标轴刻度</span></span><br><span class="line">        <span class="attr">inside</span>: <span class="literal">true</span>,     <span class="comment">// 坐标轴刻度是否朝内，默认朝外</span></span><br><span class="line">        <span class="attr">length</span>: <span class="number">5</span>,    <span class="comment">// 坐标轴刻度的长度</span></span><br><span class="line">        <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#FFF&#x27;</span>,     <span class="comment">// 刻度线的颜色</span></span><br><span class="line">            <span class="attr">width</span>: <span class="number">10</span>,    <span class="comment">// 坐标轴刻度线宽</span></span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;solid&#x27;</span>,     <span class="comment">// 坐标轴线线的类型（&#x27;solid&#x27;，实线类型；&#x27;dashed&#x27;，虚线类型；&#x27;dotted&#x27;,点状类型）</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,     <span class="comment">// 是否显示刻度标签</span></span><br><span class="line">        <span class="attr">interval</span>: <span class="string">&#x27;0&#x27;</span>,    <span class="comment">// 坐标轴刻度标签的显示间隔，在类目轴中有效.0显示所有</span></span><br><span class="line">        <span class="attr">inside</span>: <span class="literal">true</span>,    <span class="comment">// 刻度标签是否朝内，默认朝外</span></span><br><span class="line">        <span class="attr">rotate</span>: <span class="number">90</span>,    <span class="comment">// 刻度标签旋转的角度，在类目轴的类目标签显示不下的时候可以通过旋转防止标签之间重叠；旋转的角度从 -90 度到 90 度</span></span><br><span class="line">        <span class="attr">margin</span>: <span class="number">10</span>,    <span class="comment">// 刻度标签与轴线之间的距离</span></span><br><span class="line">        <span class="comment">// formatter 刻度标签的内容格式器，支持字符串模板和回调函数两种形式</span></span><br><span class="line">        <span class="attr">color</span>: <span class="string">&#x27;#FFF&#x27;</span>,     <span class="comment">// 刻度标签文字的颜色</span></span><br><span class="line">        <span class="attr">fontStyle</span>: <span class="string">&#x27;normal&#x27;</span>,    <span class="comment">// 文字字体的风格（&#x27;normal&#x27;，无样式；&#x27;italic&#x27;，斜体；&#x27;oblique&#x27;，倾斜字体） </span></span><br><span class="line">        <span class="attr">fontWeight</span>: <span class="string">&#x27;normal&#x27;</span>,    <span class="comment">// 文字字体的粗细（&#x27;normal&#x27;，无样式；&#x27;bold&#x27;，加粗；&#x27;bolder&#x27;，加粗的基础上再加粗；&#x27;lighter&#x27;，变细；数字定义粗细也可以，取值范围100至700）</span></span><br><span class="line">        <span class="attr">fontSize</span>: <span class="string">&#x27;20&#x27;</span>,    <span class="comment">// 文字字体大小</span></span><br><span class="line">        <span class="attr">align</span>: <span class="string">&#x27;left&#x27;</span>,     <span class="comment">// 文字水平对齐方式，默认自动（&#x27;left&#x27;，&#x27;center&#x27;，&#x27;right&#x27;）</span></span><br><span class="line">        <span class="attr">verticalAlign</span>: <span class="string">&#x27;left&#x27;</span>,    <span class="comment">// 文字垂直对齐方式，默认自动（&#x27;top&#x27;，&#x27;middle&#x27;，&#x27;bottom&#x27;</span></span><br><span class="line">        <span class="attr">lineHeight</span>: <span class="string">&#x27;50&#x27;</span>,    <span class="comment">// 行高 ）</span></span><br><span class="line">        <span class="attr">backgroundColor</span>: <span class="string">&#x27;red&#x27;</span>,    <span class="comment">// 文字块背景色，例：&#x27;#123234&#x27;, &#x27;red&#x27;, &#x27;rgba(0,23,11,0.3)&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">splitLine</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,    <span class="comment">// 是否显示分隔线。默认数值轴显示，类目轴不显示</span></span><br><span class="line">        <span class="attr">interval</span>: <span class="string">&#x27;0&#x27;</span>,    <span class="comment">// 坐标轴刻度标签的显示间隔，在类目轴中有效.0显示所有</span></span><br><span class="line">        <span class="attr">color</span>: [<span class="string">&#x27;#ccc&#x27;</span>],    <span class="comment">// 分隔线颜色，可以设置成单个颜色，也可以设置成颜色数组，分隔线会按数组中颜色的顺序依次循环设置颜色</span></span><br><span class="line">        <span class="attr">width</span>: <span class="number">3</span>,    <span class="comment">// 分隔线线宽</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;solid&#x27;</span>,     <span class="comment">// 坐标轴线线的类型（&#x27;solid&#x27;，实线类型；&#x27;dashed&#x27;，虚线类型；&#x27;dotted&#x27;,点状类型）</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">splitArea</span>: &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,    <span class="comment">// 是否显示分隔区域</span></span><br><span class="line">        <span class="attr">interval</span>: <span class="string">&#x27;0&#x27;</span>,    <span class="comment">// 坐标轴刻度标签的显示间隔，在类目轴中有效.0显示所有</span></span><br><span class="line">        <span class="attr">areaStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: [<span class="string">&#x27;rgba(250,250,250,0.3)&#x27;</span>,<span class="string">&#x27;rgba(200,200,200,0.3)&#x27;</span>],    <span class="comment">// 分隔区域颜色。分隔区域会按数组中颜色的顺序依次循环设置颜色。默认是一个深浅的间隔色</span></span><br><span class="line">            <span class="attr">opacity</span>: <span class="number">1</span>,    <span class="comment">// 图形透明度。支持从 0 到 1 的数字，为 0 时不绘制该图形</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">textStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#FFF&#x27;</span>,     <span class="comment">// 文字的颜色</span></span><br><span class="line">            <span class="attr">fontStyle</span>: <span class="string">&#x27;normal&#x27;</span>,    <span class="comment">// 文字字体的风格（&#x27;normal&#x27;，无样式；&#x27;italic&#x27;，斜体；&#x27;oblique&#x27;，倾斜字体） </span></span><br><span class="line">            <span class="attr">fontWeight</span>: <span class="string">&#x27;normal&#x27;</span>,    <span class="comment">// 文字字体的粗细（&#x27;normal&#x27;，无样式；&#x27;bold&#x27;，加粗；&#x27;bolder&#x27;，加粗的基础上再加粗；&#x27;lighter&#x27;，变细；数字定义粗细也可以，取值范围100至700）</span></span><br><span class="line">            <span class="attr">fontSize</span>: <span class="string">&#x27;20&#x27;</span>,    <span class="comment">// 文字字体大小</span></span><br><span class="line">            <span class="attr">align</span>: <span class="string">&#x27;left&#x27;</span>,     <span class="comment">// 文字水平对齐方式，默认自动（&#x27;left&#x27;，&#x27;center&#x27;，&#x27;right&#x27;）</span></span><br><span class="line">            <span class="attr">verticalAlign</span>: <span class="string">&#x27;left&#x27;</span>,    <span class="comment">// 文字垂直对齐方式，默认自动（&#x27;top&#x27;，&#x27;middle&#x27;，&#x27;bottom&#x27;</span></span><br><span class="line">            <span class="attr">lineHeight</span>: <span class="string">&#x27;50&#x27;</span>,    <span class="comment">// 行高 ）</span></span><br><span class="line">            <span class="attr">backgroundColor</span>: <span class="string">&#x27;red&#x27;</span>,    <span class="comment">// 文字块背景色，例：&#x27;#123234&#x27;, &#x27;red&#x27;, &#x27;rgba(0,23,11,0.3)&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Echarts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Echarts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>client,screen,page,offset的区别</title>
      <link href="/hisai3.github.io/2023/01/14/client,screen,page,offset%E7%9A%84%E5%8C%BA%E5%88%AB%20/"/>
      <url>/hisai3.github.io/2023/01/14/client,screen,page,offset%E7%9A%84%E5%8C%BA%E5%88%AB%20/</url>
      
        <content type="html"><![CDATA[<h4 id="offsetX-clientX-pageX-screenX"><a href="#offsetX-clientX-pageX-screenX" class="headerlink" title="offsetX, clientX, pageX, screenX"></a>offsetX, clientX, pageX, screenX</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        * &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">5000px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background</span>: chocolate;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span>bb<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 如果没有滚动条 三个都一样</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// client 以页面的可视区域为参照 跟滚动条没关系</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// offset 以页面的当前点击元素的内容(content + padding)为参照</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// page 以页面的html为参照</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// screen 以电脑屏幕为参照</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;e--&gt;&gt;&gt;&gt;&#x27;</span>, e.<span class="property">pageY</span>, e.<span class="property">offsetY</span>, e.<span class="property">clientY</span>, e.<span class="property">screenY</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>图解</strong><br><img src="https://gitee.com/hisai/image-bed/raw/master/offsetX.png" alt="offsetX"></p>]]></content>
      
      
      <categories>
          
          <category> 随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css实现table表头和列固定功能</title>
      <link href="/hisai3.github.io/2023/01/14/css%E5%AE%9E%E7%8E%B0table%E8%A1%A8%E5%A4%B4%E5%92%8C%E5%88%97%E5%9B%BA%E5%AE%9A%E5%8A%9F%E8%83%BD/"/>
      <url>/hisai3.github.io/2023/01/14/css%E5%AE%9E%E7%8E%B0table%E8%A1%A8%E5%A4%B4%E5%92%8C%E5%88%97%E5%9B%BA%E5%AE%9A%E5%8A%9F%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<p>核心 <code>position: sticky;</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.table</span>&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">overflow</span>:auto;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>:<span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>:<span class="number">300px</span>; <span class="comment">/* 固定高度 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">table</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-collapse</span>:separate;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">table-layout</span>: fixed;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>; <span class="comment">/* 固定寬度 */</span></span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">td</span>, <span class="selector-tag">th</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-right</span> :<span class="number">1px</span> solid <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-bottom</span> :<span class="number">1px</span> solid <span class="number">#999</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">      <span class="comment">/* 单元格宽高 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>:<span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>:<span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">th</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>:lightblue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 控制左边固定的核心代码 */</span></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">td</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>),</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">th</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>:sticky;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>:<span class="number">0</span>; <span class="comment">/* 首行在左 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>:<span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>:lightpink;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">td</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>),</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">th</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>:sticky;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>:<span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>:<span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>:lightpink;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="comment">/* 控制表头固定的核心代码 */</span></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">thead</span> <span class="selector-tag">tr</span> <span class="selector-tag">th</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>:sticky;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>:<span class="number">0</span>; <span class="comment">/* 第一列最上 */</span></span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">th</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>),</span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">th</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>)&#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>:<span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>:lightblue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>表头1<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>表头2<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>表头3<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>表头4<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>表头5<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> &gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>我的高度不固定我的高度不固定我的高度不固定我的高度不固定我的高度不固定我的高度不固定<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>drag指令</title>
      <link href="/hisai3.github.io/2023/01/14/drag%E6%8C%87%E4%BB%A4/"/>
      <url>/hisai3.github.io/2023/01/14/drag%E6%8C%87%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h5 id="方式一："><a href="#方式一：" class="headerlink" title="方式一："></a>方式一：</h5><p><strong>项目实际使用</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">directives</span>: &#123;</span><br><span class="line">    <span class="attr">drag</span>: &#123;</span><br><span class="line">        <span class="comment">// 指令的定义</span></span><br><span class="line">        <span class="attr">bind</span>: <span class="function"><span class="params">el</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> selector = binding.<span class="property">value</span></span><br><span class="line">            <span class="keyword">const</span> draggable = el.<span class="title function_">getAttribute</span>(<span class="string">&#x27;draggable&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> (draggable !== <span class="string">&#x27;true&#x27;</span>) <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">const</span> id = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">const</span> dragEl = selector ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(selector) : el</span><br><span class="line">              el.<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&#x27;default&#x27;</span></span><br><span class="line">              el.<span class="property">onmousedown</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> rect = dragEl.<span class="title function_">getBoundingClientRect</span>()</span><br><span class="line">                <span class="comment">// el-diaglog 使用了transform 居中</span></span><br><span class="line">                <span class="keyword">const</span> minTop = selector.<span class="title function_">includes</span>(<span class="string">&#x27;el-dialog&#x27;</span>) ? <span class="number">40</span> + rect.<span class="property">height</span> / <span class="number">2</span> : <span class="number">0</span></span><br><span class="line">                <span class="keyword">const</span> disX = e.<span class="property">clientX</span> - dragEl.<span class="property">offsetLeft</span></span><br><span class="line">                <span class="keyword">const</span> disY = e.<span class="property">clientY</span> - dragEl.<span class="property">offsetTop</span></span><br><span class="line">                <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="keyword">const</span> left = e.<span class="property">clientX</span> - disX</span><br><span class="line">                  <span class="keyword">const</span> top = (e.<span class="property">clientY</span> - disY)</span><br><span class="line">                  dragEl.<span class="property">style</span>.<span class="property">left</span> = left + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">                  dragEl.<span class="property">style</span>.<span class="property">top</span> = <span class="string">`<span class="subst">$&#123;(minTop &amp;&amp; top &lt;= minTop) ? minTop : top&#125;</span>px`</span></span><br><span class="line">                  dragEl.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="literal">null</span></span><br><span class="line">                  <span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="literal">null</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">              &#125;</span><br><span class="line">              <span class="built_in">clearTimeout</span>(id)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>v-drag 最好是放在自定义的header上，这样只有拖动头部才能移动<br><strong>注意：</strong><br>v-drag: 当前使用元素即为<strong>拖拽触发元素</strong><br>v-drag的value: 是<code>css selector</code> <strong>被拖拽移动的元素</strong>, 没有值即为当前拖拽触发元素<br>draggable: true: 可拖拽 false: 不可拖拽</p><p><strong>然后直接在需要拖拽的dialog上使用v-drag属性</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">title</span>=<span class="string">&quot;dialog&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:visible.sync</span>=<span class="string">&quot;dialogVisible&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">width</span>=<span class="string">&quot;900px&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-drag</span>=<span class="string">&quot;.el-dialog&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">    &lt;.../&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="方式二："><a href="#方式二：" class="headerlink" title="方式二："></a>方式二：</h5><p><strong>（未验证）</strong><br>这里<strong>注意</strong>，因为拖拽的坐标都是直接按px计算的，所以如果dialog宽度使用百分比，拖拽时会导致dialog发生<strong>变形</strong>，需要使用固定宽度</p><p>下面还有一个全局配置<code>dialog</code>拖拽的方式，推荐使用以下方法:<br>建立directives.js文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// v-dialogDrag: 弹窗拖拽属性</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;drag&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">bind</span>(<span class="params">el, binding, vnode, oldVnode</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dialogHeaderEl = el.<span class="title function_">querySelector</span>(<span class="string">&#x27;.el-dialog__header&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> dragDom = el.<span class="title function_">querySelector</span>(<span class="string">&#x27;.el-dialog&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    dialogHeaderEl.<span class="property">style</span>.<span class="property">cssText</span> += <span class="string">&#x27;;cursor:move;&#x27;</span></span><br><span class="line">    dragDom.<span class="property">style</span>.<span class="property">cssText</span> += <span class="string">&#x27;;top:0px;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取原有属性 ie dom元素.currentStyle 火狐谷歌 window.getComputedStyle(dom元素, null);</span></span><br><span class="line">    <span class="keyword">const</span> sty = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">document</span>.<span class="property">currentStyle</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params">dom, attr</span>) =&gt;</span> dom.<span class="property">currentStyle</span>[attr];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params">dom, attr</span>) =&gt;</span> <span class="title function_">getComputedStyle</span>(dom, <span class="literal">false</span>)[attr];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)()</span><br><span class="line"></span><br><span class="line">    dialogHeaderEl.<span class="property">onmousedown</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 鼠标按下，计算当前元素距离可视区的距离</span></span><br><span class="line">      <span class="keyword">const</span> disX = e.<span class="property">clientX</span> - dialogHeaderEl.<span class="property">offsetLeft</span>;</span><br><span class="line">      <span class="keyword">const</span> disY = e.<span class="property">clientY</span> - dialogHeaderEl.<span class="property">offsetTop</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> screenWidth = <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span>; <span class="comment">// body当前宽度</span></span><br><span class="line">      <span class="keyword">const</span> screenHeight = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>; <span class="comment">// 可见区域高度(应为body高度，可某些环境下无法获取)</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> dragDomWidth = dragDom.<span class="property">offsetWidth</span>; <span class="comment">// 对话框宽度</span></span><br><span class="line">      <span class="keyword">const</span> dragDomheight = dragDom.<span class="property">offsetHeight</span>; <span class="comment">// 对话框高度</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> minDragDomLeft = dragDom.<span class="property">offsetLeft</span>;</span><br><span class="line">      <span class="keyword">const</span> maxDragDomLeft = screenWidth - dragDom.<span class="property">offsetLeft</span> - dragDomWidth;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> minDragDomTop = dragDom.<span class="property">offsetTop</span>;</span><br><span class="line">      <span class="keyword">const</span> maxDragDomTop = screenHeight - dragDom.<span class="property">offsetTop</span> - dragDomheight;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取到的值带px 正则匹配替换</span></span><br><span class="line">      <span class="keyword">let</span> styL = <span class="title function_">sty</span>(dragDom, <span class="string">&#x27;left&#x27;</span>);</span><br><span class="line">      <span class="keyword">let</span> styT = <span class="title function_">sty</span>(dragDom, <span class="string">&#x27;top&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 注意在ie中 第一次获取到的值为组件自带50% 移动之后赋值为px</span></span><br><span class="line">      <span class="keyword">if</span> (styL.<span class="title function_">includes</span>(<span class="string">&#x27;%&#x27;</span>)) &#123;</span><br><span class="line">        styL = +<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span> * (+styL.<span class="title function_">replace</span>(<span class="regexp">/\%/g</span>, <span class="string">&#x27;&#x27;</span>) / <span class="number">100</span>);</span><br><span class="line">        styT = +<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> * (+styT.<span class="title function_">replace</span>(<span class="regexp">/\%/g</span>, <span class="string">&#x27;&#x27;</span>) / <span class="number">100</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        styL = +styL.<span class="title function_">replace</span>(<span class="regexp">/\px/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        styT = +styT.<span class="title function_">replace</span>(<span class="regexp">/\px/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="comment">// 通过事件委托，计算移动的距离</span></span><br><span class="line">        <span class="keyword">let</span> left = e.<span class="property">clientX</span> - disX;</span><br><span class="line">        <span class="keyword">let</span> top = e.<span class="property">clientY</span> - disY;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 边界处理</span></span><br><span class="line">        <span class="keyword">if</span> (-(left) &gt; minDragDomLeft) &#123;</span><br><span class="line">          left = -(minDragDomLeft);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (left &gt; maxDragDomLeft) &#123;</span><br><span class="line">          left = maxDragDomLeft;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (-(top) &gt; minDragDomTop) &#123;</span><br><span class="line">          top = -(minDragDomTop);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (top &gt; maxDragDomTop) &#123;</span><br><span class="line">          top = maxDragDomTop;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 移动当前元素</span></span><br><span class="line">        dragDom.<span class="property">style</span>.<span class="property">cssText</span> += <span class="string">`;left:<span class="subst">$&#123;left + styL&#125;</span>px;top:<span class="subst">$&#123;top + styT&#125;</span>px;`</span>;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="literal">null</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>main.js内引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./directives&#x27;</span></span><br></pre></td></tr></table></figure><p>在需要使用的地方，直接使用v-drag属性即可</p><pre><code class="html">&lt;el-dialog title=&quot;dialog&quot;           :visible.sync=&quot;dialogVisible&quot;           v-drag&gt;    &lt;.../&gt;&lt;/el-dialog&gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Vue指令 </tag>
            
            <tag> drag </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>antv填坑</title>
      <link href="/hisai3.github.io/2023/01/14/antv%E5%A1%AB%E5%9D%91/"/>
      <url>/hisai3.github.io/2023/01/14/antv%E5%A1%AB%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h4 id="处理table固定列出现白色间隙"><a href="#处理table固定列出现白色间隙" class="headerlink" title="处理table固定列出现白色间隙"></a>处理table固定列出现白色间隙</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> w = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.ant-table-fixed-columns-in-body&#x27;</span>).<span class="property">clientWidth</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.ant-table-fixed-right .ant-table-fixed&#x27;</span>).<span class="property">style</span>.<span class="property">width</span> = w + <span class="string">&#x27;px&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> w = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.ant-table-fixed-columns-in-body&#x27;</span>).<span class="property">clientWidth</span> </span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.ant-table-fixed-right .ant-table-fixed&#x27;</span>).<span class="property">style</span>.<span class="property">width</span> = w + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue UI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> antV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>el-table 合计行放在首行</title>
      <link href="/hisai3.github.io/2023/01/14/el-table%20%E5%90%88%E8%AE%A1%E8%A1%8C%E6%94%BE%E5%9C%A8%E9%A6%96%E8%A1%8C/"/>
      <url>/hisai3.github.io/2023/01/14/el-table%20%E5%90%88%E8%AE%A1%E8%A1%8C%E6%94%BE%E5%9C%A8%E9%A6%96%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h4 id="el-table-合计行放在首行"><a href="#el-table-合计行放在首行" class="headerlink" title="el-table 合计行放在首行"></a>el-table 合计行放在首行</h4><p>添加以下两行CSS，即可将合计行放在第一行：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* /deep/ 为深度操作符，可以穿透到子组件 */</span></span><br><span class="line">/deep/ .<span class="property">el</span>-table &#123;</span><br><span class="line">  <span class="attr">display</span>: flex;</span><br><span class="line">  flex-<span class="attr">direction</span>: column;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* order默认值为0，只需将表体order置为1即可移到最后，这样合计行就上移到表体上方 */</span></span><br><span class="line">/deep/ .<span class="property">el</span>-table__body-wrapper &#123;</span><br><span class="line">  <span class="attr">order</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意表格不要设置 fixed 属性，会有样式冲突。如果确实要启用 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fixed 属性，需再添加以下两行<span class="variable constant_">CSS</span>作为补偿修复：</span><br><span class="line"></span><br><span class="line">/ 表格启用 fixed 属性后，样式会错乱，下面<span class="number">2</span>句是补偿修复 /</span><br><span class="line"><span class="regexp">/deep/</span> .<span class="property">el</span>-table__fixed-body-wrapper &#123;</span><br><span class="line"><span class="attr">top</span>: 96px !important;</span><br><span class="line">&#125;</span><br><span class="line">/deep/ .<span class="property">el</span>-table__fixed-footer-wrapper &#123;</span><br><span class="line">z-<span class="attr">index</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 合计行点击事件</span></span><br><span class="line"><span class="keyword">let</span> self = <span class="variable language_">this</span>;</span><br><span class="line"><span class="keyword">let</span> table = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.el-table__footer-wrapper&gt;table&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.$nextTick(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    table.<span class="property">rows</span>[<span class="number">0</span>].<span class="property">cells</span>[<span class="number">7</span>].<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">        self.<span class="property">outLog</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue UI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> element UI </tag>
            
            <tag> el-table </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>el-table 合并单元格</title>
      <link href="/hisai3.github.io/2023/01/14/el-table%20%E5%90%88%E5%B9%B6%E5%8D%95%E5%85%83%E6%A0%BC/"/>
      <url>/hisai3.github.io/2023/01/14/el-table%20%E5%90%88%E5%B9%B6%E5%8D%95%E5%85%83%E6%A0%BC/</url>
      
        <content type="html"><![CDATA[<h3 id="el-table-合并单元格"><a href="#el-table-合并单元格" class="headerlink" title="el-table 合并单元格"></a>el-table 合并单元格</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">    colArr,</span></span><br><span class="line"><span class="params">    list</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> allProps = [];</span><br><span class="line">    colArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">props, index</span>) =&gt;</span> &#123;</span><br><span class="line">        allProps.<span class="title function_">push</span>(...props);</span><br><span class="line">        list = <span class="title function_">getLevel</span>(props, allProps, list);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//组装层</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getLevel</span>(<span class="params">props, allProps, list</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> rowKey = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> item <span class="keyword">of</span> list) &#123;</span><br><span class="line">        <span class="keyword">let</span> propInfo = <span class="title function_">getPropStr</span>(allProps, item);</span><br><span class="line">        <span class="keyword">if</span> (rowKey[propInfo.<span class="property">key</span>]) &#123;</span><br><span class="line">            rowKey[propInfo.<span class="property">key</span>].<span class="property">children</span>.<span class="title function_">push</span>(item);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> obj = propInfo;</span><br><span class="line">            obj.<span class="property">children</span> = [item];</span><br><span class="line">            rowKey[propInfo.<span class="property">key</span>] = obj;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;propStr.toString()--&gt;&gt;&gt;&gt;&#x27;</span>, rowKey)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> info = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> rowKey) &#123;</span><br><span class="line">        rowKey[key].<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">                item = <span class="title class_">Object</span>.<span class="title function_">assign</span>(</span><br><span class="line">                    item,</span><br><span class="line">                    <span class="title function_">getMergeInfo</span>(props, rowKey[key].<span class="property">children</span>.<span class="property">length</span>)</span><br><span class="line">                );</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                item = <span class="title class_">Object</span>.<span class="title function_">assign</span>(item, <span class="title function_">getMergeInfo</span>(props, <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            info.<span class="title function_">push</span>(item);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取合并信息</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getMergeInfo</span>(<span class="params">props, num</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">    props.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        obj[item + <span class="string">&quot;_merge&quot;</span>] = &#123;</span><br><span class="line">            <span class="attr">rowspan</span>: num,</span><br><span class="line">            <span class="attr">colspan</span>: <span class="number">1</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">RandomId</span> = len =&gt; <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">3</span>, len);</span><br><span class="line"><span class="comment">// 把属性的值拼接在⼀起,并和属性的值⼀起返回。</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPropStr</span>(<span class="params">props, info</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> propStr = props.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        obj[item] = info[item];</span><br><span class="line">        <span class="keyword">return</span> info[item] !== <span class="number">0</span> &amp;&amp; !info[item] ? <span class="title class_">RandomId</span>(<span class="number">8</span>) : info[item];</span><br><span class="line">    &#125;);</span><br><span class="line">    obj.<span class="property">key</span> = propStr.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// span-method合并函数：</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">objectSpanMethod</span>(<span class="params">&#123; row, column, rowIndex, columnIndex &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (row[column.<span class="property">property</span> + <span class="string">&quot;_merge&quot;</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> row[column.<span class="property">property</span> + <span class="string">&quot;_merge&quot;</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">rowspan</span>: <span class="number">1</span>, <span class="attr">colspan</span>: <span class="number">1</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// var colArr = [[&quot;id&quot;, &quot;grade&quot;], [&quot;class&quot;]];</span></span><br><span class="line"><span class="keyword">var</span> colArr = [[<span class="string">&quot;id&quot;</span>], [<span class="string">&quot;grade&quot;</span>], [<span class="string">&quot;class&quot;</span>]];</span><br><span class="line"><span class="keyword">var</span> list = [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">grade</span>: <span class="number">1</span>, <span class="attr">class</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">grade</span>: <span class="number">1</span>, <span class="attr">class</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">grade</span>: <span class="number">1</span>, <span class="attr">class</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;王五&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">grade</span>: <span class="number">1</span>, <span class="attr">class</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;找六&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">grade</span>: <span class="number">2</span>, <span class="attr">class</span>: <span class="number">7</span>, <span class="attr">name</span>: <span class="string">&quot;张三_1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">grade</span>: <span class="number">2</span>, <span class="attr">class</span>: <span class="number">7</span>, <span class="attr">name</span>: <span class="string">&quot;李四_1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">grade</span>: <span class="number">2</span>, <span class="attr">class</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;王五_1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">grade</span>: <span class="number">2</span>, <span class="attr">class</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;找六_1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">grade</span>: <span class="number">2</span>, <span class="attr">class</span>: <span class="literal">null</span>, <span class="attr">name</span>: <span class="string">&quot;null1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">grade</span>: <span class="number">2</span>, <span class="attr">class</span>: <span class="literal">null</span>, <span class="attr">name</span>: <span class="string">&quot;null2&quot;</span> &#125;</span><br><span class="line">];</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">tableDate</span> = <span class="title function_">merge</span>(colArr, list)</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(this.tableDate);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(this.tableDate);</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue UI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> element UI </tag>
            
            <tag> el-table </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>electron-vue</title>
      <link href="/hisai3.github.io/2023/01/14/electron-vue/"/>
      <url>/hisai3.github.io/2023/01/14/electron-vue/</url>
      
        <content type="html"><![CDATA[<h3 id="首次运行报错"><a href="#首次运行报错" class="headerlink" title="首次运行报错"></a>首次运行报错</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Html Webpack Plugin:</span><br><span class="line">  ReferenceError: process is not defined</span><br><span class="line">  </span><br><span class="line">  - index.ejs:11 eval</span><br><span class="line">    [.]/[_html-webpack-plugin@3.2.0@html-webpack-plugin]/lib/loader.js!./src/index.ejs:11:2</span><br><span class="line">  </span><br><span class="line">  - index.ejs:16 module.exports</span><br><span class="line">    [.]/[_html-webpack-plugin@3.2.0@html-webpack-plugin]/lib/loader.js!./src/index.ejs:16:3</span><br><span class="line">  </span><br><span class="line">  - index.js:284 </span><br><span class="line">    [Electron-Vue]/[_html-webpack-plugin@3.2.0@html-webpack-plugin]/index.js:284:18</span><br><span class="line">  </span><br><span class="line">  - task_queues.js:97 processTicksAndRejections</span><br><span class="line">    internal/process/task_queues.js:97:5</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">new HtmlWebpackPlugin(&#123;</span><br><span class="line">      filename: &#x27;index.html&#x27;,</span><br><span class="line">      template: path.resolve(__dirname, &#x27;../src/index.ejs&#x27;),</span><br><span class="line">      templateParameters(compilation, assets, options) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          compilation: compilation,</span><br><span class="line">          webpack: compilation.getStats().toJson(),</span><br><span class="line">          webpackConfig: compilation.options,</span><br><span class="line">          htmlWebpackPlugin: &#123;</span><br><span class="line">            files: assets,</span><br><span class="line">            options: options</span><br><span class="line">          &#125;,</span><br><span class="line">          process,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      minify: &#123;</span><br><span class="line">        collapseWhitespace: true,</span><br><span class="line">        removeAttributeQuotes: true,</span><br><span class="line">        removeComments: true</span><br><span class="line">      &#125;,</span><br><span class="line">      nodeModules: false</span><br><span class="line">    &#125;),</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>h5录音</title>
      <link href="/hisai3.github.io/2023/01/14/h5%E5%BD%95%E9%9F%B3/"/>
      <url>/hisai3.github.io/2023/01/14/h5%E5%BD%95%E9%9F%B3/</url>
      
        <content type="html"><![CDATA[<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p><code>getUserMedia</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getUserMedia</span>(<span class="params">constrains, success, error</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(navigator.<span class="property">mediaDevices</span>.<span class="property">getUserMedia</span>)&#123;</span><br><span class="line">    <span class="comment">//最新标准API</span></span><br><span class="line">    navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(constrains).<span class="title function_">then</span>(success).<span class="title function_">catch</span>(error)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (navigator.<span class="property">webkitGetUserMedia</span>)&#123;</span><br><span class="line">    <span class="comment">//webkit内核浏览器</span></span><br><span class="line">    navigator.<span class="title function_">webkitGetUserMedia</span>(constrains, success, error)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (navigator.<span class="property">mozGetUserMedia</span>)&#123;</span><br><span class="line">    <span class="comment">//Firefox浏览器</span></span><br><span class="line">    navigator.<span class="title function_">mozGetUserMedia</span>(constrains, success, error)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (navigator.<span class="property">getUserMedia</span>)&#123;</span><br><span class="line">    <span class="comment">//旧版API</span></span><br><span class="line">    navigator.<span class="title function_">getUserMedia</span>(constrains, success, error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">WebRecorder</span> &#123;</span><br><span class="line">  isUserMedia = <span class="literal">false</span></span><br><span class="line">  stream = <span class="literal">null</span></span><br><span class="line">  recorder = <span class="literal">null</span></span><br><span class="line">  chunks = []</span><br><span class="line">  startTime = <span class="number">0</span></span><br><span class="line">  onSuccess = <span class="function"><span class="params">data</span> =&gt;</span> data</span><br><span class="line">  onError = <span class="function"><span class="params">error</span> =&gt;</span> error</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * error 事件的返回状态</span></span><br><span class="line"><span class="comment">     * 101: 浏览器不支持</span></span><br><span class="line"><span class="comment">     *  201: 用户拒绝授权</span></span><br><span class="line"><span class="comment">     *  500: 未知错误</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fn</span> = data =&gt; data</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onSuccess</span> = props.<span class="property">onSuccess</span> || fn</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onError</span> = props.<span class="property">onError</span> || fn</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getRecorderManager</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">check</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      (navigator.<span class="property">mediaDevices</span> &amp;&amp; navigator.<span class="property">mediaDevices</span>.<span class="property">getUserMedia</span>) ||</span><br><span class="line">      navigator.<span class="property">getUserMedia</span> ||</span><br><span class="line">      navigator.<span class="property">webkitGetUserMedia</span> ||</span><br><span class="line">      navigator.<span class="property">mozGetUserMedia</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onErrorHandler</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;NotReadableError&#x27;</span> &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getRecorderManager</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">check</span>()) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">getUserMedia</span>(&#123; <span class="attr">audio</span>: <span class="literal">true</span> &#125;,<span class="function"><span class="params">stream</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isUserMedia</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// stream.getTracks().forEach((track) =&gt; &#123;</span></span><br><span class="line">        <span class="comment">//   track.stop()</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stream</span> = stream</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">recorder</span> = <span class="keyword">new</span> <span class="title class_">MediaRecorder</span>(stream)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">recorder</span>.<span class="property">ondataavailable</span> = <span class="variable language_">this</span>.<span class="property">getRecordingData</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">recorder</span>.<span class="property">onstop</span> = <span class="variable language_">this</span>.<span class="property">saveRecordingData</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">true</span>)</span><br><span class="line">      &#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">onErrorHandler</span>(err)</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="literal">false</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start--&gt;&gt;&gt;&gt;&#x27;</span>, <span class="variable language_">this</span>.<span class="property">recorder</span>.<span class="property">start</span>)</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">recorder</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">recorder</span>.<span class="title function_">start</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">stop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;stop--&gt;&gt;&gt;&gt;&#x27;</span>, <span class="variable language_">this</span>.<span class="property">recorder</span>)</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">recorder</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="comment">// 安卓qq浏览器 把注释打开会触发两次 recorder.onstop</span></span><br><span class="line">    <span class="comment">// this.stream.getTracks().forEach((track) =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   track.stop()</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">recorder</span>.<span class="title function_">stop</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getRecordingData</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chunks</span>.<span class="title function_">push</span>(e.<span class="property">data</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">saveRecordingData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>(<span class="variable language_">this</span>.<span class="property">chunks</span>, &#123; <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;audio/mp3&#x27;</span> &#125;), <span class="comment">// &#x27;audio/wav&#x27; iphone 11 播放没声音</span></span><br><span class="line">      localUrl = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob)</span><br><span class="line">    <span class="keyword">const</span> endTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="keyword">let</span> duration = (endTime - <span class="variable language_">this</span>.<span class="property">startTime</span>).<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    duration.<span class="title function_">splice</span>(duration.<span class="property">length</span> - <span class="number">2</span>)</span><br><span class="line">    duration.<span class="title function_">splice</span>(duration.<span class="property">length</span> - <span class="number">1</span>, <span class="number">0</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    duration = <span class="built_in">parseFloat</span>(duration.<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> recorder = &#123;</span><br><span class="line">      <span class="attr">data</span>: blob,</span><br><span class="line">      <span class="attr">duration</span>: duration,</span><br><span class="line">      <span class="attr">localUrl</span>: localUrl</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chunks</span> = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isUserMedia</span> = <span class="literal">null</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="number">0</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onSuccess</span>(recorder)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">onErrorHandler</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">dir</span>(err)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&#x27;NotAllowedError&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onError</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;201&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;麦克风权限被拒绝, 请前往浏览器设置授权, 并刷新页面&#x27;</span>,</span><br><span class="line">        err</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&#x27;NotReadableError&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onError</span>(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;101&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;当前浏览器不支持麦克风，请更换浏览器或在微信中打开&#x27;</span>,</span><br><span class="line">        err</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">onError</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="string">&#x27;500&#x27;</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;麦克风调用, 未知错误&#x27;</span>,</span><br><span class="line">      err</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">WebRecorder</span> <span class="keyword">from</span> <span class="string">&#x27;./webRecorder.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Recorder</span> = <span class="keyword">new</span> <span class="title class_">WebRecorder</span>(&#123;</span><br><span class="line">    <span class="attr">onSuccess</span>: handlerSuccess,</span><br><span class="line">    <span class="attr">onError</span>: <span class="function">(<span class="params">&#123; msg &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      uni.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;提示&#x27;</span>,</span><br><span class="line">        <span class="attr">showCancel</span>: <span class="literal">false</span>,<span class="comment">//没有取消按钮的弹框</span></span><br><span class="line">        <span class="attr">content</span>: msg,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="title class_">Recorder</span>.<span class="title function_">stop</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="title class_">Recorder</span>.<span class="title function_">start</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handlerSuccess</span>(<span class="params">file</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;handlerSuccess&#x27;</span>, file.<span class="property">duration</span>, file)</span><br><span class="line">  <span class="keyword">if</span> (!file.<span class="property">duration</span> || file.<span class="property">duration</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;说话时间太短&#x27;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">2000</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p><code>getUserMedia</code> + <code>AudioContext</code><br><a href="https://gitee.com/hisai/branch/tree/recorder/">gitee</a></p>]]></content>
      
      
      <categories>
          
          <category> WebRTC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> h5录音 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>h5拖拽</title>
      <link href="/hisai3.github.io/2023/01/14/h5%E6%8B%96%E6%8B%BD/"/>
      <url>/hisai3.github.io/2023/01/14/h5%E6%8B%96%E6%8B%BD/</url>
      
        <content type="html"><![CDATA[<h3 id="h5拖拽"><a href="#h5拖拽" class="headerlink" title="h5拖拽"></a>h5拖拽</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.colep</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: aqua;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="comment">/* transition: all .3s; */</span></span></span><br><span class="line"><span class="language-css">            <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.content</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">float</span>: right;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> dashed <span class="number">#000</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/*步骤条end*/</span></span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;colep&quot;</span> <span class="attr">draggable</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px; height: 100px; margin: 0 auto; background-color: bisque;&quot;</span>&gt;</span>move<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>content1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;background-color: blueviolet;&quot;</span>&gt;</span>content2</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.bootcss.com/jquery/3.3.1/jquery.js&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> colep = $(<span class="string">&#x27;.colep&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> body = $(<span class="string">&#x27;body&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> target = <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">        colep.<span class="title function_">on</span>(<span class="string">&#x27;drag&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;drag&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        colep.<span class="title function_">on</span>(<span class="string">&#x27;dragstart&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;dragstart&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        body.<span class="title function_">on</span>(<span class="string">&#x27;dragover&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;dragover&#x27;</span>, e.<span class="property">target</span>.<span class="property">nodeName</span>);</span></span><br><span class="line"><span class="language-javascript">            event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">            target = e.<span class="property">target</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        colep.<span class="title function_">on</span>(<span class="string">&#x27;dragend&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;dragend&#x27;</span>, e);</span></span><br><span class="line"><span class="language-javascript">            target.<span class="title function_">after</span>(e.<span class="property">target</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        colep.<span class="title function_">on</span>(<span class="string">&#x27;drop&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;drop&#x27;</span>, e);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小功能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> drag </tag>
            
            <tag> 小功能 </tag>
            
            <tag> h5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>less</title>
      <link href="/hisai3.github.io/2023/01/14/less/"/>
      <url>/hisai3.github.io/2023/01/14/less/</url>
      
        <content type="html"><![CDATA[<h1 id="Less"><a href="#Less" class="headerlink" title="Less"></a>Less</h1><h3 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@main-color:</span> <span class="number">#ff6700</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bgColor</span>&#123;</span><br><span class="line">    <span class="comment">// 使用</span></span><br><span class="line">    <span class="attribute">background-color</span>: <span class="variable">@main-color</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="混合使用"><a href="#混合使用" class="headerlink" title="混合使用"></a>混合使用</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.border</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bgColor</span>&#123;</span><br><span class="line">    <span class="selector-class">.border</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="variable">@main-color</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="带参使用"><a href="#带参使用" class="headerlink" title="带参使用"></a>带参使用</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义函数</span></span><br><span class="line"><span class="selector-class">.lcButton</span>(<span class="variable">@bgcolor</span>)&#123;</span><br><span class="line">    <span class="selector-class">.border</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="variable">@bgcolor</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置默认参数</span></span><br><span class="line"><span class="selector-class">.lcButton</span>(<span class="variable">@bgcolor</span>：blue)&#123;</span><br><span class="line">    <span class="selector-class">.border</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="variable">@bgcolor</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.relcbutton</span>&#123;</span><br><span class="line">    <span class="comment">// 实际使用</span></span><br><span class="line">    <span class="selector-class">.lcButton</span>(pink);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@_</strong>  通过改符号匹配相同的函数名（triangle）并且把 @_ 中的追加</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 三角形的封装</span></span><br><span class="line"><span class="selector-class">.triangle</span>(top, <span class="variable">@width</span>: <span class="number">5px</span>, <span class="variable">@color</span>: <span class="number">#ccc</span>)&#123;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="variable">@wdith</span>;</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="variable">@color</span> transparent transparent transparent;</span><br><span class="line">    <span class="attribute">border-style</span>: solid dashed dashed dashed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.triangle</span>(right, <span class="variable">@width</span>: <span class="number">5px</span>, <span class="variable">@color</span>: <span class="number">#ccc</span>)&#123;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="variable">@wdith</span>;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent <span class="variable">@color</span> transparent transparent;</span><br><span class="line">    <span class="attribute">border-style</span>: dashed solid dashed dashed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.triangle</span>(bottom, <span class="variable">@width</span>: <span class="number">5px</span>, <span class="variable">@color</span>: <span class="number">#ccc</span>)&#123;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="variable">@wdith</span>;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent transparent <span class="variable">@color</span> transparent;</span><br><span class="line">    <span class="attribute">border-style</span>: dashed dashed solid dashed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.triangle</span>(left, <span class="variable">@width</span>: <span class="number">5px</span>, <span class="variable">@color</span>: <span class="number">#ccc</span>)&#123;</span><br><span class="line">    <span class="attribute">border-width</span>: <span class="variable">@wdith</span>;</span><br><span class="line">    <span class="attribute">border-color</span>: transparent transparent transparent <span class="variable">@color</span>;</span><br><span class="line">    <span class="attribute">border-style</span>: dashed dashed dashed solid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.triangle</span>(<span class="variable">@_</span>, <span class="variable">@width</span>: <span class="number">5px</span>, <span class="variable">@color</span>: <span class="number">#ccc</span>)&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="selector-class">.triangle</span>(top)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>@arguments</strong></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @arguments 自动拼接参数</span></span><br><span class="line"><span class="selector-class">.border</span>(<span class="variable">@width</span>: <span class="number">1px</span>; <span class="variable">@style</span>: solid; <span class="variable">@color</span>: <span class="number">#eee</span>)&#123;</span><br><span class="line">    boder: @arguments;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="selector-class">.border</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染结果</span></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">2</span>*<span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> Scss </tag>
            
            <tag> Less </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mixin</title>
      <link href="/hisai3.github.io/2023/01/14/mixin/"/>
      <url>/hisai3.github.io/2023/01/14/mixin/</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mixin.ts</span></span><br><span class="line"><span class="keyword">const</span> native = <span class="title class_">Page</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Page</span> = <span class="function">(<span class="params">obj: any</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123;mixins = []&#125; = obj;</span><br><span class="line">  <span class="keyword">let</span> merge = <span class="keyword">new</span> <span class="title class_">Merge</span>();</span><br><span class="line">  <span class="title class_">Reflect</span>.<span class="title function_">deleteProperty</span>(obj, <span class="string">&quot;mixins&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> pageData = mixins.<span class="property">length</span> &lt;= <span class="number">0</span> ? obj : merge.<span class="title function_">start</span>(obj, ...mixins);</span><br><span class="line">  <span class="title function_">native</span>(pageData);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Merge</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">start</span>(<span class="params">rootObj: any, ...objs: any</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> root = &#123;&#125;;</span><br><span class="line">    objs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el: any</span>) =&gt;</span> &#123;</span><br><span class="line">      root = <span class="title class_">Merge</span>.<span class="title function_">recursive</span>(rootObj, el);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> recursive = <span class="function">(<span class="params">rootObj: any, obj: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> attr <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (rootObj[attr] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        rootObj[attr] = obj[attr];</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">Merge</span>.<span class="title function_">isObject</span>(obj[attr])) &#123;</span><br><span class="line">        <span class="title class_">Merge</span>.<span class="title function_">recursive</span>(rootObj[attr], obj[attr])</span><br><span class="line">      &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        rootObj[attr] = obj[attr];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> rootObj;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> isObject = <span class="function">(<span class="params">obj: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(obj).<span class="title function_">includes</span>(<span class="string">&quot;Object&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mixin/share.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">data</span>:&#123;</span><br><span class="line">    <span class="attr">posterPath</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Description</span>: 分享海报</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@author</span> <span class="variable">tangminghui</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@date</span> 2020/9/21</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShareAppMessage () &#123;</span><br><span class="line">    <span class="keyword">const</span> liveId = wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;liveId&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> &#123;title, picUrl&#125; = wx.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;shareData&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">`邀请您观看：<span class="subst">$&#123;title&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">path</span>: <span class="string">`/pages/detail/detail?id=<span class="subst">$&#123;liveId&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">imageUrl</span>: picUrl</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Description</span>: 点击分享按钮，显示分享海报内容</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@author</span> <span class="variable">lidonghui</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@date</span> 2020/9/16</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">showLayers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">posterVisible</span>: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Description</span>: 点击分享按钮，显示分享海报内容</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@author</span> <span class="variable">lidonghui</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@date</span> 2020/9/16</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">hideLayers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">posterVisible</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@Description</span>: 获取海报的 path</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@author</span> <span class="variable">tangminghui</span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@date</span> 2020/9/29</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">getImagePath</span>(<span class="params">src: string</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(src)</span></span><br><span class="line">    <span class="keyword">if</span>(src) &#123;</span><br><span class="line">      <span class="keyword">const</span> fileName = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">valueOf</span>();</span><br><span class="line">      wx.<span class="title function_">downloadFile</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: src, <span class="comment">//仅为示例，并非真实的资源</span></span><br><span class="line">        <span class="attr">filePath</span>: wx.<span class="property">env</span>.<span class="property">USER_DATA_PATH</span> + <span class="string">&#x27;/&#x27;</span> + fileName + <span class="string">&#x27;.jpg&#x27;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">statusCode</span> === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">posterPath</span>: res.<span class="property">filePath</span> &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/home/home.ts</span></span><br><span class="line"><span class="comment">// 引入mixin</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;../../utils/mixin&quot;</span>;</span><br><span class="line"><span class="comment">// 引入海报分享相关逻辑</span></span><br><span class="line"><span class="keyword">import</span> share <span class="keyword">from</span> <span class="string">&quot;../../mixins/share&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="title class_">Page</span>&lt;extraOptions&gt;(&#123;</span><br><span class="line">  <span class="attr">mixins</span>: [share],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 微信 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>router</title>
      <link href="/hisai3.github.io/2023/01/14/router/"/>
      <url>/hisai3.github.io/2023/01/14/router/</url>
      
        <content type="html"><![CDATA[<h4 id="权限路由"><a href="#权限路由" class="headerlink" title="权限路由"></a>权限路由</h4><p><code>router.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Layout</span> <span class="keyword">from</span> <span class="string">&#x27;@/layout&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  cloneDeep</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> constantRoutes = []</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> cloneRouter = <span class="title function_">cloneDeep</span>(constantRoutes)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createRouter</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">    <span class="comment">// mode: &#x27;history&#x27;, // require service support</span></span><br><span class="line">    <span class="attr">scrollBehavior</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="attr">routes</span>: constantRoutes</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// resetRouter 退出登录清空</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">resetRouter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> newRouter = <span class="title function_">createRouter</span>()</span><br><span class="line">  router.<span class="property">matcher</span> = newRouter.<span class="property">matcher</span> <span class="comment">// reset router</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>transform 固定表头和列</title>
      <link href="/hisai3.github.io/2023/01/14/tranform%20%E5%9B%BA%E5%AE%9A%E8%A1%A8%E5%A4%B4%E5%92%8C%E5%88%97/"/>
      <url>/hisai3.github.io/2023/01/14/tranform%20%E5%9B%BA%E5%AE%9A%E8%A1%A8%E5%A4%B4%E5%92%8C%E5%88%97/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;table-cont&#x27;</span> <span class="attr">style</span>=<span class="string">&quot;max-height: 150px;width: 540px;overflow: scroll;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">style</span>=<span class="string">&quot;width:800px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">&quot;background: #dcdcdc;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: #dcdcdc;&quot;</span>&gt;</span>用户编号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>试用时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>转正时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名拼音<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>生日时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>民族<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span>身高<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span>2000001<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>1997-3-13<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>1997-3-13<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>WZJ<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>1965-3-13<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>汉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>171<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span>2000045<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-15<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-3-15<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>WY<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>1978-8-5<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>汉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>162<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span>2000046<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-3-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>LQ<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>汉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>171<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span>2000046<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-3-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>LQ<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>汉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>171<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span>2000046<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-3-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>LQ<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>汉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>171<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span>2000046<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-3-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>LQ<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>汉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>171<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span>2000046<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-3-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>LQ<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>汉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>171<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;drag_user&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: white;&quot;</span>&gt;</span>2000046<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-3-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>0<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>LQ<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>2001-2-23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>汉<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">td</span>&gt;</span>171<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tableCont = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#table-cont&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">scrollHandle</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> scrollTop = event.<span class="property">target</span>.<span class="property">scrollTop</span>;</span><br><span class="line">  <span class="keyword">var</span> scrollLeft = event.<span class="property">target</span>.<span class="property">scrollLeft</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> header = event.<span class="property">target</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;thead&#x27;</span>)</span><br><span class="line">  header.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateY(&#x27;</span> + scrollTop + <span class="string">&#x27;px)&#x27;</span>;</span><br><span class="line">  header.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;relative&#x27;</span>;</span><br><span class="line">  header.<span class="property">style</span>.<span class="property">zIndex</span> = <span class="string">&#x27;1&#x27;</span>; <span class="comment">// 解决固定列导致表头被遮挡</span></span><br><span class="line">  <span class="keyword">var</span> dragUsers = event.<span class="property">target</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.drag_user&#x27;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; dragUsers.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    dragUsers[i].<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateX(&#x27;</span> + scrollLeft + <span class="string">&#x27;px)&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">tableCont.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, scrollHandle);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> css3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue.config</title>
      <link href="/hisai3.github.io/2023/01/14/vue.config/"/>
      <url>/hisai3.github.io/2023/01/14/vue.config/</url>
      
        <content type="html"><![CDATA[<h1 id="vue-config"><a href="#vue-config" class="headerlink" title="vue.config"></a>vue.config</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 部署应用包时的基本URL，默认为&#x27;/&#x27;</span></span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;./&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将构建好的文件输出到哪里，本司要求</span></span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&#x27;dist/static&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 放置生成的静态资源(js、css、img、fonts)的目录。</span></span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指定生成的 index.html 的输出路径</span></span><br><span class="line">  <span class="attr">indexPath</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是否使用包含运行时编译器的 Vue 构建版本。</span></span><br><span class="line">  <span class="attr">runtimeCompiler</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 默认情况下 babel-loader 会忽略所有 node_modules 中的文件。如果你想要通过 Babel 显式转译一个依赖，可以在这个选项中列出来。</span></span><br><span class="line">  <span class="attr">transpileDependencies</span>: [],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果你不需要生产环境的 source map，可以将其设置为 false 以加速生产环境构建。</span></span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 配置css</span></span><br><span class="line">  <span class="attr">css</span>: &#123;</span><br><span class="line">    <span class="comment">// 是否使用css分离插件 ExtractTextPlugin</span></span><br><span class="line">    <span class="attr">extract</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">sourceMap</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// css预设器配置项</span></span><br><span class="line">    <span class="attr">loaderOptions</span>: &#123;</span><br><span class="line">      <span class="attr">postcss</span>: &#123;</span><br><span class="line">        <span class="comment">// options here will be passed to postcss-loader</span></span><br><span class="line">        <span class="attr">plugins</span>: [</span><br><span class="line">          <span class="built_in">require</span>(<span class="string">&#x27;postcss-px2rem&#x27;</span>)(&#123;</span><br><span class="line">            <span class="attr">remUnit</span>: <span class="number">100</span>,</span><br><span class="line">          &#125;),</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 启用 CSS modules for all css / pre-processor files.</span></span><br><span class="line">    <span class="attr">modules</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是一个函数，允许对内部的 webpack 配置进行更细粒度的修改。</span></span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 生产环境配置</span></span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// 删除预加载</span></span><br><span class="line">      config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;preload&#x27;</span>)</span><br><span class="line">      config.<span class="property">plugins</span>.<span class="title function_">delete</span>(<span class="string">&#x27;prefetch&#x27;</span>)</span><br><span class="line">      <span class="comment">//  压缩代码</span></span><br><span class="line">      config.<span class="property">optimization</span>.<span class="title function_">minimize</span>(<span class="literal">true</span>)</span><br><span class="line">      <span class="comment">// 分割代码</span></span><br><span class="line">      config.<span class="property">optimization</span>.<span class="title function_">splitChunks</span>(&#123;</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 生产环境注入cdn</span></span><br><span class="line">      <span class="comment">// config.plugin(&#x27;html&#x27;)</span></span><br><span class="line">      <span class="comment">//   .tap(args =&gt; &#123;</span></span><br><span class="line">      <span class="comment">//     args[0].cdn = cdn</span></span><br><span class="line">      <span class="comment">//     return args</span></span><br><span class="line">      <span class="comment">//   &#125;)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 配置别名</span></span><br><span class="line">    config.<span class="property">resolve</span>.</span><br><span class="line">    alias</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;@&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;assets&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/assets&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;components&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/components&#x27;</span>))</span><br><span class="line">      .<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, <span class="title function_">resolve</span>(<span class="string">&#x27;src/views&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 去除生产环境console</span></span><br><span class="line">    <span class="comment">// 1.</span></span><br><span class="line">    <span class="comment">// config.optimization.minimizer[0].options.terserOptions.compress.drop_console = true</span></span><br><span class="line">    <span class="comment">// 2.</span></span><br><span class="line">    config.<span class="property">optimization</span>.<span class="title function_">minimizer</span>(<span class="string">&#x27;terser&#x27;</span>).<span class="title function_">tap</span>(<span class="function">(<span class="params">args</span>) =&gt;</span> &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// args[0].terserOptions.compress.drop_console = true</span></span><br><span class="line">      <span class="keyword">return</span> args</span><br><span class="line">    &#125;)</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">const</span> oneOfsMap = config.<span class="property">module</span>.<span class="title function_">rule</span>(<span class="string">&#x27;scss&#x27;</span>).<span class="property">oneOfs</span>.<span class="property">store</span></span><br><span class="line">    oneOfsMap.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      item</span><br><span class="line">        .<span class="title function_">use</span>(<span class="string">&#x27;sass-resources-loader&#x27;</span>) <span class="comment">// 使用 scss 全局变量</span></span><br><span class="line">        .<span class="title function_">loader</span>(<span class="string">&#x27;sass-resources-loader&#x27;</span>)</span><br><span class="line">        .<span class="title function_">options</span>(&#123;</span><br><span class="line">          <span class="comment">// Provide path to the file with resources</span></span><br><span class="line">          <span class="attr">resources</span>: [</span><br><span class="line">            <span class="string">&#x27;./src/styles/variables.scss&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;./src/styles/worker-order-hall/theme.scss&#x27;</span></span><br><span class="line">          ]</span><br><span class="line">          <span class="comment">// Or array of paths</span></span><br><span class="line">          <span class="comment">// resources: [&#x27;./path/to/vars.scss&#x27;, &#x27;./path/to/mixins.scss&#x27;]</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">end</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是否为 Babel 或 TypeScript 使用 thread-loader。该选项在系统的 CPU 有多于一个内核时自动启用，仅作用于生产构建。</span></span><br><span class="line">  <span class="attr">parallel</span>: <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).<span class="title function_">cpus</span>().<span class="property">length</span> &gt; <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8088</span>, <span class="comment">// 端口号</span></span><br><span class="line">    <span class="attr">https</span>: <span class="literal">false</span>, <span class="comment">// https:&#123;type:Boolean&#125;</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">false</span>, <span class="comment">// 配置自动启动浏览器  open: &#x27;Google Chrome&#x27;-默认启动谷歌</span></span><br><span class="line"><span class="attr">disableHostCheck</span>: <span class="literal">true</span>, <span class="comment">// 解决host头部报错</span></span><br><span class="line">    <span class="comment">// 配置多个代理</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;https://www.mock.com&#x27;</span>,</span><br><span class="line">        <span class="attr">ws</span>: <span class="literal">true</span>, <span class="comment">// 代理的WebSockets</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>, <span class="comment">// 允许websockets跨域</span></span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>px2rem</code> 也需要控制html字体大小  在<code>main.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">initRem</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> cale = <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">availWidth</span> &gt; <span class="number">750</span> ? <span class="number">2</span> : <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">availWidth</span> / <span class="number">375</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">`<span class="subst">$&#123;<span class="number">100</span> * cale&#125;</span>px`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">initRem</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue组件库打包</title>
      <link href="/hisai3.github.io/2023/01/14/vue%E7%BB%84%E4%BB%B6%E5%BA%93%E6%89%93%E5%8C%85/"/>
      <url>/hisai3.github.io/2023/01/14/vue%E7%BB%84%E4%BB%B6%E5%BA%93%E6%89%93%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h1 id="封装vue组件库的两种方法和形式："><a href="#封装vue组件库的两种方法和形式：" class="headerlink" title="封装vue组件库的两种方法和形式："></a>封装vue组件库的两种方法和形式：</h1><blockquote><p>方式一：是建立一个webpack-simple 项目</p></blockquote><blockquote><p>方式二：是在通过vue-cli脚手架建立webpack vue项目，这种项目有点冗余，可是我们对这种项目最熟悉<br>下面分别介绍两种用法：</p></blockquote><h2 id="方式一："><a href="#方式一：" class="headerlink" title="方式一："></a>方式一：</h2><p><strong>1. 首先先建立一个vue项目：</strong><br>通过vue init webpack-simple，新建项目目录如下：</p><p><img src="https://img-blog.csdn.net/20180907194209878?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"><br>箭头指的是在项目打包后产生的文件（打包命令npm run build ）</p><p><strong>2. 在src下新建一个目录用来存放组件源码：</strong><br><img src="https://img-blog.csdn.net/2018090719440239?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>然后写封装的组件，比如radios&#x2F;radio.vue</p><p><strong>3. 组件封装完后新建index.js文件，作为我们组件库的出入口，index.js内容如下：</strong><br><img src="https://img-blog.csdn.net/2018090719473733?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>上图中comment应该换成components，也就是你自己命名的变量名</p><p><strong>4. 完了之后修改package.json文件，修改如下：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;hz-components-ui&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;uicomponents&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;wyx&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;MIT&quot;</span>,</span><br><span class="line">  <span class="comment">// 因为组件包是公用的，所以private为false</span></span><br><span class="line">  <span class="string">&quot;private&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=development webpack-dev-server --open --hot&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=production webpack --progress --hide-modules&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 配置main结点，如果不配置，我们在其他项目中就不用import XX from &#x27;包名&#x27;来引用了，只能以包名作为起点来指定相对的路径</span></span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;dist/hz-components-ui.min.js&quot;</span>,</span><br><span class="line">  <span class="comment">// 项目官网的url</span></span><br><span class="line">  <span class="string">&quot;homepage&quot;</span>: <span class="string">&quot;https://wuyxgit.github.io/vueBuildTest/dist/index.html#/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;bugs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://github.com/hamger/hg-vcomponents/issues&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 指定代码所在的仓库地址</span></span><br><span class="line">  <span class="string">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;git+https://github.com/wuyxgit/vueBuildTest.git&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;vue&quot;</span>: <span class="string">&quot;^2.5.11&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 指定关键字</span></span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;hz&quot;</span>,</span><br><span class="line">    <span class="string">&quot;components&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 指定打包后发布到npm的文件名，没指定则不传，package.json是默认上传的</span></span><br><span class="line">  <span class="string">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">    <span class="string">&quot;src/lib&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;browserslist&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;&gt; 1%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;last 2 versions&quot;</span>,</span><br><span class="line">    <span class="string">&quot;not ie &lt;= 8&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;babel-core&quot;</span>: <span class="string">&quot;^6.26.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;babel-loader&quot;</span>: <span class="string">&quot;^7.1.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;babel-preset-env&quot;</span>: <span class="string">&quot;^1.6.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;babel-preset-stage-3&quot;</span>: <span class="string">&quot;^6.24.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cross-env&quot;</span>: <span class="string">&quot;^5.0.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;css-loader&quot;</span>: <span class="string">&quot;^0.28.7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;file-loader&quot;</span>: <span class="string">&quot;^1.1.4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue-loader&quot;</span>: <span class="string">&quot;^13.0.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue-template-compiler&quot;</span>: <span class="string">&quot;^2.4.4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^3.6.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^2.9.1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5. 修改webpack.comfig.js文件：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entry</span>: <span class="string">&quot;./src/lib/index.js&quot;</span>,</span><br><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./dist&#x27;</span>),</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;/dist/&#x27;</span>,</span><br><span class="line">  <span class="comment">// filename: &#x27;build.js&#x27;</span></span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;hz-components-ui.min.js&quot;</span>,</span><br><span class="line">  <span class="attr">library</span>: <span class="string">&quot;hzComponentsUI&quot;</span>,</span><br><span class="line">  <span class="attr">libraryTarget</span>: <span class="string">&quot;umd&quot;</span>,</span><br><span class="line">  <span class="attr">umdNamedDefine</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdn.net/20180907195438958?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"><br>箭头指的是修改的部分，红圈内的是新增部分</p><p><strong>6. 打包通过npm run build 命令，打包完成后产生dist文件，内容如下</strong>：<br><img src="https://img-blog.csdn.net/20180907195647885?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p><strong>7. 现在本地找一个项目测试是否可用，先执行命令 npm pack ，会产生一个压缩包</strong><br><img src="https://img-blog.csdn.net/2018090719584719?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>箭头所指的tgz文件，然后在测试项目中，通过npm install 路径\文件全名</p><p>路径是指压缩包所在的绝对路径，文件名指的是压缩包的全名</p><p><strong>8. 安装后直接在测试项目的入口文件mian.js内引入，和引入elementUI一样</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> 名称 <span class="keyword">from</span> ‘组件库名’</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(名称)；</span><br></pre></td></tr></table></figure><p>然后在项目的任意组件中引用就行了，如果引入成功，则说明打包成功，接下来就是发布到npm上了</p><p><strong>9. 发布到npm上</strong><br>回到组件库项目的根目录下：</p><ol><li><p>npm login     登录到npm上</p></li><li><p>npm version patch  这是把版本迭代一级，每次更新时都需要输入这个命令，或者直接在package.json中修改版本号，只要与npm上的版本不同就行</p></li><li><p>npm publish  提交到npm上，至此就完成发布npm的全部了</p></li></ol><p>项目访问组件库，就可以直接输入 npm i&#x2F;install 组件库名称来安装，然后同上第八步就可以了</p><h2 id="方式二："><a href="#方式二：" class="headerlink" title="方式二："></a>方式二：</h2><p><strong>1. 首先通过vue init webpack 项目名 ，项目目录如下：</strong><br><img src="https://img-blog.csdn.net/20180910140055770?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p><strong>2. 封装组件</strong><br>在componetns文件下新建vue组件，放功能源码，添加index.js，实现封装后的组件的出入口<br><img src="https://img-blog.csdn.net/2018091014055326?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p><strong>3. index.js添加内容如下：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hzRadio <span class="keyword">from</span> <span class="string">&#x27;./radios/radio.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> hzTimePicker <span class="keyword">from</span> <span class="string">&#x27;./timePickers/timePicker&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">Vue</span>)&#123;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;hzRadio&#x27;</span>,hzRadio);</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;hzTimePicker&#x27;</span>,hzTimePicker);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 这里的判断很重要</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="variable language_">window</span>.<span class="property">Vue</span>) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">Vue</span>.<span class="title function_">use</span>(components);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span>  <span class="keyword">default</span> components;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>4. 修改webpack.base.conf.js和webpack.prod.conf.js<br>webpack.base.conf.js</strong></p><p><img src="https://img-blog.csdn.net/20180910141216604?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>webpack.prod.conf.js</p><p>修改生产环境的出口<br><img src="https://img-blog.csdn.net/20180910141328213?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>修改生产环境的样式文件，打包后所有的样式都会在这个文件下<br><img src="https://img-blog.csdn.net/20180910141704470?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>把下面的这两个注释掉，不然npm run build 打包时会失败，<br><img src="https://img-blog.csdn.net/20180910143833546?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>这个可以注释也可以不注释，全部注释的话打包后不会产生index.html文件<br><img src="https://img-blog.csdn.net/20180910143904161?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p><strong>5. 修改package.json文件，添加项目源码地址，demo测试地址，以及一些配置：</strong><br><img src="https://img-blog.csdn.net/20180910144411662?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"><br><strong>6. 修改后打包：</strong><br><img src="https://img-blog.csdn.net/20180910144729603?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NzY3Njc3Nqc3A=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>剩下的7，8，9三步同上第一种方法的7，8，9三步！！！</p>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>watch</title>
      <link href="/hisai3.github.io/2023/01/14/watch/"/>
      <url>/hisai3.github.io/2023/01/14/watch/</url>
      
        <content type="html"><![CDATA[<p>微信小程序watch</p><p>Vue 提供了一种通用的方式来观察和响应 Vue 实例上的数据变动：<strong>监听属性 watch。</strong></p><p>虽然watch的滥用会导致性能不佳，但在一些情况下我们还是需要watch，使得<strong>代码更加简洁、逻辑更加清晰</strong>(其实就是嫌麻烦…)。</p><p>接下来我将逐步讲解微信小程序中如何实现一个监听器 watch，若想直接看最终代码，可直接滑动至底部。</p><p><strong>监听器的原理，将data中需监听的属性写在watch对象中，并给其提供一个方法，当被监听属性的值改变时，调用该方法。</strong></p><p>所以很显然，我们需要用到Javascript中的<strong>Object.defineProperty()方法，来手动劫持对象的getter&#x2F;setter</strong>，从而实现给对象赋值时(调用setter)，执行watch对象中相对应的函数，达到监听效果。Object.defineProperty()不在这里详细介绍，<strong>还不会使用的童鞋速戳这里-&gt; <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty()介绍</a>。</strong></p><p>首先，既然是微信小程序自定义watch属性，我建议直接将代码写在app.js内，需要使用的页面直接在onLoad()内调用getApp().setWatch(…)即可</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 小程序初始化</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="title function_">onLaunch</span>(<span class="params"></span>)&#123;...&#125; </span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 设置监听器</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="title function_">setWatcher</span>(<span class="params">data, watch</span>) &#123; <span class="comment">// 接收index.js传过来的data对象和watch对象</span></span><br><span class="line">       <span class="title class_">Object</span>.<span class="title function_">keys</span>(watch).<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123; <span class="comment">// 将watch对象内的key遍历</span></span><br><span class="line">           <span class="variable language_">this</span>.<span class="title function_">observe</span>(data, v,watch[v]); <span class="comment">// 监听data内的v属性，传入watch内对应函数以调用</span></span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;,</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 监听属性 并执行监听函数</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="title function_">observe</span>(<span class="params">obj, key,watchFun</span>) &#123;</span><br><span class="line">       <span class="keyword">var</span> val = obj[key]; <span class="comment">// 给该属性设默认值</span></span><br><span class="line">       <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">           <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">           <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">           <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">               val = value;</span><br><span class="line">               <span class="title function_">watchFun</span>(value,val); <span class="comment">// 赋值(set)时，调用对应函数</span></span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">               <span class="keyword">return</span> val;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>此时在index.js中已经可以实现简单的属性监听：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&quot;xuyang&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">getApp</span>().<span class="title function_">setWatcher</span>(<span class="variable language_">this</span>.<span class="property">data</span>, <span class="variable language_">this</span>.<span class="property">watch</span>); <span class="comment">// 设置监听器</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>:<span class="string">&#x27;lxm&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">watch</span>:&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="keyword">function</span>(<span class="params">newValue</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue); <span class="comment">// name改变时，调用该方法输出新值。</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>我们可以看到，index页面启动后，name被赋值成’lxm’，同时触发其setter，调用watch内的name()方法，控制台打印出 lxm。</strong></p><p>是不是挺简单的呢？掌握了这一点，接下来的事情就好办多了。</p><p><strong>我们知道，Vue中 watch对象内不光是能写name、age这类属性，还能用引号写出’my.name’、’my.age’这类属性，即对my对象下的name、age进行监听。 我们只需要改进一下setWatcher方法：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置监听器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">setWatcher</span>(<span class="params">data, watch</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(watch).<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> key = v.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>); <span class="comment">// 将watch中的属性以&#x27;.&#x27;切分成数组</span></span><br><span class="line">            <span class="keyword">let</span> nowData = data; <span class="comment">// 将data赋值给nowData</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; key.<span class="property">length</span> - <span class="number">1</span>; i++) &#123; <span class="comment">// 遍历key数组的元素，除了最后一个！</span></span><br><span class="line">                nowData = nowData[key[i]]; <span class="comment">// 将nowData指向它的key属性对象</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> lastKey = key[key.<span class="property">length</span>-<span class="number">1</span>];</span><br><span class="line">            <span class="comment">// 假设key===&#x27;my.name&#x27;,此时nowData===data[&#x27;my&#x27;]===data.my,lastKey===&#x27;name&#x27;</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">observe</span>(nowData, lastKey,watch[v]); <span class="comment">// 监听nowData对象的lastKey</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;    </span><br></pre></td></tr></table></figure><p>此时在index.js中可以这样写：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"> </span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">my</span>:&#123;</span><br><span class="line">            <span class="attr">name</span>:<span class="string">&quot;xuyang&quot;</span>,</span><br><span class="line">            <span class="attr">age</span>:<span class="number">21</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">getApp</span>().<span class="title function_">setWatcher</span>(<span class="variable language_">this</span>.<span class="property">data</span>, <span class="variable language_">this</span>.<span class="property">watch</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">my</span>.<span class="property">name</span> = <span class="string">&#x27;lxm&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">my</span>.<span class="property">age</span> = <span class="number">2</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">my</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">my</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">watch</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;my.name&#x27;</span>:<span class="keyword">function</span>(<span class="params">newValue</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;my.age&#x27;</span>:<span class="keyword">function</span>(<span class="params">newValue</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>控制台会打印出 lxm 和 2</strong></p><p>现在我们又离成功更进了一步~ 接下来我们要实现Vue中的深度监听，即监听my对象即可监听它的内部所有属性以及属性的属性以及属性的属性的属性……<strong>并且监听函数的this要指向这个page里的this。</strong></p><p>需要深度监听，Vue中的写法是 </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">watch</span>:&#123;</span><br><span class="line">    <span class="attr">my</span>:&#123;</span><br><span class="line">        <span class="title function_">handler</span>(<span class="params">newValue</span>)&#123;</span><br><span class="line">            <span class="comment">// do something...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">deep</span>:<span class="literal">true</span> <span class="comment">// 深度监听</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们需要修改一下app.js中的两个函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置监听器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">setWatcher</span>(<span class="params">page</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> data = page.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">let</span> watch = page.<span class="property">watch</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(watch).<span class="title function_">forEach</span>(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> key = v.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>); <span class="comment">// 将watch中的属性以&#x27;.&#x27;切分成数组</span></span><br><span class="line">        <span class="keyword">let</span> nowData = data; <span class="comment">// 将data赋值给nowData</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; key.<span class="property">length</span> - <span class="number">1</span>; i++) &#123; <span class="comment">// 遍历key数组的元素，除了最后一个！</span></span><br><span class="line">            nowData = nowData[key[i]]; <span class="comment">// 将nowData指向它的key属性对象</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> lastKey = key[key.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 假设key===&#x27;my.name&#x27;,此时nowData===data[&#x27;my&#x27;]===data.my,lastKey===&#x27;name&#x27;</span></span><br><span class="line">        <span class="keyword">let</span> watchFun = watch[v].<span class="property">handler</span> || watch[v]; <span class="comment">// 兼容带handler和不带handler的两种写法</span></span><br><span class="line">        <span class="keyword">let</span> deep = watch[v].<span class="property">deep</span>; <span class="comment">// 若未设置deep,则为undefine</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">observe</span>(nowData, lastKey, watchFun, deep, page); <span class="comment">// 监听nowData对象的lastKey</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听属性 并执行监听函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_">observe</span>(<span class="params">obj, key, watchFun, deep, page</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> val = obj[key];</span><br><span class="line">    <span class="comment">// 判断deep是true 且 val不能为空 且 typeof val===&#x27;object&#x27;（数组内数值变化也需要深度监听）</span></span><br><span class="line">    <span class="keyword">if</span> (deep &amp;&amp; val != <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">&#x27;object&#x27;</span>) &#123; </span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(val).<span class="title function_">forEach</span>(<span class="function"><span class="params">childKey</span>=&gt;</span>&#123; <span class="comment">// 遍历val对象下的每一个key</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">observe</span>(val,childKey,watchFun,deep,page); <span class="comment">// 递归调用监听函数</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">            <span class="comment">// 用page对象调用,改变函数内this指向,以便this.data访问data内的属性值</span></span><br><span class="line">            watchFun.<span class="title function_">call</span>(page,value,val); <span class="comment">// value是新值，val是旧值</span></span><br><span class="line">            val = value;</span><br><span class="line">            <span class="keyword">if</span>(deep)&#123; <span class="comment">// 若是深度监听,重新监听该对象，以便监听其属性。</span></span><br><span class="line">                that.<span class="title function_">observe</span>(obj, key, watchFun, deep, page); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>其中需要特别注意，若是data中先声明一个对象userInfo &#x3D; {}，再给userInfo赋值一个对象(比如从服务器获取用户数据)，则需要重新遍历监听才能实现深度监听，故需加上这段代码：</strong></p><p><strong>if(deep){ &#x2F;&#x2F; 若是深度监听,重新监听该对象，以便监听其属性。<br>    that.observe(obj, key, watchFun, deep);<br>}</strong></p><p>此时index.js中需要深度监听的属性，可以这样写：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"> </span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">my</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;xuyang&#x27;</span>,</span><br><span class="line">            <span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">            <span class="attr">hobby</span>: [<span class="string">&#x27;girls&#x27;</span>, <span class="string">&#x27;games&#x27;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">nameInfo</span>:&#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">getApp</span>().<span class="title function_">setWatcher</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">my</span>.<span class="property">hobby</span>[<span class="number">0</span>] = <span class="string">&#x27;study&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">            <span class="attr">nameInfo</span>:&#123;<span class="attr">name</span>:<span class="string">&#x27;haha&#x27;</span>,<span class="attr">sex</span>:<span class="string">&#x27;boy&#x27;</span>&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">data</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">watch</span>: &#123;</span><br><span class="line">        <span class="attr">my</span>:&#123;</span><br><span class="line">            <span class="title function_">handler</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">deep</span>:<span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>控制台中首先输出 study ，接着输出{ name: ‘haha’, sex: ‘boy’ }，接着输出this.data的值，如下图：</p><p><img src="https://img-blog.csdn.net/20180804144759924?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3h1eWFuZ3hpbmxlaQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p><p>可见my对象以及内部的所有属性都有setter&#x2F;getter，nameInfo对象内也都有setter&#x2F;getter，深度监听完成。</p><p><strong>注：watch只能监听已存在的属性，数组的push(),pop()等方法并不会触发监听函数哦~</strong></p><p><strong><a href="https://github.com/xyxl1997/watch">源码链接</a></strong></p><p>**克隆到本地后，将watch.js复制到项目的util下，在需要监听的页面*<em>按需引入*<em>即可：</em></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//index.js  </span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> watch = <span class="built_in">require</span>(<span class="string">&quot;../../utils/watch.js&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">flag</span>:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>)&#123;</span><br><span class="line">        watch.<span class="title function_">setWatcher</span>(<span class="variable language_">this</span>); <span class="comment">// 设置监听器，建议在onLoad下调用</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;<span class="attr">flag</span>:<span class="literal">false</span>&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">watch</span>:&#123;</span><br><span class="line">        <span class="attr">flag</span>:<span class="keyword">function</span>(<span class="params">newVal,oldVal</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(newVal,oldVal);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>**当然，你也可以*<em>全局引入一次*<em>，但由于小程序的限制，我们还是不得不在每一个页面调用getApp().setWatcher(this);</em></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//app.js</span></span><br><span class="line"><span class="keyword">const</span> watch = <span class="built_in">require</span>(<span class="string">&quot;./utils/watch.js&quot;</span>);</span><br><span class="line"><span class="title class_">App</span>(&#123;</span><br><span class="line">    <span class="title function_">setWatcher</span>(<span class="params">page</span>)&#123;</span><br><span class="line">        watch.<span class="title function_">setWatcher</span>(page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//index.js  </span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">    <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">getApp</span>().<span class="title function_">setWatcher</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 微信 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>webRtc-share</title>
      <link href="/hisai3.github.io/2023/01/14/webRtc-share/"/>
      <url>/hisai3.github.io/2023/01/14/webRtc-share/</url>
      
        <content type="html"><![CDATA[<p>workspace</p><h3 id="webRtc-share"><a href="#webRtc-share" class="headerlink" title="webRtc-share"></a>webRtc-share</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Use of this source code is governed by a BSD-style license</span></span><br><span class="line"><span class="comment"> *  that can be found in the LICENSE file in the root of the source</span></span><br><span class="line"><span class="comment"> *  tree.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;WebRTC code samples&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">itemprop</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Client-side WebRTC code samples&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">itemprop</span>=<span class="string">&quot;image&quot;</span> <span class="attr">content</span>=<span class="string">&quot;../../../images/webrtc-icon-192x192.png&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">itemprop</span>=<span class="string">&quot;name&quot;</span> <span class="attr">content</span>=<span class="string">&quot;WebRTC code samples&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;mobile-web-app-capable&quot;</span> <span class="attr">content</span>=<span class="string">&quot;yes&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">id</span>=<span class="string">&quot;theme-color&quot;</span> <span class="attr">name</span>=<span class="string">&quot;theme-color&quot;</span> <span class="attr">content</span>=<span class="string">&quot;#ffffff&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">base</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>getDisplayMedia<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;192x192&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../../../images/webrtc-icon-192x192.png&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;//fonts.googleapis.com/css?family=Roboto:300,400,500,700&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;link rel=&quot;stylesheet&quot; href=&quot;../../../css/main.css&quot;&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;//webrtc.github.io/samples/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;WebRTC samples homepage&quot;</span>&gt;</span>WebRTC samples<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>getDisplayMedia<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;gum-local&quot;</span> <span class="attr">autoplay</span> <span class="attr">playsinline</span> <span class="attr">muted</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;startButton&quot;</span> <span class="attr">disabled</span>&gt;</span>Start<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;errorMsg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Display the screensharing stream from <span class="tag">&lt;<span class="name">code</span>&gt;</span>getDisplayMedia()<span class="tag">&lt;/<span class="name">code</span>&gt;</span> in a video element.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/webrtc/samples/tree/gh-pages/src/content/getusermedia/getdisplaymedia&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">title</span>=<span class="string">&quot;View source for this page on GitHub&quot;</span> <span class="attr">id</span>=<span class="string">&quot;viewSource&quot;</span>&gt;</span>View source on GitHub<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://webrtc.github.io/adapter/adapter-latest.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- &lt;script src=&quot;../../../js/lib/ga.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>main.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Use of this source code is governed by a BSD-style license</span></span><br><span class="line"><span class="comment"> *  that can be found in the LICENSE file in the root of the source</span></span><br><span class="line"><span class="comment"> *  tree.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Polyfill in Firefox.</span></span><br><span class="line"><span class="comment">// See https://blog.mozilla.org/webrtc/getdisplaymedia-now-available-in-adapter-js/</span></span><br><span class="line"><span class="keyword">if</span> (adapter.<span class="property">browserDetails</span>.<span class="property">browser</span> == <span class="string">&#x27;firefox&#x27;</span>) &#123;</span><br><span class="line">  adapter.<span class="property">browserShim</span>.<span class="title function_">shimGetDisplayMedia</span>(<span class="variable language_">window</span>, <span class="string">&#x27;screen&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleSuccess</span>(<span class="params">stream</span>) &#123;</span><br><span class="line">  startButton.<span class="property">disabled</span> = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">const</span> video = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;video&#x27;</span>)</span><br><span class="line">  video.<span class="property">srcObject</span> = stream</span><br><span class="line"></span><br><span class="line">  <span class="comment">// demonstrates how to detect that the user has stopped</span></span><br><span class="line">  <span class="comment">// sharing the screen via the browser UI.</span></span><br><span class="line">  stream.<span class="title function_">getVideoTracks</span>()[<span class="number">0</span>].<span class="title function_">addEventListener</span>(<span class="string">&#x27;ended&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">errorMsg</span>(<span class="string">&#x27;The user has ended sharing the screen&#x27;</span>)</span><br><span class="line">    startButton.<span class="property">disabled</span> = <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="title function_">errorMsg</span>(<span class="string">`getDisplayMedia error: <span class="subst">$&#123;error.name&#125;</span>`</span>, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">errorMsg</span>(<span class="params">msg, error</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> errorElement = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#errorMsg&#x27;</span>)</span><br><span class="line">  errorElement.<span class="property">innerHTML</span> += <span class="string">`&lt;p&gt;<span class="subst">$&#123;msg&#125;</span>&lt;/p&gt;`</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> error !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> startButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;startButton&#x27;</span>)</span><br><span class="line">startButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  navigator.<span class="property">mediaDevices</span></span><br><span class="line">    .<span class="title function_">getDisplayMedia</span>(&#123; <span class="attr">video</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(handleSuccess, handleError)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (navigator.<span class="property">mediaDevices</span> &amp;&amp; <span class="string">&#x27;getDisplayMedia&#x27;</span> <span class="keyword">in</span> navigator.<span class="property">mediaDevices</span>) &#123;</span><br><span class="line">  startButton.<span class="property">disabled</span> = <span class="literal">false</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getDisplayMedia is not supported&#x27;</span>)</span><br><span class="line">  <span class="title function_">errorMsg</span>(<span class="string">&#x27;getDisplayMedia is not supported&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://github.com/wxiaoshuang/webrtc.git">webRtc-多人视频</a></p>]]></content>
      
      
      <categories>
          
          <category> workspace </category>
          
      </categories>
      
      
        <tags>
            
            <tag> workspace </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webRtc</title>
      <link href="/hisai3.github.io/2023/01/14/webRtc/"/>
      <url>/hisai3.github.io/2023/01/14/webRtc/</url>
      
        <content type="html"><![CDATA[<p>workspace</p><p><a href="https://github.com/wxiaoshuang/webrtc">WebRtc</a></p><p><a href="https://webrtc.github.io/samples/">webRtc-sample</a></p><h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> navigator.<span class="title function_">getUserMedia</span>(</span><br><span class="line">    mediaStreamConstraints,</span><br><span class="line">    gotLocalMediaStream,</span><br><span class="line">    handleLocalMediaStreamError</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment">// mediaStreamConstraints: &#123; // 传输视频，不传输音频</span></span><br><span class="line"><span class="comment">//  video: true,</span></span><br><span class="line"><span class="comment">//  audio: false,</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// gotLocalMediaStream: </span></span><br><span class="line"><span class="comment">// 1.获取视频流 默认参数 mediaStream(getVideoTracks 可获取视频, getAudioTracks 可获取音频)</span></span><br><span class="line"><span class="comment">// 2. 设置vide地址localVideo.srcObject = mediaStream</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// handleLocalMediaStreamError： 错误回调</span></span><br></pre></td></tr></table></figure><h3 id="call"><a href="#call" class="headerlink" title="call"></a>call</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> videoTracks = localStream.<span class="title function_">getVideoTracks</span>() <span class="comment">// 可获取视频</span></span><br><span class="line"><span class="keyword">const</span> audioTracks = localStream.<span class="title function_">getAudioTracks</span>() <span class="comment">// 可获取音频</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> servers = <span class="literal">null</span></span><br><span class="line"><span class="comment">// servers在这个例子中并没有使用，servers是配置STUN and TURN s服务器的，后面我们会介绍这个两种服务器</span></span><br><span class="line"><span class="comment">// A</span></span><br><span class="line">localPeerConnection = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(servers)</span><br><span class="line">localPeerConnection.<span class="title function_">addEventListener</span>(<span class="string">&#x27;icecandidate&#x27;</span>, handleConnection)</span><br><span class="line">localPeerConnection.<span class="title function_">addEventListener</span>( <span class="comment">// 监听ICE state 变化</span></span><br><span class="line">    <span class="string">&#x27;iceconnectionstatechange&#x27;</span>,</span><br><span class="line">    handleConnectionChange</span><br><span class="line">)</span><br><span class="line">localPeerConnection.<span class="title function_">addStream</span>(localStream) </span><br><span class="line"></span><br><span class="line"><span class="comment">// B</span></span><br><span class="line">remotePeerConnection = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(servers)</span><br><span class="line">remotePeerConnection.<span class="title function_">addEventListener</span>(<span class="string">&#x27;icecandidate&#x27;</span>, handleConnection)</span><br><span class="line">remotePeerConnection.<span class="title function_">addEventListener</span>( <span class="comment">// 监听ICE state 变化</span></span><br><span class="line">    <span class="string">&#x27;iceconnectionstatechange&#x27;</span>,</span><br><span class="line">    handleConnectionChange</span><br><span class="line">)</span><br><span class="line">remotePeerConnection.<span class="title function_">addEventListener</span>(<span class="string">&#x27;addstream&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> mediaStream = event.<span class="property">stream</span></span><br><span class="line">  remoteVideo.<span class="property">srcObject</span> = mediaStream</span><br><span class="line">  remoteStream = mediaStream</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置只交换视频</span></span><br><span class="line"><span class="keyword">const</span> offerOptions = &#123;</span><br><span class="line">  <span class="attr">offerToReceiveVideo</span>: <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">localPeerConnection</span><br><span class="line"><span class="comment">// A运行RTCPeerConnection的createOffer()方法，返回一个promise，提供了一个RTCSessionDescription： A的本地会话描述</span></span><br><span class="line">    .<span class="title function_">createOffer</span>(offerOptions) </span><br><span class="line">    .<span class="title function_">then</span>(createdOffer)</span><br><span class="line">    .<span class="title function_">catch</span>(setSessionDescriptionError)</span><br></pre></td></tr></table></figure><h4 id="绑定-icecandidate-事件"><a href="#绑定-icecandidate-事件" class="headerlink" title="绑定 icecandidate 事件"></a>绑定 <code>icecandidate</code> 事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> peerConnection = event.<span class="property">target</span></span><br><span class="line"><span class="keyword">const</span> iceCandidate = event.<span class="property">candidate</span></span><br><span class="line"><span class="comment">// 当网络候选项(candidate)变得可用的时候，onicecandidate的处理器会被调用</span></span><br><span class="line"><span class="comment">// A发送序列化的数据给B, 在真实的应用中，这个过程(交换信令)需要一个信令服务器， </span></span><br><span class="line"><span class="comment">// 当然，在我们这个例子中， 两个RTCPeerConnection在同一个页面中， 可以直接沟通，不需要额外的信令传输</span></span><br><span class="line"><span class="comment">// 当B获取到A的candidate信息的时候, 他会调用addIceCandidate, 将candidate添加到候选中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (iceCandidate) &#123;</span><br><span class="line">    <span class="keyword">const</span> newIceCandidate = <span class="keyword">new</span> <span class="title class_">RTCIceCandidate</span>(iceCandidate)</span><br><span class="line">    <span class="keyword">const</span> otherPeer = <span class="title function_">getOtherPeer</span>(peerConnection)</span><br><span class="line"></span><br><span class="line">    otherPeer</span><br><span class="line">        .<span class="title function_">addIceCandidate</span>(newIceCandidate)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">handleConnectionSuccess</span>(peerConnection)</span><br><span class="line">    &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">handleConnectionFailure</span>(peerConnection, error)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getOtherPeer</span>(<span class="params">peerConnection</span>) &#123; <span class="comment">// 取反 若A拿B 若B拿A: 需(交换信令)</span></span><br><span class="line">  <span class="keyword">return</span> peerConnection === localPeerConnection</span><br><span class="line">    ? remotePeerConnection</span><br><span class="line">    : localPeerConnection</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="createdOffer-成功回调"><a href="#createdOffer-成功回调" class="headerlink" title="createdOffer 成功回调"></a><code>createdOffer</code> 成功回调</h4><blockquote><p>如果<code>createOffer</code>的Promise成功了，A通过<code>setLocalDescription</code>方法将promise成功返回的描述设置成自己的本地描述，</p><p> 并且将描述通过信令通道发送给B, B使用<code>setRemoteDescription</code>将A发送给他的描述设置成自己的远端描述，</p><p> B运行<code>RTCPeerConnection</code>的<code>createAnswer()</code>方法，</p><p> 可以产生一个相匹配的描述，B将自己产生的描述设置为本地描述并且发送给A，</p><p> A将其设置成自己的远端描述</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">localPeerConnection</span><br><span class="line">    .<span class="title function_">setLocalDescription</span>(description) <span class="comment">// 1.A createOffer将promise成功返回的描述设置成自己的本地描述, 通过信令通道发送给B</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setLocalDescriptionSuccess</span>(localPeerConnection) <span class="comment">// 打印而已</span></span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(setSessionDescriptionError)</span><br><span class="line"></span><br><span class="line">remotePeerConnection</span><br><span class="line">    .<span class="title function_">setRemoteDescription</span>(description) <span class="comment">// 2.B将A发送过来的描述设置成自己的远端描述</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setRemoteDescriptionSuccess</span>(remotePeerConnection)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(setSessionDescriptionError)</span><br><span class="line"></span><br><span class="line">remotePeerConnection</span><br><span class="line">    .<span class="title function_">createAnswer</span>() <span class="comment">// 3. B运行RTCPeerConnection的createAnswer()方法 产生一个相匹配的描述</span></span><br><span class="line">    .<span class="title function_">then</span>(createdAnswer)</span><br><span class="line">    .<span class="title function_">catch</span>(setSessionDescriptionError)</span><br></pre></td></tr></table></figure><h4 id="createAnswer-成功回调"><a href="#createAnswer-成功回调" class="headerlink" title="createAnswer 成功回调"></a><code>createAnswer</code> 成功回调</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">remotePeerConnection</span><br><span class="line">    .<span class="title function_">setLocalDescription</span>(description) <span class="comment">// 4. B将自己产生的描述设置为本地描述并且发送给A</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setLocalDescriptionSuccess</span>(remotePeerConnection)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(setSessionDescriptionError)</span><br><span class="line"></span><br><span class="line">localPeerConnection</span><br><span class="line">    .<span class="title function_">setRemoteDescription</span>(description) <span class="comment">// 5. A将B发送过来的描述设置远端描述</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setRemoteDescriptionSuccess</span>(localPeerConnection)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(setSessionDescriptionError)</span><br></pre></td></tr></table></figure><h3 id="hangup"><a href="#hangup" class="headerlink" title="hangup"></a>hangup</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">localPeerConnection.<span class="title function_">close</span>()</span><br><span class="line">remotePeerConnection.<span class="title function_">close</span>()</span><br><span class="line">localPeerConnection = <span class="literal">null</span></span><br><span class="line">remotePeerConnection = <span class="literal">null</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> WebRTC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中间件</title>
      <link href="/hisai3.github.io/2023/01/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
      <url>/hisai3.github.io/2023/01/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h4 id="模拟-Koa-创建的实例"><a href="#模拟-Koa-创建的实例" class="headerlink" title="模拟 Koa 创建的实例"></a>模拟 Koa 创建的实例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = &#123;</span><br><span class="line">    <span class="attr">middlewares</span>: []</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 use 方法</span></span><br><span class="line">app.<span class="property">use</span> = <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    app.<span class="property">middlewares</span>.<span class="title function_">push</span>(fn);</span><br><span class="line">&#125;;</span><br><span class="line">app.<span class="property">compose</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 递归函数</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">index</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果所有中间件都执行完跳出，并返回一个 Promise</span></span><br><span class="line">        <span class="keyword">if</span> (index === app.<span class="property">middlewares</span>.<span class="property">length</span>) <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取出第 index 个中间件并执行</span></span><br><span class="line">        <span class="keyword">const</span> route = app.<span class="property">middlewares</span>[index];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行后返回成功态的 Promise</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title function_">route</span>(<span class="function">() =&gt;</span> <span class="title function_">dispatch</span>(index + <span class="number">1</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取出第一个中间件函数执行</span></span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="comment">// 异步函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        &#125;, <span class="number">3000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> next =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> next =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">fn</span>(); <span class="comment">// 调用异步函数</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> next =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">6</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">compose</span>();</span><br></pre></td></tr></table></figure><h4 id="react"><a href="#react" class="headerlink" title="react"></a>react</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">...funcs</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (funcs.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> arg;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (funcs.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> funcs.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="title function_">a</span>(<span class="title function_">b</span>(...args)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态引入组件</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%8A%A8%E6%80%81%E5%BC%95%E5%85%A5%E7%BB%84%E4%BB%B6/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%8A%A8%E6%80%81%E5%BC%95%E5%85%A5%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h4 id="动态组件"><a href="#动态组件" class="headerlink" title="动态组件"></a>动态组件</h4><p>通过<code>&lt;component&gt;</code>标签上的is属性实现对组件的动态引用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;myComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>is</code>属性的属性值可以为:</p><ul><li>一个已注册过的组件的组件名</li><li>一个组件的选项对象</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="attr">myComponent</span>:&#123;</span><br><span class="line"><span class="title function_">render</span>(<span class="params">h</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;h1&#x27;</span>,<span class="string">&#x27;这是我的组件&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="异步组件"><a href="#异步组件" class="headerlink" title="异步组件"></a>异步组件</h4><p><code>Vue</code>允许以一个函数的方式定义组件,这个函数会在组件需要被渲染的时候触发,并将结果缓存起来以便以后重新渲染</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;MyComponent&#x27;</span>,<span class="keyword">function</span>(<span class="params">resolve</span>)&#123;</span><br><span class="line"><span class="comment">// 通过resolve回调传递一个组件对象</span></span><br><span class="line"><span class="title function_">resolve</span>(&#123;</span><br><span class="line"><span class="title function_">render</span>(<span class="params">h</span>)&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;h1&#x27;</span>,<span class="string">&#x27;这是我的异步组件&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者返回一个<code>Promise</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上面用全局引入的方式,这里使用局部引入的方式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">components</span>:&#123;</span><br><span class="line"><span class="title class_">MyComponent</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span>&#123;</span><br><span class="line"><span class="title function_">resolve</span>(&#123;</span><br><span class="line"><span class="attr">render</span>:<span class="function"><span class="params">h</span>=&gt;</span><span class="title function_">h</span>(<span class="string">&#x27;h1&#x27;</span>,<span class="string">&#x27;这是我的异步组件&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">components</span>:&#123;</span><br><span class="line"><span class="title class_">MyComponent</span>:<span class="function">()=&gt;</span>(&#123;</span><br><span class="line"><span class="comment">// 需要加载的组件 (应该是一个 `Promise` 对象)</span></span><br><span class="line"><span class="attr">component</span>: <span class="title function_">import</span>(<span class="string">&#x27;./MyComponent.vue&#x27;</span>),</span><br><span class="line">  <span class="comment">// 异步组件加载时使用的组件(同步组件)</span></span><br><span class="line">  <span class="attr">loading</span>: <span class="title class_">LoadingComponent</span>,</span><br><span class="line">  <span class="comment">// 加载失败时使用的组件(同步组件)</span></span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">ErrorComponent</span>,</span><br><span class="line">  <span class="comment">// 展示加载时组件的延时时间。默认值是 200 (毫秒),即200毫秒后开始显示加载中组件</span></span><br><span class="line">  <span class="attr">delay</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="comment">// 如果提供了超时时间且组件加载也超时了，</span></span><br><span class="line">  <span class="comment">// 则使用加载失败时使用的组件。默认值是：`Infinity`</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">3000</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="x3D-x3D-import函数-x3D-x3D-动态引入"><a href="#x3D-x3D-import函数-x3D-x3D-动态引入" class="headerlink" title="&#x3D;&#x3D;import函数&#x3D;&#x3D; 动态引入"></a>&#x3D;&#x3D;import函数&#x3D;&#x3D; 动态引入</h4><p>在<code>ECMAScript2020</code>中引入<code>import函数</code>支持动态加载模块,参数与<code>import</code>命令接受的参数相同,它返回一个<code>Promise</code>对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line"><span class="title function_">handleImport</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="title function_">import</span>(<span class="string">&#x27;./a.vue&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data) <span class="comment">// &#123;default:Vue对象&#125;</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以我们常用的异步组件写法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">components</span>:&#123;</span><br><span class="line"><span class="title class_">MyComponent</span>:<span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;./my-component.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>import函数<strong>允许动态路径</strong>,但注意&#x3D;&#x3D;不能&#x3D;&#x3D;是纯动态的</p><ul><li><p>纯动态</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> file=<span class="string">&quot;/components/a.vue&quot;</span></span><br><span class="line"><span class="title function_">import</span>(file)</span><br></pre></td></tr></table></figure></li><li><p>非纯动态</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fileName=<span class="string">&quot;user&quot;</span></span><br><span class="line"><span class="title function_">import</span>(<span class="string">&#x27;@/components/&#x27;</span>+fileName+<span class="string">&#x27;.vue&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul><h4 id="AMD-require方法"><a href="#AMD-require方法" class="headerlink" title="AMD-require方法"></a>AMD-require方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;MyComponent&#x27;</span>,<span class="function"><span class="params">resolve</span>=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">require</span>([<span class="string">&#x27;@/components/my-component.vue&#x27;</span>],resolve)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="动态组件和异步组件结合实现功能"><a href="#动态组件和异步组件结合实现功能" class="headerlink" title="动态组件和异步组件结合实现功能"></a>动态组件和异步组件结合实现功能</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">v-if</span>=<span class="string">&quot;dynamicComponent&quot;</span> <span class="attr">:is</span>=<span class="string">&quot;dynamicComponent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"><span class="attr">computed</span>:&#123;</span><br><span class="line"><span class="title function_">dynamicComponent</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="comment">// 这里通过路由参数判断引入文件</span></span><br><span class="line"><span class="keyword">let</span> filename=<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">filename</span></span><br><span class="line"><span class="keyword">if</span>(filename)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function">()=&gt;</span><span class="title function_">import</span>(<span class="string">&#x27;@/components/dynamic-components/&#x27;</span>+filename+<span class="string">&#x27;.vue&#x27;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数组合</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是组合"><a href="#什么是组合" class="headerlink" title="什么是组合"></a>什么是组合</h2><p>先看一个在 Linux 系统中常用的命令 <code>ps -ef | grep node</code></p><p>这个命令的用处是将系统中与 node 有关的进程显示出来，其中<code>ps -ef</code>是显示所有进程的全格式，<code>grep node</code>是过滤与node有关的内容，<code>|</code>是将左侧的函数的输出作为输入发送给右侧的函数。</p><p>这个例子可能微不足道，但它传达了这样一个理念：</p><blockquote><p>每一个程序的输出可以是另一个尚未可知的程序的输入</p></blockquote><p>按照我们对组合的理解，现假定有<code>compose</code>函数可以实现如下功能：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">...fns</span>)&#123;</span><br><span class="line">    <span class="comment">//忽略</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// compose(f,g)(x) === f(g(x))</span></span><br><span class="line"><span class="comment">// compose(f,g,m)(x) === f(g(m(x)))</span></span><br><span class="line"><span class="comment">// compose(f,g,m)(x) === f(g(m(x)))</span></span><br><span class="line"><span class="comment">// compose(f,g,m,n)(x) === f(g(m(n(x))))</span></span><br><span class="line"><span class="comment">//···</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们可以看到<code>compose</code>函数，会接收若干个函数作为参数，每个函数执行后的输出作为下一个函数的输出，直至最后一个函数的输出作为最终的结果。</p><h2 id="应用-compose-函数"><a href="#应用-compose-函数" class="headerlink" title="应用 compose 函数"></a>应用 compose 函数</h2><p>在创建并完善我们自己的<code>compose</code>函数前，我们先来学习一下如何应用<code>compose</code>函数。</p><p>假定有这样一个需求：对一个给定的数字四舍五入求值，数字为字符型。</p><p>常规实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="string">&#x27;3.56&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> data = <span class="built_in">parseFloat</span>(n);</span><br><span class="line"><span class="keyword">let</span> result = <span class="title class_">Math</span>.<span class="title function_">round</span>(data); <span class="comment">// =&gt;4 最终结果</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在这段代码中，可以看到<code>parseFloat</code>函数的输出作为输入传递给<code>Math.round</code>函数以获得最终结果，这是<code>compose</code>函数能够解决的典型问题。</p><p>用<code>compose</code>函数改写：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> n = <span class="string">&#x27;3.56&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> number = <span class="title function_">compose</span>(<span class="title class_">Math</span>.<span class="property">round</span>,<span class="built_in">parseFloat</span>);</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">number</span>(n); <span class="comment">// =&gt;4 最终结果</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这段代码的核心是通过<code>compose</code>将<code>parseFloat</code>和<code>Math.round</code>组合到一起，返回一个新函数<code>number</code>。</p><blockquote><p>这个组合的过程就是函数式组合！我们将两个函数组合在一起以便能及时的构造出一个新函数！</p></blockquote><p>再举一个例子，假设我们有两个函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">splitIntoSpaces</span> = str =&gt; str.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">count</span> = array =&gt; array.<span class="property">length</span>;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>现希望构建一个新函数以便计算一个字符串中单词的数量，可以很容易的实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> countWords = <span class="title function_">compose</span>(count,splitIntoSpaces);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>调用一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = <span class="title function_">countWords</span>(<span class="string">&#x27;hello your reading about composition&#x27;</span>); <span class="comment">// =&gt; 5</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="开发中组合的用处"><a href="#开发中组合的用处" class="headerlink" title="开发中组合的用处"></a>开发中组合的用处</h2><p>假设我们有这样一个需求：给你一个字符串，将这个字符串转化成大写，然后逆序。</p><p>我们的常规思路如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;jspool&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//先转成大写，然后逆序</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> upperStr = str.<span class="title function_">toUpperCase</span>()</span><br><span class="line">    <span class="keyword">return</span> upperStr.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn</span>(str) <span class="comment">// =&gt; &quot;LOOPSJ&quot;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这段代码实现起来没什么问题，但现在更改了需求，需要在将字符串大写之后，将每个字符拆开并封装成一个数组：</p><p>“jspool” &#x3D;&gt; <code>[&quot;J&quot;,&quot;S&quot;,&quot;P&quot;,&quot;O&quot;,&quot;O&quot;,&quot;L&quot;]</code></p><p>为了实现这个目标，我们需要更改我们之前封装的函数，这其实就破坏了设计模式中的开闭原则。</p><blockquote><p>开闭原则：软件中的对象（类，模块，函数等等）应该对于扩展是开放的，但是对于修改是封闭的。</p></blockquote><p>那么在需求未变更，依然是字符串大写并逆序，应用组合的思想来怎么写呢？</p><p>原需求，我们可以这样实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;jspool&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stringToUpper</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">toUpperCase</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stringReverse</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> toUpperAndReverse = <span class="title function_">compose</span>(stringReverse, stringToUpper)</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">toUpperAndReverse</span>(str) <span class="comment">// &quot;LOOPSJ&quot;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>那么当我们需求变化为字符串大写并拆分为数组时，我们根本不需要修改之前封装过的函数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;jspool&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stringToUpper</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">toUpperCase</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stringReverse</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stringToArray</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> toUpperAndArray = <span class="title function_">compose</span>(stringToArray, stringToUpper)</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">toUpperAndArray</span>(str) <span class="comment">// =&gt; [&quot;J&quot;,&quot;S&quot;,&quot;P&quot;,&quot;O&quot;,&quot;O&quot;,&quot;L&quot;]</span></span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>可以看到当变更需求的时候，我们没有打破以前封装的代码，只是新增了函数功能，然后把函数进行重新组合。</p><blockquote><p>可能有人会有疑问，应用组合的方式书写代码，当需求变更时，依然也修改了代码，不是也算破坏了开闭原则么？其实我们修改的是调用的逻辑代码，并没有修改封装、抽象出来的代码，而这种书写方式也正是开闭原则所提倡的。</p></blockquote><p>我们假设，现在又修改了需求，现在的需求是，将字符串转换为大写之后，截取前3个字符，然后转换为数组，那么我们可以这样实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&#x27;jspool&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stringToUpper</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">toUpperCase</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stringReverse</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getThreeCharacters</span>(<span class="params">str</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">substring</span>(<span class="number">0</span>,<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stringToArray</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> toUpperAndGetThreeAndArray = <span class="title function_">compose</span>(stringToArray, getThreeCharacters,stringToUpper)</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">toUpperAndGetThreeAndArray</span>(str) <span class="comment">// =&gt; [&quot;J&quot;,&quot;S&quot;,&quot;P&quot;]</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>从这个例子，我们可以知道，组合的方式是真的就是抽象单一功能的函数，然后再组成复杂功能，不仅代码逻辑更加清晰，也给维护带来巨大的方便。</p><h2 id="实现组合"><a href="#实现组合" class="headerlink" title="实现组合"></a>实现组合</h2><p>先回看<code>compose</code>函数到底做了什么事：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compose(f,g)(x) === f(g(x))</span></span><br><span class="line"><span class="comment">// compose(f,g,m)(x) === f(g(m(x)))</span></span><br><span class="line"><span class="comment">// compose(f,g,m)(x) === f(g(m(x)))</span></span><br><span class="line"><span class="comment">// compose(f,g,m,n)(x) === f(g(m(n(x))))</span></span><br><span class="line"><span class="comment">//···</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>概括来说，就是接收若干个函数作为参数，返回一个新函数。新函数执行时，按照<code>由右向左</code>的顺序依次执行传入<code>compose</code>中的函数，每个函数的执行结果作为为下一个函数的输入，直至最后一个函数的输出作为最终的输出结果。</p><p>如果<code>compose</code>函数接收的函数数量是固定的，那么实现起来很简单也很好理解。</p><p>只接收两个参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">f,g</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">x</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">f</span>(<span class="title function_">g</span>(x));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>只接收三个参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">f,g,m</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">x</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">f</span>(<span class="title function_">g</span>(<span class="title function_">m</span>(x)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>上面的代码，没什么问题，但是我们要考虑的是<code>compose</code>接收的参数个数是不确定的，我们考虑用rest参数来接收：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">...fns</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">x</span>)&#123;</span><br><span class="line">        <span class="comment">//···</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>现在<code>compose</code>接收的参数<code>fns</code>是一个数组，那么现在思考的问题变成了，如何将数组中的函数<code>从右至左</code>依次执行。</p><p>我们选择数组的<code>reduceRight</code>函数来实现:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">...fns</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">x</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> fns.<span class="title function_">reduceRight</span>(<span class="keyword">function</span>(<span class="params">arg,fn</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">fn</span>(arg);</span><br><span class="line">        &#125;,x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这样我们就实现了<code>compose</code>函数~</p><h2 id="实现管道"><a href="#实现管道" class="headerlink" title="实现管道"></a>实现管道</h2><p><code>compose</code>的数据流是<code>从右至左</code>的，因为最右侧的函数首先执行，最左侧的函数最后执行！</p><p>但有些人喜欢<code>从左至右</code>的执行方式，即最左侧的函数首先执行，最右侧的函数最后执行！</p><blockquote><p>从左至右处理数据流的过程称之为管道(pipeline)!</p></blockquote><p><code>管道(pipeline)</code>的实现同<code>compose</code>的实现方式很类似，因为二者的区别仅仅是数据流的方向不同而已。</p><p>对比<code>compose</code>函数的实现，仅需将<code>reduceRight</code>替换为<code>reduce</code>即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">pipe</span>(<span class="params">...fns</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">x</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> fns.<span class="title function_">reduce</span>(<span class="keyword">function</span>(<span class="params">arg,fn</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">fn</span>(arg);</span><br><span class="line">        &#125;,x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>与<code>组合</code>相比，有些人更喜欢<code>管道</code>。这只是个人偏好，与底层实现无关。重点是<code>pipe</code>和<code>compose</code>做同样的是事情，只是数据流放行不同而已！我们可以在代码中使用<code>pipe</code>或<code>compose</code>，但不要同时使用，因为这会在团队成员中引起混淆。如果要使用，请坚持只用一种组合的风格</p>]]></content>
      
      
      <categories>
          
          <category> 随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>原生小程序配置vant</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%8E%9F%E7%94%9F%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%85%8D%E7%BD%AEvant/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%8E%9F%E7%94%9F%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%85%8D%E7%BD%AEvant/</url>
      
        <content type="html"><![CDATA[<h1 id="原生小程序配置vant"><a href="#原生小程序配置vant" class="headerlink" title="原生小程序配置vant"></a>原生小程序配置vant</h1><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>在空白地方点击 选择在终端打开</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant1.png"></p><h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p>输入npm init 然后 一直按shift</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant2.png" alt="a"></p><p>一直按 不要怕 然后 文件里会出现package.json 的文件</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant2.1.png" alt="a"></p><h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p>输入 npm i @vant&#x2F;weapp -S –production （vant快速入门的地方有这个代码）</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant3.png" alt="a"></p><p> 安装成功 </p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant3.1.png" alt="a"></p><p> 然后 目录会多出 package-lock.json的文件夹 </p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant3.2.png" alt="a"></p><h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h3><p>将 app.json 中的 “style”: “v2” 去除  小程序的新版基础组件强行加上了许多样式，难以覆盖，不关闭将造成部分组件样式混乱</p><p>project.config.json中的setting模块，设置packNpmManually为true，packNpmRelationList中新增对象{“packageJsonPath”: “.&#x2F;package.json”, “miniprogramNpmDistDir”: “.&#x2F;“}</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant4.png" alt="a"></p><h3 id="第五步"><a href="#第五步" class="headerlink" title="第五步"></a>第五步</h3><p>老版本的 微信开发工具 需要点击  右上角的 详情 然后 本地设置 里面有一个 使用npm模块 勾选上 </p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant5.png" alt="a"></p><p> 新版本 不用 直接跳过这一步  （新版本效果图如下 ）</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant5.1.png" alt="a"></p><h3 id="第六步"><a href="#第六步" class="headerlink" title="第六步"></a>第六步</h3><p>左上角的 工具里 找到构建npm </p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant6.png" alt="a"></p><p>然后 目录里 就会多出一个 miniprogram_npm的文件夹</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant6.1.png" alt="a"></p><h3 id="第七步"><a href="#第七步" class="headerlink" title="第七步"></a>第七步</h3><p>就根据 vant文档里走了 </p><p>在app.json 添加自己需要的 组件 </p><p><img src="https://gitee.com/hisai/image-bed/raw/master/wx/vant7.png" alt="a"></p>]]></content>
      
      
      <categories>
          
          <category> 微信 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue UI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>懒加载指令</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h3 id="图片懒加载"><a href="#图片懒加载" class="headerlink" title="图片懒加载"></a>图片懒加载</h3><ol><li>判断浏览器是否支持 <code>IntersectionObserver</code> API，如果支持就使用 <code>IntersectionObserver</code> 实现懒加载，否则则使用 <code>srcoll</code> 事件监听 + 节流的方法实现。</li><li>通过 <code>Vue.directive</code> 注册一个 <code>v-lazy</code> 的指令，暴露一个 <code>install()</code> 函数，供 Vue 调用。</li><li>在 <code>main.js</code> 里 use(指令) 即可调用。</li><li>将组件内 <code>&lt;img&gt;</code> 标签的 <code>src</code> 换成 <code>v-lazy</code> 即可实现图片懒加载。</li></ol><p>新建 <code>LazyLoad.js</code> 文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">LazyLoad</span> = &#123;</span><br><span class="line">  <span class="comment">// install方法</span></span><br><span class="line">  <span class="title function_">install</span>(<span class="params">Vue, options</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> defaultSrc = options.<span class="property">default</span></span><br><span class="line">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;lazy&#x27;</span>, &#123;</span><br><span class="line">      <span class="title function_">bind</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">        <span class="title class_">LazyLoad</span>.<span class="title function_">init</span>(el, binding.<span class="property">value</span>, defaultSrc)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">inserted</span>(<span class="params">el</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">IntersectionObserver</span>) &#123;</span><br><span class="line">          <span class="title class_">LazyLoad</span>.<span class="title function_">observe</span>(el)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title class_">LazyLoad</span>.<span class="title function_">listenerScroll</span>(el)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 初始化</span></span><br><span class="line">  <span class="title function_">init</span>(<span class="params">el, val, def</span>) &#123;</span><br><span class="line">    el.<span class="title function_">setAttribute</span>(<span class="string">&#x27;data-src&#x27;</span>, val)</span><br><span class="line">    el.<span class="title function_">setAttribute</span>(<span class="string">&#x27;src&#x27;</span>, def)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 利用IntersectionObserver监听el</span></span><br><span class="line">  <span class="title function_">observe</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> io = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(<span class="function">(<span class="params">entries</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> realSrc = el.<span class="property">dataset</span>.<span class="property">src</span></span><br><span class="line">      <span class="keyword">if</span> (entries[<span class="number">0</span>].<span class="property">isIntersecting</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (realSrc) &#123;</span><br><span class="line">          el.<span class="property">src</span> = realSrc</span><br><span class="line">          el.<span class="title function_">removeAttribute</span>(<span class="string">&#x27;data-src&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    io.<span class="title function_">observe</span>(el)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 监听scroll事件</span></span><br><span class="line">  <span class="title function_">listenerScroll</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="title class_">LazyLoad</span>.<span class="title function_">throttle</span>(<span class="title class_">LazyLoad</span>.<span class="property">load</span>, <span class="number">300</span>)</span><br><span class="line">    <span class="title class_">LazyLoad</span>.<span class="title function_">load</span>(el)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">handler</span>(el)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 加载真实图片</span></span><br><span class="line">  <span class="title function_">load</span>(<span class="params">el</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> windowHeight = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span></span><br><span class="line">    <span class="keyword">const</span> elTop = el.<span class="title function_">getBoundingClientRect</span>().<span class="property">top</span></span><br><span class="line">    <span class="keyword">const</span> elBtm = el.<span class="title function_">getBoundingClientRect</span>().<span class="property">bottom</span></span><br><span class="line">    <span class="keyword">const</span> realSrc = el.<span class="property">dataset</span>.<span class="property">src</span></span><br><span class="line">    <span class="keyword">if</span> (elTop - windowHeight &lt; <span class="number">0</span> &amp;&amp; elBtm &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (realSrc) &#123;</span><br><span class="line">        el.<span class="property">src</span> = realSrc</span><br><span class="line">        el.<span class="title function_">removeAttribute</span>(<span class="string">&#x27;data-src&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 节流</span></span><br><span class="line">  <span class="title function_">throttle</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timer</span><br><span class="line">    <span class="keyword">let</span> prevTime</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> currTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">      <span class="keyword">const</span> context = <span class="variable language_">this</span></span><br><span class="line">      <span class="keyword">if</span> (!prevTime) prevTime = currTime</span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (currTime - prevTime &gt; delay) &#123;</span><br><span class="line">        prevTime = currTime</span><br><span class="line">        fn.<span class="title function_">apply</span>(context, args)</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      timer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        prevTime = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">        timer = <span class="literal">null</span></span><br><span class="line">        fn.<span class="title function_">apply</span>(context, args)</span><br><span class="line">      &#125;, delay)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LazyLoad</span></span><br></pre></td></tr></table></figure><p>在 <code>main.js</code> 里 use 指令</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">LazyLoad</span> <span class="keyword">from</span> <span class="string">&#x27;./LazyLoad.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">LazyLoad</span>, &#123;</span><br><span class="line">  <span class="attr">default</span>: <span class="string">&#x27;xxx.png&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>将组件内 <code>&lt;img&gt;</code> 标签的 <code>src</code> 换成 <code>v-lazy</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">v-lazy</span>=<span class="string">&quot;xxx.jpg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小功能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue指令 </tag>
            
            <tag> drag </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css 有趣但不常用属性</title>
      <link href="/hisai3.github.io/2023/01/14/%E4%B8%8D%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/"/>
      <url>/hisai3.github.io/2023/01/14/%E4%B8%8D%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h4 id="Motion-Path"><a href="#Motion-Path" class="headerlink" title="Motion Path"></a>Motion Path</h4><p><a href="https://juejin.cn/post/6956030985251061791">探秘神奇的运动路径动画</a></p><p><a href="https://link.juejin.cn/?target=https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial/Paths">svg-path</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    // 只改变运动路径，其他保持一致  参考svg path</span><br><span class="line">    offset-path: <span class="built_in">path</span>(<span class="string">&quot;M 0 0 L 100 0 L 200 0 L 300 100 L 400 0 L 500 100 L 600 0 L 700 100 L 800 0&quot;</span>);</span><br><span class="line">    <span class="attribute">animation</span>: move <span class="number">2000ms</span> infinite alternate linear;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> move &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        offset-distance: <span class="number">0%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        offset-distance: <span class="number">100%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="clic-path"><a href="#clic-path" class="headerlink" title="clic-path"></a>clic-path</h4><p>**裁剪之后不会影响元素的位置, 但是hover在裁剪掉的空白部分无法触发,(事件未测过) **</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要注意的是，所有api里面的百分比都是以元素宽度作为基准来计算的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    circle(radius at x-axis y-axis) </span></span><br><span class="line"><span class="comment">    为了创建圆形，需要给circle传入三个值：圆心的坐标（X值和Y值）以及半径。当定义圆的半径时，我们可以用at关键字来定义圆心坐标。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;   </span><br><span class="line">  <span class="attribute">clip-path</span>: <span class="built_in">circle</span>(<span class="number">50%</span> at <span class="number">50%</span> <span class="number">50%</span>);   </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    ellipse(x-radius y-radius at x-axis y-axis) </span></span><br><span class="line"><span class="comment">    为了实现椭圆，需要给ellipse提供4个值：椭圆的x轴半径、y轴半径、定位椭圆位置的x坐标和y坐标，后面两个值用at关键字和前面两个值分开。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;   </span><br><span class="line">  <span class="attribute">clip-path</span>: <span class="built_in">ellipse</span>(<span class="number">100px</span> <span class="number">200px</span> at <span class="number">50%</span> <span class="number">50%</span>);  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    inset(&lt;top&gt; &lt;right&gt; &lt;bottom&gt; &lt;left&gt; round &lt;top-radius&gt; &lt;right-radius&gt; &lt;bottom-radius&gt; &lt;left-radius&gt;)</span></span><br><span class="line"><span class="comment">    使用四个值（对应“上 右 下 左”的顺序）来裁剪矩形和设置圆角半径。 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;   </span><br><span class="line">  <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">25%</span> <span class="number">0</span> <span class="number">25%</span> <span class="number">0</span> round <span class="number">0</span> <span class="number">25%</span> <span class="number">0</span> <span class="number">25%</span>);  </span><br><span class="line">  <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">25%</span> <span class="number">0</span> round <span class="number">0</span> <span class="number">25%</span>); <span class="comment">/* 简写形式 */</span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    polygon(x1-axis y1-axis, x2-axis y2-axis, … )   </span></span><br><span class="line"><span class="comment">    指定各个节点的坐标，不限制数量，最终将所有点连接起来形成裁剪框，从而裁剪出我们需要的形状</span></span><br><span class="line"><span class="comment">    它是最强大的api，通过它我们可以裁剪出包括但不限于上述所有api的图形 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;   </span><br><span class="line">  <span class="attribute">clip-path</span>: <span class="built_in">polygon</span>(<span class="number">0%</span> <span class="number">0%</span>, <span class="number">100%</span> <span class="number">0%</span>, <span class="number">100%</span> <span class="number">75%</span>, <span class="number">75%</span> <span class="number">75%</span>, <span class="number">75%</span> <span class="number">100%</span>, <span class="number">50%</span> <span class="number">75%</span>, <span class="number">0%</span> <span class="number">75%</span>);   </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><h4 id="background-clip"><a href="#background-clip" class="headerlink" title="background-clip"></a>background-clip</h4><p>background-clip:text 文字镂空</p><blockquote><p>元素 <strong>背景</strong> 会按照文字裁剪掉多余部分, 将文字颜色去掉即可镂空</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background</span>: red;</span><br><span class="line"><span class="attribute">color</span>: transparent;</span><br><span class="line">-webkit-<span class="attribute">background-clip</span>: text;</span><br><span class="line"><span class="attribute">background-clip</span>: text;</span><br></pre></td></tr></table></figure><h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p><code>blur</code>: 当blur滤镜和contrast滤镜一起使用时，会产生一种 <a href="https://codepen.io/alphardex/pen/BaBevXm">融合（gooey）的奇特效果</a></p><h4 id="backdrop-filter"><a href="#backdrop-filter" class="headerlink" title="backdrop-filter"></a>backdrop-filter</h4><p><a href="https://codepen.io/alphardex/pen/pooQMVp">毛玻璃</a> 图片做背景, 空元素做blur() ?</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 关键词值 */</span></span><br><span class="line">backdrop-<span class="attribute">filter</span>: none;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 指向 SVG 滤镜的 URL */</span></span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">url</span>(<span class="string">commonfilters.svg#filter</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* &lt;filter-function&gt; 滤镜函数值 */</span></span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">2px</span>);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">brightness</span>(<span class="number">60%</span>);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">contrast</span>(<span class="number">40%</span>);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">drop-shadow</span>(<span class="number">4px</span> <span class="number">4px</span> <span class="number">10px</span> blue);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">grayscale</span>(<span class="number">30%</span>);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">hue-rotate</span>(<span class="number">120deg</span>);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">invert</span>(<span class="number">70%</span>);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">opacity</span>(<span class="number">20%</span>);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">sepia</span>(<span class="number">90%</span>);</span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">saturate</span>(<span class="number">80%</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 多重滤镜 */</span></span><br><span class="line">backdrop-<span class="attribute">filter</span>: <span class="built_in">url</span>(<span class="string">filters.svg#filter</span>) <span class="built_in">blur</span>(<span class="number">4px</span>) <span class="built_in">saturate</span>(<span class="number">150%</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 全局值 */</span></span><br><span class="line">backdrop-<span class="attribute">filter</span>: inherit;</span><br><span class="line">backdrop-<span class="attribute">filter</span>: initial;</span><br><span class="line">backdrop-<span class="attribute">filter</span>: unset;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sun&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bk&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.sun</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">130px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">130px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ff6260</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">animation</span>: sunRise <span class="number">5S</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.bk</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: sticky;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: green;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">64px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">130px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: transparent;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">32px</span>;</span><br><span class="line">  backdrop-<span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">20px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="mix-blend-mode"><a href="#mix-blend-mode" class="headerlink" title="mix-blend-mode"></a>mix-blend-mode</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mix-blend-mode">MDN</a><br><a href="https://codepen.io/alphardex/full/wvvLYpV">文本视频蒙版效果</a></p><h4 id="webkit-box-reflect"><a href="#webkit-box-reflect" class="headerlink" title="webkit-box-reflect"></a>webkit-box-reflect</h4><p><a href="https://caniuse.com/?search=webkit-box-reflect">倒影</a></p><p><a href="https://juejin.cn/post/7184250130004967485">巧用视觉障眼法，还原 3D 文字特效</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">    //...</span><br><span class="line">    -webkit-box-reflect: below -<span class="number">6vw</span> <span class="built_in">linear-gradient</span>(transparent <span class="number">20%</span>, <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>, .<span class="number">6</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>富文本组件</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%AF%8C%E6%96%87%E6%9C%AC/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%AF%8C%E6%96%87%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h4 id="项目中使用"><a href="#项目中使用" class="headerlink" title="项目中使用"></a>项目中使用</h4><ol><li>列子： <code>gitee</code> 中 <code>branch/editor</code></li><li>Vue项目中使用</li></ol><ul><li><p>使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Editor</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ref</span>=<span class="string">&quot;editor&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:value</span>=<span class="string">&quot;rulesValue&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">onChange</span>=<span class="string">&quot;onChange&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>组件封装</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:id</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ref</span>=<span class="string">&quot;Editor&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;editor&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:contenteditable</span>=<span class="string">&quot;!disabled&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">input</span>=<span class="string">&quot;onChange&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">blur</span>=<span class="string">&quot;onBlur&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-html</span>=<span class="string">&quot;value&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; randomId &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/util&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;Editor&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 不支持 v-model 在修改内容过程中不能对value直接复制或修改 否则影响光标定位</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">value</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">disabled</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">range</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">id</span>: <span class="title function_">randomId</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Editor</span>() &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">Editor</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">hasEl</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> !!<span class="variable language_">this</span>.<span class="property">Editor</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">async</span> <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取内容</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getContents</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">hasEl</span> ? <span class="variable language_">this</span>.<span class="property">Editor</span>.<span class="property">innerText</span> : <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 记录光标位置</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">saveSelection</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">getSelection</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> selection = <span class="variable language_">window</span>.<span class="title function_">getSelection</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (selection.<span class="property">getRangeAt</span> &amp;&amp; selection.<span class="property">rangeCount</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">range</span> = selection.<span class="title function_">getRangeAt</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">selection</span> &amp;&amp; <span class="variable language_">document</span>.<span class="property">selection</span>.<span class="property">createRange</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">range</span> = <span class="variable language_">document</span>.<span class="property">selection</span>.<span class="title function_">createRange</span>()</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">range</span> = <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 恢复光标位置</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">restoreSelection</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; range &#125; = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">range</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">getSelection</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> selection = <span class="variable language_">window</span>.<span class="title function_">getSelection</span>()</span></span><br><span class="line"><span class="language-javascript">          selection.<span class="title function_">removeAllRanges</span>()</span></span><br><span class="line"><span class="language-javascript">          selection.<span class="title function_">addRange</span>(range)</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">selection</span> &amp;&amp; range.<span class="property">select</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          range.<span class="title function_">select</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 聚焦</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">set_focus</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">range</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restoreSelection</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 将光标移到最后</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> range = <span class="variable language_">document</span>.<span class="title function_">createRange</span>()</span></span><br><span class="line"><span class="language-javascript">      range.<span class="title function_">selectNodeContents</span>(<span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">Editor</span>)</span></span><br><span class="line"><span class="language-javascript">      range.<span class="title function_">collapse</span>(<span class="literal">false</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> selection = <span class="variable language_">window</span>.<span class="title function_">getSelection</span>()</span></span><br><span class="line"><span class="language-javascript">      selection.<span class="title function_">removeAllRanges</span>()</span></span><br><span class="line"><span class="language-javascript">      selection.<span class="title function_">addRange</span>(range)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 插入内容 html片段或文本</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">insertData</span>(<span class="params">html</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">hasEl</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> sel, range</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">getSelection</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// IE9 and non-IE</span></span></span><br><span class="line"><span class="language-javascript">        sel = <span class="variable language_">window</span>.<span class="title function_">getSelection</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">Editor</span>.<span class="title function_">contains</span>(sel.<span class="property">focusNode</span>)) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (sel.<span class="property">getRangeAt</span> &amp;&amp; sel.<span class="property">rangeCount</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          range = sel.<span class="title function_">getRangeAt</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">          range.<span class="title function_">deleteContents</span>()</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">          el.<span class="property">innerHTML</span> = html</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> frag = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>()</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> node</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> lastNode</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">while</span> ((node = el.<span class="property">firstChild</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// appendChild 具有移动性相当于把el中节点移动过去letfragment</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 即：每次取div的firstChild 移动到frg中，直到全部都移入</span></span></span><br><span class="line"><span class="language-javascript">            lastNode = frag.<span class="title function_">appendChild</span>(node)</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          range.<span class="title function_">insertNode</span>(frag)</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">onChange</span>()</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (lastNode) &#123;</span></span><br><span class="line"><span class="language-javascript">            range = range.<span class="title function_">cloneRange</span>()</span></span><br><span class="line"><span class="language-javascript">            range.<span class="title function_">setStartAfter</span>(lastNode)</span></span><br><span class="line"><span class="language-javascript">            range.<span class="title function_">collapse</span>(<span class="literal">true</span>)</span></span><br><span class="line"><span class="language-javascript">            sel.<span class="title function_">removeAllRanges</span>()</span></span><br><span class="line"><span class="language-javascript">            sel.<span class="title function_">addRange</span>(range)</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">selection</span> &amp;&amp; <span class="variable language_">document</span>.<span class="property">selection</span>.<span class="property">type</span> !== <span class="string">&#x27;Control&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// IE &lt; 9</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">selection</span>.<span class="title function_">createRange</span>().<span class="title function_">pasteHTML</span>(html)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onBlur</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">saveSelection</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;onBlur&#x27;</span>, e)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onChange</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;onChange&#x27;</span>, <span class="variable language_">this</span>.<span class="property">Editor</span>.<span class="property">innerHTML</span>, <span class="variable language_">this</span>.<span class="title function_">getContents</span>())</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.editor</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-top</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">outline</span>: <span class="number">1px</span> solid <span class="number">#dcdfe6</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">overflow-x</span>: hidden;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">overflow-y</span>: auto;</span></span><br><span class="line"><span class="language-css">  &amp;<span class="selector-pseudo">:focus</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">outline</span>: <span class="number">1px</span> solid <span class="number">#409EFF</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h4><ul><li><p>使用<code>contenteditable</code>自定义富文本<br><a href="https://www.jianshu.com/p/6446412475fb/">contenteditable</a><br><a href="https://juejin.cn/post/7018355368996634638">100行代码实现简单的富文本编辑器</a><br><a href="https://juejin.cn/post/6933468744144388103">VUE + Jquery 集成的一个简易数学公式编辑器</a><br><a href="https://blog.csdn.net/BlackJunffg/article/details/121511004">contentEditable 光标处理1</a><br><a href="https://blog.csdn.net/hhy1006894859/article/details/89920899">contentEditable 光标处理2</a><br><a href="https://blog.csdn.net/weixin_40629244/article/details/104642683">contentEditable 光标处理3</a></p></li><li><p>插件quill<br><a href="https://quilljs.com/docs/api/">quill 文档</a><br><a href="https://www.kancloud.cn/liuwave/quill/1409375#register_44">quill 中文文档</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> Vue </tag>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小程序利用safe-area-inset-兼容iPhoneX</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%88%A9%E7%94%A8safe-area-inset-%E5%85%BC%E5%AE%B9iPhoneX/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%88%A9%E7%94%A8safe-area-inset-%E5%85%BC%E5%AE%B9iPhoneX/</url>
      
        <content type="html"><![CDATA[<h1 id="小程序利用safe-area-inset-兼容iPhoneX"><a href="#小程序利用safe-area-inset-兼容iPhoneX" class="headerlink" title="小程序利用safe-area-inset-*兼容iPhoneX"></a>小程序利用safe-area-inset-*兼容iPhoneX</h1><p><a href="https://webkit.org/blog/7929/designing-websites-for-iphone-x/?hmsr=funteas.com&amp;amp;utm_medium=funteas.com&amp;amp;utm_source=funteas.com">苹果官方文档</a></p><p><strong>分别创建屏幕上边框，右边框，下边框，左边框安全距离：</strong><br>safe-area-inset-top，<br>safe-area-inset-right，<br>safe-area-inset-bottom，<br>safe-area-inset-left</p><p><strong>使用：</strong><br><strong>iOS 11</strong><br>padding-top: constant(safe-area-inset-top);<br>padding-right: constant(safe-area-inset-right);<br>padding-bottom: constant(safe-area-inset-bottom);<br>padding-left: constant(safe-area-inset-left);</p><p><strong>iOS 11.2 beta及其后</strong><br>padding-top: env(safe-area-inset-top);<br>padding-right: env(safe-area-inset-right);<br>padding-bottom: env(safe-area-inset-bottom);<br>padding-left: env(safe-area-inset-left);</p><p><strong>兼容性写法：</strong><br>padding-top: 10px;<br>padding-top: constant(safe-area-inset-top);<br>padding-top: env(safe-area-inset-top);</p><p><strong>与calc合用：</strong><br>padding-top: 10px;<br>padding-top: calc(10px + constant(safe-area-inset-top));<br>padding-top: calc(10px + env(safe-area-inset-top));</p><p><strong>终！使用sass@mixin：</strong><br>@mixin x-padding-bottom($val:0px) {<br>padding-bottom: $val;<br>padding-bottom: calc(#{$val &#x2F; 2} + constant(safe-area-inset-bottom)); &#x2F;* no <em>&#x2F;<br>padding-bottom: calc(#{$val &#x2F; 2} + env(safe-area-inset-bottom)); &#x2F;</em> no *&#x2F;<br>}</p><p><strong>注意！！！<br>1、默认值为0px，不是0，原因是calc不支持与0计算。<br>2、小程序单位为rpx，一般都会转换为rpx，但是calc不支持，所以不允许转换，保持px。</strong></p>]]></content>
      
      
      <categories>
          
          <category> 微信 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> 微信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前端实现导出 exceljs</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%AF%BC%E5%87%BA/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%AF%BC%E5%87%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="安装-exceljs"><a href="#安装-exceljs" class="headerlink" title="安装 exceljs"></a>安装 exceljs</h3><p><code>npm install exceljs</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历树</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">dfs</span>(<span class="params">arr, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> stack = [...arr]</span><br><span class="line">  <span class="keyword">while</span> (stack.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> item = stack.<span class="title function_">shift</span>()</span><br><span class="line">    <span class="keyword">if</span> (fn &amp;&amp; <span class="title function_">fn</span>(item)) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      stack.<span class="title function_">unshift</span>(...item.<span class="property">children</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; dfs &#125; <span class="keyword">from</span> <span class="string">&#x27;@/components/ElVirtualTable/util&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; cloneDeep &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ExcelJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;exceljs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置列的宽度  按单元格内容长度计算</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">autoWidthAction</span> = (<span class="params">val, width = <span class="number">10</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (val == <span class="literal">null</span>) &#123;</span><br><span class="line">    width = <span class="number">10</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (val.<span class="title function_">toString</span>().<span class="title function_">charCodeAt</span>(<span class="number">0</span>) &gt; <span class="number">255</span>) &#123;</span><br><span class="line">    <span class="comment">/* if chinese */</span></span><br><span class="line">    width = val.<span class="title function_">toString</span>().<span class="property">length</span> * <span class="number">2</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    width = val.<span class="title function_">toString</span>().<span class="property">length</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> width</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">addCellStyle</span> = (<span class="params">cell, attr</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; color, fontSize, horizontal, bold &#125; = attr || &#123;&#125;</span><br><span class="line">  cell.<span class="property">font</span> = &#123;</span><br><span class="line">    <span class="attr">bold</span>: !!bold,</span><br><span class="line">    <span class="attr">size</span>: fontSize || <span class="number">12</span>,</span><br><span class="line">    <span class="attr">lineHeight</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="comment">// italic: true,</span></span><br><span class="line">    <span class="comment">// name: &#x27;微软雅黑&#x27;,</span></span><br><span class="line">    <span class="attr">color</span>: &#123; <span class="attr">argb</span>: color || <span class="string">&#x27;4d4d4d&#x27;</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  cell.<span class="property">alignment</span> = &#123; <span class="attr">vertical</span>: <span class="string">&#x27;middle&#x27;</span>, <span class="attr">wrapText</span>: <span class="literal">true</span>, <span class="attr">horizontal</span>: horizontal || <span class="string">&#x27;center&#x27;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否数字类型 最好是在columns中加属性判断</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleNumFmt</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span> &amp;&amp; <span class="regexp">/^\d+(\,|\d|\.)*\d+$/</span>.<span class="title function_">test</span>(value)</span><br><span class="line">    ? <span class="title class_">Number</span>(value.<span class="title function_">replace</span>(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    : value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理表头包含树结构 </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">handleColumns</span>(<span class="params">list, data = []</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> children = []</span><br><span class="line">  <span class="keyword">const</span> row = []</span><br><span class="line">  <span class="keyword">let</span> hasChildren = <span class="literal">false</span>;</span><br><span class="line">  (list || []).<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, i</span>) =&gt;</span> &#123;</span><br><span class="line">    row.<span class="title function_">push</span>(item.<span class="property">label</span>)</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="title function_">dfs</span>([item], <span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!child.<span class="property">children</span> || !child.<span class="property">children</span>.<span class="property">length</span>) row.<span class="title function_">push</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      row.<span class="title function_">pop</span>()</span><br><span class="line">      children.<span class="title function_">push</span>(...<span class="title function_">cloneDeep</span>(item.<span class="property">children</span>))</span><br><span class="line">      hasChildren = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      children.<span class="title function_">push</span>(&#123; ...item &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  data.<span class="title function_">push</span>(row)</span><br><span class="line">  <span class="keyword">if</span> (hasChildren) <span class="title function_">handleColumns</span>(children, data)</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置序号  树结构 --&gt; 1.1  1.1.1  1.2.1 ...</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setIndex</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> queue = [...data]</span><br><span class="line">  <span class="keyword">let</span> loop = <span class="number">0</span></span><br><span class="line">  <span class="keyword">while</span> (queue.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    loop++;</span><br><span class="line">    [...queue].<span class="title function_">forEach</span>(<span class="function">(<span class="params">child, i</span>) =&gt;</span> &#123;</span><br><span class="line">      queue.<span class="title function_">shift</span>()</span><br><span class="line">      <span class="keyword">if</span> (loop === <span class="number">1</span>) &#123;</span><br><span class="line">        child.<span class="property">customIndex</span> = i + <span class="number">1</span> + <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (child.<span class="property">children</span> &amp;&amp; child.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> ci = <span class="number">0</span>; ci &lt; child.<span class="property">children</span>.<span class="property">length</span>; ci++) &#123;</span><br><span class="line">          child.<span class="property">children</span>[ci].<span class="property">customIndex</span> = child.<span class="property">customIndex</span> + <span class="string">&#x27;.&#x27;</span> + (ci + <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        queue.<span class="title function_">push</span>(...child.<span class="property">children</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">translateLetter</span>(<span class="params">j</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> letterMap = [</span><br><span class="line">    <span class="string">&#x27;Z&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="keyword">if</span> (j &lt; <span class="number">26</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> letterMap[j]</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> repeatTime = <span class="title class_">Math</span>.<span class="title function_">floor</span>(j / <span class="number">26</span>)</span><br><span class="line">    <span class="keyword">const</span> rest = j % <span class="number">26</span></span><br><span class="line">    <span class="keyword">return</span> letterMap[rest === <span class="number">0</span> ? repeatTime - <span class="number">1</span> : repeatTime] + letterMap[rest]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getMergeCell</span>(<span class="params">list</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> mergeCells = []</span><br><span class="line">  <span class="keyword">let</span> colFlag = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">let</span> rowFlag = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> rowRecode = &#123;&#125;</span><br><span class="line">  list.<span class="title function_">forEach</span>(<span class="function">(<span class="params">row, i</span>) =&gt;</span> &#123;</span><br><span class="line">    row.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, j</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 垂直合并</span></span><br><span class="line">      <span class="keyword">let</span> i2 = i + <span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (item &amp;&amp; !rowRecode[i + <span class="string">&#x27;-&#x27;</span> + j]) &#123;</span><br><span class="line">        <span class="keyword">for</span> (i2; i2 &lt; list.<span class="property">length</span>; i2++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (list[i2][j] !== item) <span class="keyword">break</span></span><br><span class="line">          rowFlag = <span class="literal">true</span></span><br><span class="line">          rowRecode[i2 + <span class="string">&#x27;-&#x27;</span> + j] = item</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (rowFlag) &#123;</span><br><span class="line">          <span class="keyword">const</span> x = <span class="title function_">translateLetter</span>(j + <span class="number">1</span>)</span><br><span class="line">          mergeCells.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;x + (i + <span class="number">1</span>)&#125;</span>:<span class="subst">$&#123;x + (i2)&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        rowFlag = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 横向合并</span></span><br><span class="line">      <span class="keyword">if</span> (item) &#123;</span><br><span class="line">        <span class="keyword">let</span> j2 = j + <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> (j2; j2 &lt; row.<span class="property">length</span>; j2++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (row[j2]) <span class="keyword">break</span></span><br><span class="line">          colFlag = <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (colFlag) &#123;</span><br><span class="line">          <span class="keyword">const</span> y = i + <span class="number">1</span></span><br><span class="line">          mergeCells.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;translateLetter(j + <span class="number">1</span>) + y&#125;</span>:<span class="subst">$&#123;translateLetter(j2) + y&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        colFlag = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> mergeCells</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">exportExcel</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  &#123;</span></span><br><span class="line"><span class="params">    column,</span></span><br><span class="line"><span class="params">    data,</span></span><br><span class="line"><span class="params">    filename = <span class="string">&#x27;报表&#x27;</span>,</span></span><br><span class="line"><span class="params">    mergeCells, // [<span class="string">&#x27;A1:A2&#x27;</span>, <span class="string">&#x27;B1:B2&#x27;</span>, <span class="string">&#x27;C1:C2&#x27;</span>]</span></span><br><span class="line"><span class="params">    hasIndex = <span class="literal">false</span>,</span></span><br><span class="line"><span class="params">    collect</span></span><br><span class="line"><span class="params">  &#125;</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 创建excel</span></span><br><span class="line">  <span class="keyword">const</span> workbook = <span class="keyword">new</span> <span class="title class_">ExcelJS</span>.<span class="title class_">Workbook</span>()</span><br><span class="line">  <span class="comment">// 创建工作表</span></span><br><span class="line">  <span class="keyword">const</span> sheet = workbook.<span class="title function_">addWorksheet</span>(<span class="string">&#x27;sheet1&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> list = <span class="title function_">cloneDeep</span>(data)</span><br><span class="line">  column = column.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">isShow</span> !== <span class="literal">false</span>)</span><br><span class="line">  <span class="keyword">if</span> (hasIndex) &#123;</span><br><span class="line">    column.<span class="title function_">unshift</span>(&#123; <span class="attr">prop</span>: <span class="string">&#x27;customIndex&#x27;</span>, <span class="attr">label</span>: <span class="string">&#x27;序号&#x27;</span> &#125;)</span><br><span class="line">    <span class="title function_">setIndex</span>(list)</span><br><span class="line">    <span class="keyword">if</span> (collect) &#123;</span><br><span class="line">      collect.<span class="property">customIndex</span> = collect.<span class="property">customIndex</span> || <span class="string">&#x27;&#x27;</span></span><br><span class="line">      list.<span class="title function_">unshift</span>(collect)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 表头处理</span></span><br><span class="line">  <span class="keyword">const</span> headerCells = <span class="title function_">handleColumns</span>(column)</span><br><span class="line">  headerCells.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, i</span>) =&gt;</span> &#123;</span><br><span class="line">    sheet.<span class="title function_">getRow</span>(i + <span class="number">1</span>).<span class="property">values</span> = item</span><br><span class="line">    <span class="keyword">const</span> row = sheet.<span class="title function_">getRow</span>(i + <span class="number">1</span>)</span><br><span class="line">    row.<span class="title function_">eachCell</span>(<span class="function">(<span class="params">cell</span>) =&gt;</span> <span class="title function_">addCellStyle</span>(cell, &#123; <span class="attr">bold</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 合并单元格</span></span><br><span class="line">  mergeCells = mergeCells || <span class="title function_">getMergeCell</span>(headerCells)</span><br><span class="line">  mergeCells.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    sheet.<span class="title function_">mergeCells</span>(item)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> tableData = []</span><br><span class="line">  <span class="keyword">let</span> i = headerCells.<span class="property">length</span> + <span class="number">1</span> || <span class="number">1</span></span><br><span class="line">  <span class="title function_">dfs</span>(list, <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> row = &#123; ...item &#125;</span><br><span class="line">    tableData.<span class="title function_">push</span>(row)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> headers = []</span><br><span class="line">  <span class="title function_">dfs</span>(column, <span class="function"><span class="params">col</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!col.<span class="property">children</span> || !col.<span class="property">children</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> maxArr = [<span class="title function_">autoWidthAction</span>(col.<span class="property">label</span>)]</span><br><span class="line">      tableData.<span class="title function_">forEach</span>(<span class="function"><span class="params">ite</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> str = ite[col.<span class="property">prop</span>]</span><br><span class="line">        <span class="keyword">if</span> (str) &#123;</span><br><span class="line">          maxArr.<span class="title function_">push</span>(<span class="title function_">autoWidthAction</span>(str || <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (col.<span class="property">prop</span> !== <span class="string">&#x27;customIndex&#x27;</span>) &#123;</span><br><span class="line">          ite[col.<span class="property">prop</span>] = <span class="title function_">handleNumFmt</span>(str)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// console.log(&#x27;col.isRate--&gt;&gt;&gt;&gt;&#x27;, col.isRate)</span></span><br><span class="line">      <span class="comment">// 设置列名、键和宽度</span></span><br><span class="line">      headers.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">key</span>: col.<span class="property">prop</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="title class_">Math</span>.<span class="title function_">max</span>(...maxArr) + <span class="number">5</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// console.log(&#x27;headers-data-&gt;&gt;&gt;&gt;&#x27;, headers)</span></span><br><span class="line"></span><br><span class="line">  sheet.<span class="property">columns</span> = headers</span><br><span class="line">  sheet.<span class="title function_">addRows</span>(tableData)</span><br><span class="line">  <span class="title function_">dfs</span>(tableData, <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> row = sheet.<span class="title function_">getRow</span>(i)</span><br><span class="line">    row.<span class="title function_">eachCell</span>(<span class="function"><span class="params">cell</span> =&gt;</span> <span class="title function_">addCellStyle</span>(cell))</span><br><span class="line">    i++</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// console.log(&#x27;this.tableData-data-&gt;&gt;&gt;&gt;&#x27;, tableData)</span></span><br><span class="line">  <span class="comment">// return</span></span><br><span class="line">  <span class="comment">// 写入文件</span></span><br><span class="line">  workbook.<span class="property">xlsx</span>.<span class="title function_">writeBuffer</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([data, &#123; <span class="attr">type</span>: <span class="string">&#x27;application/vnd.ms-excel&#x27;</span> &#125;])</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">navigator</span>.<span class="property">msSaveOrOpenBlob</span>) &#123;</span><br><span class="line">      <span class="comment">// msSaveOrOpenBlob方法返回boolean值</span></span><br><span class="line">      navigator.<span class="title function_">msSaveBlob</span>(blob, filename + <span class="string">&#x27;.xlsx&#x27;</span>)</span><br><span class="line">      <span class="comment">// 本地保存</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>) <span class="comment">// a标签下载</span></span><br><span class="line">      link.<span class="property">href</span> = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(blob) <span class="comment">// href属性指定下载链接</span></span><br><span class="line">      link.<span class="property">download</span> = filename + <span class="string">&#x27;.xlsx&#x27;</span> <span class="comment">// dowload属性指定文件名</span></span><br><span class="line">      link.<span class="title function_">click</span>() <span class="comment">// click()事件触发下载</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">revokeObjectURL</span>(link.<span class="property">href</span>) <span class="comment">// 释放内存</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h4><p><a href="https://github.com/exceljs/exceljs#readme">excel.js gihub</a><br><a href="https://blog.csdn.net/qq_40595893/article/details/124796429">前端导出Excel（自定义样式、多级表头、普通导出）</a><br><a href="http://t.zoukankan.com/kyrie1-p-14553527.html">Exceljs使用</a><br><a href="https://blog.csdn.net/weixin_41852038/article/details/112181759">Vue用Export2Excel导出excel,多级表头数据</a><br><a href="https://blog.csdn.net/weixin_38457055/article/details/88969904"><code>file-saver、xlsx</code>  实现element表格导出为excel表格</a></p>]]></content>
      
      
      <categories>
          
          <category> 随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>展开收起 自适应高度</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%B1%95%E5%BC%80%E6%94%B6%E8%B5%B7%20%E8%87%AA%E9%80%82%E5%BA%94%E9%AB%98%E5%BA%A6/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%B1%95%E5%BC%80%E6%94%B6%E8%B5%B7%20%E8%87%AA%E9%80%82%E5%BA%94%E9%AB%98%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="展开收起-自适应高度"><a href="#展开收起-自适应高度" class="headerlink" title="展开收起 自适应高度"></a>展开收起 自适应高度</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;colep&quot;</span> <span class="attr">draggable</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px; height: 100px; margin: 0 auto; background-color: bisque;&quot;</span>&gt;</span>move<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.colep</span> &#123;</span><br><span class="line">    <span class="attribute">overflow</span>: hiden;</span><br><span class="line">    <span class="attribute">background-color</span>: aqua;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="comment">/* 自适应可以不设置高度 */</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>; </span><br><span class="line">    <span class="attribute">transition</span>: all .<span class="number">3s</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> colep = $(<span class="string">&#x27;.colep&#x27;</span>)</span><br><span class="line">$(<span class="string">&#x27;.btn&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">const</span> scrollHeight = colep[<span class="number">0</span>].<span class="property">scrollHeight</span></span><br><span class="line">    $(<span class="string">&#x27;.colep&#x27;</span>)[<span class="number">0</span>].<span class="property">style</span>.<span class="property">height</span> = colep.<span class="title function_">height</span>() !== <span class="number">0</span> ? <span class="string">&#x27;0&#x27;</span> : scrollHeight + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">    <span class="comment">// 如果设置了高度 第一次获取的就是200， 后面是100(即: colep内容撑开的高度)</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;scrollHeight&#x27;</span>, colep[<span class="number">0</span>].<span class="property">scrollHeight</span>); </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小功能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> 小功能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>拖拽缩放</title>
      <link href="/hisai3.github.io/2023/01/14/%E6%8B%96%E6%8B%BD%E7%BC%A9%E6%94%BE/"/>
      <url>/hisai3.github.io/2023/01/14/%E6%8B%96%E6%8B%BD%E7%BC%A9%E6%94%BE/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;//cdn.bootcss.com/jquery/3.1.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">html</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">padding</span>: <span class="number">50px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.drag-wrap</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">border</span>: slategray <span class="number">1px</span> solid;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">cursor</span>: move;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.dot</span> &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">width</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">height</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">border</span>: red <span class="number">1px</span> solid;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.dot</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">2</span>n-<span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">left</span>: -<span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">cursor</span>: ne-resize</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.dot</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">2</span>n) &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">right</span>: -<span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">cursor</span>: se-resize</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.dot</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">1</span>),</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.dot</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">top</span>: -<span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.dot</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">3</span>),</span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.dot</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="language-css">          <span class="attribute">bottom</span>: -<span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;drag-wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dot dot1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;dot dot4&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> dragWrap = $(<span class="string">&#x27;.drag-wrap&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> dot4 = $(<span class="string">&#x27;.dot4&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  dragWrap.<span class="title function_">on</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="keyword">function</span> <span class="title function_">down</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> d_top_old = e.<span class="property">target</span>.<span class="property">offsetTop</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> d_left_old = e.<span class="property">target</span>.<span class="property">offsetLeft</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> top_space = (e.<span class="property">clientY</span> - d_top_old)</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> left_space = (e.<span class="property">clientX</span> - d_left_old)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 注意：移动事件绑定在 目标元素中，容易脱离，绑定在document中也会有其他问题，可能是边界未处理好</span></span></span><br><span class="line"><span class="language-javascript">    dragWrap.<span class="title function_">on</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> maxX = $(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">width</span>() - e.<span class="property">target</span>.<span class="property">offsetWidth</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> maxY = $(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">height</span>() - e.<span class="property">target</span>.<span class="property">offsetHeight</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> m_clientX = e.<span class="property">clientX</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> m_clientY = e.<span class="property">clientY</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> top = m_clientY - top_space</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> left = m_clientX - left_space</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> top &lt; <span class="number">0</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="number">0</span> + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> top &gt; <span class="attr">maxY</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">top</span> = maxY + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">default</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">top</span> = top + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> left &lt; <span class="number">0</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">left</span> = <span class="number">0</span> + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> left &gt; <span class="attr">maxX</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">left</span> = maxX + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">default</span>:</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">left</span> = left + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    dragWrap.<span class="title function_">on</span>(<span class="string">&#x27;mouseup&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      dragWrap.<span class="title function_">off</span>(<span class="string">&#x27;mousemove&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      dragWrap.<span class="title function_">off</span>(<span class="string">&#x27;mouseup&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 注意：移动事件绑定在document中</span></span></span><br><span class="line"><span class="language-javascript">  dot4.<span class="title function_">on</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    event.<span class="title function_">stopPropagation</span>()</span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      event.<span class="title function_">stopPropagation</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> m_clientX = e.<span class="property">clientX</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> m_clientY = e.<span class="property">clientY</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123;left, top&#125; = dragWrap.<span class="title function_">offset</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> width = m_clientX - left</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> height = m_clientY - top</span></span><br><span class="line"><span class="language-javascript">      dragWrap.<span class="title function_">width</span>(width)</span></span><br><span class="line"><span class="language-javascript">      dragWrap.<span class="title function_">height</span>(height)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;mouseup&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      $(<span class="variable language_">document</span>).<span class="title function_">off</span>(<span class="string">&#x27;mousemove&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      $(<span class="variable language_">document</span>).<span class="title function_">off</span>(<span class="string">&#x27;mouseup&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  $(<span class="string">&#x27;.dot1&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;mousedown&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    event.<span class="title function_">stopPropagation</span>()</span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;mousemove&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      event.<span class="title function_">stopPropagation</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123;left, top&#125; = dragWrap.<span class="title function_">offset</span>() <span class="comment">// 必须实时获取</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> m_clientX = e.<span class="property">clientX</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> m_clientY = e.<span class="property">clientY</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> diffL = m_clientX - left</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> diffT = m_clientY - top</span></span><br><span class="line"><span class="language-javascript">      dragWrap.<span class="title function_">css</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">left</span>: m_clientX + <span class="string">&#x27;px&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">top</span>: m_clientY + <span class="string">&#x27;px&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">width</span>: dragWrap.<span class="title function_">width</span>() - diffL + <span class="string">&#x27;px&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">height</span>: dragWrap.<span class="title function_">height</span>() - diffT + <span class="string">&#x27;px&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;mouseup&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      $(<span class="variable language_">document</span>).<span class="title function_">off</span>(<span class="string">&#x27;mousemove&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      $(<span class="variable language_">document</span>).<span class="title function_">off</span>(<span class="string">&#x27;mouseup&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小功能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> drag </tag>
            
            <tag> 小功能 </tag>
            
            <tag> h5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>柱状图（bar）</title>
      <link href="/hisai3.github.io/2023/01/14/%E6%9F%B1%E7%8A%B6%E5%9B%BE%EF%BC%88bar%EF%BC%89/"/>
      <url>/hisai3.github.io/2023/01/14/%E6%9F%B1%E7%8A%B6%E5%9B%BE%EF%BC%88bar%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h4 id="柱状图-折线1"><a href="#柱状图-折线1" class="headerlink" title="柱状图 + 折线1"></a>柱状图 + 折线1</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">legend</span>: &#123;</span><br><span class="line">    <span class="attr">orient</span>: <span class="string">&#x27;vertical&#x27;</span>,</span><br><span class="line">    <span class="attr">x</span>:<span class="string">&#x27;right&#x27;</span>,      <span class="comment">//可设定图例在左、右、居中</span></span><br><span class="line">    <span class="attr">y</span>:<span class="string">&#x27;center&#x27;</span>,     <span class="comment">//可设定图例在上、下、居中</span></span><br><span class="line">    <span class="attr">padding</span>:[<span class="number">0</span>,<span class="number">50</span>,<span class="number">0</span>,<span class="number">0</span>],   <span class="comment">//可设定图例[距上方距离，距右方距离，距下方距离，距左方距离]</span></span><br><span class="line">    <span class="attr">data</span>: [<span class="string">&#x27;直接访问&#x27;</span>,<span class="string">&#x27;微信&#x27;</span>,<span class="string">&#x27;百度&#x27;</span>,<span class="string">&#x27;其他文章&#x27;</span>,<span class="string">&#x27;网页&#x27;</span>]</span><br><span class="line"> &#125;,</span><br><span class="line">  <span class="attr">tooltip</span>: &#123; <span class="comment">// 移入阴影</span></span><br><span class="line">    <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span>,</span><br><span class="line">    <span class="attr">axisPointer</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;shadow&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: [<span class="string">&#x27;Mon&#x27;</span>, <span class="string">&#x27;Tue&#x27;</span>, <span class="string">&#x27;Wed&#x27;</span>, <span class="string">&#x27;Thu&#x27;</span>, <span class="string">&#x27;Fri&#x27;</span>, <span class="string">&#x27;Sat&#x27;</span>, <span class="string">&#x27;Sun&#x27;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">series</span>: [</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      <span class="attr">label</span>: &#123;</span><br><span class="line">        <span class="attr">normal</span>: &#123;</span><br><span class="line">          <span class="attr">show</span>: <span class="literal">true</span>,<span class="comment">// 开启显示</span></span><br><span class="line">          <span class="attr">position</span>: <span class="string">&#x27;top&#x27;</span>,<span class="comment">// 柱形上方</span></span><br><span class="line">          <span class="attr">textStyle</span>: &#123; <span class="comment">// 数值样式</span></span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#000&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">formatter</span>: <span class="string">&#x27;&#123;c&#125;&#x27;</span>,  <span class="comment">// 自定义数值  a: series中的name  b:x轴 c:y轴的值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">data</span>: [<span class="number">150</span>, <span class="number">230</span>, <span class="number">224</span>, <span class="number">218</span>, <span class="number">135</span>, <span class="number">147</span>, <span class="number">260</span>],</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">      <span class="attr">stack</span>: <span class="string">&#x27;Ad&#x27;</span>, <span class="comment">// 设置这个就会成为堆叠柱状图</span></span><br><span class="line">      <span class="comment">// showBackground: true,</span></span><br><span class="line">      <span class="attr">backgroundStyle</span>: &#123;</span><br><span class="line">        <span class="comment">// color: &#x27;rgba(180, 180, 180, 0.2)&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">data</span>: [<span class="number">150</span>, <span class="number">230</span>, <span class="number">224</span>, <span class="number">218</span>, <span class="number">135</span>, <span class="number">147</span>, <span class="number">260</span>],</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">      <span class="attr">stack</span>: <span class="string">&#x27;Ad&#x27;</span>, <span class="comment">// 设置这个就会成为堆叠柱状图</span></span><br><span class="line">      <span class="comment">// showBackground: true, // 灰色背景</span></span><br><span class="line">      <span class="attr">backgroundStyle</span>: &#123;</span><br><span class="line">        <span class="comment">// color: &#x27;rgba(180, 180, 180, 0.2)&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">data</span>: [<span class="number">300</span>, <span class="number">230</span>, <span class="number">224</span>, <span class="number">218</span>, <span class="number">135</span>, <span class="number">147</span>, <span class="number">260</span>],</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">      <span class="attr">symbol</span>: <span class="string">&#x27;circle&#x27;</span>, <span class="comment">//拐点样式</span></span><br><span class="line">      <span class="attr">symbolSize</span>: <span class="number">18</span>, <span class="comment">//拐点大小</span></span><br><span class="line">      <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">        <span class="attr">normal</span>: &#123;</span><br><span class="line">          <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">            <span class="attr">width</span>: <span class="number">3</span>, <span class="comment">//折线宽度</span></span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;#FF0000&#x27;</span> <span class="comment">//折线颜色</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="comment">//拐点颜色</span></span><br><span class="line">          <span class="attr">borderColor</span>: <span class="string">&#x27;#000000&#x27;</span>, <span class="comment">//拐点边框颜色</span></span><br><span class="line">          <span class="attr">borderWidth</span>: <span class="number">3</span> <span class="comment">//拐点边框大小</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">emphasis</span>: &#123;</span><br><span class="line">          <span class="attr">color</span>: <span class="string">&#x27;#000000&#x27;</span> <span class="comment">//hover拐点颜色定义</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="柱状图-折线2"><a href="#柱状图-折线2" class="headerlink" title="柱状图 + 折线2"></a>柱状图 + 折线2</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">color</span>: [<span class="string">&#x27;#EFA90D&#x27;</span>, <span class="string">&#x27;#006BB0&#x27;</span>, <span class="string">&#x27;#059341&#x27;</span>,<span class="string">&#x27;#DC2F1F&#x27;</span>], <span class="comment">// 柱子的颜色，几个柱子就可以设置几个颜色</span></span><br><span class="line">        <span class="attr">tooltip</span>: &#123;</span><br><span class="line">            <span class="attr">trigger</span>: <span class="string">&#x27;axis&#x27;</span>,</span><br><span class="line">            <span class="attr">axisPointer</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;cross&#x27;</span>,</span><br><span class="line">                <span class="attr">label</span>: &#123;</span><br><span class="line">                    <span class="attr">backgroundColor</span>: <span class="string">&#x27;#6a7985&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">legend</span>: &#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="number">8</span>,</span><br><span class="line">            <span class="attr">itemWidth</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">itemHeight</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">data</span>: [<span class="string">&#x27;药品费&#x27;</span>,<span class="string">&#x27;耗材费&#x27;</span>, <span class="string">&#x27;检验检查费&#x27;</span>, <span class="string">&#x27;其他费&#x27;</span>,<span class="string">&#x27;偏差级别&#x27;</span>,<span class="string">&#x27;药品费偏差级别&#x27;</span>,  <span class="string">&#x27;耗材费偏差级别&#x27;</span>,<span class="string">&#x27;检验检查费偏差级别&#x27;</span>, <span class="string">&#x27;其他费偏差级别&#x27;</span>]  </span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">grid</span>: &#123;</span><br><span class="line">            <span class="attr">left</span>: <span class="string">&#x27;3%&#x27;</span>,</span><br><span class="line">            <span class="attr">right</span>: <span class="string">&#x27;4%&#x27;</span>,</span><br><span class="line">            <span class="attr">bottom</span>: <span class="string">&#x27;3%&#x27;</span>,</span><br><span class="line">            <span class="attr">containLabel</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">xAxis</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span><br><span class="line">                <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#999999&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">axisLine</span>: &#123;<span class="attr">show</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">                <span class="attr">axisTick</span>: &#123;<span class="attr">show</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">                <span class="attr">boundaryGap</span>: [<span class="string">&#x27;20%&#x27;</span>, <span class="string">&#x27;20%&#x27;</span>],</span><br><span class="line">                <span class="attr">data</span>:  [<span class="string">&#x27;一月&#x27;</span>, <span class="string">&#x27;二月&#x27;</span>, <span class="string">&#x27;三月&#x27;</span>, <span class="string">&#x27;四月&#x27;</span>, <span class="string">&#x27;五月&#x27;</span>, <span class="string">&#x27;六月&#x27;</span>, <span class="string">&#x27;七月&#x27;</span>, <span class="string">&#x27;八月&#x27;</span>, <span class="string">&#x27;九月&#x27;</span>, <span class="string">&#x27;十月&#x27;</span>, <span class="string">&#x27;十一月&#x27;</span>, <span class="string">&#x27;十二月&#x27;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">yAxis</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">                <span class="comment">// name: &#x27;均费&#x27;,</span></span><br><span class="line">                <span class="attr">nameTextStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#999999&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">axisLine</span>: &#123;<span class="attr">show</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">                <span class="attr">axisTick</span>: &#123;<span class="attr">show</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">                <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                    <span class="attr">margin</span>: <span class="number">2</span>,</span><br><span class="line">                    <span class="attr">interval</span>: <span class="number">15</span>,</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#999999&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;增长率(%)&#x27;</span>,</span><br><span class="line">                <span class="attr">nameTextStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#999999&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">splitLine</span>:&#123;<span class="attr">show</span>: <span class="literal">false</span>&#125;,<span class="comment">//去除网格线</span></span><br><span class="line">                <span class="attr">axisLine</span>: &#123;<span class="attr">show</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">                <span class="attr">axisTick</span>: &#123;<span class="attr">show</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">                <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                    <span class="attr">margin</span>: <span class="number">2</span>,</span><br><span class="line">                    <span class="attr">interval</span>: <span class="number">15</span>,</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#999999&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">series</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;药品费&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="comment">// 这个是柱状图的类型，设置成这个就是柱状图</span></span><br><span class="line">                <span class="attr">barWidth</span>: <span class="number">20</span>, <span class="comment">// 柱子的宽度，设置一个就行了，别的也会采用这个宽度</span></span><br><span class="line">                <span class="attr">stack</span>: <span class="string">&#x27;Ad&#x27;</span>, <span class="comment">// 设置这个就会成为堆叠柱状图</span></span><br><span class="line">                <span class="attr">data</span>:  [<span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">3</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;耗材费&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                <span class="attr">stack</span>: <span class="string">&#x27;Ad&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>: [<span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">3</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;检验检查费&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                <span class="attr">stack</span>: <span class="string">&#x27;Ad&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>:  [<span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">3</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;其他费&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                <span class="attr">stack</span>: <span class="string">&#x27;Ad&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>: [<span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>,<span class="number">3</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;偏差级别&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>, <span class="comment">// 这个就是折线图的类型，设置成这个就是折线图了。</span></span><br><span class="line">                <span class="attr">smooth</span>: <span class="literal">false</span>, <span class="comment">// 曲线弧度</span></span><br><span class="line">                <span class="attr">color</span>:[<span class="string">&#x27;#1D1815&#x27;</span>],  <span class="comment">//折线条的颜色</span></span><br><span class="line">                <span class="attr">yAxisIndex</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">shadowBlur</span>: <span class="number">2</span>, <span class="comment">// 这点阴影</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">data</span>:  [<span class="number">30</span>, <span class="number">60</span>, <span class="number">80</span>, <span class="number">90</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">15</span>,<span class="number">15</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;药品费偏差级别&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">                <span class="attr">color</span>:[<span class="string">&#x27;#EFA90D&#x27;</span>],  <span class="comment">//折线条的颜色</span></span><br><span class="line">                <span class="attr">smooth</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">yAxisIndex</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">shadowBlur</span>: <span class="number">2</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">data</span>:  [<span class="number">31</span>, <span class="number">62</span>, <span class="number">89</span>, <span class="number">40</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">25</span>, <span class="number">25</span>,<span class="number">25</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;耗材费偏差级别&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">                <span class="attr">smooth</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">color</span>:[<span class="string">&#x27;#006BB0&#x27;</span>],  <span class="comment">//折线条的颜色</span></span><br><span class="line">                <span class="attr">yAxisIndex</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">shadowBlur</span>: <span class="number">2</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">data</span>:  [<span class="number">20</span>, <span class="number">40</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">15</span>,<span class="number">15</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;检验检查费偏差级别&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">                <span class="attr">color</span>:[<span class="string">&#x27;#059341&#x27;</span>],  <span class="comment">//折线条的颜色</span></span><br><span class="line">                <span class="attr">smooth</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">yAxisIndex</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">shadowBlur</span>: <span class="number">2</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">data</span>:  [<span class="number">30</span>, <span class="number">60</span>, <span class="number">84</span>, <span class="number">25</span>, <span class="number">14</span>, <span class="number">23</span>, <span class="number">16</span>, <span class="number">12</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">16</span>,<span class="number">16</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;其他费偏差级别&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">                <span class="attr">color</span>:[<span class="string">&#x27;#DC2F1F&#x27;</span>],  <span class="comment">//折线条的颜色</span></span><br><span class="line">                <span class="attr">smooth</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">yAxisIndex</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                    <span class="attr">shadowBlur</span>: <span class="number">2</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">data</span>:  [-<span class="number">21</span>, <span class="number">40</span>, <span class="number">60</span>, <span class="number">90</span>, <span class="number">15</span>, <span class="number">25</span>, <span class="number">35</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">15</span>,<span class="number">15</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Echarts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Echarts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>水波指令</title>
      <link href="/hisai3.github.io/2023/01/14/%E6%B0%B4%E6%B3%A2%E6%8C%87%E4%BB%A4/"/>
      <url>/hisai3.github.io/2023/01/14/%E6%B0%B4%E6%B3%A2%E6%8C%87%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h4 id="水波指令"><a href="#水波指令" class="headerlink" title="水波指令"></a>水波指令</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;shuibowen&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">//binding 指令携带的变量数据</span></span><br><span class="line">  <span class="attr">inserted</span>: <span class="keyword">function</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> x = e.<span class="property">clientX</span> - el.<span class="title function_">getBoundingClientRect</span>().<span class="property">left</span></span><br><span class="line">      <span class="keyword">let</span> y = e.<span class="property">clientY</span> - el.<span class="title function_">getBoundingClientRect</span>().<span class="property">top</span></span><br><span class="line">      el.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;relative&#x27;</span></span><br><span class="line">      el.<span class="property">style</span>.<span class="property">overflow</span> = <span class="string">&#x27;hidden&#x27;</span></span><br><span class="line">      <span class="comment">//在鼠标位置增加一个span标签</span></span><br><span class="line">      <span class="keyword">let</span> span = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;span&quot;</span>)</span><br><span class="line">      span.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&quot;absolute&quot;</span></span><br><span class="line">      span.<span class="property">style</span>.<span class="property">background</span> = binding.<span class="property">value</span> || <span class="string">&#x27;rgba(150, 91, 91, .5)&#x27;</span></span><br><span class="line">      span.<span class="property">style</span>.<span class="property">opacity</span> = <span class="number">1</span>;</span><br><span class="line">      span.<span class="property">style</span>.<span class="property">borderRadius</span> = <span class="string">&#x27;50%&#x27;</span></span><br><span class="line">      el.<span class="title function_">append</span>(span)</span><br><span class="line">      <span class="keyword">let</span> width = <span class="number">0</span></span><br><span class="line">      <span class="keyword">let</span> height = <span class="number">0</span></span><br><span class="line">      <span class="keyword">let</span> opacity = <span class="number">1</span></span><br><span class="line">      <span class="keyword">let</span> max_length = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(el.<span class="property">offsetWidth</span> * el.<span class="property">offsetWidth</span> + el.<span class="property">offsetHeight</span> * el.<span class="property">offsetHeight</span>) * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> time = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        width += <span class="number">5</span></span><br><span class="line">        height += <span class="number">5</span></span><br><span class="line">        opacity -= <span class="number">0.01</span></span><br><span class="line">        <span class="comment">// 判断超出最大值时，清除定时，并且删除span</span></span><br><span class="line">        <span class="keyword">if</span> (width &lt; max_length) &#123;</span><br><span class="line">          span.<span class="property">style</span>.<span class="property">width</span> = width + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">          span.<span class="property">style</span>.<span class="property">height</span> = height + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">          span.<span class="property">style</span>.<span class="property">opacity</span> = opacity;</span><br><span class="line">          span.<span class="property">style</span>.<span class="property">left</span> = x - span.<span class="property">offsetWidth</span> / <span class="number">2</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">          span.<span class="property">style</span>.<span class="property">top</span> = y - span.<span class="property">offsetHeight</span> / <span class="number">2</span> + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(time)</span><br><span class="line">          time = <span class="literal">null</span>;</span><br><span class="line">          span.<span class="title function_">remove</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">10</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue指令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>渲染函数和jsx</title>
      <link href="/hisai3.github.io/2023/01/14/%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0%E5%92%8Cjsx/"/>
      <url>/hisai3.github.io/2023/01/14/%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0%E5%92%8Cjsx/</url>
      
        <content type="html"><![CDATA[<h3 id="渲染函数"><a href="#渲染函数" class="headerlink" title="渲染函数"></a>渲染函数</h3><p><code>createElement</code> 接收参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @returns &#123;VNode&#125;</span></span><br><span class="line"><span class="title function_">createElement</span>(</span><br><span class="line">  <span class="comment">// &#123;String | Object | Function&#125;</span></span><br><span class="line">  <span class="comment">// 一个 HTML 标签名、组件选项对象，或者</span></span><br><span class="line">  <span class="comment">// resolve 了上述任何一种的一个 async 函数。必填项。</span></span><br><span class="line">  <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#123;Object&#125;</span></span><br><span class="line">  <span class="comment">// 一个与模板中 attribute 对应的数据对象。可选。</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// (详情见下一节)</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#123;String | Array&#125;</span></span><br><span class="line">  <span class="comment">// 子级虚拟节点 (VNodes)，由 `createElement()` 构建而成，</span></span><br><span class="line">  <span class="comment">// 也可以使用字符串来生成“文本虚拟节点”。可选。</span></span><br><span class="line">  [</span><br><span class="line">    <span class="string">&#x27;先写一些文字&#x27;</span>,</span><br><span class="line">    <span class="title function_">createElement</span>(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;一则头条&#x27;</span>),</span><br><span class="line">    <span class="title function_">createElement</span>(<span class="title class_">MyComponent</span>, &#123;</span><br><span class="line">      <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">someProp</span>: <span class="string">&#x27;foobar&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>Object</code> 具体内容</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 与 `v-bind:class` 的 API 相同，</span></span><br><span class="line">  <span class="comment">// 接受一个字符串、对象或字符串和对象组成的数组</span></span><br><span class="line">  <span class="string">&#x27;class&#x27;</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">bar</span>: <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 与 `v-bind:style` 的 API 相同，</span></span><br><span class="line">  <span class="comment">// 接受一个字符串、对象，或对象组成的数组</span></span><br><span class="line">  <span class="attr">style</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">    <span class="attr">fontSize</span>: <span class="string">&#x27;14px&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 普通的 HTML attribute</span></span><br><span class="line">  <span class="attr">attrs</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 组件 prop</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">myProp</span>: <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// DOM property</span></span><br><span class="line">  <span class="attr">domProps</span>: &#123;</span><br><span class="line">    <span class="attr">innerHTML</span>: <span class="string">&#x27;baz&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 事件监听器在 `on` 内，</span></span><br><span class="line">  <span class="comment">// 但不再支持如 `v-on:keyup.enter` 这样的修饰器。</span></span><br><span class="line">  <span class="comment">// 需要在处理函数中手动检查 keyCode。</span></span><br><span class="line">  <span class="attr">on</span>: &#123;</span><br><span class="line">    <span class="attr">click</span>: <span class="variable language_">this</span>.<span class="property">clickHandler</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 仅用于组件，用于监听原生事件，而不是组件内部使用</span></span><br><span class="line">  <span class="comment">// `vm.$emit` 触发的事件。</span></span><br><span class="line">  <span class="attr">nativeOn</span>: &#123;</span><br><span class="line">    <span class="attr">click</span>: <span class="variable language_">this</span>.<span class="property">nativeClickHandler</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 自定义指令。注意，你无法对 `binding` 中的 `oldValue`</span></span><br><span class="line">  <span class="comment">// 赋值，因为 Vue 已经自动为你进行了同步。</span></span><br><span class="line">  <span class="attr">directives</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;my-custom-directive&#x27;</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">      <span class="attr">expression</span>: <span class="string">&#x27;1 + 1&#x27;</span>,</span><br><span class="line">      <span class="attr">arg</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">      <span class="attr">modifiers</span>: &#123;</span><br><span class="line">        <span class="attr">bar</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// 作用域插槽的格式为</span></span><br><span class="line">  <span class="comment">// &#123; name: props =&gt; VNode | Array&lt;VNode&gt; &#125;</span></span><br><span class="line">  <span class="attr">scopedSlots</span>: &#123;</span><br><span class="line">    <span class="attr">default</span>: <span class="function"><span class="params">props</span> =&gt;</span> <span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>, props.<span class="property">text</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 如果组件是其它组件的子组件，需为插槽指定名称</span></span><br><span class="line">  <span class="attr">slot</span>: <span class="string">&#x27;name-of-slot&#x27;</span>,</span><br><span class="line">  <span class="comment">// 其它特殊顶层 property</span></span><br><span class="line">  <span class="attr">key</span>: <span class="string">&#x27;myKey&#x27;</span>,</span><br><span class="line">  <span class="attr">ref</span>: <span class="string">&#x27;myRef&#x27;</span>,</span><br><span class="line">  <span class="comment">// 如果你在渲染函数中给多个元素都应用了相同的 ref 名，</span></span><br><span class="line">  <span class="comment">// 那么 `$refs.myRef` 会变成一个数组。</span></span><br><span class="line">  <span class="attr">refInFor</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x3D;&#x3D;<strong>注意：</strong>&#x3D;&#x3D;</p><ol><li>不能使用<code>v-model</code></li><li>事件修饰符更换()</li></ol><p><a href="https://v2.cn.vuejs.org/v2/guide/render-function.html#JSX">官网-渲染函数</a></p><table><thead><tr><th align="left">修饰符</th><th align="left">前缀</th></tr></thead><tbody><tr><td align="left">.passive</td><td align="left">&amp;</td></tr><tr><td align="left">.capture</td><td align="left">!</td></tr><tr><td align="left">.once</td><td align="left">~</td></tr><tr><td align="left">.capture.once 或 .once.capture</td><td align="left">~!</td></tr></tbody></table><p>例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;!click&#x27;</span>: <span class="variable language_">this</span>.<span class="property">doThisInCapturingMode</span>,</span><br><span class="line">  <span class="string">&#x27;~keyup&#x27;</span>: <span class="variable language_">this</span>.<span class="property">doThisOnce</span>,</span><br><span class="line">  <span class="string">&#x27;~!mouseover&#x27;</span>: <span class="variable language_">this</span>.<span class="property">doThisOnceInCapturingMode</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h3><h4 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h4><p><a href="https://blog.csdn.net/qq449245884/article/details/104243678">vue中使用jsx</a></p><blockquote><p>如果使用的 Vue-cli <strong>大于或等于</strong> &#x3D;&#x3D;3.0&#x3D;&#x3D; 版本，那么就直接可以使用JSX的语法了。<br>如果您使用的是不支持 JSX 的Vue-cli较旧版本，则可以通过安装<code>babel-preset-vue-app</code>来添加它，并将其添加到您的<code>.babelrc</code>文件中。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">Using npm</span></span><br><span class="line"> npm install --save-dev babel-preset-vue-app</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Using yarn</span></span><br><span class="line"> yarn add --dev babel-preset-vue-app</span><br></pre></td></tr></table></figure><p>在<code>.babelrc</code>文件中，添加：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;vue-app&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><ul><li>要监听 JSX 中的事件，我们需要“on”前缀。 例如，将onClick用于单击事件。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;button onClick=&#123;this.handleClick&#125;&gt;&lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>要修改事件，请使用。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;button onClick:prevent=&#123;this.handleClick&#125;&gt;&lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>绑定变量，注意这里不是使用 :。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line">    return (</span><br><span class="line">        &lt;button content=&#123;this.generatedText&#125;&gt;&lt;/button&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>将HTML字符串设置为元素的内容，使用<code>domPropsInnerHTML</code>而不是使用<code>v-html</code>。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line">     return (</span><br><span class="line">         &lt;button domPropsInnerHTML=&#123;htmlContent&#125;&gt;&lt;/button&gt;</span><br><span class="line">     )</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ul><li>我们也可以展开一个大对象：。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">render (createElement) &#123;</span><br><span class="line">     return (</span><br><span class="line">         &lt;button &#123;...this.largeProps&#125;&gt;&lt;/button&gt;</span><br><span class="line">     )</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://blog.csdn.net/weixin_44423832/article/details/106187043">jsx中使用插槽</a></li></ul><p><strong>1. 静态插槽 <code>$slots</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MySlot</span> = &#123;</span><br><span class="line">  render (h) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">header</span>&gt;</span>&#123;this.$slots.header&#125;<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">main</span>&gt;</span>&#123;this.$slots.default&#125;<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">footer</span>&gt;</span>&#123;this.$slots.footer&#125;<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  render (h) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">MySlot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&#x27;header&#x27;</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        children node</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&#x27;footer&#x27;</span>&gt;</span>this is footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">MySlot</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. 作用域插槽 <code>$scopedSlots</code></strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MySlot</span> = &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">user</span>: <span class="string">&#x27;John&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;vue&#x27;</span>, <span class="attr">copytight</span>: <span class="string">&#x27;CopyRight&#x27;</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  render (h) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">header</span>&gt;</span>&#123;this.$scopedSlots.header(&#123; user: this.user &#125;)&#125;<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">main</span>&gt;</span>&#123;this.$scopedSlots.default(&#123; content: this.content &#125;)&#125;<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">footer</span>&gt;</span>&#123;this.$scopedSlots.footer(&#123; copytight: this.copytight &#125;)&#125;<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  render (h) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">MySlot</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">scopedSlots</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">header:</span> <span class="attr">props</span> =&gt;</span> `hello, $&#123;props.user&#125;`</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        children node</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&#x27;footer&#x27;</span>&gt;</span>this is footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">MySlot</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 Vue 中使用JSX的另一个好处是，我们<strong>不再需要注册</strong>所需的每个组件。 我们只是导入和使用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Button</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;../components&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">     render (createElement) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">primary</span>=<span class="string">&#123;true&#125;</span>&gt;</span>Edit<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>环形进度条 canvas</title>
      <link href="/hisai3.github.io/2023/01/14/%E7%8E%AF%E5%BD%A2%E8%BF%9B%E5%BA%A6%E6%9D%A1%20canvas/"/>
      <url>/hisai3.github.io/2023/01/14/%E7%8E%AF%E5%BD%A2%E8%BF%9B%E5%BA%A6%E6%9D%A1%20canvas/</url>
      
        <content type="html"><![CDATA[<h3 id="环形进度条"><a href="#环形进度条" class="headerlink" title="环形进度条"></a>环形进度条</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// CircleBarBuilder.js</span></span><br><span class="line"><span class="comment">// 环形进度条生成插件</span></span><br><span class="line">;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params"><span class="variable language_">global</span>, <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">    <span class="string">&quot;use strict&quot;</span> <span class="comment">//使用js严格模式检查，使语法更规范</span></span><br><span class="line">    <span class="keyword">let</span> _global;</span><br><span class="line">    <span class="comment">//定义一些默认参数</span></span><br><span class="line">    <span class="keyword">let</span> _options = &#123;</span><br><span class="line">        <span class="comment">// 动画选项，使用每帧增加的百分比调整动画速度，默认 2.5 即每帧增加 2.5%，设置为 0 或 false 关闭动画</span></span><br><span class="line">        <span class="attr">animation</span>: <span class="number">2.5</span>,</span><br><span class="line">        <span class="comment">// 总值，如果显示百分比，但是传值使用绝对值，则需要指定一个 100% 的绝对值</span></span><br><span class="line">        <span class="attr">total</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="comment">// true 显示百分比 || false 显示绝对值</span></span><br><span class="line">        <span class="attr">showPercent</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 如果以绝对值显示可以为数字添加单位符号后缀</span></span><br><span class="line">        <span class="attr">valueSymbol</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="comment">// 数字格式化选项，默认保留小数点后2位</span></span><br><span class="line">        <span class="attr">fiexd</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="comment">// 样式</span></span><br><span class="line">        <span class="attr">style</span>: &#123;</span><br><span class="line">            <span class="comment">// 线宽</span></span><br><span class="line">            <span class="attr">circleWidth</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="comment">// 进度条颜色</span></span><br><span class="line">            <span class="attr">circleColor</span>: <span class="string">&quot;#10aeff&quot;</span>,</span><br><span class="line">            <span class="comment">// 进度条背景颜色，设置为 false 时不显示</span></span><br><span class="line">            <span class="attr">circleBackground</span>: <span class="string">&#x27;#eee&#x27;</span>,</span><br><span class="line">            <span class="comment">// 值文本颜色</span></span><br><span class="line">            <span class="attr">valueColor</span>: <span class="string">&quot;#777&quot;</span>,</span><br><span class="line">            <span class="comment">// 标签文本颜色</span></span><br><span class="line">            <span class="attr">lableColor</span>: <span class="string">&quot;#777&quot;</span>,</span><br><span class="line">            <span class="comment">// 字体，不能设置文字大小</span></span><br><span class="line">            <span class="attr">font</span>: <span class="string">&quot;&#x27;Helvetica Neue&#x27;, Helvetica, Arial, &#x27;PingFang SC&#x27;, &#x27;Hiragino Sans GB&#x27;, &#x27;Heiti SC&#x27;, &#x27;Microsoft YaHei&#x27;, &#x27;WenQuanYi Micro Hei&#x27;, sans-serif&quot;</span>,</span><br><span class="line">            <span class="comment">// 进度条渐变设置，设置渐变以后会使 circleColor 选项失效</span></span><br><span class="line">            <span class="attr">gradient</span>: <span class="literal">false</span> <span class="comment">// 进度条渐变设置，设置渐变以后会使 circleColor 选项失效</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">rotate</span>: <span class="number">0</span>, <span class="comment">// 旋转，只旋转进度条，文本不旋转</span></span><br><span class="line">        <span class="attr">reverse</span>: <span class="literal">false</span> <span class="comment">// 反方向，顺时针还是逆时针</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// api 实例</span></span><br><span class="line">    <span class="keyword">let</span> apiInstance;</span><br><span class="line">    <span class="comment">// 定义 api</span></span><br><span class="line">    <span class="keyword">let</span> _plugin_api = <span class="keyword">function</span> (<span class="params">options</span>) &#123;</span><br><span class="line">        <span class="comment">// api 实例化，可以在 api 以外的函数中调用 api</span></span><br><span class="line">        apiInstance = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="comment">// 合并默认参数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span> = <span class="title function_">mergeObj</span>(options, _options)</span><br><span class="line">        <span class="comment">// 设置旋转角度，既 2 * 旋转百分比</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">rotate</span> = <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">rotate</span> / <span class="number">180</span>;</span><br><span class="line">        <span class="comment">// 绘制函数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">draw</span> = <span class="keyword">function</span> (<span class="params">value, selector, label = <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> value !== <span class="string">&#x27;number&#x27;</span>) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[CircleBarBuilder Error] value must be Number&#x27;</span>)</span><br><span class="line">            <span class="comment">// 获取画布</span></span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(selector);</span><br><span class="line">            <span class="keyword">if</span> (!canvas) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[CircleBarBuilder Error] cannot find selector&#x27;</span>)</span><br><span class="line">            <span class="comment">// 获取 context</span></span><br><span class="line">            <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">animation</span>) &#123;</span><br><span class="line">                <span class="comment">// 静态绘制</span></span><br><span class="line">                <span class="title function_">drawArcBg</span>(context); <span class="comment">// 绘制进度条背景</span></span><br><span class="line">                <span class="title function_">drawLabel</span>(label, context); <span class="comment">// 绘制标签</span></span><br><span class="line">                <span class="title function_">drawArc</span>(<span class="title function_">getPercent</span>(value), context); <span class="comment">// 绘制进度条</span></span><br><span class="line">                <span class="title function_">drawValueTxt</span>(value, context);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 使用动画绘制</span></span><br><span class="line">                <span class="comment">// 设置自增变量，百分比</span></span><br><span class="line">                <span class="keyword">let</span> increment = <span class="number">0</span>;</span><br><span class="line">                (<span class="keyword">function</span> <span class="title function_">drawAnimation</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(drawAnimation, canvas);</span><br><span class="line">                    context.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">                    <span class="title function_">drawArcBg</span>(context);</span><br><span class="line">                    <span class="title function_">drawLabel</span>(label, context);</span><br><span class="line">                    <span class="title function_">drawArc</span>(increment, context);</span><br><span class="line">                    <span class="comment">// 绘制值文本时需要将自增变量百分比逆向转换为绝对值</span></span><br><span class="line">                    <span class="title function_">drawValueTxt</span>(<span class="title function_">getAbsolute</span>(increment), context);</span><br><span class="line">                    <span class="keyword">if</span> (increment &lt; <span class="title function_">getPercent</span>(value)) &#123;</span><br><span class="line">                        increment += apiInstance.<span class="property">options</span>.<span class="property">animation</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        increment = <span class="title function_">getPercent</span>(value);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>; <span class="comment">//返回当前方法</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 绘制环行条</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">drawArc</span>(<span class="params">percent, context</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置图形中心</span></span><br><span class="line">        <span class="keyword">const</span> center = <span class="title function_">getCenter</span>(context);</span><br><span class="line">        <span class="comment">// 设置环形半径 </span></span><br><span class="line">        <span class="keyword">const</span> radius = <span class="title function_">getRadius</span>(context);</span><br><span class="line">        <span class="comment">// 设置开始角度</span></span><br><span class="line">        <span class="keyword">const</span> startAngle = (-<span class="number">0.5</span> + apiInstance.<span class="property">options</span>.<span class="property">rotate</span>) * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">        <span class="comment">// 设置结束角度</span></span><br><span class="line">        <span class="keyword">const</span> endAngle = (percent / <span class="number">50</span> - <span class="number">0.5</span> + apiInstance.<span class="property">options</span>.<span class="property">rotate</span>) * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">        context.<span class="title function_">save</span>();</span><br><span class="line">        context.<span class="title function_">beginPath</span>();</span><br><span class="line">        <span class="comment">// 创建圆</span></span><br><span class="line">        context.<span class="title function_">arc</span>(center, center, radius, startAngle, endAngle, apiInstance.<span class="property">options</span>.<span class="property">reverse</span>);</span><br><span class="line">        <span class="comment">// 设置线宽</span></span><br><span class="line">        context.<span class="property">lineWidth</span> = apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">circleWidth</span>;</span><br><span class="line">        <span class="comment">// 使用渐变</span></span><br><span class="line">        <span class="keyword">if</span> (!apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">gradient</span>) &#123;</span><br><span class="line">            context.<span class="property">strokeStyle</span> = apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">circleColor</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> gradientDirection = &#123;</span><br><span class="line">                <span class="attr">x1</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">y1</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">x2</span>: radius * <span class="number">2</span>,</span><br><span class="line">                <span class="attr">y2</span>: <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">switch</span> (apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">gradient</span>.<span class="property">direction</span>) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    gradientDirection.<span class="property">x2</span> = <span class="number">0</span>;</span><br><span class="line">                    gradientDirection.<span class="property">y2</span> = radius * <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    gradientDirection.<span class="property">y2</span> = radius * <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    gradientDirection.<span class="property">y1</span> = radius * <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> gradient = context.<span class="title function_">createLinearGradient</span>(gradientDirection.<span class="property">x1</span>, gradientDirection.<span class="property">y1</span>, gradientDirection.<span class="property">x2</span>, gradientDirection.<span class="property">y2</span>);</span><br><span class="line">            <span class="keyword">const</span> clolor = apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">gradient</span>.<span class="property">color</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> index <span class="keyword">in</span> clolor) &#123;</span><br><span class="line">                gradient.<span class="title function_">addColorStop</span>(index, clolor[index]);</span><br><span class="line">            &#125;</span><br><span class="line">            context.<span class="property">strokeStyle</span> = gradient;</span><br><span class="line">        &#125;</span><br><span class="line">        context.<span class="title function_">stroke</span>();</span><br><span class="line">        context.<span class="title function_">restore</span>();</span><br><span class="line">        <span class="keyword">return</span> apiInstance</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 绘制环形背景</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">drawArcBg</span>(<span class="params">context</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">circleBackground</span>) &#123;</span><br><span class="line">            <span class="comment">// 设置图形中心</span></span><br><span class="line">            <span class="keyword">const</span> center = <span class="title function_">getCenter</span>(context);</span><br><span class="line">            <span class="comment">// 设置环形半径 </span></span><br><span class="line">            <span class="keyword">const</span> radius = <span class="title function_">getRadius</span>(context);</span><br><span class="line">            context.<span class="title function_">beginPath</span>();</span><br><span class="line">            <span class="comment">// 创建圆</span></span><br><span class="line">            context.<span class="title function_">arc</span>(center, center, radius, <span class="number">0</span>, <span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">            <span class="comment">// 设置线宽</span></span><br><span class="line">            context.<span class="property">lineWidth</span> = apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">circleWidth</span>;</span><br><span class="line">            context.<span class="property">strokeStyle</span> = apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">circleBackground</span>;</span><br><span class="line">            context.<span class="title function_">stroke</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> apiInstance</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 绘制值文本</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">drawValueTxt</span>(<span class="params">value, context</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置图形中心</span></span><br><span class="line">        <span class="keyword">const</span> center = <span class="title function_">getCenter</span>(context);</span><br><span class="line">        <span class="comment">// 设置环形半径 </span></span><br><span class="line">        <span class="keyword">const</span> radius = <span class="title function_">getRadius</span>(context);</span><br><span class="line">        <span class="comment">// 设置值显示文本</span></span><br><span class="line">        <span class="keyword">let</span> valStr;</span><br><span class="line">        <span class="keyword">let</span> num</span><br><span class="line">        <span class="keyword">if</span> (apiInstance.<span class="property">options</span>.<span class="property">showPercent</span>) &#123;</span><br><span class="line">            valStr = <span class="title function_">isInteger</span>(value) ? <span class="string">`<span class="subst">$&#123;value&#125;</span>%`</span> : <span class="string">`<span class="subst">$&#123;getPercent(value).toFixed(apiInstance.options.fiexd)&#125;</span>%`</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> valueSymbol = apiInstance.<span class="property">options</span>.<span class="property">valueSymbol</span></span><br><span class="line">            valStr = <span class="title function_">isInteger</span>(value) ? <span class="string">`<span class="subst">$&#123;value&#125;</span><span class="subst">$&#123;valueSymbol&#125;</span>`</span> : <span class="string">`<span class="subst">$&#123;value.toFixed(apiInstance.options.fiexd)&#125;</span><span class="subst">$&#123;valueSymbol&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        context.<span class="title function_">save</span>();</span><br><span class="line">        context.<span class="property">font</span> = radius / <span class="number">2.25</span> + <span class="string">&quot;px &quot;</span> + apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">font</span>;</span><br><span class="line">        context.<span class="property">textAlign</span> = <span class="string">&quot;center&quot;</span>;</span><br><span class="line">        context.<span class="property">textBaseline</span> = <span class="string">&quot;middle&quot;</span>;</span><br><span class="line">        context.<span class="property">fillStyle</span> = apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">valueColor</span>;</span><br><span class="line">        context.<span class="title function_">fillText</span>(valStr, center, center, radius * <span class="number">1.75</span>);</span><br><span class="line">        context.<span class="title function_">restore</span>();</span><br><span class="line">        <span class="keyword">return</span> apiInstance</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 绘制标签</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">drawLabel</span>(<span class="params">label, context</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置图形中心</span></span><br><span class="line">        <span class="keyword">const</span> center = <span class="title function_">getCenter</span>(context);</span><br><span class="line">        <span class="comment">// 设置环形半径 </span></span><br><span class="line">        <span class="keyword">const</span> radius = <span class="title function_">getRadius</span>(context);</span><br><span class="line">        <span class="comment">// 显示标签文本</span></span><br><span class="line">        <span class="keyword">if</span> (label) &#123;</span><br><span class="line">            context.<span class="property">font</span> = radius / <span class="number">3.5</span> + <span class="string">&quot;px &quot;</span> + apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">font</span>;</span><br><span class="line">            context.<span class="property">textAlign</span> = <span class="string">&quot;center&quot;</span>;</span><br><span class="line">            context.<span class="property">textBaseline</span> = <span class="string">&quot;middle&quot;</span>;</span><br><span class="line">            context.<span class="property">fillStyle</span> = apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">lableColor</span>;</span><br><span class="line">            context.<span class="title function_">fillText</span>(label, center, center + radius / <span class="number">2.5</span>, radius);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> apiInstance</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取 canvas 半径</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getRadius</span>(<span class="params">context</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (context.<span class="property">canvas</span>.<span class="property">width</span> - apiInstance.<span class="property">options</span>.<span class="property">style</span>.<span class="property">circleWidth</span>) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取 canvas 中心坐标</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getCenter</span>(<span class="params">context</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> context.<span class="property">canvas</span>.<span class="property">width</span> / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取百分比值</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getPercent</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value / apiInstance.<span class="property">options</span>.<span class="property">total</span> * <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取绝对值</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getAbsolute</span>(<span class="params">percent</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> percent * apiInstance.<span class="property">options</span>.<span class="property">total</span> / <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 是否为整数</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">isInteger</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(data) === data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 合并对象，支持无限深度，用来合并 options</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">mergeObj</span>(<span class="params">obj, original</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">in</span> obj) &#123;</span><br><span class="line">            <span class="comment">// 如果新的值和原始值类型都是 object，则使用 mergeObj 进行合并</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> obj[item] === <span class="string">&#x27;object&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> original[item] === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">                <span class="title function_">mergeObj</span>(obj[item], original[item])</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                original[item] = obj[item]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> original</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 将插件对象暴露给全局对象</span></span><br><span class="line">    _global = (<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span> || (<span class="number">0</span>, <span class="built_in">eval</span>)(<span class="string">&#x27;this&#x27;</span>);</span><br><span class="line">    &#125;());</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">module</span> !== <span class="string">&quot;undefined&quot;</span> &amp;&amp; <span class="variable language_">module</span>.<span class="property">exports</span>) &#123;</span><br><span class="line">        <span class="variable language_">module</span>.<span class="property">exports</span> = _plugin_api;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.<span class="property">amd</span>) &#123;</span><br><span class="line">        <span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> _plugin_api;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 最后的插件名称在这里定义</span></span><br><span class="line">        <span class="keyword">var</span> _plugin_name = <span class="string">&#x27;CircleBarBuilder&#x27;</span>;</span><br><span class="line">        !(_plugin_name <span class="keyword">in</span> _global) &amp;&amp; (_global[_plugin_name] = _plugin_api);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> progressBar = <span class="keyword">new</span> <span class="title class_">CircleBarBuilder</span>(&#123;</span><br><span class="line">    <span class="comment">// 动画选项，使用每帧增加的百分比调整动画速度，默认 2.5 即每帧增加 2.5%，设置为 0 或 false 关闭动画</span></span><br><span class="line">    <span class="attr">animation</span>: <span class="number">2.5</span>,</span><br><span class="line">    <span class="comment">// 总值，如果显示百分比，但是传值使用绝对值，则需要指定一个 100% 的绝对值</span></span><br><span class="line">    <span class="attr">total</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="comment">// true 显示百分比 || false 显示绝对值</span></span><br><span class="line">    <span class="attr">showPercent</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 如果以绝对值显示可以为数字添加单位符号后缀</span></span><br><span class="line">    <span class="attr">valueSymbol</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">// 数字格式化选项，默认保留小数点后2位</span></span><br><span class="line">    <span class="attr">fiexd</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="comment">// 样式</span></span><br><span class="line">    <span class="attr">style</span>: &#123;</span><br><span class="line">        <span class="comment">// 线宽</span></span><br><span class="line">        <span class="attr">circleWidth</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="comment">// 进度条颜色</span></span><br><span class="line">        <span class="attr">circleColor</span>: <span class="string">&quot;#10aeff&quot;</span>,</span><br><span class="line">        <span class="comment">// 进度条背景颜色，设置为 false 时不显示</span></span><br><span class="line">        <span class="attr">circleBackground</span>: <span class="string">&#x27;#eee&#x27;</span>,</span><br><span class="line">        <span class="comment">// 值文本颜色</span></span><br><span class="line">        <span class="attr">valueColor</span>: <span class="string">&quot;#777&quot;</span>,</span><br><span class="line">        <span class="comment">// 标签文本颜色</span></span><br><span class="line">        <span class="attr">lableColor</span>: <span class="string">&quot;#777&quot;</span>,</span><br><span class="line">        <span class="comment">// 字体，不能设置文字大小</span></span><br><span class="line">        <span class="attr">font</span>: <span class="string">&quot;&#x27;Helvetica Neue&#x27;, Helvetica, Arial, &#x27;PingFang SC&#x27;, &#x27;Hiragino Sans GB&#x27;, &#x27;Heiti SC&#x27;, &#x27;Microsoft YaHei&#x27;, &#x27;WenQuanYi Micro Hei&#x27;, sans-serif&quot;</span>,</span><br><span class="line">        <span class="comment">// 进度条渐变设置，设置渐变以后会使 circleColor 选项失效</span></span><br><span class="line">        <span class="attr">gradient</span>: &#123;</span><br><span class="line">            <span class="comment">// 渐变方向，默认左右；1 - 上下；2 - 左上右下；3 - 左下右上</span></span><br><span class="line">            <span class="attr">direction</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="comment">// 渐变颜色，设置位置 0 至 1 的不同颜色节点</span></span><br><span class="line">            <span class="attr">color</span>: &#123;</span><br><span class="line">                <span class="string">&quot;0&quot;</span>: <span class="string">&quot;#10aeff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;1&quot;</span>: <span class="string">&quot;#6ad2a5&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rotate</span>: <span class="number">0</span>, <span class="comment">// 旋转，只旋转进度条，文本不旋转</span></span><br><span class="line">    <span class="attr">reverse</span>: <span class="literal">false</span> <span class="comment">// 反方向，顺时针还是逆时针</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;myCanvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;myCanvas2&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            progressBar.<span class="title function_">draw</span>(<span class="number">5.2</span>, <span class="string">&#x27;#myCanvas&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            progressBar.<span class="title function_">draw</span>(<span class="number">19</span>, <span class="string">&#x27;#myCanvas2&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./circleBarBuilder.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./bulde.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小功能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小功能 </tag>
            
            <tag> canvas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>相关问题</title>
      <link href="/hisai3.github.io/2023/01/14/%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
      <url>/hisai3.github.io/2023/01/14/%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>Less,Scss</p><h3 id="node-sass-安装失败"><a href="#node-sass-安装失败" class="headerlink" title="node-sass 安装失败"></a>node-sass 安装失败</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm i node-sass --sass_binary_site=<span class="attr">https</span>:<span class="comment">//npm.taobao.org/mirrors/node-sass/</span></span><br><span class="line"><span class="comment">// 也可以设置系统环境变量的方式。示例</span></span><br><span class="line"><span class="comment">// linux、mac 下</span></span><br><span class="line"><span class="variable constant_">SASS_BINARY_SITE</span>=<span class="attr">https</span>:<span class="comment">//npm.taobao.org/mirrors/node-sass/ npm install node-sass</span></span><br><span class="line"><span class="comment">// window 下</span></span><br><span class="line">set <span class="variable constant_">SASS_BINARY_SITE</span>=<span class="attr">https</span>:<span class="comment">//npm.taobao.org/mirrors/node-sass/ &amp;&amp; npm install node-sass</span></span><br></pre></td></tr></table></figure><p>或者设置全局镜像源：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set sass_binary_site <span class="attr">https</span>:<span class="comment">//npm.taobao.org/mirrors/node-sass/</span></span><br></pre></td></tr></table></figure><p><strong>安装失败后重新安装问题<br>之前安装失败，再安装就不去下载了，怎么办呢？那就先卸载再安装：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall node-sass</span><br><span class="line">npm i node-sass --sass_binary_site=<span class="attr">https</span>:<span class="comment">//npm.taobao.org/mirrors/node-sass/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Scss </tag>
            
            <tag> Less </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端</title>
      <link href="/hisai3.github.io/2023/01/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF/"/>
      <url>/hisai3.github.io/2023/01/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF/</url>
      
        <content type="html"><![CDATA[<h6 id="像素"><a href="#像素" class="headerlink" title="像素"></a>像素</h6><p>1、逻辑分辨率：width height px；</p><p>2、设备分辨率：物理像素点的多少，越多越清晰</p><p>3、失真:同一图像在设备分辨率大的设备上显示会变得模糊<br>需要根据不同的1倍屏（设备像素比），2倍屏，3倍屏显示对应的图片。<br>&lt;img srcset&#x3D;“路径 2x，路径 3x”&gt;<br>pc为1倍屏幕，iphone678plus3b倍屏</p><p>4、PPI（像素密度）：一英寸有多少物理像素点 越大越清晰</p><p>5、viewport 视口：布局视口不设meta：vp   会把pc端的网页缩放至980px，在以前的网页版心一般小于等于980px<br>        理想视口设置meta：vp（移动端）<br>meta标签设置设备访问当前网站的时候的情况（是否允许横屏竖屏、关键字、描述。。。）<br>content&#x3D;”wdth&#x3D;divicewidth，..，..，”<br>width&#x3D;divicewidth：视口宽度等于设备宽度<br>initial-scale&#x3D;1.0：一打开页面要被缩放的倍数<br>maximum-scale&#x3D;1：最大的放大倍数<br>minimum-scale&#x3D;1：最小的放大倍数<br>user-scalable&#x3D;no：是否允许用户缩放页面</p><h4 id="长度单位比较"><a href="#长度单位比较" class="headerlink" title="长度单位比较"></a>长度单位比较</h4><p>1、px：绝对长度单位，固定大小</p><p>2、em：相对长度单位，相对于自身的font-size大小      font-size是多少px，1em就等于多少px！！谷歌默认最小12px字体大小，即使设置10px，无效。</p><p>3、rem：相对长度单位，相对于跟标签html的font-size   font-size是多少px，1rem就等于多！</p><p>rem&lt;—-&gt;px转换！！！！！！！！！！！<br>直接把px改为 rem&#x2F;html的字体大小（即设计稿的宽“不带单位”）<br>优化：引入淘宝flexiable.js    直接把改为rem&#x2F;(pagewidth&#x2F;10)<br>例：设计稿pagewidth为320px，想要font-size为14px     在less中font-size：14rem&#x2F;(320&#x2F;10)</p><p>淘宝flexible.js！！<br>1、根据屏幕宽度动态改变html的字体大小</p><p>2、会把根标签的字体大小改成屏幕大小的1&#x2F;10px</p>]]></content>
      
      
      <categories>
          
          <category> 随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动端的rem适配计算原理</title>
      <link href="/hisai3.github.io/2023/01/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%9A%84rem%E9%80%82%E9%85%8D%E8%AE%A1%E7%AE%97%E5%8E%9F%E7%90%86/"/>
      <url>/hisai3.github.io/2023/01/14/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%9A%84rem%E9%80%82%E9%85%8D%E8%AE%A1%E7%AE%97%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="移动端的rem适配计算原理"><a href="#移动端的rem适配计算原理" class="headerlink" title="移动端的rem适配计算原理"></a>移动端的rem适配计算原理</h1><h2 id="rem是什么？"><a href="#rem是什么？" class="headerlink" title="rem是什么？"></a>rem是什么？</h2><p> rem（font size of the root element）是指相对于根元素的字体大小的单位。简单的说它就是一个相对单位。看到rem大家一定会想起em单位，em（font size of the element）是指相对于父元素的字体大小的单位。它们之间其实很相似，只不过一个计算的规则是依赖根元素一个是依赖父元素计算。</p><h2 id="计算原理："><a href="#计算原理：" class="headerlink" title="计算原理："></a>计算原理：</h2><p>1 屏幕宽为 clientWidth(px)。 设计稿宽度为 750 (px), 假设 n &#x3D; clientWidth(px)&#x2F;750(px);单位化简&#x3D;&#x3D;&#x3D;&gt; n&#x3D; clientWidth&#x2F;750 ;</p><p>2 将 html的 font-size: n(px);</p><p>3 则有 n(px) &#x3D; 1(rem) ,因为1rem为根节点(html节点)字体的大小一倍;</p><p>4 假设有一个 div ,在设计稿测量的宽度为 ruleW(px);</p><p>5 则需要写入的宽度 width: 设为 w (单位暂不确定)</p><p>6 则有 w&#x2F;clientWidth(px) &#x3D; ruleW(px)&#x2F;750(px) 单位化简&#x3D;&#x3D;&#x3D;&gt; w&#x2F;clientWidth(px) &#x3D; ruleW&#x2F;750</p><p>7 化简 w &#x3D; (clientWidth&#x2F;750)<em>ruleW(px) 化简&#x3D;&#x3D;&gt; w &#x3D; n</em>ruleW(px) 转换 w &#x3D; ruleW * n(px)</p><p>8 最后得出 w &#x3D; ruleW * 1(rem) &#x3D; ruleW(rem);</p><p>结论: 当我们设置html的font-szie为 (屏幕宽度&#x2F;设计稿宽度) 的px 时<br>当我们在设计稿上测得的 px 单位值,直接将值换为 rem单位写到代码里面即可,这点与微信小程序的 rpx 单位适配类似</p><p><strong>问题: 上面推导完全按照 数学问题来推算,忽略了一个重要的问题,就是浏览器存在最小字体,不得小于 12px,当我们设置 font-size: n(px) ; 屏幕宽度除以750可能已经很小了,这个比例已经不太合适了,所以我们把它放大一百倍</strong></p><p><strong>放大比例计算规则如下:</strong></p><ol><li>n &#x3D; clientWidth(px)&#x2F;750(px); n2 &#x3D; clientWidth(px)&#x2F;7.50(px); n * 100 &#x3D; n2; n2为n放大后的比例</li><li>将 html的 font-size: n2(px); n2为放大后的比例</li><li>则有 n2(px) &#x3D; 1(rem) , n (px) * 100 &#x3D; 1(rem) , n(px) &#x3D; 1&#x2F;100 (rem);</li><li>假设有一个 div ,在设计稿测量的宽度为 ruleW(px);</li><li>则需要写入的宽度 width: 设为 w (单位暂不确定)</li><li>则有 w&#x2F;clientWidth(px) &#x3D; ruleW(px)&#x2F;750(px) ,<strong>注意这里还是除以 750</strong>, 单位化简&#x3D;&#x3D;&#x3D;&gt; w&#x2F;clientWidth(px) &#x3D; ruleW&#x2F;750</li><li>化简 w &#x3D; (clientWidth&#x2F;750)<strong>ruleW(px) 化简&#x3D;&#x3D;&gt; w &#x3D; n</strong>ruleW(px) 转换 w &#x3D; ruleW * n(px)</li><li>最后得出 w &#x3D; ruleW * 1&#x2F;100(rem) &#x3D; (ruleW&#x2F;100)(rem)</li></ol><p>结论: 当我们设置html的font-szie为 (屏幕宽度*100&#x2F;设计稿宽度) 的px 时 当我们在设计稿上测得的 px 单位值,直接将值除以100换为 rem单位写到代码里面即可</p><p>下面给出几种适配方案：</p><p><strong>所有的使用例子，以一个 div ，在 750 的设计稿中测的 宽度 750 px 、高度 80px 、 背景 pink</strong></p><h4 id="1、js适配，在html页面的-head标签内加入如下代码：-（推荐）"><a href="#1、js适配，在html页面的-head标签内加入如下代码：-（推荐）" class="headerlink" title="1、js适配，在html页面的 head标签内加入如下代码： （推荐）"></a>1、js适配，在html页面的 head标签内加入如下代码： （推荐）</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>= <span class="string">&quot;text/javascript&quot;</span> &gt;</span><span class="language-javascript">    <span class="comment">//手机端的适配    </span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>( <span class="string">&quot;DOMContentLoaded&quot;</span> , <span class="keyword">function</span> (<span class="params"></span>)&#123;      </span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>( <span class="string">&quot;html&quot;</span> )[<span class="number">0</span>].<span class="property">style</span>.<span class="property">fontSize</span>=(<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>/<span class="number">750</span>)*<span class="number">100</span> + <span class="string">&quot;px&quot;</span>;    </span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onresize</span> =  <span class="keyword">function</span> (<span class="params"></span>)&#123;      </span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>( <span class="string">&quot;html&quot;</span> )[<span class="number">0</span>].<span class="property">style</span>.<span class="property">fontSize</span>=(<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>/<span class="number">750</span>)*<span class="number">100</span> + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125; </span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用　　</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;   </span><br><span class="line"><span class="attribute">height</span>: .<span class="number">8rem</span>;   </span><br><span class="line"><span class="attribute">width</span>: <span class="number">7.5rem</span>;    </span><br><span class="line"><span class="attribute">background</span>: pink; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2、css的-calc适配-（推荐）"><a href="#2、css的-calc适配-（推荐）" class="headerlink" title="2、css的 calc适配 （推荐）"></a>2、css的 calc适配 （推荐）</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>&#123;    <span class="attribute">font-size</span>: <span class="built_in">calc</span>(<span class="number">100vw</span> / <span class="number">7.5</span>); &#125;　　</span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;    <span class="attribute">height</span>: .<span class="number">8rem</span>;    <span class="attribute">width</span>: <span class="number">7.5rem</span>;    <span class="attribute">background</span>: pink; &#125;</span><br></pre></td></tr></table></figure><h4 id="3、less-适配（不是和很标准）"><a href="#3、less-适配（不是和很标准）" class="headerlink" title="3、less 适配（不是和很标准）"></a>3、less 适配（不是和很标准）</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.re</span>(<span class="variable">@width</span>) &#123;    </span><br><span class="line">    <span class="variable">@xs:</span> <span class="number">100px</span>/(<span class="number">750px</span>/<span class="variable">@width</span>);    </span><br><span class="line">    <span class="keyword">@media</span> (<span class="attribute">max-width</span>:(<span class="variable">@width</span> + <span class="number">1px</span>)) &#123;      </span><br><span class="line">        <span class="selector-tag">html</span> &#123;        </span><br><span class="line">            <span class="attribute">font-size</span>: <span class="variable">@xs</span>;      </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-class">.re</span>(<span class="number">1600px</span>); <span class="selector-class">.re</span>(<span class="number">1440px</span>); <span class="selector-class">.re</span>(<span class="number">1280px</span>); <span class="selector-class">.re</span>(<span class="number">1024px</span>); <span class="selector-class">.re</span>(<span class="number">960px</span>); <span class="selector-class">.re</span>(<span class="number">950px</span>); <span class="selector-class">.re</span>(<span class="number">900px</span>); <span class="selector-class">.re</span>(<span class="number">800px</span>); <span class="selector-class">.re</span>(<span class="number">773px</span>); <span class="selector-class">.re</span>(<span class="number">768px</span>); <span class="selector-class">.re</span>(<span class="number">736px</span>); <span class="selector-class">.re</span>(<span class="number">732px</span>); <span class="selector-class">.re</span>(<span class="number">731px</span>); <span class="selector-class">.re</span>(<span class="number">667px</span>); <span class="selector-class">.re</span>(<span class="number">640px</span>); <span class="selector-class">.re</span>(<span class="number">600px</span>); <span class="selector-class">.re</span>(<span class="number">568px</span>); <span class="selector-class">.re</span>(<span class="number">533px</span>); <span class="selector-class">.re</span>(<span class="number">435px</span>); <span class="selector-class">.re</span>(<span class="number">414px</span>); <span class="selector-class">.re</span>(<span class="number">411px</span>); <span class="selector-class">.re</span>(<span class="number">384px</span>); <span class="selector-class">.re</span>(<span class="number">375px</span>); <span class="selector-class">.re</span>(<span class="number">360px</span>); <span class="selector-class">.re</span>(<span class="number">320px</span>);　　</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;    <span class="attribute">height</span>: .<span class="number">8rem</span>;    <span class="attribute">width</span>: <span class="number">7.5rem</span>;    <span class="attribute">background</span>: pink; &#125;</span><br></pre></td></tr></table></figure><p>　　</p><h4 id="4、scss-适配"><a href="#4、scss-适配" class="headerlink" title="4、scss 适配"></a>4、scss 适配</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算rem的基准字体 </span></span><br><span class="line"><span class="variable">$rem-base-font-size</span>: <span class="number">100px</span>;  </span><br><span class="line"><span class="comment">// UI设计图的分辨率宽度 </span></span><br><span class="line"><span class="variable">$UI-resolution-width</span>: <span class="number">750px</span>;  </span><br><span class="line"><span class="comment">// 需要适配的屏幕宽度 </span></span><br><span class="line"><span class="variable">$device-widths</span>: <span class="number">240px</span>, <span class="number">320px</span>, <span class="number">360px</span>, <span class="number">375px</span>, <span class="number">390px</span>, <span class="number">414px</span>, <span class="number">480px</span>, <span class="number">540px</span>, <span class="number">640px</span>, <span class="number">720px</span>, <span class="number">768px</span>,<span class="number">1080px</span>, <span class="number">1024px</span>;  <span class="keyword">@mixin</span> html-font-size() &#123;</span><br><span class="line">    <span class="keyword">@each</span> <span class="variable">$current-width</span>  in  <span class="variable">$device-widths</span> &#123;</span><br><span class="line">        <span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="variable">$current-width</span>) &#123;</span><br><span class="line">            <span class="selector-tag">html</span> &#123;      </span><br><span class="line">                <span class="variable">$x</span>: <span class="variable">$UI-resolution-width</span> / <span class="variable">$current-width</span>;</span><br><span class="line">                <span class="comment">//计算出是几倍屏      </span></span><br><span class="line">                <span class="attribute">font-size</span>: <span class="variable">$rem-base-font-size</span> / <span class="variable">$x</span>;     </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125; </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">@include</span> html-font-size();  </span><br><span class="line">@ function  pxToRem(<span class="variable">$px</span>) &#123; </span><br><span class="line">    @ return  <span class="variable">$px</span> / <span class="variable">$rem-base-font-size</span> * <span class="number">1rem</span>; </span><br><span class="line">&#125;　　</span><br></pre></td></tr></table></figure><p>使用： </p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;    <span class="attribute">height</span>: .<span class="number">8rem</span>;    <span class="attribute">width</span>: <span class="number">7.5rem</span>;    <span class="attribute">background</span>: pink; &#125;</span><br></pre></td></tr></table></figure><p>　或者：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;          <span class="attribute">height</span>: <span class="built_in">pxToRem</span>(<span class="number">80px</span>);          <span class="attribute">width</span>: <span class="built_in">pxToRem</span>(<span class="number">750px</span>);          <span class="attribute">background</span>: pink;        &#125;</span><br></pre></td></tr></table></figure><p>　总结： 一般使用第一种，或者第二种较多，</p><h4 id="最后-ipad-上的布局"><a href="#最后-ipad-上的布局" class="headerlink" title="最后 ipad 上的布局"></a>最后 ipad 上的布局</h4><p><strong>注意</strong>：第一种，或者第二种 两种方式在 ipad上面，会出现问题，因为ipad的宽度大于高度，类似于 pc的布局。其实就是一个缩小版的pc，可以直接用 px写布局。 </p><p>实际上，如果确定在 ipad 上面，就不需要再缩放了。<strong>直接还原为 pc布局</strong>，，为了同时兼容 手机端 和 ipad 。所以我们将 第一种方式修改一下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">;( <span class="keyword">function</span> (<span class="params"></span>)&#123;   </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">loaded</span>(<span class="params"></span>)&#123;    </span><br><span class="line">        <span class="keyword">var</span> ua = navigator.<span class="property">userAgent</span>.<span class="title function_">toLowerCase</span>();    </span><br><span class="line">        <span class="keyword">if</span> (<span class="regexp">/ipad/i</span>.<span class="title function_">test</span>(ua))&#123;     <span class="comment">//是 ipad   </span></span><br><span class="line">            <span class="comment">//等同于缩小一倍,这个值,自己可以调整</span></span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>( <span class="string">&quot;html&quot;</span> )[<span class="number">0</span>].<span class="property">style</span>.<span class="property">fontSize</span>= <span class="string">&quot;50px&quot;</span> ;  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;     </span><br><span class="line">            <span class="keyword">var</span> width = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>;     </span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>( <span class="string">&quot;html&quot;</span> )[<span class="number">0</span>].<span class="property">style</span>.<span class="property">fontSize</span>=(width/<span class="number">7.50</span>)+ <span class="string">&quot;px&quot;</span> ;   </span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>( <span class="string">&quot;DOMContentLoaded&quot;</span> ,loaded);   <span class="title function_">loaded</span>(); &#125;()</span><br><span class="line"> );</span><br></pre></td></tr></table></figure><p>　　</p><p> 在 ipad上面 设置 html 的字体为 50px的原因是，因为我们在移动端，设置了字体为 缩小100后的 rem。还是上面的例子：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span>&#123;          <span class="attribute">height</span>: .<span class="number">8rem</span>;          <span class="attribute">width</span>: <span class="number">7.5rem</span>;          <span class="attribute">background</span>: pink;        &#125;</span><br></pre></td></tr></table></figure><p>　　</p><p>以宽度来解析：</p><p>实际在 ipad 中的网页呈现为  0.8 rem &#x3D;&gt;  0.8 * 50 px &#x3D; 40px; 也就是说，我原本在设计稿上测的 80px ，在 ipad上面只展示为 40px。缩小一半，因为 ipad 看上去就像是缩小版的pc。当然这个比例可以自己调整。</p><h4 id="Echarts-rem字体"><a href="#Echarts-rem字体" class="headerlink" title="Echarts rem字体"></a>Echarts rem字体</h4><blockquote><p>该方法为在1920尺寸中；以1rem &#x3D; 100px换算关系的设计稿<br>使用时直接调用：若100px则为： width: fontSize(0.01)</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fontSize</span>(<span class="params">res</span>)&#123;</span><br><span class="line"><span class="keyword">let</span> docEl = <span class="variable language_">document</span>.<span class="property">documentElement</span>,</span><br><span class="line">clientWidth = <span class="variable language_">window</span>.<span class="property">innerWidth</span>||<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>||<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span>;</span><br><span class="line"><span class="keyword">if</span> (!clientWidth) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">let</span> fontSize = <span class="number">100</span> * (clientWidth / <span class="number">1920</span>);</span><br><span class="line"><span class="keyword">return</span> res*fontSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="大屏适配-scale-（字体不会因为太大而换行-布局不会乱）"><a href="#大屏适配-scale-（字体不会因为太大而换行-布局不会乱）" class="headerlink" title="大屏适配 scale （字体不会因为太大而换行, 布局不会乱）"></a>大屏适配 scale （字体不会因为太大而换行, 布局不会乱）</h4><p><strong>第一种最好</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设计稿宽高  预先要设置在外层容器（记得外层容器需要设置定位和宽高为设计稿的宽高！！）</span></span><br><span class="line"><span class="keyword">const</span> designWidth = <span class="number">1920</span></span><br><span class="line"><span class="keyword">const</span> designHeight = <span class="number">1080</span></span><br><span class="line"><span class="comment">// 获取(外层容器 默认window)放大缩小比例</span></span><br><span class="line"><span class="title function_">getScale</span>(<span class="params">isFull = <span class="literal">false</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> w = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / designWidth</span><br><span class="line">  <span class="keyword">const</span> h = <span class="variable language_">window</span>.<span class="property">innerHeight</span> / designHeight</span><br><span class="line">  <span class="keyword">if</span> (!isFull) &#123;</span><br><span class="line">      <span class="keyword">return</span> w &lt; h ? w : h</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">x</span>: w,</span><br><span class="line">      <span class="attr">y</span>: h,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 设置比例</span></span><br><span class="line"><span class="title function_">setScale</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">  <span class="comment">// content 缩放的主要内容（居中：记得外层容器需要先设置绝对定位 left: 50%; top: 50%！！）</span></span><br><span class="line">  <span class="keyword">const</span> content = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.selector&#x27;</span>)</span><br><span class="line">  <span class="comment">// 1.等比例缩放</span></span><br><span class="line">  content.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`scale(<span class="subst">$&#123;<span class="variable language_">this</span>.getScale()&#125;</span>) translate(-50%, -50%)`</span></span><br><span class="line">  <span class="comment">// 2.撑满容器 （会变形）</span></span><br><span class="line">  <span class="keyword">const</span> &#123; x, y &#125; = <span class="variable language_">this</span>.<span class="title function_">getScale</span>(<span class="literal">true</span>)</span><br><span class="line">  content.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`scale(<span class="subst">$&#123;x&#125;</span>, <span class="subst">$&#123;y&#125;</span>) translate(-50%, -50%)`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 撑满屏幕的缩放</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">zoom</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> designWidth = <span class="number">1920</span> <span class="comment">// 设计稿的宽度，根据实际项目调整</span></span><br><span class="line">      <span class="keyword">const</span> designHeight = <span class="number">1080</span> <span class="comment">// 设计稿的高度，根据实际项目调整</span></span><br><span class="line">      <span class="keyword">const</span> cW = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span></span><br><span class="line">      <span class="keyword">const</span> cH = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span></span><br><span class="line">      <span class="keyword">const</span> scaleW = cW / designWidth</span><br><span class="line">      <span class="keyword">const</span> scaleH = cH / designHeight</span><br><span class="line">      hall.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`scale(<span class="subst">$&#123;scaleW&#125;</span>, <span class="subst">$&#123;scaleH&#125;</span>)`</span></span><br><span class="line">      hall.<span class="property">style</span>.<span class="property">transformOrigin</span> = <span class="string">&#x27;left top&#x27;</span></span><br><span class="line">      hall.<span class="property">style</span>.<span class="property">width</span> = designWidth + <span class="string">&#x27;px&#x27;</span> <span class="comment">// 必须, 否则不会铺满</span></span><br><span class="line">      hall.<span class="property">style</span>.<span class="property">height</span> = designHeight + <span class="string">&#x27;px&#x27;</span> <span class="comment">// 必须, 否则不会铺满</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 等比缩放  会有留白</span></span><br><span class="line"><span class="keyword">let</span> cliWidth = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span> || <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span></span><br><span class="line">      <span class="keyword">let</span> cliHeight = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span> || <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span></span><br><span class="line">      <span class="keyword">let</span> contW = <span class="number">1920</span></span><br><span class="line">      <span class="keyword">let</span> contH = <span class="number">1080</span></span><br><span class="line">      <span class="keyword">let</span> w = cliWidth / contW</span><br><span class="line">      <span class="keyword">let</span> h = cliHeight / contH</span><br><span class="line">      <span class="keyword">let</span> appDom = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line">      <span class="keyword">let</span> size = cliWidth / cliHeight</span><br><span class="line">      <span class="keyword">if</span> (cliWidth === screen.<span class="property">width</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;view/setResize&#x27;</span>, [w, h])</span><br><span class="line">        appDom.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;scale(&#x27;</span> + w + <span class="string">&#x27;,&#x27;</span> + h + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (size &gt; contW / contH) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;view/setResize&#x27;</span>, [w, h])</span><br><span class="line">        appDom.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;scale(&#x27;</span> + h + <span class="string">&#x27;,&#x27;</span> + h + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&#x27;view/setResize&#x27;</span>, [w, w])</span><br><span class="line">        appDom.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;scale(&#x27;</span> + w + <span class="string">&#x27;,&#x27;</span> + w + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      appDom.<span class="property">style</span>.<span class="property">transformOrigin</span> = <span class="string">&#x27;top left&#x27;</span></span><br><span class="line">      appDom.<span class="property">style</span>.<span class="property">width</span> = contW + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">      appDom.<span class="property">style</span>.<span class="property">height</span> = contH + <span class="string">&#x27;px&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 随记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> javascript </tag>
            
            <tag> 移动端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>链接</title>
      <link href="/hisai3.github.io/2023/01/14/%E9%93%BE%E6%8E%A5/"/>
      <url>/hisai3.github.io/2023/01/14/%E9%93%BE%E6%8E%A5/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.jianshu.com/p/6545015017c4">文件下载重命名</a></p><blockquote><p>浏览器下载视频 避免download属性跨域而失效，导致浏览器直接打开视频观看 –&gt; 笔记-problem</p></blockquote><p><a href="https://juejin.im/post/6844903561017425927">文件预览</a></p><p><a href="https://github.com/acexyf/multerDemo.git">node 文件上传demo</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">附node代理转发:</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">&#x27;http-proxy-middleware&#x27;</span>)</span><br><span class="line"><span class="comment">// 允许所有域名跨域</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;*&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;  </span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Content-Type,Content-Length, Authorization, Accept,X-Requested-With&quot;</span>);   </span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PUT,POST,GET,DELETE,OPTIONS&quot;</span>);    </span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;X-Powered-By&quot;</span>, <span class="string">&#x27; 3.2.1&#x27;</span>) </span><br><span class="line">    <span class="comment">// 跨域请求CORS中的预请求    </span></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&quot;OPTIONS&quot;</span>) &#123;        </span><br><span class="line">        res.<span class="title function_">send</span>(<span class="number">200</span>); </span><br><span class="line">    <span class="comment">//让options请求快速返回    </span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>();    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//代理</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>,  proxy.<span class="title function_">createProxyMiddleware</span>(&#123;    </span><br><span class="line">    <span class="attr">target</span>: <span class="string">&quot;https://livetest.bndxqc.com:443&quot;</span>,      </span><br><span class="line">    <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// pathRewrite: &#123; &quot;^/api&quot;: &quot;/&quot; &#125;    </span></span><br><span class="line"> &#125;))</span><br><span class="line"> </span><br><span class="line"><span class="comment">//删除</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/dele&#x27;</span>, <span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123; </span><br><span class="line">    <span class="keyword">const</span> file = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./uploads/1603169708176-7SJ5nTc2CAJBxTmtNWP7Y4bYanGyHMJW.png&#x27;</span>)    </span><br><span class="line">    <span class="comment">// fs.unlinkSync(file);    </span></span><br><span class="line">    fs.<span class="title function_">unlink</span>(file, err =&amp;gt; &#123;        </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);        </span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123; <span class="attr">msg</span>: <span class="string">&#x27;delete fail&#x27;</span>&#125;) </span><br><span class="line">        res.<span class="title function_">json</span>(&#123;            </span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;delete Ok&#x27;</span></span><br><span class="line">        &#125;)   </span><br><span class="line">    &#125;);    </span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://withpinbox.com/explore/collection/266629">摸鱼</a></p><p><a href="https://blog.csdn.net/csm0912/article/details/90260296">正则-千位分割符的理解</a></p><p><a href="https://blog.csdn.net/csm0912/article/details/81206848">正则-?&#x3D;和?:和?!的理解</a></p><p><a href="https://wow.techbrood.com/fiddle/26702">css3点赞动画</a></p><p><a href="https://juejin.im/post/6892017198450081800">vue3</a></p><p><a href="https://blog.csdn.net/qq_40146638/article/details/103493997?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~first_rank_v2~rank_v28-5-103493997.nonecase&utm_term=%E6%BB%9A%E5%8A%A8%E5%8A%A0%E8%BD%BD%E5%92%8C%E8%99%9A%E6%8B%9F%E6%BB%9A%E5%8A%A8&spm=1000.2123.3001.4430">长列表虚拟滚动</a></p>]]></content>
      
      
      <categories>
          
          <category> workspace </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>预渲染  prerender-spa-plugin</title>
      <link href="/hisai3.github.io/2023/01/14/%E9%A2%84%E6%B8%B2%E6%9F%93%20%20prerender-spa-plugin/"/>
      <url>/hisai3.github.io/2023/01/14/%E9%A2%84%E6%B8%B2%E6%9F%93%20%20prerender-spa-plugin/</url>
      
        <content type="html"><![CDATA[<h3 id="预渲染-prerender-spa-plugin"><a href="#预渲染-prerender-spa-plugin" class="headerlink" title="预渲染  prerender-spa-plugin"></a>预渲染  prerender-spa-plugin</h3><p>main.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>),</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&#x27;render-event&#x27;</span>))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>vue.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="comment">// 预渲染</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PrerenderSPAPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;prerender-spa-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Renderer</span> = <span class="title class_">PrerenderSPAPlugin</span>.<span class="property">PuppeteerRenderer</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> path.<span class="title function_">join</span>(__dirname, dir)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8013</span> <span class="comment">// 端口配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// All configuration item explanations can be find in https://cli.vuejs.org/config/</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;./&#x27;</span>,</span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&#x27;static&#x27;</span>,</span><br><span class="line">  <span class="attr">lintOnSave</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// disableHostCheck: true,</span></span><br><span class="line">    <span class="attr">port</span>: port,</span><br><span class="line">    <span class="comment">// open: true,</span></span><br><span class="line">    <span class="attr">overlay</span>: &#123;</span><br><span class="line">      <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">errors</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;api&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;/auth&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;^/auth&#x27;</span>: <span class="string">&#x27;auth&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">chainWebpack</span>(<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">// config.plugins.delete(&#x27;preload&#x27;) // <span class="doctag">TODO:</span> need test</span></span><br><span class="line">    <span class="comment">// config.plugins.delete(&#x27;prefetch&#x27;) // <span class="doctag">TODO:</span> need test</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// set svg-sprite-loader</span></span><br><span class="line">    <span class="comment">// config.module</span></span><br><span class="line">    <span class="comment">//   .rule(&#x27;svg&#x27;)</span></span><br><span class="line">    <span class="comment">//   .exclude.add(resolve(&#x27;src/assets/icons&#x27;))</span></span><br><span class="line">    <span class="comment">//   .end()</span></span><br><span class="line">    <span class="comment">// config.module</span></span><br><span class="line">    <span class="comment">//   .rule(&#x27;icons&#x27;)</span></span><br><span class="line">    <span class="comment">//   .test(/\.svg$/)</span></span><br><span class="line">    <span class="comment">//   .include.add(resolve(&#x27;src/assets/icons&#x27;))</span></span><br><span class="line">    <span class="comment">//   .end()</span></span><br><span class="line">    <span class="comment">//   .use(&#x27;svg-sprite-loader&#x27;)</span></span><br><span class="line">    <span class="comment">//   .loader(&#x27;svg-sprite-loader&#x27;)</span></span><br><span class="line">    <span class="comment">//   .options(&#123;</span></span><br><span class="line">    <span class="comment">//     symbolId: &#x27;icon-[name]&#x27;</span></span><br><span class="line">    <span class="comment">//   &#125;)</span></span><br><span class="line">    <span class="comment">//   .end()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// set preserveWhitespace</span></span><br><span class="line">    config.<span class="property">module</span></span><br><span class="line">      .<span class="title function_">rule</span>(<span class="string">&#x27;vue&#x27;</span>)</span><br><span class="line">      .<span class="title function_">use</span>(<span class="string">&#x27;vue-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">loader</span>(<span class="string">&#x27;vue-loader&#x27;</span>)</span><br><span class="line">      .<span class="title function_">tap</span>(<span class="function"><span class="params">options</span> =&gt;</span> &#123;</span><br><span class="line">        options.<span class="property">compilerOptions</span>.<span class="property">preserveWhitespace</span> = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span> options</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">end</span>()</span><br><span class="line"></span><br><span class="line">    config</span><br><span class="line">      <span class="comment">// https://webpack.js.org/configuration/devtool/#development</span></span><br><span class="line">      .<span class="title function_">when</span>(process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="params">config</span> =&gt;</span> config.<span class="title function_">devtool</span>(<span class="string">&#x27;cheap-source-map&#x27;</span>)</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">    config</span><br><span class="line">      .<span class="title function_">when</span>(process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">        <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">          config</span><br><span class="line">            .<span class="title function_">plugin</span>(<span class="string">&#x27;ScriptExtHtmlWebpackPlugin&#x27;</span>)</span><br><span class="line">            .<span class="title function_">after</span>(<span class="string">&#x27;html&#x27;</span>)</span><br><span class="line">            .<span class="title function_">use</span>(<span class="string">&#x27;script-ext-html-webpack-plugin&#x27;</span>, [&#123;</span><br><span class="line">              <span class="comment">// `runtime` must same as runtimeChunk name. default is `runtime`</span></span><br><span class="line">              <span class="attr">inline</span>: <span class="regexp">/runtime\..*\.js$/</span></span><br><span class="line">            &#125;])</span><br><span class="line">            <span class="comment">// 预渲染</span></span><br><span class="line">          config</span><br><span class="line">            .<span class="title function_">plugin</span>(<span class="string">&#x27;PrerenderSpaPlugin&#x27;</span>)</span><br><span class="line">            .<span class="title function_">use</span>(<span class="string">&#x27;prerender-spa-plugin&#x27;</span>, [&#123;</span><br><span class="line">              <span class="attr">staticDir</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">              <span class="attr">routes</span>: [<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;/about&#x27;</span>],</span><br><span class="line">              <span class="attr">renderer</span>: <span class="keyword">new</span> <span class="title class_">Renderer</span>(&#123;</span><br><span class="line">                <span class="attr">inject</span>: &#123;</span><br><span class="line">                  <span class="attr">foo</span>: <span class="string">&quot;bar&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">headless</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">renderAfterDocumentEvent</span>: <span class="string">&#x27;render-event&#x27;</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;])</span><br><span class="line">            .<span class="title function_">end</span>()</span><br><span class="line">          config</span><br><span class="line">            .<span class="property">optimization</span>.<span class="title function_">splitChunks</span>(&#123;</span><br><span class="line">              <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">              <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">                <span class="attr">libs</span>: &#123;</span><br><span class="line">                  <span class="attr">name</span>: <span class="string">&#x27;chunk-libs&#x27;</span>,</span><br><span class="line">                  <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                  <span class="attr">priority</span>: <span class="number">10</span>,</span><br><span class="line">                  <span class="attr">chunks</span>: <span class="string">&#x27;initial&#x27;</span> <span class="comment">// only package third parties that are initially dependent</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">elementUI</span>: &#123;</span><br><span class="line">                  <span class="attr">name</span>: <span class="string">&#x27;chunk-elementUI&#x27;</span>, <span class="comment">// split elementUI into a single package</span></span><br><span class="line">                  <span class="attr">priority</span>: <span class="number">20</span>, <span class="comment">// the weight needs to be larger than libs and app or it will be packaged into libs or app</span></span><br><span class="line">                  <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]_?element-ui(.*)/</span> <span class="comment">// in order to adapt to cnpm</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">commons</span>: &#123;</span><br><span class="line">                  <span class="attr">name</span>: <span class="string">&#x27;chunk-commons&#x27;</span>,</span><br><span class="line">                  <span class="attr">test</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src/components&#x27;</span>), <span class="comment">// can customize your rules</span></span><br><span class="line">                  <span class="attr">minChunks</span>: <span class="number">3</span>, <span class="comment">//  minimum common number</span></span><br><span class="line">                  <span class="attr">priority</span>: <span class="number">5</span>,</span><br><span class="line">                  <span class="attr">reuseExistingChunk</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          config.<span class="property">optimization</span>.<span class="title function_">runtimeChunk</span>(<span class="string">&#x27;single&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>鼠标幻影动画</title>
      <link href="/hisai3.github.io/2023/01/14/%E9%BC%A0%E6%A0%87%E5%B9%BB%E5%BD%B1%E5%8A%A8%E7%94%BB/"/>
      <url>/hisai3.github.io/2023/01/14/%E9%BC%A0%E6%A0%87%E5%B9%BB%E5%BD%B1%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<h3 id="鼠标幻影动画（一串div追随鼠标移动）"><a href="#鼠标幻影动画（一串div追随鼠标移动）" class="headerlink" title="鼠标幻影动画（一串div追随鼠标移动）"></a>鼠标幻影动画（一串div追随鼠标移动）</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    * &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="comment">/* background: green; */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: red;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">2</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">3</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: yellow;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">4</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: blue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">5</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: pink;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">6</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: orange;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">7</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: skyblue;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">8</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: hotpink;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">9</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: purple;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box</span><span class="selector-pseudo">:nth-of-type</span>(<span class="number">10</span>n) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: gold;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> aBox = <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&quot;box&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> timer;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="keyword">function</span> (<span class="params">ev</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">clearInterval</span>(timer);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> ev = ev || <span class="variable language_">window</span>.<span class="property">event</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 设置一个div块跟随鼠标移动</span></span></span><br><span class="line"><span class="language-javascript">      aBox[<span class="number">0</span>].<span class="property">style</span>.<span class="property">top</span> = ev.<span class="property">pageY</span> + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">      aBox[<span class="number">0</span>].<span class="property">style</span>.<span class="property">left</span> = ev.<span class="property">pageX</span> + <span class="string">&quot;px&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">var</span> i = aBox.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span></span><br><span class="line"><span class="language-javascript">        aBox[i].<span class="property">style</span>.<span class="property">top</span> = aBox[i - <span class="number">1</span>].<span class="property">style</span>.<span class="property">top</span>;</span></span><br><span class="line"><span class="language-javascript">        aBox[i].<span class="property">style</span>.<span class="property">left</span> = aBox[i - <span class="number">1</span>].<span class="property">style</span>.<span class="property">left</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 设置定时器  每隔一段时间让后面一个div覆盖前面一个div的位置</span></span></span><br><span class="line"><span class="language-javascript">      timer = <span class="built_in">setInterval</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">var</span> i = aBox.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span></span><br><span class="line"><span class="language-javascript">          aBox[i].<span class="property">style</span>.<span class="property">top</span> = aBox[i - <span class="number">1</span>].<span class="property">style</span>.<span class="property">top</span>;</span></span><br><span class="line"><span class="language-javascript">          aBox[i].<span class="property">style</span>.<span class="property">left</span> = aBox[i - <span class="number">1</span>].<span class="property">style</span>.<span class="property">left</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;, <span class="number">10</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小功能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小功能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>饼图（pie）</title>
      <link href="/hisai3.github.io/2023/01/14/%E9%A5%BC%E5%9B%BE%EF%BC%88pie%EF%BC%89/"/>
      <url>/hisai3.github.io/2023/01/14/%E9%A5%BC%E5%9B%BE%EF%BC%88pie%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.hangge.com/blog/cache/detail_3130.html#">自定义label标签的样式</a></p><p>饼图1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">tooltip</span>: &#123;</span><br><span class="line">      <span class="attr">trigger</span>: <span class="string">&#x27;item&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">        <span class="attr">radius</span>: <span class="string">&#x27;60%&#x27;</span>,</span><br><span class="line">        data,</span><br><span class="line">       <span class="attr">label</span>: &#123;</span><br><span class="line">                  <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">                  <span class="attr">formatter</span>: <span class="string">&quot;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&quot;</span> <span class="comment">// b代表名称，c代表对应值，d代表百分比</span></span><br><span class="line">              &#125;,</span><br><span class="line">        <span class="attr">emphasis</span>: &#123;</span><br><span class="line">          <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">            <span class="attr">shadowBlur</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">shadowOffsetX</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">shadowColor</span>: <span class="string">&#x27;rgba(0, 0, 0, 0.5)&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>饼图2</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">color</span>: [<span class="string">&#x27;#5087ec&#x27;</span> , <span class="string">&#x27;#68bbc4&#x27;</span>, <span class="string">&#x27;#58a55c&#x27;</span>], <span class="comment">// 饼图颜色</span></span><br><span class="line">    <span class="attr">legend</span>: &#123;</span><br><span class="line">      <span class="attr">left</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">      <span class="attr">selectedMode</span>: <span class="literal">false</span> <span class="comment">// 禁止点击legend显示隐藏对应列</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">        <span class="attr">radius</span>: <span class="string">&#x27;48%&#x27;</span>, </span><br><span class="line">        <span class="attr">center</span>: [<span class="string">&#x27;50%&#x27;</span>, <span class="string">&#x27;50%&#x27;</span>],  <span class="comment">// 水平垂直居中</span></span><br><span class="line">        <span class="attr">data</span>: [],</span><br><span class="line">        <span class="attr">silent</span>: <span class="string">&#x27;ture&#x27;</span>, <span class="comment">// 取消点击列的放大效果</span></span><br><span class="line">        <span class="attr">label</span>: &#123; <span class="comment">// 适用于柱状图</span></span><br><span class="line">            <span class="attr">normal</span>: &#123;</span><br><span class="line">                <span class="comment">// 字符串形式</span></span><br><span class="line">                <span class="comment">// formatter: &#x27;&#123;a&#125;\n&#123;bTitle|来源：&#125;&#123;bValue|&#123;b&#125;&#125;\n&#123;hr|&#125;\n&#x27; </span></span><br><span class="line">                <span class="attr">formatter</span>: <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> percent = <span class="title class_">Math</span>.<span class="title function_">round</span>(data.<span class="property">percent</span> * <span class="number">10</span>) / <span class="number">10</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;data.name&#125;</span>\n\r<span class="subst">$&#123;data.value&#125;</span> &#123;per|<span class="subst">$&#123;percent&#125;</span>%&#125;`</span> <span class="comment">// per未类名</span></span><br><span class="line">                &#125;,</span><br><span class="line">            <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">textStyle</span>: &#123;</span><br><span class="line">              <span class="attr">color</span>: <span class="string">&#x27;#000&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">rich</span>: &#123;</span><br><span class="line">              <span class="attr">per</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;#ff0000&#x27;</span>,</span><br><span class="line">                <span class="attr">fontWeight</span>: <span class="string">&#x27;Bold&#x27;</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Echarts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Echarts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript</title>
      <link href="/hisai3.github.io/2023/01/14/TypeScript/"/>
      <url>/hisai3.github.io/2023/01/14/TypeScript/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.tslang.cn/docs/handbook/interfaces.html">typescript 官网3</a></p><p><a href="https://juejin.im/post/6883432548970545160">掘金参考</a></p><h3 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h3><h4 id="any"><a href="#any" class="headerlink" title="any"></a>any</h4><blockquote><p>any 即是 top type, 又是 bottom type (它是任何类型的 subtype ) , 这导致 any 基本上就是放弃了任何类型检查.</p><p>unknown 类型的变量可以赋值给所有类型 （除了<code>never</code>以外）</p></blockquote><h4 id="unknow"><a href="#unknow" class="headerlink" title="unknow"></a>unknow</h4><blockquote><p>unknown 是 top type (任何类型都是它的 subtype)</p><p><strong>所有类型</strong>都可以分配给unknown</p><p> unknown 类型的变量  <strong>只能</strong> 赋值给 any 和 unknown</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">uncertain</span>: unknown = <span class="string">&#x27;Hello&#x27;</span>!;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">notSure</span>: any = uncertain;</span><br></pre></td></tr></table></figure><blockquote><p><strong>如果不缩小类型，就无法对 unknown 类型执行任何操作</strong></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getDog</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&#x27;22&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">dog</span>: unknown = <span class="title function_">getDog</span>();</span><br><span class="line">dog.<span class="title function_">hello</span>(); <span class="comment">//Object is of type &#x27;unknown&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="类型保护"><a href="#类型保护" class="headerlink" title="类型保护"></a>类型保护</h4><blockquote><p>类型保护：缩小类型的范围</p></blockquote><blockquote><p>使用类型断言来缩小范围: </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getDogName</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"> <span class="keyword">let</span> <span class="attr">x</span>: unknown;</span><br><span class="line"> <span class="keyword">return</span> x;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> dogName = <span class="title function_">getDogName</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((dogName <span class="keyword">as</span> string).<span class="title function_">toLowerCase</span>());</span><br></pre></td></tr></table></figure><blockquote><p> <strong>in 关键字</strong></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Admin</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">privileges</span>: string[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Employee</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string;</span><br><span class="line">  <span class="attr">startDate</span>: <span class="title class_">Date</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">UnknownEmployee</span> = <span class="title class_">Employee</span> | <span class="title class_">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printEmployeeInformation</span>(<span class="params">emp: UnknownEmployee</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Name: &quot;</span> + emp.<span class="property">name</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;privileges&quot;</span> <span class="keyword">in</span> emp) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Privileges: &quot;</span> + emp.<span class="property">privileges</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&quot;startDate&quot;</span> <span class="keyword">in</span> emp) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Start Date: &quot;</span> + emp.<span class="property">startDate</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>或者用 <em><strong>typeOf</strong></em>  <em><strong>instanceOf</strong></em>  进行校验</p><p><strong>注意：</strong><code>typeof</code> 只有和基本类型（<code>number，string，boolean，symbol</code>）通过 <code>===, !==</code> 比较时，才会被识别为类型保护</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">func</span>(<span class="params">value: unknown</span>) &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore: Object is of type &#x27;unknown&#x27;.</span></span><br><span class="line">  value.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>) &#123; <span class="comment">// type guard</span></span><br><span class="line">      <span class="comment">// %inferred-type: string</span></span><br><span class="line">      value;</span><br><span class="line"></span><br><span class="line">      value.<span class="property">length</span>; <span class="comment">// OK</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>或者断言函数:</p><p>定义一个类型保护，我们只要简单地定义一个函数，它的返回值是一个 <strong>类型谓词</strong></p><p><strong>类型谓词</strong>:</p><p><code>pet is Fish</code> 就是类型谓词。 谓词为 <code>parameterName is Type</code> 这种形式，<code>parameterName</code> 必须是来自于当前函数签名里的一个参数名</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isFish</span>(<span class="params">pet: Fish | Bird</span>): pet is <span class="title class_">Fish</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (&lt;<span class="title class_">Fish</span>&gt;pet).<span class="property">swim</span> !== <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="never"><a href="#never" class="headerlink" title="never"></a>never</h4><blockquote><p><code>never </code>类型 <code>(bottom type: 即最低层)</code> 是任何类型的子类型，也可以赋值给任何类型；<br>然而，没有类型是never的子类型 <em><strong>或</strong></em>  没有类型可以赋值给never类型（除了never本身之外）。<br>即使 any 也不可以赋值给 never。<br>通常表现为  <code>抛出异常</code>  或  <code>无法执行到终止点</code>（例如无线循环）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">x</span>: never;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">y</span>: number;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行错误，数字类型不能转为 never 类型</span></span><br><span class="line">x = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行正确，never 类型可以赋值给 never类型</span></span><br><span class="line">x = (<span class="function">()=&gt;</span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;exception&#x27;</span>)&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行正确，never 类型可以赋值给 数字类型</span></span><br><span class="line">y = (<span class="function">()=&gt;</span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;exception&#x27;</span>)&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回值为 never 的函数可以是抛出异常的情况</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">message: string</span>): never &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回值为 never 的函数可以是无限循环这种无法被执行到的终止点的情况</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>): never &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="定义类型：接口interface、class、type"><a href="#定义类型：接口interface、class、type" class="headerlink" title="定义类型：接口interface、class、type"></a>定义类型：接口interface、class、type</h3><h4 id="接口interface"><a href="#接口interface" class="headerlink" title="接口interface"></a>接口interface</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface name &#123;</span><br><span class="line">  <span class="attr">label</span>: string; <span class="comment">// 默认必须有</span></span><br><span class="line">  grade!: string; <span class="comment">// !必须</span></span><br><span class="line">  color?: string; <span class="comment">// ?可选属性 可有可无,但不能写错,否则会报错提示</span></span><br><span class="line">  readonly <span class="attr">y</span>: number; <span class="comment">// readonly 只读属性 (跟class一样)</span></span><br><span class="line">  (<span class="attr">source</span>: string, <span class="attr">subString</span>: string): number; <span class="comment">// 函数类型(接口) 就像一个只有参数列表和返回值类型的函数定义。参数列表里的每个参数都需要名字和类型。</span></span><br><span class="line">  [<span class="attr">propName</span>: string]: any; <span class="comment">// 额外类型(可索引类型 规定类型没要求)</span></span><br><span class="line">  [<span class="attr">x</span>: string]: <span class="title class_">Array</span>; <span class="comment">// 可索引类型(接口中所有的key为string, value为Array,否则报错) “通过索引得到值”如：a[10]或ageMap[&quot;daniel&quot;]</span></span><br><span class="line">  <span class="keyword">new</span> (<span class="attr">hour</span>: number, <span class="attr">minute</span>: number); <span class="comment">// 如果签名有前缀new表示这个函数必须要被构造器调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>接口的额外类型  <em>error: ‘width’ not expected in type ‘SquareConfig’</em></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">interface student &#123;</span><br><span class="line">  <span class="attr">color</span>: string; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createSquare</span>(<span class="params">config: student</span>): &#123; <span class="attr">color</span>: string &#125; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(config)</span><br><span class="line">    <span class="keyword">return</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> mySquare = <span class="title function_">createSquare</span>(&#123; <span class="attr">color</span>: <span class="string">&quot;red&quot;</span>, <span class="attr">width</span>: <span class="number">100</span> &#125;); <span class="comment">// error: &#x27;width&#x27; not expected in type &#x27;SquareConfig&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决报错</span></span><br><span class="line"><span class="comment">// 1.使用断言</span></span><br><span class="line"><span class="keyword">let</span> mySquare = <span class="title function_">createSquare</span>(&#123; <span class="attr">color</span>: <span class="string">&quot;red&quot;</span>, <span class="attr">width</span>: <span class="number">100</span> &#125; <span class="keyword">as</span> student);</span><br><span class="line"><span class="comment">// 2.在接口中添加字符串索引</span></span><br><span class="line">interface <span class="title class_">SquareConfig</span> &#123;</span><br><span class="line">    <span class="attr">color</span>: string;</span><br><span class="line">    [<span class="attr">propName</span>: string]: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="类类型-implements"><a href="#类类型-implements" class="headerlink" title="类类型 implements"></a>类类型 <strong>implements</strong></h5><blockquote><p>( 一种约定，明确的强制一个类去符合某种契约！)</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">ClockInterface</span> &#123;</span><br><span class="line">    <span class="attr">currentTime</span>: <span class="title class_">Date</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> implements <span class="title class_">ClockInterface</span> &#123; <span class="comment">// 实现接口</span></span><br><span class="line"><span class="comment">// implements 强制要求Clock必须有 ClockInterface接口中的类型 否则报错 Property &#x27;currentTime&#x27; is missing in type &#x27;Clock&#x27;</span></span><br><span class="line">    <span class="attr">currentTime</span>: <span class="title class_">Date</span>; </span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">h: number, m: number</span>) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="interface中的-new"><a href="#interface中的-new" class="headerlink" title="interface中的 new()"></a><strong>interface</strong>中的 <em><strong>new()</strong></em></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">ClockConstructor</span> &#123;</span><br><span class="line">  <span class="keyword">new</span> (<span class="attr">hour</span>: number, <span class="attr">minute</span>: number); <span class="comment">// 如果签名有前缀new表示这个函数必须要被构造器调用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Clock</span> implements <span class="title class_">ClockConstructor</span> &#123;</span><br><span class="line"><span class="comment">/*报错：Class &#x27;Clock&#x27; incorrectly implements interface &#x27;ClockConstructor&#x27;.</span></span><br><span class="line"><span class="comment">  Type &#x27;Clock&#x27; provides no match for the signature &#x27;new (hour: number, minute: number): any&#x27;.*/</span></span><br><span class="line">  <span class="attr">currentTime</span>: <span class="title class_">Date</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">h: number, m: number</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 报错原因：类实现接口的时候，只检查实例部分，而类里的constructor属于静态部分，所以不检查</span></span><br><span class="line"><span class="comment">// 解决: class expression</span></span><br><span class="line">interface <span class="title class_">ClockConstructor</span> &#123;</span><br><span class="line">  <span class="keyword">new</span> (<span class="attr">hour</span>: number, <span class="attr">minute</span>: number);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ClockInterface</span> &#123;</span><br><span class="line">  <span class="title function_">tick</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Clock</span>: <span class="title class_">ClockConstructor</span> = <span class="keyword">class</span> <span class="title class_">Clock</span> implements <span class="title class_">ClockInterface</span> &#123; <span class="comment">// 就是指定类型 或按官网事例参数类型检查也可以但复杂</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">h: number, m: number</span>) &#123;&#125;</span><br><span class="line">  <span class="title function_">tick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beep beep&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c =<span class="keyword">new</span> <span class="title class_">Clock</span>(<span class="number">12</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure><h5 id="接口继承-extends"><a href="#接口继承-extends" class="headerlink" title="接口继承 extends"></a>接口继承 extends</h5><blockquote><p>interface  extends  interface  </p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="attr">color</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">PenStroke</span> &#123;</span><br><span class="line">    <span class="attr">penWidth</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_">Shape</span>, <span class="title class_">PenStroke</span> &#123; <span class="comment">// class的继承一次只能继承一个class</span></span><br><span class="line">    <span class="attr">sideLength</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> square = &lt;<span class="title class_">Square</span>&gt;&#123;&#125;;</span><br><span class="line">square.<span class="property">color</span> = <span class="string">&quot;blue&quot;</span>;</span><br><span class="line">square.<span class="property">sideLength</span> = <span class="number">10</span>;</span><br><span class="line">square.<span class="property">penWidth</span> = <span class="number">5.0</span>;</span><br></pre></td></tr></table></figure><blockquote><p>interface  extends  class  …</p></blockquote><h4 id="class"><a href="#class" class="headerlink" title="class"></a>class</h4><h5 id="public-private-protected"><a href="#public-private-protected" class="headerlink" title="public,  private,  protected"></a><em><strong>public</strong></em>,  <em>private</em>,  <strong>protected</strong></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    public <span class="attr">name</span>: string; <span class="comment">// 默认即public</span></span><br><span class="line">private <span class="attr">name</span>: string; <span class="comment">// 仅仅能在这个类中进行在这个属性的访问。在子类和类的实现的对象中都不能访问</span></span><br><span class="line">    protected <span class="attr">name</span>: string; <span class="comment">// 仅仅能在这个类中或子类中能访问</span></span><br><span class="line">protected <span class="title function_">constructor</span>(<span class="params">theName: string</span>) &#123; <span class="comment">// 该类只能被继承不能被实现</span></span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">name</span> = theName;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="interface-和-class-继承注意"><a href="#interface-和-class-继承注意" class="headerlink" title="interface  和 class 继承注意"></a><em><strong>interface</strong></em>  和 <em><strong>class</strong></em> 继承注意</h5><blockquote><p><em><strong>interface</strong></em>  和 <em><strong>class</strong></em> 继承大致相同</p><table><thead><tr><th></th><th>数量</th><th>属性重复</th><th>接口（类名）重复</th></tr></thead><tbody><tr><td>interface</td><td>可继承多个</td><td>类型不一致会报错</td><td>类似于继承</td></tr><tr><td>class</td><td>只能继承一个</td><td>类型不一致会报错</td><td>报错：重复声明</td></tr></tbody></table></blockquote><h5 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h5><blockquote><p><code>abstract</code>关键字是用于定义  <em><strong>抽象类</strong></em>  和在  抽象类内部定义  <em><strong>抽象方法</strong></em>。</p></blockquote><p>类似于  <em><strong>类类型</strong></em>  实现接口</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">    abstract <span class="title function_">makeSound</span>(): <span class="keyword">void</span>; <span class="comment">// 必须在派生类(子类)中实现</span></span><br><span class="line">    <span class="title function_">move</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;roaming the earch...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AccountingDepartment</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Department</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(<span class="string">&#x27;Accounting and Auditing&#x27;</span>); <span class="comment">// 在派生类的构造函数中必须调用 super()</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="title function_">makeSound</span>(): <span class="keyword">void</span> &#123; &#125;;</span><br><span class="line">    <span class="title function_">move</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;The Accounting Department meets each Monday at 10am.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">generateReports</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Generating accounting reports...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">department</span>: <span class="title class_">Department</span>; <span class="comment">// 允许创建一个对抽象类型的引用</span></span><br><span class="line">department = <span class="keyword">new</span> <span class="title class_">Department</span>(); <span class="comment">// 错误: 不能创建一个抽象类的实例</span></span><br><span class="line">department = <span class="keyword">new</span> <span class="title class_">AccountingDepartment</span>(); <span class="comment">// 允许对一个抽象子类进行实例化和赋值</span></span><br><span class="line">department.<span class="title function_">generateReports</span>(); <span class="comment">// 错误: 方法在声明的抽象类中不存在</span></span><br></pre></td></tr></table></figure><h4 id="type-类型别名"><a href="#type-类型别名" class="headerlink" title="type(类型别名)"></a>type(类型别名)</h4><p><strong>与 <em>interface</em> 区别</strong></p><blockquote><ol><li><strong>interface</strong> 只能表示function，object和class类型，<strong>type</strong> 除了这些类型还可以表示其他类型</li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface A&#123;<span class="attr">name</span>:string;</span><br><span class="line">            <span class="attr">add</span>:<span class="function">()=&gt;</span><span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line">interface B&#123;():<span class="keyword">void</span>&#125;</span><br><span class="line"> </span><br><span class="line">type C=<span class="function">()=&gt;</span>number;</span><br><span class="line">type D=string;</span><br><span class="line">type E=&#123;<span class="attr">name</span>:string,<span class="attr">age</span>:number&#125;</span><br></pre></td></tr></table></figure><blockquote><ol start="2"><li><strong>interface</strong> 可以合并同名接口，<strong>type</strong> 不可以</li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface A&#123;<span class="attr">name</span>:string&#125;</span><br><span class="line">interface A&#123;<span class="attr">age</span>:number&#125;</span><br><span class="line">interface A&#123; <span class="attr">age</span>: number, <span class="attr">name</span>: number &#125; <span class="comment">// 重新指定类型会报错</span></span><br><span class="line"><span class="keyword">var</span> <span class="attr">x</span>:A=&#123;<span class="attr">name</span>:<span class="string">&#x27;xx&#x27;</span>,<span class="attr">age</span>:<span class="number">20</span>&#125;</span><br></pre></td></tr></table></figure><blockquote><ol start="3"><li><strong>interface</strong> 可以继承interface，继承type，使用extends关键字，<strong>type</strong> 也可继承type，也可继承interface，使用&amp;</li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface A&#123;<span class="attr">name</span>:string&#125;</span><br><span class="line">interface B <span class="keyword">extends</span> A&#123;<span class="attr">age</span>:number&#125;</span><br><span class="line"> </span><br><span class="line">type C=&#123;<span class="attr">sex</span>:string&#125;</span><br><span class="line"> </span><br><span class="line">interface D <span class="keyword">extends</span> C&#123;<span class="attr">name</span>:string&#125;</span><br><span class="line"> </span><br><span class="line">type E=&#123;<span class="attr">name</span>:string&#125;&amp;C</span><br><span class="line"> </span><br><span class="line">type F =&#123;<span class="attr">age</span>:number&#125;&amp;A</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface class 也可以使用 &amp;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: A &amp; B</span><br></pre></td></tr></table></figure><blockquote><ol start="4"><li>还有类可以实现接口，也可以实现type</li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">interface A&#123;<span class="attr">name</span>:string;<span class="attr">add</span>:<span class="function">()=&gt;</span><span class="keyword">void</span>&#125;</span><br><span class="line">type B=&#123;<span class="attr">age</span>:number,<span class="attr">add</span>:<span class="function">()=&gt;</span><span class="keyword">void</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> implements A&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;xx&#x27;</span></span><br><span class="line">    <span class="title function_">add</span>(<span class="params"></span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;类实现接口&#x27;</span>)&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span> implements B&#123;</span><br><span class="line">    <span class="attr">age</span>:<span class="number">20</span></span><br><span class="line">    <span class="title function_">add</span>(<span class="params"></span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;类实现type&#x27;</span>)&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只要参数类型是匹配的，那么就认为它是有效的函数类型，而不在乎参数名是否正确</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myAdd</span>: <span class="function">(<span class="params">baseValue: number, increment: number</span>) =&gt;</span> number </span><br><span class="line">    myAdd = <span class="keyword">function</span>(<span class="params">x: number, y: number</span>): number &#123; <span class="keyword">return</span> x + y; &#125;; </span><br><span class="line"><span class="comment">// 推断类型 </span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myAdd</span>: <span class="function">(<span class="params">baseValue: number, increment: number</span>) =&gt;</span> number</span><br><span class="line">    myAdd = <span class="keyword">function</span>(<span class="params">x, y</span>) &#123; <span class="keyword">return</span> x + y; &#125;;</span><br></pre></td></tr></table></figure><h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><h4 id="泛型函数"><a href="#泛型函数" class="headerlink" title="泛型函数"></a>泛型函数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> identity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 &lt;&gt; 明确的指定 T 是 string 类型</span></span><br><span class="line"><span class="keyword">let</span> output = identity&lt;string&gt;(<span class="string">&quot;myString&quot;</span>);</span><br><span class="line"><span class="comment">// 利用了类型推论 -- 即编译器会根据传入的参数自动地帮助我们确定T的类型：</span></span><br><span class="line"><span class="keyword">let</span> output = <span class="title function_">identity</span>(<span class="string">&quot;myString&quot;</span>); </span><br></pre></td></tr></table></figure><p><strong>使用泛型函数时 你必须把这些参数当做是任意或所有类型</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> loggingIdentity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="property">length</span>);  <span class="comment">// Error: T doesn&#x27;t have .length</span></span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> loggingIdentity&lt;T&gt;(<span class="attr">arg</span>: <span class="title class_">Array</span>&lt;T&gt;): <span class="title class_">Array</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="property">length</span>);  <span class="comment">// Array has a .length, so no more error</span></span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 相比于操作any所有类型，我们想要限制函数去处理任意带有.length属性的所有类型。 只要传入的类型有这个属性，我们就允许，</span></span><br><span class="line"><span class="comment">// 就是说至少包含这一属性。 </span></span><br><span class="line"><span class="comment">// 为此，我们需要列出对于T的约束要求</span></span><br><span class="line"><span class="comment">// 也可以使用泛型约束 解决:</span></span><br></pre></td></tr></table></figure><h4 id="泛型约束0"><a href="#泛型约束0" class="headerlink" title="泛型约束0"></a>泛型约束0</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">Lengthwise</span> &#123;</span><br><span class="line">    <span class="attr">length</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> loggingIdentity&lt;T <span class="keyword">extends</span> <span class="title class_">Lengthwise</span>&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(arg.<span class="property">length</span>);  <span class="comment">// Now we know it has a .length property, so no more error</span></span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">loggingIdentity</span>(<span class="number">3</span>);  <span class="comment">// Error, number doesn&#x27;t have a .length property</span></span><br><span class="line"><span class="title function_">loggingIdentity</span>(<span class="string">&#x27;12312&#x27;</span>); <span class="comment">// no more error</span></span><br></pre></td></tr></table></figure><h4 id="泛型函数的类型"><a href="#泛型函数的类型" class="headerlink" title="泛型函数的类型"></a>泛型函数的类型</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> identity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myIdentity</span>: &lt;T&gt;<span class="function">(<span class="params">arg: T</span>) =&gt;</span> T = identity;</span><br></pre></td></tr></table></figure><blockquote><p>可以使用不同的泛型参数名，只要在数量上和使用方式上能对应上就可以。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> identity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myIdentity</span>: &lt;U&gt;<span class="function">(<span class="params">arg: U</span>) =&gt;</span> U = identity;</span><br></pre></td></tr></table></figure><blockquote><p>使用带有调用签名的对象字面量来定义泛型函数</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> identity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myIdentity</span>: &#123;&lt;T&gt;(<span class="attr">arg</span>: T): T&#125; = identity;</span><br></pre></td></tr></table></figure><h4 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">GenericIdentityFn</span> &#123;</span><br><span class="line">    &lt;T&gt;(<span class="attr">arg</span>: T): T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> identity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myIdentity</span>: <span class="title class_">GenericIdentityFn</span> = identity;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 把泛型参数当作整个接口的一个参数</span></span><br><span class="line">interface <span class="title class_">GenericIdentityFn</span>&lt;T&gt; &#123;</span><br><span class="line">    (<span class="attr">arg</span>: T): T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> identity&lt;T&gt;(<span class="attr">arg</span>: T): T &#123;</span><br><span class="line">    <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">myIdentity</span>: <span class="title class_">GenericIdentityFn</span>&lt;number&gt; = identity;</span><br></pre></td></tr></table></figure><h4 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GenericNumber</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">zeroValue</span>: T;</span><br><span class="line">    <span class="attr">add</span>: <span class="function">(<span class="params">x: T, y: T</span>) =&gt;</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myGenericNumber = <span class="keyword">new</span> <span class="title class_">GenericNumber</span>&lt;number&gt;();</span><br><span class="line">myGenericNumber.<span class="property">zeroValue</span> = <span class="number">0</span>;</span><br><span class="line">myGenericNumber.<span class="property">add</span> = <span class="keyword">function</span>(<span class="params">x, y</span>) &#123; <span class="keyword">return</span> x + y; &#125;;</span><br></pre></td></tr></table></figure><h3 id="全局声明declare"><a href="#全局声明declare" class="headerlink" title="全局声明declare"></a>全局声明declare</h3><blockquote><p>明文件放在项目里的<strong>任意路径&#x2F;文件名</strong>都可以被ts编译器识别, 但实际开发中, 声明变量使用关键字<strong>declare</strong>来表示声明其后面的全局变量的类型</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packages/global.d.ts</span></span><br><span class="line">declare <span class="keyword">var</span> <span class="attr">__DEV__</span>: boolean</span><br><span class="line">declare <span class="keyword">var</span> <span class="attr">__TEST__</span>: boolean</span><br><span class="line">declare <span class="keyword">var</span> <span class="attr">__BROWSER__</span>: boolean</span><br><span class="line">declare <span class="keyword">var</span> <span class="attr">__RUNTIME_COMPILE__</span>: boolean</span><br><span class="line">declare <span class="keyword">var</span> <span class="attr">__COMMIT__</span>: string</span><br><span class="line">declare <span class="keyword">var</span> <span class="attr">__VERSION__</span>: string</span><br></pre></td></tr></table></figure><h4 id="声明文件-d-ts"><a href="#声明文件-d-ts" class="headerlink" title="声明文件 .d.ts"></a>声明文件 .d.ts</h4><blockquote><p>为了规避一些奇怪的问题, <strong>推荐放在根目录下</strong></p><p>如果”@types&#x2F;“下找不到声明文件, 那么就需要我们自己手写了</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局声明应用</span></span><br><span class="line"><span class="comment">// @types/global.d.ts</span></span><br><span class="line">declare <span class="keyword">var</span> <span class="attr">n</span>: number;</span><br><span class="line">declare <span class="keyword">let</span> <span class="attr">s</span>: string;</span><br><span class="line">declare <span class="keyword">const</span> <span class="attr">o</span>: object;</span><br><span class="line">declare <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params">s: string</span>): number;</span><br><span class="line">declare enum dir &#123;</span><br><span class="line">    top,</span><br><span class="line">    right,</span><br><span class="line">    bottom,</span><br><span class="line">    left</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line">n = <span class="number">321</span></span><br><span class="line">s = <span class="string">&#x27;文字&#x27;</span></span><br><span class="line"><span class="keyword">let</span> o1 = o;</span><br><span class="line"><span class="title function_">f</span>(<span class="string">&#x27;123&#x27;</span>).<span class="title function_">toFixed</span>();</span><br><span class="line">dir.<span class="property">bottom</span>.<span class="title function_">toFixed</span>();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line">n = <span class="string">&#x27;312&#x27;</span></span><br><span class="line">s = <span class="number">123</span></span><br></pre></td></tr></table></figure><h4 id="declare-namespace"><a href="#declare-namespace" class="headerlink" title="declare namespace"></a><em><strong>declare namespace</strong></em></h4><blockquote><p><code>namespace </code>   代表后面的全局变量是一个对象</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @types/global.d.ts</span></span><br><span class="line">declare namespace <span class="title class_">MyPlugin</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="attr">n</span>:number;</span><br><span class="line">    <span class="keyword">var</span> <span class="attr">s</span>:string;</span><br><span class="line">    <span class="keyword">var</span> <span class="attr">f</span>:<span class="function">(<span class="params">s:string</span>)=&gt;</span>number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="title class_">MyPlugin</span>.<span class="property">s</span>.<span class="title function_">substr</span>(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line"><span class="title class_">MyPlugin</span>.<span class="property">n</span>.<span class="title function_">toFixed</span>();</span><br><span class="line"><span class="title class_">MyPlugin</span>.<span class="title function_">f</span>(<span class="string">&#x27;文字&#x27;</span>).<span class="title function_">toFixed</span>();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 报错</span></span><br><span class="line"><span class="title class_">MyPlugin</span>.<span class="property">s</span>.<span class="title function_">toFixed</span>();</span><br><span class="line"><span class="title class_">MyPlugin</span>.<span class="property">n</span>.<span class="title function_">substr</span>(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line"><span class="title class_">MyPlugin</span>.<span class="title function_">f</span>(<span class="number">123</span>);</span><br></pre></td></tr></table></figure><h4 id="修改已存在的全局声明"><a href="#修改已存在的全局声明" class="headerlink" title="修改已存在的全局声明"></a>修改已存在的全局声明</h4><blockquote><p>其实我们安装完t<strong>ypescript</strong>, 会自动给我们安装一些系统变量的声明文件, 存在<code>node_modules/typescript/lib</code>下.</p><p>如果你要修改<strong>已存在</strong>的全局变量的声明可以这么写, 下面用node下的<code>global</code>举例</p><p>全局扩展</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @types/global.d.ts</span></span><br><span class="line">declare <span class="variable language_">global</span> &#123; <span class="comment">// </span></span><br><span class="line">    interface <span class="title class_">String</span> &#123; <span class="comment">// 拓展新方法 </span></span><br><span class="line">        <span class="title function_">hump</span>(<span class="attr">input</span>: string): string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注意: 修改&quot;全局声明&quot;必须在模块内部, 所以至少要有 export&#123;&#125;字样, 即：当在 @types/global.d.ts 下不必 export, 其余的都要, 否则报错 </span></span><br><span class="line"><span class="comment">// 不然会报错❌: Augmentations for the global scope can only be directly nested in external modules or ambient module declarations</span></span><br><span class="line"><span class="comment">// 全局范围的扩大仅可直接嵌套在外部模块中或环境模块声明中</span></span><br><span class="line"><span class="keyword">export</span> &#123;&#125; <span class="comment">// </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hump</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>模块扩展 <em><strong>declare module</strong></em></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/module.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AClass</span> &#123;</span><br><span class="line">    public <span class="attr">a</span>:string;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">a:string</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">AClass</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./module&#x27;</span>;</span><br><span class="line"></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;./module&#x27;</span> &#123; <span class="comment">// 如果没有这个声明 后面的test都会报错</span></span><br><span class="line">   interface <span class="title class_">AClass</span> &#123; <span class="comment">// 拓展新方法</span></span><br><span class="line">    <span class="attr">test</span>: <span class="function">(<span class="params">b: number</span>) =&gt;</span> number;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">AClass</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">test</span> = (<span class="attr">b</span>: number): <span class="function"><span class="params">number</span> =&gt;</span> &#123; </span><br><span class="line">   <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="title class_">AClass</span> = &#123;<span class="attr">a</span>: <span class="string">&#x27;1&#x27;</span>, <span class="title function_">test</span>(<span class="attr">b</span>:number): number &#123; <span class="keyword">return</span>&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h3><blockquote><p>类型断言可以（转换）重写原有的类型</p><p>语法：&lt;类型&gt;值 或者 值 as 类型</p><p><strong>注意：</strong> 类型断言**不是 **类型转换，断言成一个联合类型中不存在的类型是不允许的</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.</span></span><br><span class="line">interface student &#123;</span><br><span class="line">  <span class="attr">color</span>: string; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createSquare</span>(<span class="params">config: student</span>): &#123; <span class="attr">color</span>: string &#125; &#123;</span><br><span class="line">    <span class="comment">// 使用断言</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(config)</span><br><span class="line">    <span class="keyword">return</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用断言</span></span><br><span class="line"><span class="keyword">let</span> mySquare = <span class="title function_">createSquare</span>(&#123; <span class="attr">color</span>: <span class="string">&quot;red&quot;</span>, <span class="attr">width</span>: <span class="number">100</span> &#125; <span class="keyword">as</span> student);</span><br><span class="line"><span class="comment">// let mySquare = createSquare(&lt;student&gt;&#123; color: &quot;red&quot;, width: 100 &#125;);</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params">num: number | string</span>) &#123;</span><br><span class="line">    (num <span class="keyword">as</span> string) = <span class="string">&#x27;123&#x27;</span> <span class="comment">// ok</span></span><br><span class="line">    (&lt;string&gt;num) = <span class="string">&#x27;123&#x27;</span> <span class="comment">// ok</span></span><br><span class="line">    (num <span class="keyword">as</span> []) <span class="comment">// 报错：断言成一个联合类型中不存在的类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="类型推论"><a href="#类型推论" class="headerlink" title="类型推论"></a>类型推论</h3><h4 id="默认类型推导"><a href="#默认类型推导" class="headerlink" title="默认类型推导"></a>默认类型推导</h4><blockquote><p>如果没有明确的指定类型，在TypeScript中会依照类型推论的规则推断出一个类型。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="literal">null</span>] <span class="comment">// 此时会将arr推断为 let arr: (number | null)[] </span></span><br><span class="line"><span class="keyword">let</span> seven = <span class="number">7</span>  <span class="comment">// 将seven推断为number</span></span><br><span class="line">seven = <span class="string">&#x27;a&#x27;</span> <span class="comment">// error 不能将类型“&quot;a&quot;”分配给类型“number”。</span></span><br></pre></td></tr></table></figure><blockquote><p>如果定义时没有被赋值，则会被推断为any类型而不用再受类型检查</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a;</span><br><span class="line">a = <span class="number">1</span>;</span><br><span class="line">a = <span class="string">&#x27;str&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="类型推论与内置类型结合"><a href="#类型推论与内置类型结合" class="headerlink" title="类型推论与内置类型结合"></a>类型推论与内置类型结合</h4><h5 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h5><blockquote><p>作用就是将泛型T中的所有属性都转化成可选属性</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">Partial</span>&lt;T&gt; = &#123;</span><br><span class="line">    [p <span class="keyword">in</span> keyof T]? : T[p]</span><br><span class="line">&#125;</span><br><span class="line">interface <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: string,</span><br><span class="line">    <span class="attr">age</span>: number</span><br><span class="line">&#125;</span><br><span class="line">type t = <span class="title class_">Partial</span>&lt;<span class="title class_">Person</span>&gt;; </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 类型推断出来的结果</span></span><br><span class="line"><span class="comment">     type t = &#123;</span></span><br><span class="line"><span class="comment">        name?: string;</span></span><br><span class="line"><span class="comment">        age?: number;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><blockquote><p>解析：</p><p>上面一行代码的作用就是首先通过 <strong><code>keyof</code> 获取 <code>T</code>中的所有属性，然后使用<code>in</code>遍历，并将值赋值给p</strong>，</p><p>后面的<code>?</code>就是将所有的属性都变成可选属性。最后通过<code>T[P]</code>取得相应的属性值。 </p><p>当我们将定义的接口通过Partial作用之后，将鼠标放置在t上，此时TypeScript就会将t中的数据类型以及结构推断出来。</p></blockquote><h5 id="Required"><a href="#Required" class="headerlink" title="Required"></a>Required</h5><blockquote><p>与Partial的作用恰好相反，它的主要作用就是将泛型T中的所有属性都转化为必选属性。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">Required</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]-?: T[P];</span><br><span class="line">&#125;;</span><br><span class="line">interface <span class="title class_">Person</span> &#123;</span><br><span class="line"> name?: string,</span><br><span class="line"> age?: number</span><br><span class="line">&#125;</span><br><span class="line">type t = <span class="title class_">Required</span>&lt;<span class="title class_">Person</span>&gt;; </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">类型推断出的结果</span></span><br><span class="line"><span class="comment"> * type t = &#123;</span></span><br><span class="line"><span class="comment">    name: string;</span></span><br><span class="line"><span class="comment">    age: number;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">const</span> <span class="attr">user</span>: t = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;jan&#x27;</span> <span class="comment">// 类型 &quot;&#123; name: string; &#125;&quot; 中缺少属性 &quot;age&quot;，但类型 &quot;Required&lt;Person&gt;&quot; 中需要该属性。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Readonly"><a href="#Readonly" class="headerlink" title="Readonly"></a>Readonly</h5><blockquote><p>作用: 将泛型T中的所有属性都转化为只读属性</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">Readonly</span>&lt;T&gt; = &#123;</span><br><span class="line"> readonly [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line">interface <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="attr">name</span>: string,</span><br><span class="line">age?: number</span><br><span class="line">&#125;</span><br><span class="line">type t = <span class="title class_">Readonly</span>&lt;<span class="title class_">Person</span>&gt;; </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">type t = &#123;</span></span><br><span class="line"><span class="comment">   readonly name: string;</span></span><br><span class="line"><span class="comment">   readonly age?: number;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">user</span>: t = &#123;</span><br><span class="line"> <span class="attr">name</span>: <span class="string">&#x27;jan&#x27;</span> </span><br><span class="line">&#125;</span><br><span class="line">user.<span class="property">name</span> = <span class="string">&#x27;jery&#x27;</span><span class="comment">// 无法分配到 &quot;name&quot; ，因为它是只读属性</span></span><br><span class="line">user.<span class="property">age</span> = <span class="number">1</span> <span class="comment">// 无法分配到 &quot;age&quot; ，因为它是只读属性</span></span><br></pre></td></tr></table></figure><blockquote><p>解析: </p><p>遍历T中的所有属性并将所有属性都变成readonly属性，从上面的age赋值例子我们也可以观察出只读属性的赋值是发生在初始化接口阶段而不是第一个给属性赋值阶段</p></blockquote><h5 id="ReturnType"><a href="#ReturnType" class="headerlink" title="ReturnType"></a>ReturnType</h5><blockquote><p>作用: 获取函数返回值类型。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Obtain the return type of a function type</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">type <span class="title class_">ReturnType</span>&lt;T <span class="keyword">extends</span> (...<span class="attr">args</span>: any) =&gt; any&gt; = T <span class="keyword">extends</span> (...<span class="attr">args</span>: any) =&gt; infer R ? R : any;</span><br><span class="line"></span><br><span class="line">type t = <span class="title class_">ReturnType</span>&lt;<span class="function">(<span class="params">name: string</span>) =&gt;</span> string | number&gt;</span><br><span class="line"><span class="comment">// ts推断出 type t = string | number</span></span><br></pre></td></tr></table></figure><h5 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h5><blockquote><p>作用: 允许从联合类型中创建一个新的类型，联合类型中的值作为新类型的属性。使用场景：接口类型声明。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">Record</span>&lt;K <span class="keyword">extends</span> keyof any, T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">DepartName</span> = <span class="string">&#x27;grade&#x27;</span> | <span class="string">&#x27;office&#x27;</span> | <span class="string">&#x27;class&#x27;</span> <span class="comment">// string | number | symbol 只能是这三种</span></span><br><span class="line">type <span class="title class_">DepartList</span> = <span class="title class_">Record</span>&lt;<span class="title class_">DepartName</span>, &#123;<span class="attr">id</span>: number&#125;&gt;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> type DepartList = &#123;</span></span><br><span class="line"><span class="comment">    grade: &#123;</span></span><br><span class="line"><span class="comment">        id: number;</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    office: &#123;</span></span><br><span class="line"><span class="comment">        id: number;</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    class: &#123;</span></span><br><span class="line"><span class="comment">        id: number;</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">cars</span>: <span class="title class_">DepartList</span> = &#123;</span><br><span class="line">  <span class="attr">grade</span>: &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">office</span>: &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">class</span>: &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><p><strong>“内部模块”现在称做“命名空间”</strong></p><p>为了与 <a href="http://www.ecma-international.org/ecma-262/6.0/">ECMAScript 2015</a>里的术语保持一致，(也就是说 <code>module X &#123;</code> 相当于现在推荐的写法 <code>namespace X &#123;</code>)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Validation.ts</span></span><br><span class="line">namespace <span class="title class_">Validation</span> &#123;</span><br><span class="line">  <span class="keyword">export</span> interface <span class="title class_">StringValidator</span> &#123;</span><br><span class="line">    <span class="title function_">isAcceptable</span>(<span class="attr">s</span>:string): boolean;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//LettersOnlyValidator.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;./Validation&quot; /&gt;</span></span><br><span class="line">namespace <span class="title class_">Validation</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> lettersRegexp = <span class="regexp">/^[A-Za-z]+$/</span>;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">LettersOnlyValidator</span> implements <span class="title class_">StringValidator</span> &#123;</span><br><span class="line">    <span class="title function_">isAcceptable</span>( <span class="attr">s</span>: string ) : boolean &#123;</span><br><span class="line">      <span class="keyword">return</span> lettersRegexp.<span class="title function_">test</span>(s);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ZipCodeValidator.ts</span></span><br><span class="line"><span class="comment">/// &lt;reference path=&quot;./Validation.ts&quot; /&gt;</span></span><br><span class="line">namespace <span class="title class_">Validation</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> numberRegexp = <span class="regexp">/^[0-9]+$/</span>;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ZipCodeValidatior</span> implements <span class="title class_">StringValidator</span> &#123;</span><br><span class="line">    <span class="title function_">isAcceptable</span>( <span class="attr">s</span>: string ) : boolean &#123;</span><br><span class="line">      <span class="keyword">return</span> s.<span class="property">length</span> === <span class="number">5</span> &amp;&amp; numberRegexp.<span class="title function_">test</span>(s)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Test.ts</span></span><br><span class="line"><span class="comment">///&lt;reference path=&quot;Validator.ts&quot; /&gt;</span></span><br><span class="line"><span class="comment">///&lt;reference path=&quot;LettersOnlyValidator.ts&quot; /&gt;</span></span><br><span class="line"><span class="comment">///&lt;reference path=&quot;ZipCodeValidator.ts&quot; /&gt;</span></span><br><span class="line"><span class="keyword">let</span> strings = [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;98502&quot;</span>, <span class="string">&quot;101&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="attr">validators</span>: &#123; [<span class="attr">s</span>: string ] : <span class="title class_">Validation</span>.<span class="property">StringValidator</span> &#125; = &#123;&#125;;</span><br><span class="line">validators[<span class="string">&quot;ZIP code&quot;</span>] = <span class="keyword">new</span> <span class="title class_">Validation</span>.<span class="title class_">ZipCodeValidator</span>();</span><br><span class="line">validators[<span class="string">&quot;Letters only&quot;</span>] = <span class="keyword">new</span> <span class="title class_">Validation</span>.<span class="title class_">LettersOnlyValidator</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> s <span class="keyword">of</span> strings ) &#123;</span><br><span class="line">  <span class="keyword">for</span>( <span class="keyword">let</span> name <span class="keyword">in</span> validators ) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span><span class="string">&quot; + s + &quot;</span><span class="string">&quot; &quot;</span> + (validators[name]).<span class="title function_">isAcceptable</span>(s) ? <span class="string">&quot;matches&quot;</span> : <span class="string">&quot; does not match &quot;</span> + name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Summery:</span></span><br><span class="line"><span class="comment">//在ts中引用带命名空间的文件，用三斜线指令引入要引用的文件。但貌似在实际开发过程中，我们还是用模块用得比较多。</span></span><br><span class="line"><span class="comment">//引用方式：</span></span><br><span class="line"><span class="comment">// 1.///&lt;reference path=&quot;ZipCodeValidator.ts&quot; /&gt;</span></span><br><span class="line"><span class="comment">// 2.import StringValidator = Validation.StringValidator</span></span><br></pre></td></tr></table></figure><h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><p><strong>“外部模块”现在则简称为“模块”</strong></p><h4 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 任何声明（比如变量，函数，类，类型别名或接口）都能够通过添加export关键字来导出</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">StringValidator</span> &#123;</span><br><span class="line">    <span class="title function_">isAcceptable</span>(<span class="attr">s</span>: string): boolean;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> numberRegexp = <span class="regexp">/^[0-9]+$/</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出的部分重命名</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">StringValidator</span> <span class="keyword">as</span> mainValidator &#125;;</span><br></pre></td></tr></table></figure><h4 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ZipCodeValidator</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./ZipCodeValidator&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myValidator = <span class="keyword">new</span> <span class="title class_">ZipCodeValidator</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入重命名</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ZipCodeValidator</span> <span class="keyword">as</span> <span class="variable constant_">ZCV</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./ZipCodeValidator&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> myValidator = <span class="keyword">new</span> <span class="title function_">ZCV</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将整个模块导入到一个变量</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> validator <span class="keyword">from</span> <span class="string">&quot;./ZipCodeValidator&quot;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> TypeScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uniApp开发注意</title>
      <link href="/hisai3.github.io/2023/01/14/uniapp%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
      <url>/hisai3.github.io/2023/01/14/uniapp%E6%B3%A8%E6%84%8F%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h3 id="运行到小程序开发工具"><a href="#运行到小程序开发工具" class="headerlink" title="运行到小程序开发工具"></a>运行到小程序开发工具</h3><ol><li>设置小程序开发工具</li></ol><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/uniapp-wx-anquan.png" alt="uniapp-wx-anquan.png"></p><ol start="2"><li>hbuder配置</li></ol><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/uniapp-run-peizhi.png" alt="uniapp-run-peizhi.png"></p><h3 id="运行到浏览器"><a href="#运行到浏览器" class="headerlink" title="运行到浏览器"></a>运行到浏览器</h3><ol><li>需要先点击（最外层的）项目文件夹, 再选择运行到浏览器</li><li>修改运行配置  添加浏览器安装路径</li></ol><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/liulanqi.png" alt="liulanqi.png"></p><h3 id="UI组件-（vant-weapp）"><a href="#UI组件-（vant-weapp）" class="headerlink" title="UI组件 （vant-weapp）"></a>UI组件 （vant-weapp）</h3><p><a href="https://github.com/youzan/vant-weapp">vant-weapp</a>  下载, 创建文件将<code>dist</code>包改为<code>vant</code></p><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/vant-weapp-mulu.png" alt="vant-weapp-mulu"></p><p>引入样式</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/vabt-weapp-css.png" alt="vabt-weapp-css.png"></p><p>全局引入</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/vant-peizhi.png" alt="vant-peizhi"></p><p>修改<code>page.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;globalStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uni-app&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;navigationBarBackgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#5c8cbc&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;usingComponents&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;van-action-sheet&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/action-sheet/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-area&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/area/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">//&quot;van-badge&quot;: &quot;/wxcomponents/vant/badge/index&quot;,</span></span><br><span class="line"><span class="comment">//&quot;van-badge-group&quot;: &quot;/wxcomponents/vant/badge-group/index&quot;,</span></span><br><span class="line"><span class="attr">&quot;van-button&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/button/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-card&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/card/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-cell&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/cell/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-cell-group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/cell-group/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-checkbox&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/checkbox/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-checkbox-group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/checkbox-group/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-col&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/col/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-dialog&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/dialog/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/field/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-goods-action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/goods-action/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-goods-action-icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/goods-action-icon/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-goods-action-button&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/goods-action-button/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/icon/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-loading&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/loading/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-nav-bar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/nav-bar/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-notice-bar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/notice-bar/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-notify&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/notify/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-panel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/panel/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-popup&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/popup/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-overlay&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/overlay/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-progress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/progress/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-radio&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/radio/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-radio-group&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/radio-group/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-row&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/row/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-slider&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/slider/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-stepper&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/stepper/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-steps&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/steps/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-submit-bar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/submit-bar/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-swipe-cell&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/swipe-cell/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-switch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/switch/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">//&quot;van-switch-cell&quot;: &quot;/wxcomponents/vant/switch-cell/index&quot;,</span></span><br><span class="line"><span class="attr">&quot;van-tab&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/tab/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-tabs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/tabs/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-tabbar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/tabbar/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-tabbar-item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/tabbar-item/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/tag/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-toast&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/toast/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-transition&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/transition/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-tree-select&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/tree-select/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-datetime-picker&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/datetime-picker/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-rate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/rate/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-collapse&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/collapse/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-collapse-item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/collapse-item/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;van-picker&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/wxcomponents/vant/picker/index&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>页面直接使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span>&gt;</span>vant<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="vant-运行到h5报错"><a href="#vant-运行到h5报错" class="headerlink" title="vant 运行到h5报错"></a>vant 运行到h5报错</h3><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/vant-error.png" alt="vant-error.png"></p><p>解决</p><p>格式化 vant icon组件下的index.wxss</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/icon-wxss.png" alt="icon-wxss.png"></p><h3 id="van-uploader"><a href="#van-uploader" class="headerlink" title="van-uploader"></a><code>van-uploader</code></h3><p><code>accept :  media</code> 同时上传照片和视频(可拍摄) h5不兼容 （底层实现的是chooseMedia）</p><p>重写  <code>cus-upload-media</code> 只针对照片和视频</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;burst-wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">v-if</span>=<span class="string">&quot;filesList.length&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(file,index) in filesList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span> <span class="attr">class</span>=<span class="string">&quot;uni-uploader__file&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;file-item&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">video</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-if</span>=<span class="string">&quot;file.type === &#x27;video&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:src</span>=<span class="string">&quot;file.url&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:poster</span>=<span class="string">&quot;file.thumbTempFilePath&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;full-box&quot;</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-else-if</span>=<span class="string">&quot;file.type === &#x27;image&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:src</span>=<span class="string">&quot;file.url&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:data-src</span>=<span class="string">&quot;file.tempFilePath&quot;</span></span></span><br><span class="line"><span class="tag">              @<span class="attr">tap</span>=<span class="string">&quot;previewImage(file.url)&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;full-box&quot;</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">text</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-if</span>=<span class="string">&quot;showDelIcon&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;icon-close uni-icons uniui-closeempty&quot;</span></span></span><br><span class="line"><span class="tag">              @<span class="attr">click</span>=<span class="string">&quot;delFile(index)&quot;</span></span></span><br><span class="line"><span class="tag">          /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-if</span>=<span class="string">&quot;!disabled &amp;&amp; filesList.length &lt; limit&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;uni-uploader__input-box&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;fix-width&#x27;: isFixWidth &#125;&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">tap</span>=<span class="string">&quot;startUpload&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;upload-btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">type</span>=<span class="string">&quot;plusempty&quot;</span> <span class="attr">size</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>添加图片/视频<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">value</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> []</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">disabled</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">delIcon</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">accept</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="string">&#x27;media&#x27;</span>  <span class="comment">// image media video</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">camera</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="string">&#x27;back&#x27;</span> <span class="comment">// 前后置摄像头 &#x27;front&#x27;、&#x27;back&#x27;，默认&#x27;back&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">compressed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">true</span> <span class="comment">// 视频选择 是否压缩所选的视频源文件，默认值为 true，需要压缩</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">limit</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: [<span class="title class_">String</span>, <span class="title class_">Number</span>],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="number">6</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">maxDuration</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="number">30</span> <span class="comment">// 拍摄视频最长拍摄时间，单位秒。时间范围为 3s 至 30s 之间</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">mediaType</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> [<span class="string">&#x27;image&#x27;</span>, <span class="string">&#x27;video&#x27;</span>] <span class="comment">// 文件类型</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">sourceType</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> [<span class="string">&#x27;album&#x27;</span>, <span class="string">&#x27;camera&#x27;</span>] <span class="comment">// 图片和视频选择的来源</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">sizeType</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> [<span class="string">&#x27;original&#x27;</span>, <span class="string">&#x27;compressed&#x27;</span>] <span class="comment">// 仅对 mediaType 为 image 时有效 是否压缩所选文件</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">complete</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Function</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">filesList</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      get () &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> [...<span class="variable language_">this</span>.<span class="property">value</span>]</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      set (v) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;input&#x27;</span>, v)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">isFixWidth</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> !!<span class="variable language_">this</span>.<span class="property">filesList</span>.<span class="property">length</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">showDelIcon</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">disabled</span>) <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">delIcon</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">delFile</span>(<span class="params">i</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> file = <span class="variable language_">this</span>.<span class="property">filesList</span>.<span class="title function_">splice</span>(i, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;delete&#x27;</span>, file[<span class="number">0</span>])</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">filesList</span> = [...<span class="variable language_">this</span>.<span class="property">filesList</span>]</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> startUpload () &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">disabled</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> [err, res] = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">chooseFile</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res--&gt;&gt;&gt;&gt;&#x27;</span>, res, err)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (res) &#123;</span></span><br><span class="line"><span class="language-javascript">        res.<span class="property">tempFiles</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          item.<span class="property">url</span> = item.<span class="property">tempFilePath</span></span></span><br><span class="line"><span class="language-javascript">          item.<span class="property">type</span> = item.<span class="property">fileType</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">filesList</span>.<span class="title function_">push</span>(...res.<span class="property">tempFiles</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;select&#x27;</span>, res)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// this.filesList = [...this.filesList]</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">chooseFile</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; accept &#125; = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>( <span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">switch</span> (accept) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">case</span> <span class="string">&#x27;image&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">chooseImg</span>(resolve)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">case</span> <span class="string">&#x27;media&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">chooseMedia</span>(resolve)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">case</span> <span class="string">&#x27;video&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">chooseVideo</span>(resolve)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">default</span>:</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;没有找到对应文件类型：&#x27;</span> + accept)</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">resolve</span>([&#123; <span class="attr">errMsg</span>: <span class="string">&#x27;没有找到对应文件类型：&#x27;</span> + accept &#125;, <span class="literal">null</span>])</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    chooseMedia (resolve) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// #ifdef H5</span></span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">showActionSheet</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">title</span>:<span class="string">&quot;选择上传类型&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">itemList</span>: [<span class="string">&#x27;图片&#x27;</span>,<span class="string">&#x27;视频&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span>(res.<span class="property">tapIndex</span> === <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">chooseImg</span>(resolve)</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">chooseVideo</span>(resolve)</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// #endif</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// #ifdef MP-WEIXIN</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; sourceType, limit, sizeType, mediaType, maxDuration, camera, complete &#125; = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">chooseMedia</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">count</span>: limit * <span class="number">1</span> - <span class="variable language_">this</span>.<span class="property">filesList</span>.<span class="property">length</span>,</span></span><br><span class="line"><span class="language-javascript">        mediaType,</span></span><br><span class="line"><span class="language-javascript">        sourceType,</span></span><br><span class="line"><span class="language-javascript">        sizeType,</span></span><br><span class="line"><span class="language-javascript">        maxDuration,</span></span><br><span class="line"><span class="language-javascript">        camera,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="title function_">resolve</span>([<span class="literal">null</span>, res])</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="title function_">resolve</span>([err, <span class="literal">null</span>]),</span></span><br><span class="line"><span class="language-javascript">        complete</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// #endif</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    chooseImg (resolve) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; sourceType, limit, sizeType, complete &#125; = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">chooseImage</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">count</span>: limit * <span class="number">1</span> - <span class="variable language_">this</span>.<span class="property">filesList</span>.<span class="property">length</span>,</span></span><br><span class="line"><span class="language-javascript">        sourceType,</span></span><br><span class="line"><span class="language-javascript">        sizeType,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> data = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">errMsg</span>: res.<span class="property">errMsg</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">tempFiles</span>: res.<span class="property">tempFiles</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">size</span>: item.<span class="property">size</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">tempFilePath</span>: item.<span class="property">path</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">fileType</span>: <span class="string">&#x27;image&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;))</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">resolve</span>([<span class="literal">null</span>, data])</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="title function_">resolve</span>([err, <span class="literal">null</span>]),</span></span><br><span class="line"><span class="language-javascript">        complete</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    chooseVideo (resolve) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> &#123; sourceType, compressed, maxDuration, camera, complete &#125; = <span class="variable language_">this</span></span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">chooseVideo</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        sourceType,</span></span><br><span class="line"><span class="language-javascript">        compressed,</span></span><br><span class="line"><span class="language-javascript">        maxDuration,</span></span><br><span class="line"><span class="language-javascript">        camera,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">const</span> &#123; errMsg, tempFile, ...rest &#125; = res</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> data = &#123;</span></span><br><span class="line"><span class="language-javascript">            errMsg,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">tempFiles</span>: [&#123; ...rest, <span class="attr">tempFilePath</span>: res.<span class="property">tempFilePath</span>, <span class="attr">fileType</span>: <span class="string">&#x27;video&#x27;</span> &#125;]</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// #ifdef H5</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (tempFile.<span class="property">type</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;video&#x27;</span>) === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">resolve</span>([<span class="literal">null</span>, data])</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">resolve</span>([&#123; <span class="attr">errMsg</span>: <span class="string">&#x27;选择文件格式不对：&#x27;</span> + tempFile.<span class="property">type</span> &#125;, <span class="literal">null</span>])</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// #endif</span></span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">resolve</span>([<span class="literal">null</span>, data])</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">fail</span>: <span class="function"><span class="params">err</span> =&gt;</span> <span class="title function_">resolve</span>([err, <span class="literal">null</span>]),</span></span><br><span class="line"><span class="language-javascript">        complete</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">previewImage</span>(<span class="params">src</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//预览图片</span></span></span><br><span class="line"><span class="language-javascript">      uni.<span class="title function_">previewImage</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">current</span>: src,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">urls</span>: [src]</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.burst-wrap</span>&#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20</span>upx;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">flex-wrap</span>: wrap;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: -<span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.uni-uploader__file</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-top</span>: <span class="number">33.33%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">33.33%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.icon-close</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">24</span>upx;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">26</span>upx;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#313336</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">border-radius</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">60%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">24</span>upx;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">    &amp;<span class="selector-class">.uniui-closeempty</span><span class="selector-pseudo">:before</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: <span class="number">3px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: -<span class="number">3px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">content</span>: <span class="string">&quot;x&quot;</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.full-box</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.file-item</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">10</span>upx);</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">10</span>upx);</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.uni-uploader__input-box</span> &#123;</span></span><br><span class="line"><span class="language-css">    //<span class="attribute">margin</span>: <span class="number">0</span> <span class="number">20</span>upx;</span></span><br><span class="line"><span class="language-css">    //<span class="attribute">padding-top</span>: <span class="number">45</span>upx;</span></span><br><span class="line"><span class="language-css">    //<span class="attribute">height</span>: <span class="number">200</span>upx;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">padding-top</span>: <span class="number">33.33%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: <span class="number">#f0f0f0</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="number">#969696</span>;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">font-size</span>: <span class="number">28</span>upx;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    /deep/ <span class="selector-class">.uni-icons</span><span class="selector-class">.uniui-plusempty</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#969696</span> <span class="meta">!important</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    &amp;<span class="selector-class">.fix-width</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">33.33%</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.upload-btn</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">10</span>upx);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cusUpload</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-model</span>=<span class="string">&quot;process.fileList&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">limit</span>=<span class="string">&quot;9&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:disabled</span>=<span class="string">&quot;status == &#x27;read&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:del-icon</span>=<span class="string">&quot;showDelIcon(rootIndex)&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">delete</span>=<span class="string">&quot;mediaDelete&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">select</span>=<span class="string">&quot;afterRead&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="关于登录持久化"><a href="#关于登录持久化" class="headerlink" title="关于登录持久化"></a>关于登录持久化</h3><ol><li>App.vue中的 <code>globalData</code>  在h5中和vuex一样当页面刷新就会重置</li><li>基于第一点  将信息同时存到本地 (或者添加路由拦截跟vue项目一样处理：没有就重新获取）</li></ol><p><strong>h5无法获取完整的响应头</strong></p><p><img src="https://gitee.com/hisai/image-bed/raw/master/uniapp/token.png" alt="token.png"></p><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>在<strong>h5</strong>中 页面刷新后 <code>navigateBack</code> 失效 处理 (自定义头部导航)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> canNavBack = <span class="title function_">getCurrentPages</span>()</span><br><span class="line"><span class="keyword">if</span>( canNavBack &amp;&amp; canNavBack.<span class="property">length</span>&gt;<span class="number">1</span>) &#123;</span><br><span class="line">  uni.<span class="title function_">navigateBack</span>()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  history &amp;&amp; history.<span class="title function_">back</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>路由拦截</strong> 针对vue-cli创建的uni项目 (使用插件)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uniapp&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;main.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uni-read-pages&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.0.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uni-simple-router&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.0.2&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="easycom组件规范（免注册，直接使用）"><a href="#easycom组件规范（免注册，直接使用）" class="headerlink" title="easycom组件规范（免注册，直接使用）"></a>easycom组件规范（免注册，直接使用）</h3><ol><li>只要组件安装在项目的components目录下或<code>uni_modules</code>目录下，并符合<code>components/组件名称/组件名称.vue</code>目录结构。就可以不用引用、注册，直接在页面中使用。</li><li><code>easycom</code>是自动开启的，不需要手动开启。</li></ol><h3 id="文件别名"><a href="#文件别名" class="headerlink" title="文件别名"></a>文件别名</h3><p>无需配置 <code>@</code> 默认是从根目录开始</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import common from &#x27;@/components/tabbar.js&#x27;;</span><br></pre></td></tr></table></figure><h3 id="修改第三方组件的样式"><a href="#修改第三方组件的样式" class="headerlink" title="修改第三方组件的样式"></a>修改第三方组件的样式</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uni-icons</span> <span class="attr">class</span>=<span class="string">&quot;contact&quot;</span> <span class="attr">type</span>=<span class="string">&quot;contact&quot;</span> <span class="attr">size</span>=<span class="string">&quot;30&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-icons</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意<strong>H5和小程序</strong>编译的结果是不一样的</p><p><code>uni-cions</code>的源码是这样的：(只有一个text标签)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">:style</span>=<span class="string">&quot;&#123; color: color, &#x27;font-size&#x27;: iconSize &#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;uni-icons&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;_onClick&quot;</span>&gt;</span>&#123;&#123;unicode&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br></pre></td></tr></table></figure><p>h5编译结果： (自定义类名和源码的类名是再同一级的元素中)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uni-text</span> <span class="attr">data-v-a2e81f6e</span>=<span class="string">&quot;&quot;</span> <span class="attr">data-v-76f421a0</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;uni-icons contact uniui-contact&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: rgb(51, 51, 51); font-size: 30px;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-text</span>&gt;</span></span><br></pre></td></tr></table></figure><p>小程序编译结果：  (自定义类名是源码的类名的父级)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uni-iconsclass=&quot;contact&quot; style=&quot;color: rgb(51, 51, 51); font-size: 30px;&quot;&gt;<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;uni-icons uniui-contact&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">uni-text</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>在<code>uni.scss</code> 中全局修改  兼容h5和微信小程序</li></ol><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* #ifdef H5 */</span></span><br><span class="line"><span class="selector-class">.contact</span><span class="selector-class">.uni-icons</span><span class="selector-class">.uniui-contact</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lawngreen;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* #endif */</span></span><br><span class="line"><span class="comment">/* #ifdef MP-WEIXIN */</span></span><br><span class="line"><span class="selector-class">.contact</span> /deep/ <span class="selector-class">.uni-icons</span><span class="selector-class">.uniui-contact</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: lawngreen;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* #endif */</span></span><br></pre></td></tr></table></figure><ol start="2"><li>在page页面中跟vue一样使用 &#x2F;deep&#x2F; 即可</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.contact</span> &#123;</span></span><br><span class="line"><span class="language-css">  /deep/ <span class="selector-class">.uni-icons</span><span class="selector-class">.uniui-contact</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red ;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">background-color</span>: lawngreen;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>在<strong>自定义组件</strong>中使用的第三方组件样式修改</li></ol><ul><li><p>h5中更vue项目一样处理即可</p></li><li><p>微信小程序中只能在全局改</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// 在自定义组件中添加</span></span><br><span class="line">    <span class="attr">options</span>: &#123;</span><br><span class="line">      <span class="attr">styleIsolation</span>: <span class="string">&#x27;shared&#x27;</span>, <span class="comment">// 解除样式隔离</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p><h3 id="UPX-单位"><a href="#UPX-单位" class="headerlink" title="UPX 单位"></a>UPX 单位</h3><blockquote><p>uni-app 使用 upx 作为默认尺寸单位， upx 是相对于基准宽度的单位，可以根据屏幕宽度进行自适应。<br>uni-app 规定屏幕基准宽度750upx。</p><p>开发者可以通过设计稿基准宽度计算页面元素 upx 值，设计稿 1px 与框架样式 1upx 转换公式如下：<br>设计稿 1px &#x2F; 设计稿基准宽度 &#x3D; 框架样式 1upx &#x2F; 750upx</p></blockquote><p><strong>举例说明：</strong></p><p>若设计稿宽度为 640px，元素 A 在设计稿上的宽度为 100px，那么元素 A 在 uni-app 里面的宽度应该设为：750 * 100 &#x2F; 640，结果为：<strong>117upx</strong>。<br>若设计稿宽度为 375px，元素 B 在设计稿上的宽度为 200px，那么元素 B 在 uni-app 里面的宽度应该设为：750 * 200 &#x2F; 375，结果为：<strong>400upx</strong>。</p><h5 id="1-动态绑定的-style-不支持直接使用-upx。-h5可以-微信小程序不行-建议直接使用rpx"><a href="#1-动态绑定的-style-不支持直接使用-upx。-h5可以-微信小程序不行-建议直接使用rpx" class="headerlink" title="1.动态绑定的 style 不支持直接使用 upx。(h5可以, 微信小程序不行, 建议直接使用rpx)"></a>1.动态绑定的 style 不支持直接使用 upx。(h5可以, 微信小程序不行, 建议直接使用rpx)</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- - 静态upx赋值生效 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;test&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:200upx&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- - 动态绑定不生效 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;test&quot;</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;width:winWidth + &#x27;upx;&#x27;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="2-使用-uni-upx2px-Number-转换为-px-后再赋值。"><a href="#2-使用-uni-upx2px-Number-转换为-px-后再赋值。" class="headerlink" title="2.使用 uni.upx2px(Number) 转换为 px 后再赋值。"></a>2.使用 uni.upx2px(Number) 转换为 px 后再赋值。</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>  <span class="attr">:style</span>=<span class="string">&quot;&#123;width: h_Width&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">h_Width</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> uni.<span class="title function_">upx2px</span>(<span class="number">750</span> / <span class="number">2</span>) + <span class="string">&#x27;px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="官方推荐使用rpx替代upx"><a href="#官方推荐使用rpx替代upx" class="headerlink" title="官方推荐使用rpx替代upx"></a><strong>官方推荐使用rpx替代upx</strong></h3><p>在设置文件mainfest.json里开启px转rpx（默认关闭），所有的px可一键转换为rpx</p><ul><li>注意 rpx 是和宽度相关的单位，屏幕越宽，该值实际像素越大。如不想根据屏幕宽度缩放，则应该使用 px 单位。</li><li>如果开发者在字体或高度中也使用了 rpx ，那么需注意这样的写法意味着随着屏幕变宽，字体会变大、高度会变大。如果你需要固定高度，则应该使用 px 。</li><li>rpx<strong>不支持</strong>动态横竖屏切换计算，使用rpx建议锁定屏幕方向</li></ul><h3 id="IOS-safe-area-inset"><a href="#IOS-safe-area-inset" class="headerlink" title="IOS  safe-area-inset-*"></a>IOS  safe-area-inset-*</h3><p><a href="https://blog.csdn.net/sd19871122/article/details/80989704">参考1</a><br><a href="https://developers.weixin.qq.com/community/develop/article/doc/000604d707c5b023a049ba7125b413">参考2</a><br><a href="https://webkit.org/blog/7929/designing-websites-for-iphone-x/?hmsr=funteas.com&utm_medium=funteas.com&utm_source=funteas.com">苹果官方文档</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">padding-bottom</span>: <span class="number">0</span>;</span><br><span class="line"><span class="attribute">padding-bottom</span>: <span class="built_in">constant</span>(safe-area-inset-bottom) / <span class="number">2</span>;  <span class="comment">/* 兼容 iOS &lt; 11.2 */</span></span><br><span class="line"><span class="attribute">padding-bottom</span>: <span class="built_in">env</span>(safe-area-inset-bottom) / <span class="number">2</span>;  <span class="comment">/* 兼容 iOS &gt;= 11.2 */</span></span><br></pre></td></tr></table></figure><h3 id="input-层级很高-z-index也无法调整-需要使用cover-view"><a href="#input-层级很高-z-index也无法调整-需要使用cover-view" class="headerlink" title="input (层级很高  z-index也无法调整,需要使用cover-view)"></a>input (层级很高  z-index也无法调整,需要使用<a href="https://uniapp.dcloud.net.cn/component/cover-view.html#cover-view">cover-view</a>)</h3><ol><li><strong>聚焦问题</strong><br>聚焦： <strong>focus</strong>:   boolean<br>光标位置： <strong>cursor</strong>:   number</li></ol><ul><li>对<code>type</code>为<code>number、digit</code> 无效 <ul><li>想要光标回到最后 (使用v-if重新渲染<code>且</code>input宽度不能为<strong>0</strong>) 场景：验证码 [0][0][0][0][0][0]</li></ul></li></ul><p>例子： 点击其他地方聚焦输入框且光标在最后(类似：label for)</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-if</span>=<span class="string">&quot;show&quot;</span> <span class="attr">:focus</span>=<span class="string">&quot;isfocus&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;code&quot;</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;6&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 隐藏软键盘 (ios bug：isfocus为true后不会弹出键盘)</span></span><br><span class="line"><span class="keyword">if</span> (uni.<span class="title function_">getSystemInfoSync</span>().<span class="property">platform</span> === <span class="string">&#x27;ios&#x27;</span>) &#123;</span><br><span class="line">    uni.<span class="title function_">hideKeyboard</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 先失焦 再聚焦 否则只有第一次能聚焦 聚焦后默认在第一位</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">isfocus</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">show</span> = <span class="literal">false</span></span><br><span class="line"><span class="keyword">await</span> <span class="variable language_">this</span>.$nextTick()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">show</span> = <span class="literal">true</span></span><br><span class="line"><span class="keyword">await</span> <span class="variable language_">this</span>.$nextTick()</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">isfocus</span> = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>键盘显示页面向上顶</strong><br>input 必须是显示的 不能visibility：hidden、 display: none、 opacity: 0</li></ol><h3 id="开发环境和生产环境"><a href="#开发环境和生产环境" class="headerlink" title="开发环境和生产环境"></a>开发环境和生产环境</h3><p><a href="https://uniapp.dcloud.net.cn/worktile/running-env.html#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%92%8C%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83">运行环境管理</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;development&#x27;</span>) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;开发环境&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;生产环境&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> uniApp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> uniApp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树</title>
      <link href="/hisai3.github.io/2023/01/14/%E6%A0%91/"/>
      <url>/hisai3.github.io/2023/01/14/%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<p>JS常用工具</p><h1 id="树"><a href="#树" class="headerlink" title="树"></a>树</h1><h2 id="数组扁平化"><a href="#数组扁平化" class="headerlink" title="数组扁平化"></a>数组扁平化</h2><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]], <span class="number">5</span>, [<span class="number">6</span>]];</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>1、递归</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">flatten</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> res = [];</span><br><span class="line">    arr.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(item)) &#123;</span><br><span class="line">            res = res.<span class="title function_">concat</span>(<span class="title function_">flatten</span>(item));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">push</span>(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2、reduce</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">flatten</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">result, item</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result.<span class="title function_">concat</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(item) ? <span class="title function_">flatten</span>(item) : item);</span><br><span class="line">    &#125;, []);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3、flat</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">flatten</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">flat</span>(<span class="title class_">Infinity</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">flatten</span>(arr);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="将树转成list-以叶子节点为主的list"><a href="#将树转成list-以叶子节点为主的list" class="headerlink" title="将树转成list (以叶子节点为主的list)"></a>将树转成list (以叶子节点为主的list)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseTreeToRow</span>(<span class="params">node, data = [], row = []</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!node.<span class="property">children</span>) &#123;</span><br><span class="line">   data.<span class="title function_">push</span>(row);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">children</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> child = node.<span class="property">children</span>[i];</span><br><span class="line">      <span class="keyword">const</span> cell = &#123; <span class="attr">value</span>: child.<span class="property">name</span> &#125;;</span><br><span class="line">      <span class="title function_">parseTreeToRow</span>(child, data, [...row, cell]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="运行结果-1"><a href="#运行结果-1" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="title function_">parseTreeToRow</span>(&#123;<span class="attr">children</span>: tree&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;data--&gt;&gt;&#x27;</span>, data);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">  [ &#123; <span class="attr">value</span>: <span class="string">&#x27;小明&#x27;</span> &#125;, &#123; <span class="attr">value</span>: <span class="string">&#x27;小花&#x27;</span> &#125;, &#123; <span class="attr">value</span>: <span class="string">&#x27;小华&#x27;</span> &#125; ],</span><br><span class="line">  [ &#123; <span class="attr">value</span>: <span class="string">&#x27;小明&#x27;</span> &#125;, &#123; <span class="attr">value</span>: <span class="string">&#x27;小花&#x27;</span> &#125;, &#123; <span class="attr">value</span>: <span class="string">&#x27;小李&#x27;</span> &#125; ],</span><br><span class="line">  [ &#123; <span class="attr">value</span>: <span class="string">&#x27;小明&#x27;</span> &#125;, &#123; <span class="attr">value</span>: <span class="string">&#x27;小红&#x27;</span> &#125; ],</span><br><span class="line">  [ &#123; <span class="attr">value</span>: <span class="string">&#x27;小王&#x27;</span> &#125;, &#123; <span class="attr">value</span>: <span class="string">&#x27;小林&#x27;</span> &#125; ],</span><br><span class="line">  [ &#123; <span class="attr">value</span>: <span class="string">&#x27;小王&#x27;</span> &#125;, &#123; <span class="attr">value</span>: <span class="string">&#x27;小李&#x27;</span> &#125; ]</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="数组转树形结构"><a href="#数组转树形结构" class="headerlink" title="数组转树形结构"></a>数组转树形结构</h2><h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小花&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小华&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">111</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">112</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小林&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">21</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">22</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h3><p>1、非递归</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> <span class="title function_">arrayToTree</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(arr) || arr.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> map = &#123;&#125;;</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> map[item.<span class="property">id</span>] = item);</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> parent = map[item.<span class="property">pid</span>];</span><br><span class="line">        <span class="keyword">if</span>(parent)&#123;</span><br><span class="line">            (parent.<span class="property">children</span> || (parent.<span class="property">children</span>=[])).<span class="title function_">push</span>(item);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result.<span class="title function_">push</span>(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>2、递归</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">arrayToTree</span> = (<span class="params">arr, pid</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> res = [];</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(item.<span class="property">pid</span> === pid)&#123;</span><br><span class="line">            <span class="keyword">let</span> itemChildren = <span class="title function_">arrayToTree</span>(arr,item.<span class="property">id</span>);</span><br><span class="line">            <span class="keyword">if</span>(itemChildren.<span class="property">length</span>) &#123;</span><br><span class="line">                item.<span class="property">children</span> = itemChildren;</span><br><span class="line">            &#125;</span><br><span class="line">            res.<span class="title function_">push</span>(item);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果-2"><a href="#运行结果-2" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const result = arrayToTree(arr);</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="title function_">arrayToTree</span>(arr, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小华&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小林&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="树形结构转数组（扁平化）"><a href="#树形结构转数组（扁平化）" class="headerlink" title="树形结构转数组（扁平化）"></a>树形结构转数组（扁平化）</h2><h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小花&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小华&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小林&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h3><h4 id="1、深度优先遍历"><a href="#1、深度优先遍历" class="headerlink" title="1、深度优先遍历"></a>1、深度优先遍历</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">treeToArray</span> = (<span class="params">tree</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> stack = tree,</span><br><span class="line">        result = [];</span><br><span class="line">    <span class="keyword">while</span>(stack.<span class="property">length</span> !== <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> pop = stack.<span class="title function_">pop</span>();</span><br><span class="line">        result.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">id</span>: pop.<span class="property">id</span>,</span><br><span class="line">            <span class="attr">name</span>: pop.<span class="property">name</span>,</span><br><span class="line">            <span class="attr">pid</span>: pop.<span class="property">pid</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">let</span> children = pop.<span class="property">children</span></span><br><span class="line">        <span class="keyword">if</span>(children)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> i = children.<span class="property">length</span>-<span class="number">1</span>; i &gt;=<span class="number">0</span>; i--)&#123;</span><br><span class="line">                stack.<span class="title function_">push</span>(children[i])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2、广度优先遍历"><a href="#2、广度优先遍历" class="headerlink" title="2、广度优先遍历"></a>2、广度优先遍历</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">treeToArray</span> = (<span class="params">tree</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> queue = tree,</span><br><span class="line">        result = [];</span><br><span class="line">    <span class="keyword">while</span>(queue.<span class="property">length</span> !== <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> shift = queue.<span class="title function_">shift</span>();</span><br><span class="line">        result.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">id</span>: shift.<span class="property">id</span>,</span><br><span class="line">            <span class="attr">name</span>: shift.<span class="property">name</span>,</span><br><span class="line">            <span class="attr">pid</span>: shift.<span class="property">pid</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">let</span> children = shift.<span class="property">children</span></span><br><span class="line">        <span class="keyword">if</span>(children)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; children.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                queue.<span class="title function_">push</span>(children[i])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3、不用考虑除children外的其他属性"><a href="#3、不用考虑除children外的其他属性" class="headerlink" title="3、不用考虑除children外的其他属性"></a>3、不用考虑除children外的其他属性</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">treeToArray</span> = (<span class="params">source</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">let</span> res = []</span><br><span class="line">    source.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">        res.<span class="title function_">push</span>(item)</span><br><span class="line">        item.<span class="property">children</span> &amp;&amp; res.<span class="title function_">push</span>(...<span class="title function_">treeToArray</span>(item.<span class="property">children</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">children</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> item.<span class="property">children</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果-3"><a href="#运行结果-3" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">treeToArray</span>(tree);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小华&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">111</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小林&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="树筛选，保留符合条件的数据并返回树结构"><a href="#树筛选，保留符合条件的数据并返回树结构" class="headerlink" title="树筛选，保留符合条件的数据并返回树结构"></a>树筛选，保留符合条件的数据并返回树结构</h2><h3 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小花&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小华&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                        <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小林&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法-3"><a href="#方法-3" class="headerlink" title="方法"></a>方法</h3><h4 id="1、递归"><a href="#1、递归" class="headerlink" title="1、递归"></a>1、递归</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">filterTreeByFunc</span> = (<span class="params">tree, func</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(tree) || tree.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tree.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        item.<span class="property">children</span> = item.<span class="property">children</span> &amp;&amp; <span class="title function_">filterTreeByFunc</span>(item.<span class="property">children</span>, func)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">func</span>(item) || (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">func</span> = (<span class="params">item</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> item.<span class="property">show</span> === <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2、深度优先遍历查找"><a href="#2、深度优先遍历查找" class="headerlink" title="2、深度优先遍历查找"></a>2、深度优先遍历查找</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 查找包含自身节点的父代节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tree 需要查找的树数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> curKey 当前节点key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keyField 自定义 key 字段</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node 找到的node 可以不传</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findCurNode</span>(<span class="params">tree, curKey, keyField, node = <span class="literal">null</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> stack = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> tree) &#123;</span><br><span class="line">    <span class="keyword">if</span> (item) &#123;</span><br><span class="line">      stack.<span class="title function_">push</span>(item)</span><br><span class="line">      <span class="keyword">while</span> (stack.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> temp = stack.<span class="title function_">pop</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (temp[keyField] === curKey) &#123;</span><br><span class="line">          node = temp</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> children = temp.<span class="property">children</span> || []</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = children.<span class="property">length</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            stack.<span class="title function_">push</span>(children[i])</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> node = <span class="title function_">findCurNode</span>(tree, <span class="number">10</span>, <span class="string">&#x27;id&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="运行结果-4"><a href="#运行结果-4" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">filterTreeByFunc</span>(tree, func);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;show&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;show&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                        <span class="string">&quot;show&quot;</span>: <span class="literal">true</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;show&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="查找某一节点在树中路径"><a href="#查找某一节点在树中路径" class="headerlink" title="查找某一节点在树中路径"></a>查找某一节点在树中路径</h2><h3 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小花&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小华&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小林&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法-4"><a href="#方法-4" class="headerlink" title="方法"></a>方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getNodePath</span> = (<span class="params">tree, id</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(tree) || tree.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> path = []</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">treeFindPath</span> = (<span class="params">tree, id, path</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> tree) &#123;</span><br><span class="line">            path.<span class="title function_">push</span>(item.<span class="property">id</span>);</span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">id</span> === id) &#123;</span><br><span class="line">                <span class="keyword">return</span> path</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">children</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> findChildren = <span class="title function_">treeFindPath</span>(item.<span class="property">children</span>,id, path);</span><br><span class="line">                <span class="keyword">if</span> (findChildren.<span class="property">length</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> findChildren;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            path.<span class="title function_">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">treeFindPath</span>(tree, id, path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果-5"><a href="#运行结果-5" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">getNodePath</span>(tree, <span class="number">112</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">11</span>, <span class="number">112</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="模糊查询树"><a href="#模糊查询树" class="headerlink" title="模糊查询树"></a>模糊查询树</h2><h3 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小明前端专家&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小花前端程序媛&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小华划水运动员&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小李摸鱼运动员&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小红摸鱼程序员&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小王内卷王&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小林摸鱼王&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小李后端程序员&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法-5"><a href="#方法-5" class="headerlink" title="方法"></a>方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fuzzyQueryTree</span> = (<span class="params">arr, value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(arr) || arr.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> result = [];</span><br><span class="line">    arr.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">name</span>.<span class="title function_">indexOf</span>(value) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> children = <span class="title function_">fuzzyQueryTree</span>(item.<span class="property">children</span>, value);</span><br><span class="line">            <span class="keyword">const</span> obj = &#123; ...item, children &#125;</span><br><span class="line">            result.<span class="title function_">push</span>(obj);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> children = <span class="title function_">fuzzyQueryTree</span>(item.<span class="property">children</span>, value);</span><br><span class="line">                <span class="keyword">const</span> obj = &#123; ...item, children &#125;</span><br><span class="line">                <span class="keyword">if</span> (children &amp;&amp; children.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    result.<span class="title function_">push</span>(obj);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果-6"><a href="#运行结果-6" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">fuzzyQueryTree</span>(tree,<span class="string">&#x27;程序&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明前端专家&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花前端程序媛&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: []</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红摸鱼程序员&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: []</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王内卷王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李后端程序员&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: []</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="树节点添加属性"><a href="#树节点添加属性" class="headerlink" title="树节点添加属性"></a>树节点添加属性</h2><h3 id="示例-6"><a href="#示例-6" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小花&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小华&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小林&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法-6"><a href="#方法-6" class="headerlink" title="方法"></a>方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">addAttrToNodes</span> = (<span class="params">tree</span>) =&gt; &#123;</span><br><span class="line">    tree.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        item.<span class="property">title</span> = <span class="string">&#x27;新生代农民工&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_">addAttrToNodes</span>(item.<span class="property">children</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果-7"><a href="#运行结果-7" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">addAttrToNodes</span>(tree);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小华&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;新生代农民工&quot;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;新生代农民工&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: <span class="string">&quot;新生代农民工&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: <span class="string">&quot;新生代农民工&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;新生代农民工&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小林&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: <span class="string">&quot;新生代农民工&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: <span class="string">&quot;新生代农民工&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;新生代农民工&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="树节点删除属性"><a href="#树节点删除属性" class="headerlink" title="树节点删除属性"></a>树节点删除属性</h2><h3 id="示例-7"><a href="#示例-7" class="headerlink" title="示例"></a>示例</h3><p>这里直接使用上面——<strong>树形结构节点添加属性</strong>的运行结果</p><h3 id="方法-7"><a href="#方法-7" class="headerlink" title="方法"></a>方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">removeAttrFromNode</span> = (<span class="params">tree</span>) =&gt; &#123;</span><br><span class="line">    tree.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">delete</span> item.<span class="property">title</span></span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_">removeAttrFromNode</span>(item.<span class="property">children</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果-8"><a href="#运行结果-8" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">removeAttrFromNode</span>(tree);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小华&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小林&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="删除树中的空children"><a href="#删除树中的空children" class="headerlink" title="删除树中的空children"></a>删除树中的空children</h2><h3 id="示例-8"><a href="#示例-8" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小花&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小华&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                        <span class="attr">children</span>: []</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">children</span>: []</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小林&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">                <span class="attr">children</span>: []</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法-8"><a href="#方法-8" class="headerlink" title="方法"></a>方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">removeEmptyChildren</span> = (<span class="params">tree</span>) =&gt; &#123;</span><br><span class="line">    tree.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span> ===<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> item.<span class="property">children</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_">removeEmptyChildren</span>(item.<span class="property">children</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果-9"><a href="#运行结果-9" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">removeEmptyChildren</span>(tree);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小华&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小林&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="获取树中所有的叶子节点"><a href="#获取树中所有的叶子节点" class="headerlink" title="获取树中所有的叶子节点"></a>获取树中所有的叶子节点</h2><h3 id="示例-9"><a href="#示例-9" class="headerlink" title="示例"></a>示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小明&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小花&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小华&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                        <span class="attr">id</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="attr">pid</span>: <span class="number">11</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小红&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">1</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;小王&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">pid</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小林&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>: <span class="string">&#x27;小李&#x27;</span>,</span><br><span class="line">                <span class="attr">id</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="attr">pid</span>: <span class="number">2</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="方法-9"><a href="#方法-9" class="headerlink" title="方法"></a>方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getAllLeaf</span> = (<span class="params">tree</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> result = []</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getLeaf</span> = (<span class="params">tree</span>) =&gt; &#123;</span><br><span class="line">        tree.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!item.<span class="property">children</span>) &#123;</span><br><span class="line">                result.<span class="title function_">push</span>(item)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">getLeaf</span>(item.<span class="property">children</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">getLeaf</span>(tree)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="运行结果-10"><a href="#运行结果-10" class="headerlink" title="运行结果"></a>运行结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">getAllLeaf</span>(tree);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小华&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">111</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小林&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="合并树-并去重"><a href="#合并树-并去重" class="headerlink" title="合并树 并去重"></a>合并树 并去重</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tree1 = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小华&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">111</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小林&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">21</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tree2 = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小明&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小花&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">11</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">children</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;id&quot;</span>: <span class="number">112</span>,</span><br><span class="line">                        <span class="string">&quot;pid&quot;</span>: <span class="number">11</span></span><br><span class="line">                    &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小红&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">12</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小王&quot;</span>,</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;pid&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;小李&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">22</span>,</span><br><span class="line">                <span class="string">&quot;pid&quot;</span>: <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeTree</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> record = &#123;&#125;</span><br><span class="line">    <span class="keyword">const</span> newArr = arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">pre, cur</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (record[cur.<span class="property">id</span>]) &#123;</span><br><span class="line">            <span class="keyword">const</span> child1 = record[cur.<span class="property">id</span>].<span class="property">children</span> || []</span><br><span class="line">            <span class="keyword">const</span> child2 = cur.<span class="property">children</span> || []</span><br><span class="line">            record[cur.<span class="property">id</span>].<span class="property">children</span> = <span class="title function_">mergeTree</span>([...child1, ...child2])</span><br><span class="line">            <span class="keyword">return</span> pre</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            record[cur.<span class="property">id</span>] = cur</span><br><span class="line">            <span class="keyword">return</span> [...pre, cur]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> newArr</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;newArr&#x27;</span>, newArr)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(&#x27;---&gt;&#x27;, uniArr([...tree1, ...tree2]))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mergeTreeList</span>(<span class="params">list</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newTree = list[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">while</span> (list.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> firstTree = list.<span class="title function_">shift</span>()</span><br><span class="line">        <span class="keyword">const</span> nextTree = list[<span class="number">0</span>] || []</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(firstTree, nextTree)</span><br><span class="line">        newTree = !nextTree.<span class="property">length</span> ? firstTree : <span class="title function_">mergeTree</span>([...firstTree, ...nextTree])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTree</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> treeList = [tree1, tree2]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;mergeTreeList--&gt;&#x27;</span>, <span class="title function_">mergeTreeList</span>(treeList));</span><br></pre></td></tr></table></figure><h3 id="树深度计算"><a href="#树深度计算" class="headerlink" title="树深度计算"></a>树深度计算</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getLevel</span> (treeData, key = <span class="string">&#x27;children&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> ans = &#123;&#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> treeData) &#123;</span><br><span class="line">        <span class="title function_">getDepth</span>(item)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">getDepth</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj[key]) &#123;</span><br><span class="line">          ans[obj.<span class="property">nodeId</span>] = <span class="number">0</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> obj[key]) &#123;</span><br><span class="line">            ans[obj.<span class="property">nodeId</span>] = <span class="title class_">Math</span>.<span class="title function_">max</span>(ans[obj.<span class="property">nodeId</span>], <span class="title function_">getDepth</span>(item) + <span class="number">1</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> ans[obj.<span class="property">nodeId</span>]</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ans[obj.<span class="property">nodeId</span>] = <span class="number">0</span></span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> level = <span class="number">0</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> ans) &#123;</span><br><span class="line">        level = <span class="title class_">Math</span>.<span class="title function_">max</span>(level, ans[key])</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> level</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS常用工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>环形进度svg</title>
      <link href="/hisai3.github.io/2023/01/14/%E7%8E%AF%E5%BD%A2%E8%BF%9B%E5%BA%A6svg/"/>
      <url>/hisai3.github.io/2023/01/14/%E7%8E%AF%E5%BD%A2%E8%BF%9B%E5%BA%A6svg/</url>
      
        <content type="html"><![CDATA[<h1 id="环形进度条-svg"><a href="#环形进度条-svg" class="headerlink" title="环形进度条 svg"></a>环形进度条 svg</h1><h2 id="我们需要什么"><a href="#我们需要什么" class="headerlink" title="我们需要什么?"></a>我们需要什么?</h2><ol><li>一个环形进度条</li><li>渐变色</li><li>动画</li></ol><p>细节点<br> <strong>环形精度条的首尾都是圆形</strong></p><p><strong>我们先来实现环形进度条。</strong><br> 实现思路很简单<br> 使用svg画两个圆<br> 一个圆作为底色，画满<br> 另一个圆作为进度条，此时应该只画一段弧形</p><h2 id="怎么画圆"><a href="#怎么画圆" class="headerlink" title="怎么画圆"></a>怎么画圆</h2><p>参考svg的文档我们可以知道得出以下代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">:height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">:width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">x-mlns</span>=<span class="string">&quot;http://www.w3.org/200/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:r</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cx</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cy</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke</span>=<span class="string">&quot;&#x27;red&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke-width</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果如图</p><p><img src="https://upload-images.jianshu.io/upload_images/2444724-fc6380e7fea2855b?imageMogr2/auto-orient/strip%7CimageView2/2/w/400/format/webp" alt="img"></p><p>image</p><p>我们得到了一个红色的圆环<br> 其中<br> r为半径<br> cx,cy为在svg中的坐标<br> stroke为颜色<br> stroke-width为画笔的宽度<br> fill为none表示不进行填充，不然我们看到的将是一整个圆而不是圆环</p><p>接下来我们需要画一段圆弧<br> 画圆弧我们可以通过<strong>stoke-dasharray</strong>,他的本意是画实线跟虚线交替的线段，我们设置参数为 ‘弧长,极大值’<br> 那么在显示上因为虚线空的部分很长，所以我们将看不到第二段的实线<br> 对于我们需要的<strong>圆的头部</strong> 可以设置<strong>stroke-linecap</strong>为round<br> 最终效果如图</p><p><img src="https://upload-images.jianshu.io/upload_images/2444724-c1d033c325908699?imageMogr2/auto-orient/strip%7CimageView2/2/w/266/format/webp" alt="img"></p><p>image</p><p>代码如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:r</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cx</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cy</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke</span>=<span class="string">&quot;&#x27;red&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke-width</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span> </span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:r</span>=<span class="string">&quot;50&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cx</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cy</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke</span>=<span class="string">&quot;&#x27;yellow&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke-dasharray</span>=<span class="string">&quot;`100,100000`&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke-width</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时我们观测到起始方向是在左边的中间位置,因此我们进行旋转，在第二个圆上加上旋转</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform=<span class="string">&quot;rotate(-90)&quot;</span></span><br><span class="line">transform-origin=<span class="string">&quot;center&quot;</span></span><br></pre></td></tr></table></figure><p>因为我们需要封装成一个组件，那么他应该接收</p><ol><li>进度</li><li>底色</li><li>弧度的颜色</li><li>内圆的半径</li><li>圆弧的宽度<br> 同时对于</li><li>svg的宽高</li><li>外圆的半径</li><li>弧长</li></ol><p>这些应该是我们进行计算得出来的值<br> 当然为了使用上的方便 我们应该给出一些默认值<br> 组件代码如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:height</span>=<span class="string">&quot;option.size&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:width</span>=<span class="string">&quot;option.size&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">x-mlns</span>=<span class="string">&quot;http://www.w3.org/200/svg&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke</span>=<span class="string">&quot;option.backColor&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke</span>=<span class="string">&quot;option.progressColor&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke-dasharray</span>=<span class="string">&quot;arcLength&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">transform</span>=<span class="string">&quot;rotate(-90)&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">transform-origin</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;Progress&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">progress</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">required</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">progressOption</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  data () &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    arcLength () &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> circleLength = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">radius</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> progressLength = <span class="variable language_">this</span>.<span class="property">progress</span> * circleLength</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;progressLength&#125;</span>,100000000`</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    option () &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 所有进度条的可配置项</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> baseOption = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">radius</span>: <span class="number">100</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">strokeWidth</span>: <span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">backColor</span>: <span class="string">&#x27;red&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">progressColor</span>: <span class="string">&#x27;yellow&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(baseOption, <span class="variable language_">this</span>.<span class="property">progressOption</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 中心位置自动生成</span></span></span><br><span class="line"><span class="language-javascript">      baseOption.<span class="property">cy</span> = baseOption.<span class="property">cx</span> = baseOption.<span class="property">radius</span> + baseOption.<span class="property">strokeWidth</span></span></span><br><span class="line"><span class="language-javascript">      baseOption.<span class="property">size</span> = (baseOption.<span class="property">radius</span> + baseOption.<span class="property">strokeWidth</span>) * <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> baseOption</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其实现在修改一下这让人吐槽的配色已经可以用来使用了~</p><h2 id="接下来我们来实现渐变色"><a href="#接下来我们来实现渐变色" class="headerlink" title="接下来我们来实现渐变色"></a>接下来我们来实现渐变色</h2><p>第一个思路当然是去搜索svg怎么实现渐变色了，我一开始也是进行了搜索，最终写出来了如下的代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linearGradient</span> <span class="attr">id</span>=<span class="string">&quot;gradient&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">stop</span></span></span><br><span class="line"><span class="tag">        <span class="attr">offset</span>=<span class="string">&quot;0%&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;stop-color: red;&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">stop</span></span></span><br><span class="line"><span class="tag">        <span class="attr">offset</span>=<span class="string">&quot;100%&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;stop-color: yellow&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">linearGradient</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke</span>=<span class="string">&quot;option.backColor&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke</span>=<span class="string">&quot;&#x27;url(#gradient)&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke-dasharray</span>=<span class="string">&quot;arcLength&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">transform</span>=<span class="string">&quot;rotate(-90)&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">transform-origin</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果如图</p><p><img src="https://upload-images.jianshu.io/upload_images/2444724-22d9a4742ff3e118?imageMogr2/auto-orient/strip%7CimageView2/2/w/516/format/webp" alt="img"></p><p>image</p><p>为什么跟我们期望的效果不一样?<br> 我们期望的是从最上方顺时针方向开始画圆弧,顶部颜色是红色,而到了结尾的时候是黄色的，为什么会这样呢?<br> 因为其实我们的观点是错的。假如我们不做其他的处理，单纯的给一个圆加上渐变是什么样子的呢?</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">linearGradient</span> <span class="attr">id</span>=<span class="string">&quot;gradient&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">stop</span></span></span><br><span class="line"><span class="tag">        <span class="attr">offset</span>=<span class="string">&quot;0%&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;stop-color: green;&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">stop</span></span></span><br><span class="line"><span class="tag">        <span class="attr">offset</span>=<span class="string">&quot;100%&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">&quot;stop-color: yellow&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">linearGradient</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;circle</span></span><br><span class="line"><span class="comment">    :r=&quot;option.radius&quot;</span></span><br><span class="line"><span class="comment">    :cx=&quot;option.cx&quot;</span></span><br><span class="line"><span class="comment">    :cy=&quot;option.cy&quot;</span></span><br><span class="line"><span class="comment">    :stroke=&quot;option.backColor&quot;</span></span><br><span class="line"><span class="comment">    :stroke-width=&quot;option.strokeWidth&quot;</span></span><br><span class="line"><span class="comment">    fill=&quot;none&quot;</span></span><br><span class="line"><span class="comment">  /&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke</span>=<span class="string">&quot;&#x27;url(#gradient)&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如图</p><p><img src="https://upload-images.jianshu.io/upload_images/2444724-04ea1c1c15a78c6e?imageMogr2/auto-orient/strip%7CimageView2/2/w/456/format/webp" alt="img"></p><p>image</p><p>可见</p><ol><li>线性渐变是从左到右边</li><li>刚刚的位置不正确是因为设置了旋转的原因</li></ol><p>那么我们可以推翻我们前面<strong>不靠谱的推测</strong>转回来继续思考怎么实现渐变的办法,对于有没有办法依靠svg的渐变元素这些来实现渐变的互动，鉴于CSS依靠渐变可以做出很多玩法，所以我不能打包票说没有，只不过我觉得可能实现思路会比较的麻烦，所以就换了一种思路来进行实现。</p><p><strong>我们只需要手动计算渐变就ok了</strong><br> 也就是说只需要实现算法，计算出从<strong>颜色a到颜色b之间的各个渐变色是多少</strong>，依靠不同弧长不同颜色的圆进行重叠，那么我们就可以模拟渐变的实现<br> 需要注意的是渐变的实现并不是有的时候相信的那样,从<strong>000000到ffffff进行累加</strong>,而是需要<strong>先转化成为rgb</strong>再进行计算<br> 通过搜索引擎我们可以找到一些实现好的算法,对于具体的原理就没有再深究了,<br> <a href="https://links.jianshu.com/go?to=https://www.jb51.net/article/109044.htm">参考文章</a><br> 里面还实现了rgb转16进制的算法这些，不过核心的渐变算法大致如下，其他的算法如果有需要得话可以参考一下</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">gradientColor</span> (startRGB, endRGB, step) &#123;</span><br><span class="line">  <span class="keyword">let</span> startR = startRGB[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> startG = startRGB[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">let</span> startB = startRGB[<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">let</span> endR = endRGB[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">let</span> endG = endRGB[<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">let</span> endB = endRGB[<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">let</span> sR = (endR - startR) / step <span class="comment">// 总差值</span></span><br><span class="line">  <span class="keyword">let</span> sG = (endG - startG) / step</span><br><span class="line">  <span class="keyword">let</span> sB = (endB - startB) / step</span><br><span class="line">  <span class="keyword">var</span> colorArr = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; step; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> color = <span class="string">&#x27;rgb(&#x27;</span> + <span class="built_in">parseInt</span>((sR * i + startR)) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">parseInt</span>((sG * i + startG)) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">parseInt</span>((sB * i + startB)) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    colorArr.<span class="title function_">push</span>(color)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> colorArr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到是对<strong>rgb颜色的三位分别进行步进</strong>以达到渐变的效果</p><p>接下来的问题便是如何<strong>计算步数</strong>，并且根据我们前面的分析，<strong>渐变色</strong>跟<strong>圆弧</strong>应该是对应的,经过一些测试,在步数为100的情况下，肉眼不是很能分辨出存在渐变色的空隙(<em>ps:本来在写这篇文字之前自己的看法是进行一些计算，在进度高的情况下，步进次数会高于进度低的步进次数的说，不过写到这里的时候突然想到了过低会导致不连贯的问题。。。于是可以回去修方案了,事实证明确实进行总结确实会有更多的发现</em>)</p><p>步数我们设定为100再对原来的弧长进行一百等分，就可以得到一个数组了,而原来的svg中circl元素我们则使用v-for根据前面生成的数组进行生成，代码如下</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;svg</span><br><span class="line">    :height=<span class="string">&quot;option.size&quot;</span></span><br><span class="line">    :width=<span class="string">&quot;option.size&quot;</span></span><br><span class="line">    x-mlns=<span class="string">&quot;http://www.w3.org/200/svg&quot;</span></span><br><span class="line">  &gt;</span><br><span class="line">    &lt;circle</span><br><span class="line">      :r=<span class="string">&quot;option.radius&quot;</span></span><br><span class="line">      :cx=<span class="string">&quot;option.cx&quot;</span></span><br><span class="line">      :cy=<span class="string">&quot;option.cy&quot;</span></span><br><span class="line">      :stroke=<span class="string">&quot;option.backColor&quot;</span></span><br><span class="line">      :stroke-width=<span class="string">&quot;option.strokeWidth&quot;</span></span><br><span class="line">      fill=<span class="string">&quot;none&quot;</span></span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;circle</span><br><span class="line">      v-<span class="keyword">for</span>=<span class="string">&quot;(item, index) in arcArr&quot;</span></span><br><span class="line">      :key=<span class="string">&quot;index&quot;</span></span><br><span class="line">      :r=<span class="string">&quot;option.radius&quot;</span></span><br><span class="line">      :cx=<span class="string">&quot;option.cx&quot;</span></span><br><span class="line">      :cy=<span class="string">&quot;option.cy&quot;</span></span><br><span class="line">      :stroke=<span class="string">&quot;item.color&quot;</span></span><br><span class="line">      :stroke-dasharray=<span class="string">&quot;item.arcLength&quot;</span></span><br><span class="line">      :stroke-width=<span class="string">&quot;option.strokeWidth&quot;</span></span><br><span class="line">      fill=<span class="string">&quot;none&quot;</span></span><br><span class="line">      transform=<span class="string">&quot;rotate(-90)&quot;</span></span><br><span class="line">      transform-origin=<span class="string">&quot;center&quot;</span></span><br><span class="line">      stroke-linecap=<span class="string">&quot;round&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">        &lt;animate</span><br><span class="line">          :to=<span class="string">&quot;item.arcLength&quot;</span></span><br><span class="line">          begin=<span class="string">&quot;0s&quot;</span></span><br><span class="line">          :dur=<span class="string">&quot;option.durtion&quot;</span></span><br><span class="line">          <span class="keyword">from</span>=<span class="string">&quot;0,1000000&quot;</span></span><br><span class="line">          attributeName=<span class="string">&quot;stroke-dasharray&quot;</span></span><br><span class="line">          fill=<span class="string">&quot;freeze&quot;</span></span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/circle&gt;</span><br><span class="line">      &lt;text</span><br><span class="line">        :x=<span class="string">&quot;option.cx&quot;</span></span><br><span class="line">        :y=<span class="string">&quot;option.cy + 10&quot;</span></span><br><span class="line">        font-size=<span class="string">&quot;30&quot;</span></span><br><span class="line">        font-family=<span class="string">&quot;Microsoft Yahei&quot;</span></span><br><span class="line">        font-weight=<span class="string">&quot;bold&quot;</span></span><br><span class="line">        text-anchor=<span class="string">&quot;middle&quot;</span></span><br><span class="line">        fill=<span class="string">&quot;#000&quot;</span></span><br><span class="line">      &gt;</span><br><span class="line">        &#123;&#123; text &#125;&#125;%</span><br><span class="line">      &lt;/text&gt;</span><br><span class="line">  &lt;/svg&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export <span class="literal">default</span> &#123;</span><br><span class="line">  name: <span class="string">&#x27;Progress&#x27;</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    progress: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    progressOption: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      <span class="literal">default</span>: () =&gt; &#123; &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      text: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    arcArr () &#123;</span><br><span class="line">      <span class="keyword">let</span> circleLength = Math.floor(<span class="number">2</span> * Math.PI * <span class="keyword">this</span>.option.radius)</span><br><span class="line">      <span class="keyword">let</span> progressLength = <span class="keyword">this</span>.progress / <span class="number">100</span> * circleLength</span><br><span class="line">      <span class="keyword">const</span> step = <span class="number">100</span> <span class="comment">// 设置到100则已经比较难看出来颜色断层</span></span><br><span class="line">      <span class="keyword">const</span> gradientColor = (startRGB, endRGB, step) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> startR = startRGB[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">let</span> startG = startRGB[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">let</span> startB = startRGB[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">let</span> endR = endRGB[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">let</span> endG = endRGB[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">let</span> endB = endRGB[<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">let</span> sR = (endR - startR) / step <span class="comment">// 总差值</span></span><br><span class="line">        <span class="keyword">let</span> sG = (endG - startG) / step</span><br><span class="line">        <span class="keyword">let</span> sB = (endB - startB) / step</span><br><span class="line">        <span class="keyword">let</span> colorArr = []</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; step; i++) &#123;</span><br><span class="line">          <span class="keyword">let</span> color = `rgb($&#123;sR * i + startR&#125;,$&#123;sG * i + startG&#125;,$&#123;sB * i + startB&#125;)`</span><br><span class="line">          colorArr.push(color)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> colorArr</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> colorArr = gradientColor(<span class="keyword">this</span>.option.startColor, <span class="keyword">this</span>.option.endColor, step)</span><br><span class="line">      <span class="comment">// 计算每个步进中的弧长</span></span><br><span class="line">      <span class="keyword">let</span> arcLengthArr = colorArr.map((color, index) =&gt; (&#123;</span><br><span class="line">        arcLength: `$&#123;index * (progressLength / <span class="number">100</span>)&#125;,<span class="number">100000000</span>`,</span><br><span class="line">        color: color</span><br><span class="line">      &#125;))</span><br><span class="line">      arcLengthArr.reverse()</span><br><span class="line">      <span class="keyword">return</span> arcLengthArr</span><br><span class="line">    &#125;,</span><br><span class="line">    option () &#123;</span><br><span class="line">      <span class="comment">// 所有进度条的可配置项</span></span><br><span class="line">      <span class="keyword">let</span> baseOption = &#123;</span><br><span class="line">        radius: <span class="number">100</span>,</span><br><span class="line">        strokeWidth: <span class="number">20</span>,</span><br><span class="line">        backColor: <span class="string">&#x27;#E6E6E6&#x27;</span>,</span><br><span class="line">        startColor: [<span class="number">249</span>, <span class="number">221</span>, <span class="number">180</span>],</span><br><span class="line">        endColor: [<span class="number">238</span>, <span class="number">171</span>, <span class="number">86</span>], <span class="comment">// 用于渐变色的开始</span></span><br><span class="line">      &#125;</span><br><span class="line">      Object.assign(baseOption, <span class="keyword">this</span>.progressOption)</span><br><span class="line">      <span class="comment">// 中心位置自动生成</span></span><br><span class="line">      baseOption.cy = baseOption.cx = baseOption.radius + baseOption.strokeWidth</span><br><span class="line">      baseOption.size = (baseOption.radius + baseOption.strokeWidth) * <span class="number">2</span></span><br><span class="line">      <span class="keyword">return</span> baseOption</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    <span class="keyword">this</span>.count()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    count() &#123;</span><br><span class="line">      <span class="keyword">this</span>.text += <span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.text &gt;= <span class="keyword">this</span>.progress) &#123;</span><br><span class="line">        <span class="keyword">this</span>.text = <span class="keyword">this</span>.<span class="function">progress</span></span><br><span class="line"><span class="function">        <span class="title">clearTimeout</span>(<span class="params">timeId</span>)</span></span><br><span class="line"><span class="function">        <span class="keyword">return</span></span></span><br><span class="line"><span class="function">      &#125;</span></span><br><span class="line"><span class="function">      <span class="keyword">const</span> timeId</span> = setTimeout(<span class="keyword">this</span>.count, <span class="number">30</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>需要注意的是我们最后的时候对生成的数组进行了一次<strong>颠倒</strong>,不然弧度最长的圆弧会挂在最后面,导致我们看不到渐变效果<br> 效果如图</p><p><img src="https://upload-images.jianshu.io/upload_images/2444724-16d8b2da8e75d1a5?imageMogr2/auto-orient/strip%7CimageView2/2/w/532/format/webp" alt="img"></p><p>image</p><p> 这里我稍微调整了一下颜色让他符合我们的预期</p><h2 id="最后为其加上动画效果"><a href="#最后为其加上动画效果" class="headerlink" title="最后为其加上动画效果"></a>最后为其加上动画效果</h2><p>这部分不是一个很复杂的事情,需要注意<strong>在circle上的stroke-dasharray我们需要去掉</strong>,避免出现弧长在一开始的时候就渲染了出来，然后又马上消失进入动画效果的情况，虽然影响不大，但是还是需要注意一下。<br> 代码如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">  <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in arcArr&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:stroke</span>=<span class="string">&quot;item.color&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">transform</span>=<span class="string">&quot;rotate(-90)&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">transform-origin</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">animate</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:to</span>=<span class="string">&quot;item.arcLength&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">begin</span>=<span class="string">&quot;0s&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:dur</span>=<span class="string">&quot;option.durtion&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">from</span>=<span class="string">&quot;0,1000000&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">attributeName</span>=<span class="string">&quot;stroke-dasharray&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">fill</span>=<span class="string">&quot;freeze&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>确实在学到东西以后需要做一些输出才能达到真正的学会,其实整个组件设计一开始的时候跟现在的区别还蛮大的，中间走了很多的弯路，关于svg的渐变从一开始就想错了，即使在我换思路的时候，我还以为是svg的渐变在作用于弧型的时候是顺时针画圆，并且在百分之五十的时候从结尾的颜色切换到开始的颜色达到循环渐变，直到自己写文章的时候才发现自己的错误，比如一开始的时候加入渐变效果后因为步长的计算有问题，导致出现了精度的概念，只能做到0.01的进度，而一旦切换到高精度就会导致动画非常卡顿，后来换了思路就清晰很多了<br> 以下需要进行补充</p><ol><li>因为重点在于渐变，所以对接受的参数就没有过多的需求了，附带的参考文章里面自己看一下改一改就能让startColor跟endColor接受正常的颜色值了</li><li>这里只做了两个渐变色，如果需要多个渐变感觉修正一下算法也不会很难</li><li>关于步进次数为100，这里自己也做过一些测试，在我试验的颜色值下面感觉在20这些数字差距也不会很大，不过性能看起在100的情况下跟20的情况下差距不大，就没有再进行修正了,而是成为了参数默认值默认值</li></ol><h2 id="另一种实现方式"><a href="#另一种实现方式" class="headerlink" title="另一种实现方式:"></a>另一种实现方式:</h2><p>果然是学无止境,搜索网上的文章的时候突然发现了张大神的一篇漏网之鱼，居然只使用了两个circle元素就实现了渐变效果<br> 于是我也从中吸取了一些帮助对这个进度条进行了进一步的优化<br> 参考链接</p><p><a href="https://links.jianshu.com/go?to=https://www.zhangxinxu.com/wordpress/2015/07/svg-circle-loading/">张鑫旭渐变进度条实现</a><br> 不过确定貌似是不能做到最后的尾部颜色是设置的结尾色，不过这样也可以作为一个补充，具体效果如图</p><p><img src="https://upload-images.jianshu.io/upload_images/2444724-890ad08283cf9c1f.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/360/format/webp" alt="img"></p><p>image</p><p> 可以看到右边的末端颜色略微淡色<br> 具体实现方式看代码，个人认为需要注意的点</p><ol><li>实现方式，本质上是两张circle的叠加,然后进行了旋转得到的,从颜色colorA到颜色colorB，算出中间值colorC，然后第一个从colorA到colorC,第二个从colorB到colorC,旋转到从上到下，那么进行叠加，看起来就是从colorA到colorC再到colorB了</li><li>要注意动画的实现，需要按照比例对动画时长进行切割，这样才不会导致在最后的时候原本流畅的动画过了最底部的时候速度突然骤降，注意动画的无缝衔接</li></ol><p>具体参考代码如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">:height</span>=<span class="string">&quot;option.size&quot;</span> <span class="attr">:width</span>=<span class="string">&quot;option.size&quot;</span> <span class="attr">x-mlns</span>=<span class="string">&quot;http://www.w3.org/200/svg&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defs</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">linearGradient</span> <span class="attr">id</span>=<span class="string">&quot;outGradient&quot;</span> <span class="attr">x1</span>=<span class="string">&quot;1&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">&quot;0%&quot;</span> <span class="attr">:stop-color</span>=<span class="string">&quot;arcOption.outArcStartColor&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">:stop-color</span>=<span class="string">&quot;arcOption.outArcEndColor&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">linearGradient</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">linearGradient</span> <span class="attr">id</span>=<span class="string">&quot;innerGradient&quot;</span> <span class="attr">x1</span>=<span class="string">&quot;1&quot;</span> <span class="attr">y1</span>=<span class="string">&quot;0&quot;</span> <span class="attr">x2</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y2</span>=<span class="string">&quot;0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">&quot;0%&quot;</span> <span class="attr">:stop-color</span>=<span class="string">&quot;arcOption.innerArcStartColor&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">stop</span> <span class="attr">offset</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">:stop-color</span>=<span class="string">&quot;arcOption.innerArcEndColor&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">linearGradient</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">defs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke</span>=<span class="string">&quot;option.backColor&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth / 2&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">stroke</span>=<span class="string">&quot;url(&#x27;#innerGradient&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">transform</span>=<span class="string">&quot;rotate(-90)&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">transform-origin</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke-dasharray</span>=<span class="string">&quot;`0,1000000`&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">animate</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:to</span>=<span class="string">&quot;`$&#123;arcOption.innerArcLength&#125;,1000000`&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:begin</span>=<span class="string">&quot;arcOption.outDurtion&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:dur</span>=<span class="string">&quot;arcOption.innerDurtion&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:from</span>=<span class="string">&quot;`$&#123;arcOption.innerInitArcLength&#125;,1000000`&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">attributeName</span>=<span class="string">&quot;stroke-dasharray&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fill</span>=<span class="string">&quot;freeze&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">circle</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:r</span>=<span class="string">&quot;option.radius&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cx</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cy</span>=<span class="string">&quot;option.cy&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">stroke</span>=<span class="string">&quot;url(&#x27;#outGradient&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke-width</span>=<span class="string">&quot;option.strokeWidth&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stroke-dasharray</span>=<span class="string">&quot;`$&#123;arcOption.outArcLength&#125;,1000000`&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fill</span>=<span class="string">&quot;none&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">transform</span>=<span class="string">&quot;rotate(-90)&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">transform-origin</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">stroke-linecap</span>=<span class="string">&quot;round&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">animate</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:to</span>=<span class="string">&quot;`$&#123;arcOption.outArcLength&#125;,1000000`&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">begin</span>=<span class="string">&quot;0s&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:dur</span>=<span class="string">&quot;arcOption.outDurtion&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">from</span>=<span class="string">&quot;0,1000000&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">attributeName</span>=<span class="string">&quot;stroke-dasharray&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fill</span>=<span class="string">&quot;freeze&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:x</span>=<span class="string">&quot;option.cx&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:y</span>=<span class="string">&quot;option.cy + 10&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">font-size</span>=<span class="string">&quot;30&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">font-family</span>=<span class="string">&quot;Microsoft Yahei&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">font-weight</span>=<span class="string">&quot;bold&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">text-anchor</span>=<span class="string">&quot;middle&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">fill</span>=<span class="string">&quot;#000&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      &#123;&#123; text &#125;&#125;%</span><br><span class="line">    <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;Progress&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">progress</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Number</span>, <span class="comment">// 0 ~ 1</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">progressOption</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123; &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">text</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    arcOption () &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> arcConfig = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> circleLength = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">radius</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 如果此时小于0.5 则只需要显示最外层的圆弧 里面的圆弧不需要画了</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 时间计算 因为第二段的长度不见得等于第一段 所以不能平分时间 不然会导致第二端的速度出现骤降</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 因此需要按照比例进行时间计算</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> progress = <span class="variable language_">this</span>.<span class="property">progress</span> / <span class="number">100</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (progress &lt; <span class="number">0.5</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">outArcLength</span> = progress * circleLength</span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">outDurtion</span> = <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">durtion</span> <span class="comment">// 为初始设置的动画值</span></span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">innerArcLength</span> = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">innerInitArcLength</span> = <span class="number">0</span> <span class="comment">// 为动画做准备</span></span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">innerDurtion</span> = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> time = <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">durtion</span></span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">outArcLength</span> = <span class="number">0.5</span> * circleLength</span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">outDurtion</span> = (<span class="number">0.5</span> / progress) * time + <span class="string">&#x27;s&#x27;</span> <span class="comment">//</span></span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">innerArcLength</span> = progress * circleLength</span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">innerInitArcLength</span> = <span class="number">0.5</span> * circleLength <span class="comment">// 为动画做准备 此时从中间开始</span></span></span><br><span class="line"><span class="language-javascript">        arcConfig.<span class="property">innerDurtion</span> = ((progress - <span class="number">0.5</span>) / progress) * time + <span class="string">&#x27;s&#x27;</span> <span class="comment">// 为动画做准备 此时从中间开始</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> <span class="title function_">tansfromColor</span> = arr =&gt; <span class="string">`rgb(<span class="subst">$&#123;arr[<span class="number">0</span>]&#125;</span>,<span class="subst">$&#123;arr[<span class="number">1</span>]&#125;</span>,<span class="subst">$&#123;arr[<span class="number">2</span>]&#125;</span>)`</span></span></span><br><span class="line"><span class="language-javascript">      arcConfig.<span class="property">outArcStartColor</span> = <span class="title function_">tansfromColor</span>(<span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">startColor</span>)</span></span><br><span class="line"><span class="language-javascript">      arcConfig.<span class="property">outArcEndColor</span> = <span class="title function_">tansfromColor</span>(<span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">startColor</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">color, index</span>) =&gt;</span> color + (<span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">endColor</span>[index] - color) / <span class="number">2</span>))</span></span><br><span class="line"><span class="language-javascript">      arcConfig.<span class="property">innerArcStartColor</span> = <span class="title function_">tansfromColor</span>(<span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">endColor</span>)</span></span><br><span class="line"><span class="language-javascript">      arcConfig.<span class="property">innerArcEndColor</span> = <span class="title function_">tansfromColor</span>(<span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">startColor</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">color, index</span>) =&gt;</span> color + (<span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">endColor</span>[index] - color) / <span class="number">2</span>))</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> arcConfig</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    option () &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 所有进度条的可配置项</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> baseOption = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">radius</span>: <span class="number">100</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">strokeWidth</span>: <span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">backColor</span>: <span class="string">&#x27;#E6E6E6&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">startColor</span>: [<span class="number">249</span>, <span class="number">221</span>, <span class="number">180</span>],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">endColor</span>: [<span class="number">238</span>, <span class="number">171</span>, <span class="number">86</span>],</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">durtion</span>: <span class="number">.7</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">step</span>: <span class="number">100</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(baseOption, <span class="variable language_">this</span>.<span class="property">progressOption</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 中心位置自动生成</span></span></span><br><span class="line"><span class="language-javascript">      baseOption.<span class="property">cy</span> = baseOption.<span class="property">cx</span> = baseOption.<span class="property">radius</span> + baseOption.<span class="property">strokeWidth</span></span></span><br><span class="line"><span class="language-javascript">      baseOption.<span class="property">size</span> = (baseOption.<span class="property">radius</span> + baseOption.<span class="property">strokeWidth</span>) * <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> baseOption</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">count</span>()</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">count</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">text</span> += <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">text</span> &gt;= <span class="variable language_">this</span>.<span class="property">progress</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">text</span> = <span class="variable language_">this</span>.<span class="property">progress</span></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">clearTimeout</span>(timeId)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> timeId = <span class="built_in">setTimeout</span>(<span class="variable language_">this</span>.<span class="property">count</span>, <span class="number">10</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 小功能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小功能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3最新的15个常用API</title>
      <link href="/hisai3.github.io/2023/01/14/Vue3%E6%9C%80%E6%96%B0%E7%9A%8415%E4%B8%AA%E5%B8%B8%E7%94%A8API/"/>
      <url>/hisai3.github.io/2023/01/14/Vue3%E6%9C%80%E6%96%B0%E7%9A%8415%E4%B8%AA%E5%B8%B8%E7%94%A8API/</url>
      
        <content type="html"><![CDATA[<h1 id="快速使用Vue3最新的15个常用API"><a href="#快速使用Vue3最新的15个常用API" class="headerlink" title="快速使用Vue3最新的15个常用API"></a>快速使用Vue3最新的15个常用API</h1><p>之前我写了一篇博客介绍了Vue3的新特性，简单了解了一下Vue3都有哪些特色，并且在文末带大家稍微体验了一下Vue3中 <code>Compsition API</code> 的简单使用</p><p>上一篇文章地址：<a href="https://lpyexplore.blog.csdn.net/article/details/107820234">紧跟尤大的脚步提前体验Vue3新特性，你不会还没了解过Vue3吧</a></p><p>因为这个月的月初给自己定了个小目标，学完Vue3的基本使用，并使用Vue3亲手做一个小项目（稍微透露一下，我制作的是一个小工具，现在已经完成了90％了，这个月月底之前会通过博客的形式向大家展示，并且提供设计思路，大家敬请期待……），本文会频繁地对比Vue2来介绍Vue3，也将对各个API结合代码实例讲解，这既是对自己知识的总结，也希望能帮助到大家</p><p>也欢迎大家阅读我之前的一些文章👇👇初来掘金，待我之后向大家介绍我自己👏</p><ul><li><a href="https://juejin.cn/post/6886992599006380045">浏览器与Node环境下的Event Loop</a></li><li><a href="https://juejin.cn/post/6896397110078504973">聊聊CommonJS与ES6 Module的使用与区别</a></li></ul><h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p>大家都知道，现在Vue3的各个版本已经陆续发布了，并且有很多的团队已经着手各个库的开发与Vue2向Vue3的升级，我们当然也不能落后，所以赶紧将你手中的Vue2升级到Vue3，跟着本文一起学习新的API吧</p><p>升级的方法可以点击本文开头的文章，在上一篇文章中有个<strong>保姆级别的教程</strong>告诉大家如何升级</p><h1 id="二、正文"><a href="#二、正文" class="headerlink" title="二、正文"></a>二、正文</h1><p>Vue2每次都把整个Vue导入，例如Vue2的 <code>main.js</code> 文件中的代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property">config</span>.<span class="property">productionTip</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>但很明显我们的项目中不可能用到Vue所有的API，因此很多模块其实是没有用的</p><p>那么在Vue3中，对外暴露了很多的API供开发者使用，我们可以根据自己的需求，将所需要的API从Vue中导入。例如 <code>main.js</code> 中的代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>利用了 <code>import</code> 和 <code>export</code> 的导入导出语法，实现了按需打包模块的功能，项目打包后的文件体积明显小了很多</p><p>这也是我们本文需要对 <code>Vue3 API</code> 进行详细了解的原因</p><h2 id="（1）setup"><a href="#（1）setup" class="headerlink" title="（1）setup"></a>（1）setup</h2><p><code>setup</code> 函数也是 <code>Compsition API</code> 的入口函数，我们的变量、方法都是在该函数里定义的，来看一下使用方法</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; number &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 1. 从 vue 中引入 ref 函数</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 2. 用 ref 函数包装一个响应式变量 number</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> number = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 3. 设定一个方法</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// number是被ref函数包装过了的，其值保存在.value中</span></span></span><br><span class="line"><span class="language-javascript">          number.<span class="property">value</span> ++</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 4. 将 number 和 add 返回出去，供template中使用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;number, add&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>上述代码中用到了 <code>ref</code> 函数，下面会详细讲解，在这里你只需要理解它的作用是包装一个响应式的数据即可，并且你可以将 <code>ref</code> 函数包装过的变量看作是Vue2 <code>data</code> 中的变量</p><p>这样就简单实现了一个点击按钮数字加1的功能</p><hr><p>在Vue2中，我们访问 <code>data</code> 或 <code>props</code> 中的变量，都是通过类似 <code>this.number</code> 这样的形式去获取的，但要特别注意的是，在setup中，<code>this</code> 指向的是 <code>undefined</code>，也就是说不能再向Vue2一样通过 <code>this</code> 去获取变量了</p><p>那么到底该如何获取到 <code>props</code> 中的数据呢？</p><p>其实 <code>setup</code> 函数还有两个参数，分别是 <code>props</code> 、<code>context</code>，前者存储着定义当前组件允许外界传递过来的参数名称以及对应的值；后者是一个上下文对象，能从中访问到 <code>attr</code> 、<code>emit</code> 、<code>slots</code></p><p>其中 <code>emit</code> 就是我们熟悉的Vue2中与父组件通信的方法，可以直接拿来调用</p><h2 id="（2）生命周期"><a href="#（2）生命周期" class="headerlink" title="（2）生命周期"></a>（2）生命周期</h2><p>Vue2中有 <code>beforeCreate</code> 、<code>created</code> 、<code>beforeMount</code> 、<code>mounted</code> 、<code>beforeUpdate</code> 等生命周期函数</p><p>而在Vue3中，这些生命周期部分有所变化，并且调用的方式也有所改变，下面放上一张变化图来简单了解一下</p><table><thead><tr><th>Vue2</th><th>Vue3</th></tr></thead><tbody><tr><td>beforeCreate</td><td>setup</td></tr><tr><td>created</td><td>setup</td></tr><tr><td>beforeMount</td><td>onBeforeMount</td></tr><tr><td>mounted</td><td>onMounted</td></tr><tr><td>beforeUpdate</td><td>onBeforeUpdate</td></tr><tr><td>updated</td><td>onUpdated</td></tr><tr><td>beforeDestory</td><td>onBeforeUnmount</td></tr><tr><td>destoryed</td><td>unMounted</td></tr></tbody></table><p>Vue3的这些生命周期调用也很简单，同样是先从 <code>vue</code> 中导入，再进行直接调用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 1. 从 vue 中引入 多个生命周期函数</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, unMounted&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onBeforeMount</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 在挂载前执行某些代码</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 在挂载后执行某些代码</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onBeforeUpdate</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 在更新前前执行某些代码</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onUpdated</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 在更新后执行某些代码</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 在组件销毁前执行某些代码</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">unMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 在组件销毁后执行某些代码</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>要特别说明一下的就是，<code>setup</code> 函数代替了 <code>beforeCreate</code> 和 <code>created</code> 两个生命周期函数，因此我们可以认为它的执行时间在<code>beforeCreate</code> 和 <code>created</code> 之间</p><h2 id="（3）reactive"><a href="#（3）reactive" class="headerlink" title="（3）reactive"></a>（3）reactive</h2><p><code>reactive</code> 方法是用来创建一个响应式的数据对象，该API也很好地解决了Vue2通过 <code>defineProperty</code> 实现数据响应式的缺陷</p><p>用法很简单，只需将数据作为参数传入即可，代码如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 4. 访问响应式数据对象中的 count  --&gt;</span></span><br><span class="line">  &#123;&#123; state.count &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 1. 从 vue 中导入 reactive </span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 2. 创建响应式的数据对象</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;<span class="attr">count</span>: <span class="number">3</span>&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 3. 将响应式数据对象state return 出去，供template使用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;state&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="（4）ref"><a href="#（4）ref" class="headerlink" title="（4）ref"></a>（4）ref</h2><p>在介绍 <code>setup</code> 函数时，我们使用了 <code>ref</code> 函数包装了一个响应式的数据对象，这里表面上看上去跟 <code>reactive</code> 好像功能一模一样啊，确实差不多，因为 <code>ref</code> 就是通过 <code>reactive</code> 包装了一个对象 ，然后是将值传给该对象中的 <code>value</code> 属性，这也就解释了为什么每次访问时我们都需要加上 <code>.value</code></p><p>我们可以简单地把 <code>ref(obj)</code> 理解为这个样子 <code>reactive(&#123;value: obj&#125;)</code></p><p>这里我们写一段代码来具体看一下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref, reactive&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> obj = &#123;<span class="attr">count</span>: <span class="number">3</span>&#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> state1 = <span class="title function_">ref</span>(obj)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> state2 = <span class="title function_">reactive</span>(obj)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(state1)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(state2)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>来看一下打印结果</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>)</p><blockquote><p><strong>注意：</strong> 这里指的 <code>.value</code> 是在 <code>setup</code> 函数中访问 <code>ref</code> 包装后的对象时才需要加的，在 <code>template</code> 模板中访问时是不需要的，因为在编译时，会自动识别其是否为 <code>ref</code> 包装过的</p></blockquote><p>那么我们到底该如何选择 <code>ref</code> 和 <code>reactive</code> 呢？</p><p><strong>建议：</strong></p><ol><li>基本类型值（<code>String</code> 、<code>Nmuber</code> 、<code>Boolean</code> 等）或单值对象（类似像 <code>&#123;count: 3&#125;</code> 这样只有一个属性值的对象）使用 <code>ref</code></li><li>引用类型值（<code>Object</code> 、<code>Array</code>）使用 <code>reactive</code></li></ol><h2 id="（5）toRef"><a href="#（5）toRef" class="headerlink" title="（5）toRef"></a>（5）toRef</h2><p><code>toRef</code> 是将某个对象中的某个值转化为响应式数据，其接收两个参数，第一个参数为 <code>obj</code> 对象；第二个参数为对象中的属性名</p><p>代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 1. 导入 toRef</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;toRef&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;<span class="attr">count</span>: <span class="number">3</span>&#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2. 将 obj 对象中属性count的值转化为响应式数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">toRef</span>(obj, <span class="string">&#x27;count&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3. 将toRef包装过的数据对象返回供template使用</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;state&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>但其实表面上看上去 <code>toRef</code> 这个API好像非常的没用，因为这个功能也可以用 <code>ref</code> 实现，代码如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 1. 导入 ref</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;<span class="attr">count</span>: <span class="number">3</span>&#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2. 将 obj 对象中属性count的值转化为响应式数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">ref</span>(obj.<span class="property">count</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3. 将ref包装过的数据对象返回供template使用</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;state&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>乍一看好像还真是，其实这两者是有区别的，我们可以通过一个案例来比较一下，代码如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add1&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state2 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add2&quot;</span>&gt;</span>增加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref, toRef&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;<span class="attr">count</span>: <span class="number">3</span>&#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state1 = <span class="title function_">ref</span>(obj.<span class="property">count</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state2 = <span class="title function_">toRef</span>(obj, <span class="string">&#x27;count&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">add1</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            state1.<span class="property">value</span> ++</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;原始值：&#x27;</span>, obj);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;响应式数据对象：&#x27;</span>, state1);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">add2</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            state2.<span class="property">value</span> ++</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;原始值：&#x27;</span>, obj);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;响应式数据对象：&#x27;</span>, state2);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;state1, state2, add1, add2&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们分别用 <code>ref</code> 和 <code>toRef</code> 将 <code>obj</code> 中的 <code>count</code> 转化为响应式，并声明了两个方法分别使 <code>count</code> 值增加，每次增加后打印一下原始值 <code>obj</code> 和被包装过的响应式数据对象，同时还要看看视图的变化</p><p><strong>ref：</strong></p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 可以看到，在对响应式数据的值进行 <code>+1</code> 操作后，视图改变了，原始值未改变，响应式数据对象的值也改变了，这说明 <code>ref</code> 是对原数据的一个<strong>拷贝</strong>，不会影响到原始值，同时响应式数据对象值改变后会同步更新视图</p><p><strong>toRef：</strong></p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 可以看到，在对响应式数据的值进行 <code>+1</code> 操作后，视图未发生改变，原始值改变了，响应式数据对象的值也改变了，这说明 <code>toRef</code> 是对原数据的一个<strong>引用</strong>，会影响到原始值，但是响应式数据对象值改变后会不会更新视图</p><p><strong>总结：</strong></p><ol><li><code>ref</code> 是对传入数据的拷贝；<code>toRef</code> 是对传入数据的引用</li><li><code>ref</code> 的值改变会更新视图；<code>toRef</code> 的值改变不会更新视图</li></ol><h2 id="（6）toRefs"><a href="#（6）toRefs" class="headerlink" title="（6）toRefs"></a>（6）toRefs</h2><p>了解完 <code>toRef</code> 后，就很好理解 <code>toRefs</code> 了，其作用就是将传入的对象里所有的属性的值都转化为响应式数据对象，该函数支持一个参数，即 <code>obj</code> 对象</p><p>我们来看一下它的基本使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 1. 导入 toRefs</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;toRefs&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&#x27;前端印象&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="number">22</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">gender</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 2. 将 obj 对象中属性count的值转化为响应式数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">toRefs</span>(obj)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 3. 打印查看一下</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>打印结果如下：</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 返回的是一个对象，对象里包含了每一个包装过后的响应式数据对象</p><h2 id="（7）shallowReactive"><a href="#（7）shallowReactive" class="headerlink" title="（7）shallowReactive"></a>（7）shallowReactive</h2><p>听这个API的名称就知道，这是一个渐层的 <code>reactive</code>，难道意思就是原本的 <code>reactive</code> 是深层的呗，没错，这是一个用于性能优化的API</p><p>其实将 <code>obj</code> 作为参数传递给 <code>reactive</code> 生成响应式数据对象时，若 <code>obj</code> 的层级不止一层，那么会将每一层都用 <code>Proxy</code> 包装一次，我们来验证一下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">a</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">first</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">b</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">second</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">c</span>: <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">reactive</span>(obj)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">first</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">first</span>.<span class="property">second</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>来看一下打印结果：</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 设想一下如果一个对象层级比较深，那么每一层都用 <code>Proxy</code> 包装后，对于性能是非常不友好的</p><p>接下来我们再来看看 <code>shallowReactive</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;shallowReactive&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">a</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">first</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">b</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">second</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">c</span>: <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">shallowReactive</span>(obj)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">first</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">first</span>.<span class="property">second</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>来看一下打印结果：</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 结果非常的明了了，只有第一层被 <code>Proxy</code> 处理了，也就是说只有修改第一层的值时，才会响应式更新，代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.a &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.first.b &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.first.second.c &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change1&quot;</span>&gt;</span>改变1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change2&quot;</span>&gt;</span>改变2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;shallowReactive&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">a</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">first</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">b</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">second</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">c</span>: <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">shallowReactive</span>(obj)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">change1</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">a</span> = <span class="number">7</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">change2</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">first</span>.<span class="property">b</span> = <span class="number">8</span></span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">first</span>.<span class="property">second</span>.<span class="property">c</span> = <span class="number">9</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(state);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;state&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>来看一下具体过程：</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 首先我们点击了第二个按钮，改变了第二层的 <code>b</code> 和第三层的 <code>c</code>，虽然值发生了改变，但是视图却没有进行更新；</p><p>当我们点击了第一个按钮，改变了第一层的 <code>a</code> 时，整个视图进行了更新；</p><p>由此可说明，<code>shallowReactive</code> 监听了第一层属性的值，一旦发生改变，则更新视图</p><h2 id="（8）shallowRef"><a href="#（8）shallowRef" class="headerlink" title="（8）shallowRef"></a>（8）shallowRef</h2><p>这是一个浅层的 <code>ref</code>，与 <code>shallowReactive</code> 一样是拿来做性能优化的</p><p><code>shallowReactive</code> 是监听对象第一层的数据变化用于驱动视图更新，那么 <code>shallowRef</code> 则是监听 <code>.value</code> 的值的变化来更新视图的</p><p>我们来看一下具体代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.a &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.first.b &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.first.second.c &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change1&quot;</span>&gt;</span>改变1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change2&quot;</span>&gt;</span>改变2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;shallowRef&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">a</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">first</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">b</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">second</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">c</span>: <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">shallowRef</span>(obj)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">change1</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 直接将state.value重新赋值</span></span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">value</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">a</span>: <span class="number">7</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">first</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">b</span>: <span class="number">8</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">second</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">c</span>: <span class="number">9</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">change2</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">value</span>.<span class="property">first</span>.<span class="property">b</span> = <span class="number">8</span></span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">value</span>.<span class="property">first</span>.<span class="property">second</span>.<span class="property">c</span> = <span class="number">9</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(state);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;state, change1, change2&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>首先看一下被 <code>shallowRef</code> 包装过后是怎样的结构</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 然后再来看看改变其值会有什么变化</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 我们先点击了第二个按钮，发现数据确实被改变了，但是视图并没随之更新；</p><p>于是点击了第二个按钮，即将整个 <code>.value</code> 重新赋值了，视图就立马更新了</p><p>这么一看，未免也太过麻烦了，改个数据还要重新赋值，不要担心，此时我们可以用到另一个API，叫做 <code>triggerRef</code> ，调用它就可以立马更新视图，其接收一个参数 <code>state</code> ，即需要更新的 <code>ref</code> 对象</p><p>我们来使用一下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.a &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.first.b &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.first.second.c &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change&quot;</span>&gt;</span>改变<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;shallowRef, triggerRef&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">a</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">first</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">b</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">second</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">c</span>: <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">shallowRef</span>(obj)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(state);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">change</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">value</span>.<span class="property">first</span>.<span class="property">b</span> = <span class="number">8</span></span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">value</span>.<span class="property">first</span>.<span class="property">second</span>.<span class="property">c</span> = <span class="number">9</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 修改值后立即驱动视图更新</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">triggerRef</span>(state)</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(state);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;state, change&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们来看一下具体过程</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 可以看到，我们没有给 <code>.value</code> 重新赋值，只是在修改值后，调用了 <code>triggerRef</code> 就实现了视图的更新</p><h2 id="（9）toRaw"><a href="#（9）toRaw" class="headerlink" title="（9）toRaw"></a>（9）toRaw</h2><p><code>toRaw</code> 方法是用于获取 <code>ref</code> 或 <code>reactive</code> 对象的原始数据的</p><p>先来看一段代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change&quot;</span>&gt;</span>改变<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&#x27;前端印象&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="number">22</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">reactive</span>(obj)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">change</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">age</span> = <span class="number">90</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">// 打印原始数据obj</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(state);  <span class="comment">// 打印 reactive对象</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;state, change&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>来看看具体过程</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 我们改变了 <code>reactive</code> 对象中的数据，于是看到原始数据 <code>obj</code> 和被 <code>reactive</code> 包装过的对象的值都发生了变化，由此我们可以看出，这两者是一个引用关系</p><p>那么此时我们就想了，那如果直接改变原始数据 <code>obj</code> 的值，会怎么样呢？答案是： <code>reactive</code> 的值也会跟着改变，但是视图不会更新</p><p>由此可见，当我们想修改数据，但不想让视图更新时，可以选择直接修改原始数据上的值，因此需要先获取到原始数据，我们可以使用 Vue3 提供的 <code>toRaw</code> 方法</p><p><code>toRaw</code> 接收一个参数，即 <code>ref</code> 对象或 <code>reactive</code> 对象</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive, toRaw&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&#x27;前端印象&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="number">22</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">reactive</span>(obj)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> raw = <span class="title function_">toRaw</span>(state)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj === raw)   <span class="comment">// true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>上述代码就证明了 <code>toRaw</code> 方法从 <code>reactive</code> 对象中获取到的是原始数据，因此我们就可以很方便的通过修改原始数据的值而不更新视图来做一些性能优化了</p><blockquote><p><strong>注意：</strong> 补充一句，当 <code>toRaw</code> 方法接收的参数是 <code>ref</code> 对象时，需要加上 <code>.value</code> 才能获取到原始数据对象</p></blockquote><h2 id="（10）markRaw"><a href="#（10）markRaw" class="headerlink" title="（10）markRaw"></a>（10）markRaw</h2><p><code>markRaw</code> 方法可以将原始数据标记为非响应式的，即使用 <code>ref</code> 或 <code>reactive</code> 将其包装，仍无法实现数据响应式，其接收一个参数，即原始数据，并返回被标记后的数据</p><p>我们来看一下代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; state.age &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;change&quot;</span>&gt;</span>改变<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive, markRaw&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&#x27;前端印象&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="number">22</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 通过markRaw标记原始数据obj, 使其数据更新不再被追踪</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> raw = <span class="title function_">markRaw</span>(obj)   </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 试图用reactive包装raw, 使其变成响应式数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">reactive</span>(raw)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">change</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">age</span> = <span class="number">90</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(state);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;state, change&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们来看一下在被 <code>markRaw</code> 方法处理过后的数据是否还能被 <code>reactive</code> 包装成响应式数据</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 从图中可以看到，即使我们修改了值也不会更新视图了，即没有实现数据响应式</p><h2 id="（11）provide-amp-amp-inject"><a href="#（11）provide-amp-amp-inject" class="headerlink" title="（11）provide &amp;&amp; inject"></a>（11）provide &amp;&amp; inject</h2><p>与 Vue2中的 <code>provide</code> 和 <code>inject</code> 作用相同，只不过在Vue3中需要手动从 <code>vue</code> 中导入</p><p>这里简单说明一下这两个方法的作用：</p><ul><li><strong>provide</strong> ：向子组件以及子孙组件传递数据。接收两个参数，第一个参数是 <code>key</code>，即数据的名称；第二个参数为 <code>value</code>，即数据的值</li><li><strong>inject</strong> ：接收父组件或祖先组件传递过来的数据。接收一个参数 <code>key</code>，即父组件或祖先组件传递的数据名称</li></ul><p>假设这有三个组件，分别是 <code>A.vue</code> 、<code>B.vue</code> 、<code>C.vue</code>，其中 <code>B.vue</code> 是 <code>A.vue</code> 的子组件，<code>C.vue</code> 是 <code>B.vue</code> 的子组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// A.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;provide&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> obj= &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&#x27;前端印象&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">age</span>: <span class="number">22</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 向子组件以及子孙组件传递名为info的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">provide</span>(<span class="string">&#x27;info&#x27;</span>, obj)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// B.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;inject&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 接收A.vue传递过来的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">inject</span>(<span class="string">&#x27;info&#x27;</span>)  <span class="comment">// &#123;name: &#x27;前端印象&#x27;, age: 22&#125;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// C.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;inject&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 接收A.vue传递过来的数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">inject</span>(<span class="string">&#x27;info&#x27;</span>)  <span class="comment">// &#123;name: &#x27;前端印象&#x27;, age: 22&#125;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="（12）watch-amp-amp-watchEffect"><a href="#（12）watch-amp-amp-watchEffect" class="headerlink" title="（12）watch &amp;&amp; watchEffect"></a>（12）watch &amp;&amp; watchEffect</h2><p><code>watch</code> 和 <code>watchEffect</code> 都是用来监视某项数据变化从而执行指定的操作的，但用法上还是有所区别</p><p><strong>watch</strong>：watch( source, cb, [options] )</p><p>参数说明：</p><ul><li>source：可以是表达式或函数，用于指定监听的依赖对象</li><li>cb：依赖对象变化后执行的回调函数</li><li>options：可参数，可以配置的属性有 immediate（立即触发回调函数）、deep（深度监听）</li></ul><p>当监听 <code>ref</code> 类型时：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">watch</span>(state, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`原值为<span class="subst">$&#123;oldValue&#125;</span>`</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`新值为<span class="subst">$&#123;newValue&#125;</span>`</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">/* 1秒后打印结果：</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            原值为0</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            新值为1</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">            */</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 1秒后将state值+1</span></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">value</span> ++</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>当监听 <code>reactive</code> 类型时：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;<span class="attr">count</span>: <span class="number">0</span>&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">watch</span>(<span class="function">() =&gt;</span> state.<span class="property">count</span>, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`原值为<span class="subst">$&#123;oldValue&#125;</span>`</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`新值为<span class="subst">$&#123;newValue&#125;</span>`</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">/* 1秒后打印结果：</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            原值为0</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            新值为1</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">            */</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 1秒后将state.count的值+1</span></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            state.<span class="property">count</span> ++</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>当同时监听多个值时：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive, watch&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span> &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">watch</span>(</span></span><br><span class="line"><span class="language-javascript">            [<span class="function">() =&gt;</span> state.<span class="property">count</span>, <span class="function">() =&gt;</span> state.<span class="property">name</span>], </span></span><br><span class="line"><span class="language-javascript">            <span class="function">(<span class="params">[newCount, newName], [oldvCount, oldvName]</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(oldvCount) <span class="comment">// 旧的 count 值</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(newCount) <span class="comment">// 新的 count 值</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(oldName) <span class="comment">// 旧的 name 值</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(newvName) <span class="comment">// 新的 name 值</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        )</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          state.<span class="property">count</span> ++</span></span><br><span class="line"><span class="language-javascript">          state.<span class="property">name</span> = <span class="string">&#x27;ls&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>因为 <code>watch</code> 方法的第一个参数我们已经指定了监听的对象，因此当组件初始化时，不会执行第二个参数中的回调函数，若我们想让其初始化时就先执行一遍，可以在第三个参数对象中设置 <code>immediate: true</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch` 方法默认是渐层的监听我们指定的数据，例如如果监听的数据有多层嵌套，深层的数据变化不会触发监听的回调，若我们想要其对深层数据也进行监听，可以在第三个参数对象中设置 `deep: true</span><br></pre></td></tr></table></figure><blockquote><p><strong>补充：</strong> watch方法会返回一个stop方法，若想要停止监听，便可直接执行该stop函数</p></blockquote><hr><p>接下来再来聊聊 <code>watchEffect</code>，它与 <code>watch</code> 的区别主要有以下几点：</p><ol><li>不需要手动传入依赖</li><li>每次初始化时会执行一次回调函数来自动获取依赖</li><li>无法获取到原值，只能得到变化后的值</li></ol><p>来看一下该方法如何使用：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;reactive, watchEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span> &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">count</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">name</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">/*  初始化时打印：</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            0</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            zs</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                1秒后打印：</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            1</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            ls</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">            */</span></span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          state.<span class="property">count</span> ++</span></span><br><span class="line"><span class="language-javascript">          state.<span class="property">name</span> = <span class="string">&#x27;ls&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>从上述代码中可以看出，我们并没有像 <code>watch</code> 方法一样先给其传入一个依赖，而是直接指定了一个回调函数</p><p>当组件初始化时，将该回调函数执行一次，自动获取到需要检测的数据是 <code>state.count</code> 和 <code>state.name</code></p><p>根据以上特征，我们可以自行选择使用哪一个监听器</p><h2 id="（13）getCurrentInstance"><a href="#（13）getCurrentInstance" class="headerlink" title="（13）getCurrentInstance"></a>（13）getCurrentInstance</h2><p>我们都知道在Vue2的任何一个组件中想要获取当前组件的实例可以通过 <code>this</code> 来得到，而在Vue3中我们大量的代码都在 <code>setup</code> 函数中运行，并且在该函数中 <code>this</code> 指向的是 <code>undefined</code>，那么该如何获取到当前组件的实例呢？</p><p>这时可以用到另一个方法，即 <code>getCurrentInstance</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; num &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;ref, getCurrentInstance&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> num = <span class="title function_">ref</span>(<span class="number">3</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> instance = <span class="title function_">getCurrentInstance</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(instance)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;num&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们来看一下其打印结果</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 因为 <code>instance</code> 包含的内容太多，所以没截完整，但是主要的内容都在图上了，我们重点来看一下 <code>ctx</code> 和 <code>proxy</code>，因为这两个才是我们想要的 <code>this</code> 的内容</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) ![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 可以看到 <code>ctx</code> 和 <code>proxy</code> 的内容十分类似，只是后者相对于前者外部包装了一层 <code>proxy</code>，由此可说明 <code>proxy</code> 是响应式的</p><h2 id="（14）useStore"><a href="#（14）useStore" class="headerlink" title="（14）useStore"></a>（14）useStore</h2><p>在Vue2中使用 Vuex，我们都是通过 <code>this.$store</code> 来与获取到Vuex实例，但上一部分说了原本Vue2中的 <code>this</code> 的获取方式不一样了，并且我们在Vue3的 <code>getCurrentInstance().ctx</code> 中也没有发现 <code>$store</code> 这个属性，那么如何获取到Vuex实例呢？这就要通过 <code>vuex</code> 中的一个方法了，即 <code>useStore</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store 文件夹下的 index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vuex</span> <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title class_">Vuex</span>.<span class="title function_">createStore</span>(&#123;</span><br><span class="line">    <span class="attr">state</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;前端印象&#x27;</span>,</span><br><span class="line">        <span class="attr">age</span>: <span class="number">22</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">mutations</span>: &#123;</span><br><span class="line">        ……</span><br><span class="line">    &#125;,</span><br><span class="line">    ……</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// example.vue</span></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">// 从 vuex 中导入 useStore 方法</span></span><br><span class="line"><span class="keyword">import</span> &#123;useStore&#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 获取 vuex 实例</span></span><br><span class="line">        <span class="keyword">const</span> store = <span class="title function_">useStore</span>()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(store)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们来看一下打印结果</p><p>![在这里插入图片描述](data:image&#x2F;svg+xml;utf8,<?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="800" height="600"></svg>) 然后接下来就可以像之前一样正常使用 <code>vuex</code> 了</p><h2 id="（15）获取标签元素"><a href="#（15）获取标签元素" class="headerlink" title="（15）获取标签元素"></a>（15）获取标签元素</h2><p>最后再补充一个 <code>ref</code> 另外的作用，那就是可以获取到标签元素或组件</p><p>在Vue2中，我们获取元素都是通过给元素一个 <code>ref</code> 属性，然后通过 <code>this.$refs.xx</code> 来访问的，但这在Vue3中已经不再适用了</p><p>接下来看看Vue3中是如何获取元素的吧</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;el&quot;</span>&gt;</span>div元素<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 创建一个DOM引用，名称必须与元素的ref属性名相同</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> el = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 在挂载后才能通过 el 获取到目标元素</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        el.<span class="property">value</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;内容被修改&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 把创建的引用 return 出去</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;el&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>获取元素的操作一共分为以下几个步骤：</p><ol><li>先给目标元素的 <code>ref</code> 属性设置一个值，假设为 <code>el</code></li><li>然后在 <code>setup</code> 函数中调用 <code>ref</code> 函数，值为 <code>null</code>，并赋值给变量 <code>el</code>，这里要注意，该变量名必须与我们给元素设置的 <code>ref</code> 属性名相同</li><li>把对元素的引用变量 <code>el</code> 返回（return）出去</li></ol><blockquote><p><strong>补充</strong>：设置的元素引用变量只有在组件挂载后才能访问到，因此在挂载前对元素进行操作都是无效的</p></blockquote><p>当然如果我们引用的是一个组件元素，那么获得的将是该组件的实例对象，这里就不做过多的演示了</p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>el-table 虚拟滚动</title>
      <link href="/hisai3.github.io/2023/01/14/el-table%20%E8%99%9A%E6%8B%9F%E6%BB%9A%E5%8A%A8/"/>
      <url>/hisai3.github.io/2023/01/14/el-table%20%E8%99%9A%E6%8B%9F%E6%BB%9A%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h4 id="el-table-虚拟滚动"><a href="#el-table-虚拟滚动" class="headerlink" title="el-table 虚拟滚动"></a>el-table 虚拟滚动</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-table</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:data</span>=<span class="string">&quot;tableData&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">&quot;tableRef&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;width: 900px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">max-height</span>=<span class="string">&quot;380&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">border</span></span></span><br><span class="line"><span class="tag">      <span class="attr">stripe</span></span></span><br><span class="line"><span class="tag">      <span class="attr">row-key</span>=<span class="string">&quot;customIndex&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;myTable&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">expand-change</span>=<span class="string">&quot;expendRow&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:expand-row-keys</span>=<span class="string">&quot;expendArrs&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:tree-props</span>=<span class="string">&quot;&#123; children: &#x27;children&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">        <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">label</span>=<span class="string">&quot;必要元素：&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">min-width</span>=<span class="string">&quot;150&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fixed</span>=<span class="string">&quot;left&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;每一行高度必须相同&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">          <span class="attr">prop</span>=<span class="string">&quot;date&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">label</span>=<span class="string">&quot;class不能为【myTable】&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">min-width</span>=<span class="string">&quot;180&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;ref不能为【tableRef】&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;province&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;省份&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">min-width</span>=<span class="string">&quot;150&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;city&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;市区&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">min-width</span>=<span class="string">&quot;150&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prop</span>=<span class="string">&quot;address&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">label</span>=<span class="string">&quot;地址&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">min-width</span>=<span class="string">&quot;150&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span> <span class="attr">fixed</span>=<span class="string">&quot;right&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;160&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;mini&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableData</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">saveDATA</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">expendArrs</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableRef</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableWarp</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fixLeft</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fixRight</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableFixedLeft</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableFixedRight</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">scrollTop</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">num</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">start</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">end</span>: <span class="number">42</span>, <span class="comment">// 3倍的pageList</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">starts</span>: <span class="number">0</span>, <span class="comment">// 备份[保持与上一样]</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">ends</span>: <span class="number">42</span>, <span class="comment">// 备份[保持与上一样]</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">pageList</span>: <span class="number">14</span>, <span class="comment">// 一屏显示</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">itemHeight</span>: <span class="number">53</span>, <span class="comment">// 每一行高度</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">timeOut</span>: <span class="number">0</span>, <span class="comment">// 延迟</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">len</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">setConfig</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">len</span> &lt;= <span class="variable language_">this</span>.<span class="property">ends</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">drawTable</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableRef</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="variable language_">this</span>.<span class="property">onScroll</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 默认配置</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setConfig</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> aa = <span class="string">&#x27;max-height&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> bodyHeight = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="property">bodyHeight</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> height = (bodyHeight.<span class="property">height</span> || <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;px&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> maxHeight = (bodyHeight[<span class="string">&#x27;max-height&#x27;</span>] || <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;px&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// const height = this.height || this.maxHeight || this.$refs.tableRef.bodyHeight</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> viewHeight = (height || maxHeight) * <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;tHead.offsetHeight--&gt;&gt;&gt;&gt;&#x27;</span>, viewHeight)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">pageList</span> = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(viewHeight / <span class="variable language_">this</span>.<span class="property">itemHeight</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">end</span> = <span class="variable language_">this</span>.<span class="property">pageList</span> * <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">ends</span> = <span class="variable language_">this</span>.<span class="property">pageList</span> * <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">init</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">drawTable</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableRef</span> = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="property">bodyWrapper</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableFixedLeft</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;.el-table .el-table__fixed .el-table__fixed-body-wrapper&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableFixedRight</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;.el-table .el-table__fixed-right .el-table__fixed-body-wrapper&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * fixed-left | 主体 | fixed-right</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       */</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 主体改造</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> divWarpPar = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      divWarpPar.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> divWarpChild = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      divWarpChild.<span class="property">className</span> = <span class="string">&#x27;fix-warp&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      divWarpChild.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">tableRef</span>.<span class="property">children</span>[<span class="number">0</span>])</span></span><br><span class="line"><span class="language-javascript">      divWarpPar.<span class="title function_">append</span>(divWarpChild)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableRef</span>.<span class="title function_">append</span>(divWarpPar)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// left改造</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> divLeftPar = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      divLeftPar.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> divLeftChild = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      divLeftChild.<span class="property">className</span> = <span class="string">&#x27;fix-left&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableFixedLeft</span> &amp;&amp;</span></span><br><span class="line"><span class="language-javascript">      divLeftChild.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">tableFixedLeft</span>.<span class="property">children</span>[<span class="number">0</span>])</span></span><br><span class="line"><span class="language-javascript">      divLeftPar.<span class="title function_">append</span>(divLeftChild)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableFixedLeft</span>.<span class="title function_">append</span>(divLeftPar)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// right改造</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> divRightPar = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      divRightPar.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> divRightChild = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      divRightChild.<span class="property">className</span> = <span class="string">&#x27;fix-right&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableFixedRight</span> &amp;&amp;</span></span><br><span class="line"><span class="language-javascript">      divRightChild.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">tableFixedRight</span>.<span class="property">children</span>[<span class="number">0</span>])</span></span><br><span class="line"><span class="language-javascript">      divRightPar.<span class="title function_">append</span>(divRightChild)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableFixedRight</span>.<span class="title function_">append</span>(divRightPar)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">divWarpPar</span> = divWarpPar</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">divLeftPar</span> = divLeftPar</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">divRightPar</span> = divRightPar</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 被设置的transform元素</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableWarp</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;.el-table .el-table__body-wrapper .fix-warp&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">fixLeft</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;.el-table .el-table__fixed .el-table__fixed-body-wrapper .fix-left&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">fixRight</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;.el-table .el-table__fixed-right .el-table__fixed-body-wrapper .fix-right&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">init</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> rows = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">100</span>).<span class="title function_">fill</span>(<span class="number">0</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> (&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: i,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">id</span>: i + <span class="string">&quot;10&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">children</span>: [],</span></span><br><span class="line"><span class="language-javascript">      &#125;));</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">saveDATA</span> = [</span></span><br><span class="line"><span class="language-javascript">        ...rows,</span></span><br><span class="line"><span class="language-javascript">        ...[</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">date</span>: <span class="string">&quot;2016-05-02&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&quot;王小虎1&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">address</span>: <span class="string">&quot;江路 1518 弄&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">customIndex</span>: <span class="string">&quot;1&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">children</span>: [</span></span><br><span class="line"><span class="language-javascript">              &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">name</span>: <span class="string">&quot;233&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">customIndex</span>: <span class="string">&quot;1.1&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">children</span>: [&#123; <span class="attr">name</span>: <span class="string">&quot;9&quot;</span>, <span class="attr">customIndex</span>: <span class="string">&quot;1.1.1&quot;</span> &#125;],</span></span><br><span class="line"><span class="language-javascript">              &#125;,</span></span><br><span class="line"><span class="language-javascript">              &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">name</span>: <span class="string">&quot;7771&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">customIndex</span>: <span class="string">&quot;1.2&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">children</span>: [</span></span><br><span class="line"><span class="language-javascript">                  &#123; <span class="attr">name</span>: <span class="string">&quot;9&quot;</span>, <span class="attr">customIndex</span>: <span class="string">&quot;1.2.1&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                  &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>: <span class="string">&quot;9&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">customIndex</span>: <span class="string">&quot;1.2.2&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                  &#125;,</span></span><br><span class="line"><span class="language-javascript">                ],</span></span><br><span class="line"><span class="language-javascript">              &#125;,</span></span><br><span class="line"><span class="language-javascript">            ],</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">id</span>: <span class="string">&quot;2&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">date</span>: <span class="string">&quot;2016-05-04&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">name</span>: <span class="string">&quot;王小虎2&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">address</span>: <span class="string">&quot;上海市普&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">customIndex</span>: <span class="string">&quot;2&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">children</span>: [],</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">        ],</span></span><br><span class="line"><span class="language-javascript">      ];</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">setIndex</span>(<span class="variable language_">this</span>.<span class="property">saveDATA</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">clacTree</span>(<span class="variable language_">this</span>.<span class="property">start</span>, <span class="variable language_">this</span>.<span class="property">end</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onScroll</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">scrollTop</span> = <span class="variable language_">this</span>.<span class="property">tableRef</span>.<span class="property">scrollTop</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">num</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="variable language_">this</span>.<span class="property">scrollTop</span> / (<span class="variable language_">this</span>.<span class="property">itemHeight</span> * <span class="variable language_">this</span>.<span class="property">pageList</span>))</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setIndex</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> queue = [...data];</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> loop = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">expendArrs</span> = [];</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">listLen</span> = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">len</span> = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">while</span> (queue.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        loop++;</span></span><br><span class="line"><span class="language-javascript">        [...queue].<span class="title function_">forEach</span>(<span class="function">(<span class="params">child, i</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          queue.<span class="title function_">shift</span>();</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">len</span>++;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (loop == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            child.<span class="property">customIndex</span> = i + <span class="number">1</span> + <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            child.<span class="property">currentIndex</span> = i;</span></span><br><span class="line"><span class="language-javascript">            child.<span class="property">path</span> = i;</span></span><br><span class="line"><span class="language-javascript">            child.<span class="property">pid</span> = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (child.<span class="property">children</span> &amp;&amp; child.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            child.<span class="property">dataType</span> = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">for</span> (<span class="keyword">let</span> ci = <span class="number">0</span>; ci &lt; child.<span class="property">children</span>.<span class="property">length</span>; ci++) &#123;</span></span><br><span class="line"><span class="language-javascript">              child.<span class="property">children</span>[ci].<span class="property">currentIndex</span> = ci;</span></span><br><span class="line"><span class="language-javascript">              child.<span class="property">children</span>[ci].<span class="property">customIndex</span> =</span></span><br><span class="line"><span class="language-javascript">                  child.<span class="property">customIndex</span> + <span class="string">&quot;.&quot;</span> + (ci + <span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">              child.<span class="property">children</span>[ci].<span class="property">path</span> = child.<span class="property">path</span> + <span class="string">&quot;.children.&quot;</span> + ci;</span></span><br><span class="line"><span class="language-javascript">              child.<span class="property">children</span>[ci].<span class="property">pid</span> = child.<span class="property">customIndex</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            queue.<span class="title function_">push</span>(...child.<span class="property">children</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            child.<span class="property">dataType</span> = <span class="number">2</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          child.<span class="property">expended</span> = child.<span class="property">expended</span> || <span class="string">&quot;true&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (child.<span class="property">expended</span> === <span class="string">&quot;true&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">expendArrs</span>.<span class="title function_">push</span>(child.<span class="property">customIndex</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// console.log(this.expendArrs);</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">clacTree</span>(<span class="params">start, end</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> count = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableData</span> = [];</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params">arr</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">          count++;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (count &gt;= start &amp;&amp; count &lt;= start + end) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">combineArr</span>(_.<span class="title function_">cloneDeep</span>(arr[i]));</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          arr[i].<span class="property">children</span> &amp;&amp; arr[i].<span class="property">expended</span> === <span class="string">&quot;true&quot;</span> &amp;&amp; <span class="title function_">fn</span>(arr[i].<span class="property">children</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">saveDATA</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">combineArr</span>(<span class="params">node</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> flag = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">      node.<span class="property">children</span> = [];</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params">arr</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (node.<span class="property">pid</span> === v.<span class="property">customIndex</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            v.<span class="property">children</span>.<span class="title function_">push</span>(node);</span></span><br><span class="line"><span class="language-javascript">            flag = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          v.<span class="property">children</span> &amp;&amp; <span class="title function_">fn</span>(v.<span class="property">children</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">tableData</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!flag) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">tableData</span>.<span class="title function_">push</span>(node);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">expendRow</span>(<span class="params">rows, expended</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 重新计算总高度</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> count = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">DFS_Array</span>([rows], <span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        v.<span class="property">expended</span> = <span class="title class_">String</span>(expended);</span></span><br><span class="line"><span class="language-javascript">        count++</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      count--</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">len</span> = expended ? <span class="variable language_">this</span>.<span class="property">len</span> + count : <span class="variable language_">this</span>.<span class="property">len</span> - count</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!expended) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> index = <span class="variable language_">this</span>.<span class="property">expendArrs</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">id</span>) =&gt;</span> id == rows.<span class="property">customIndex</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">expendArrs</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">expendArrs</span>.<span class="title function_">push</span>(rows.<span class="property">customIndex</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">divWarpPar</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">divLeftPar</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">divRightPar</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">DFS_Array</span>(<span class="params">arr, fn</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fn</span>(arr[i]);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (arr[i].<span class="property">children</span> &amp;&amp; arr[i].<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">DFS_Array</span>(arr[i].<span class="property">children</span>, fn);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">num</span>: <span class="keyword">function</span>(<span class="params">newV</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (newV &gt; <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">start</span> = (newV - <span class="number">1</span>) * <span class="variable language_">this</span>.<span class="property">pageList</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">end</span> = (newV + <span class="number">2</span>) * <span class="variable language_">this</span>.<span class="property">pageList</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> transform = <span class="string">`translateY(<span class="subst">$&#123;<span class="variable language_">this</span>.start * <span class="variable language_">this</span>.itemHeight&#125;</span>px)`</span></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">tableWarp</span>.<span class="property">style</span>.<span class="property">transform</span> = transform</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fixLeft</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fixLeft</span>.<span class="property">style</span>.<span class="property">transform</span> = transform</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fixRight</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fixRight</span>.<span class="property">style</span>.<span class="property">transform</span> = transform</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">clacTree</span>(<span class="variable language_">this</span>.<span class="property">start</span>, <span class="variable language_">this</span>.<span class="property">end</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// this.tableData = this.saveDATA.slice(this.start, this.end)</span></span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="variable language_">this</span>.<span class="property">timeOut</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">clacTree</span>(<span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">ends</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// this.tableData = this.saveDATA.slice(this.starts, this.ends)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">tableWarp</span>.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateY(0px)`</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fixLeft</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fixLeft</span>.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateY(0px)`</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fixRight</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fixRight</span>.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateY(0px)`</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="variable language_">this</span>.<span class="property">timeOut</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="封装为组件"><a href="#封装为组件" class="headerlink" title="封装为组件"></a>封装为组件</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;virtual-table&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:style</span>=<span class="string">&quot;wrapStyle&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">&quot;tableRef&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:data</span>=<span class="string">&quot;tableData&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:border</span>=<span class="string">&quot;border&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:stripe</span>=<span class="string">&quot;stripe&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:row-key</span>=<span class="string">&quot;rowKey&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:height</span>=<span class="string">&quot;height&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:max-height</span>=<span class="string">&quot;cMaxHeight&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:expand-row-keys</span>=<span class="string">&quot;expendArrs&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:highlight-current-row</span>=<span class="string">&quot;highlightCurrentRow&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:header-cell-style</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="string"><span class="tag">        background: &#x27;#F2F4FA&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">        &#x27;text-align&#x27;: &#x27;center&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">        fontSize:&#x27;14px&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">        color:&#x27;#6B7491&#x27;,</span></span></span><br><span class="line"><span class="string"><span class="tag">        fontWeight:&#x27;Bold&#x27;</span></span></span><br><span class="line"><span class="string"><span class="tag">      &#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cell-style</span>=<span class="string">&quot;&#123; height: itemHeight + &#x27;px&#x27;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:cell-class-name</span>=<span class="string">&quot;cellClassName&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:size</span>=<span class="string">&quot;size&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:tree-props</span>=<span class="string">&quot;treeProps&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:row-class-name</span>=<span class="string">&quot;rowClassName&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">select-all</span>=<span class="string">&quot;handleSelectionAllChange&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">selection-change</span>=<span class="string">&quot;handleSelectChange&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">select</span>=<span class="string">&quot;handleSelect&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">cell-click</span>=<span class="string">&quot;cellClick&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">expand-change</span>=<span class="string">&quot;expandRow&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-on</span>=<span class="string">&quot;cListeners&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-if</span>=<span class="string">&quot;hasSelection&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;selection&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">width</span>=<span class="string">&quot;55&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">reserve-selection</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fixed</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-if</span>=<span class="string">&quot;hasIndex&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;index&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">width</span>=<span class="string">&quot;60&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">label</span>=<span class="string">&quot;序号&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fixed</span></span></span><br><span class="line"><span class="tag">        <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span>&#123;&#123; scope.row.customIndex &#125;&#125;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-for</span>=<span class="string">&quot;item in columnData&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:key</span>=<span class="string">&quot;item.prop&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:prop</span>=<span class="string">&quot;item.prop&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:label</span>=<span class="string">&quot;item.label&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:align</span>=<span class="string">&quot;item.align || &#x27;center&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:fixed</span>=<span class="string">&quot;item.fixed&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:width</span>=<span class="string">&quot;item.width&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:min-width</span>=<span class="string">&quot;item.minWidth&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:show-overflow-tooltip</span>=<span class="string">&quot;!currentCell[item.prop] &amp;&amp; item.tooltip&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class-name</span>=<span class="string">&quot;cClassName(item)&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;header&quot;</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">slot</span> <span class="attr">:name</span>=<span class="string">&quot;item.prop + &#x27;-header&#x27;&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; item.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;template slot=&quot;header&quot; slot-scope=&quot;&quot;&gt;&lt;/template&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;&#123; row: sRow &#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">component</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:is</span>=<span class="string">&quot;item.editMode.editType&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-if</span>=<span class="string">&quot;canEdit(item) &amp;&amp; currentCell[item.prop] === sRow[rowKey]&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:ref</span>=<span class="string">&quot;&#x27;comp&#x27; + sRow[rowKey]&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-model</span>=<span class="string">&quot;sRow[cModelProp(item)]&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">style</span>=<span class="string">&quot;width:100%&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-bind</span>=<span class="string">&quot;item.editMode.config&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">filterable</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">blur</span>=<span class="string">&quot;cancelEdit(item.editMode.editType)&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">visible-change</span>=<span class="string">&quot;visibleChange(sRow[cModelProp(item)], item.editMode.config, $event)&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">visibleChange</span>=<span class="string">&quot;visibleChange(sRow[cModelProp(item)], item.editMode.config, $event)&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">selectChange</span>=<span class="string">&quot;targetOptionsChange(sRow, item, $event)&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">change</span>=<span class="string">&quot;targetOptionsChange(sRow, item, $event)&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-option</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-for</span>=<span class="string">&quot;sitem in item.options&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:key</span>=<span class="string">&quot;sitem.value&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:value</span>=<span class="string">&quot;sitem.value&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:label</span>=<span class="string">&quot;sitem.label&quot;</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">            <span class="attr">v-show</span>=<span class="string">&quot;currentCell[item.prop] !== sRow[rowKey]&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:class</span>=<span class="string">&quot;[&#x27;text-ellipsis&#x27;, item.className || &#x27;&#x27;]&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">slot</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:name</span>=<span class="string">&quot;item.prop&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-bind</span>=<span class="string">&quot;&#123; row: sRow, props: item.prop, column: item &#125;&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">              &#123;&#123; getValueText(sRow, item) &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> portalSelectTree <span class="keyword">from</span> <span class="string">&#x27;@/components/portalSelectTree&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">ScrollSelect</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/ScrollSelect&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">PreCondition</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/preCondition&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; cloneDeep &#125; <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; dfs &#125; <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;ElVirtualTable&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    portalSelectTree,</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">ScrollSelect</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">PreCondition</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">defaultExpandAll</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">showSummary</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">highlightCurrentRow</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">hasSelection</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">hasIndex</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">columnData</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> []</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> []</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">multiple</span>: &#123; <span class="comment">// 是否多选</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">size</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="string">&#x27;small&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">border</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">stripe</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">rowKey</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="string">&#x27;customIndex&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">height</span>: &#123; <span class="comment">// 高度</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">maxHeight</span>: &#123; <span class="comment">// 最大高度</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">itemHeight</span>: &#123; <span class="comment">// 每一行高度</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="number">45</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">cacheNum</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">headerCellStyle</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">treeProps</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123; <span class="attr">children</span>: <span class="string">&#x27;children&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">cellClassName</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Function</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">load</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Function</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">rowClassName</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Function</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">beforeEdit</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Function</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableData</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">expendArrs</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableRef</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableWarp</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fixLeft</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fixRight</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableFixedLeft</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">tableFixedRight</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">scrollTop</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">num</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">start</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">end</span>: <span class="number">42</span>, <span class="comment">// 3倍的pageList</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">starts</span>: <span class="number">0</span>, <span class="comment">// 备份[保持与上一样]</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">ends</span>: <span class="number">42</span>, <span class="comment">// 备份[保持与上一样]</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">pageList</span>: <span class="number">14</span>, <span class="comment">// 一屏显示</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">timeOut</span>: <span class="number">1000</span> / <span class="number">60</span>, <span class="comment">// 延迟</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">len</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">dom</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fresh</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">menuVisible</span>: <span class="literal">false</span>, <span class="comment">// 菜单显示</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">row</span>: &#123;&#125;, <span class="comment">// 当前行</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">column</span>: &#123;&#125;, <span class="comment">// 当前列</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">notActions</span>: [], <span class="comment">// 没有编辑状态的数据</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">selectsOptions</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">currentState</span>: &#123;&#125;, <span class="comment">// 当前点击行的状态</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">resize</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">currentCell</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">selection</span>: [],</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">cHeight</span>: <span class="literal">null</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">cMaxHeight</span>: <span class="literal">null</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">cListeners</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> keyMap = [</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;select-all&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;selection-change&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;select&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;cell-click&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;expand-change&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      ]</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> listeners = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="variable language_">this</span>.<span class="property">$listeners</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!keyMap.<span class="title function_">includes</span>(key)) &#123;</span></span><br><span class="line"><span class="language-javascript">          listeners[key] = <span class="variable language_">this</span>.<span class="property">$listeners</span>[key]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> listeners</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">cSelection</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> selected = []</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">selection</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">dfs</span>(<span class="variable language_">this</span>.<span class="property">data</span>, <span class="function"><span class="params">row</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (row[<span class="variable language_">this</span>.<span class="property">rowKey</span>] === item[<span class="variable language_">this</span>.<span class="property">rowKey</span>]) &#123;</span></span><br><span class="line"><span class="language-javascript">            selected.<span class="title function_">push</span>(row)</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> selected</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">wrapStyle</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">height</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">maxHeight</span> ? &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">height</span>: <span class="string">&#x27;100%&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125; : &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">height</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.height || <span class="variable language_">this</span>.maxHeight&#125;</span>px`</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">cClassName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">col</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="string">`flex-align-center flex-just-<span class="subst">$&#123;col.align || <span class="string">&#x27;center&#x27;</span>&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">cModelProp</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> <span class="function">(<span class="params">col</span>) =&gt;</span> col.<span class="property">model</span> || col.<span class="property">prop</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">async</span> <span class="title function_">handler</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">await</span> <span class="variable language_">this</span>.$nextTick()</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// this.$refs.tableRef.clearSelection()</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">init</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// this.drawTable()</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">deep</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="title function_">len</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">await</span> <span class="variable language_">this</span>.$nextTick()</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">calcHeight</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">num</span>(<span class="params">newV</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (newV &gt; <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">start</span> = (newV - <span class="number">1</span>) * <span class="variable language_">this</span>.<span class="property">pageList</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">end</span> = (newV + <span class="number">2</span>) * <span class="variable language_">this</span>.<span class="property">pageList</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> transform = <span class="string">`translateY(<span class="subst">$&#123;<span class="variable language_">this</span>.start * <span class="variable language_">this</span>.itemHeight&#125;</span>px)`</span></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">tableWarp</span>.<span class="property">style</span>.<span class="property">transform</span> = transform</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fixLeft</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fixLeft</span>.<span class="property">style</span>.<span class="property">transform</span> = transform</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fixRight</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fixRight</span>.<span class="property">style</span>.<span class="property">transform</span> = transform</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">calcTree</span>(<span class="variable language_">this</span>.<span class="property">start</span>, <span class="variable language_">this</span>.<span class="property">end</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// this.tableData = this.data.slice(this.start, this.end)</span></span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="variable language_">this</span>.<span class="property">timeOut</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">calcTree</span>(<span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">ends</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// this.tableData = this.saveDATA.slice(this.starts, this.ends)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">tableWarp</span>.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateY(0px)`</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fixLeft</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fixLeft</span>.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateY(0px)`</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">fixRight</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">fixRight</span>.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">`translateY(0px)`</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="variable language_">this</span>.<span class="property">timeOut</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">async</span> <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">await</span> <span class="variable language_">this</span>.$nextTick()</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">setConfig</span>()</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">this</span>.<span class="title function_">drawTable</span>()</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    dfs,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 默认配置</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="title function_">setConfig</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">height</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">maxHeight</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> wrap = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.virtual-table&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">cMaxHeight</span> = wrap.<span class="property">offsetHeight</span></span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">cMaxHeight</span> = <span class="variable language_">this</span>.<span class="property">maxHeight</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 高度和最大高度必须传一个 maxHeight 和 height 同时传入会以 maxHeight 为主</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">await</span> <span class="variable language_">this</span>.$nextTick()</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> bodyHeight = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="property">bodyHeight</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> height = (bodyHeight.<span class="property">height</span> || <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;px&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> maxHeight = (bodyHeight[<span class="string">&#x27;max-height&#x27;</span>] || <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(<span class="string">&#x27;px&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> viewHeight = (height || maxHeight) * <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">pageList</span> = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(viewHeight / <span class="variable language_">this</span>.<span class="property">itemHeight</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">end</span> = <span class="variable language_">this</span>.<span class="property">pageList</span> * <span class="variable language_">this</span>.<span class="property">cacheNum</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">ends</span> = <span class="variable language_">this</span>.<span class="property">pageList</span> * <span class="variable language_">this</span>.<span class="property">cacheNum</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// console.log(&#x27;newVHeight--&gt;&gt;&gt;&gt;&#x27;, viewHeight)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// console.log(&#x27;bodyHeight--&gt;&gt;&gt;&gt;&#x27;, this.$refs.tableRef)</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">drawTable</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// if (this.len &lt;= this.ends) return</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableRef</span> = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="property">bodyWrapper</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableFixedLeft</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;.el-table .el-table__fixed .el-table__fixed-body-wrapper&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableFixedRight</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;.el-table .el-table__fixed-right .el-table__fixed-body-wrapper&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableRef</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">isBindScroll</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">tableRef</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="variable language_">this</span>.<span class="property">onScroll</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       * fixed-left | 主体 | fixed-right</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">       */</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 主体改造</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> divWarpPar = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      divWarpPar.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> divWarpChild = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      divWarpChild.<span class="property">className</span> = <span class="string">&#x27;fix-warp&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      divWarpChild.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">tableRef</span>.<span class="property">children</span>[<span class="number">0</span>])</span></span><br><span class="line"><span class="language-javascript">      divWarpPar.<span class="title function_">append</span>(divWarpChild)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableRef</span>.<span class="title function_">append</span>(divWarpPar)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">divWarpPar</span> = divWarpPar</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// left改造</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">tableFixedLeft</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> divLeftPar = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        divLeftPar.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> divLeftChild = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        divLeftChild.<span class="property">className</span> = <span class="string">&#x27;fix-left&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">tableFixedLeft</span> &amp;&amp;</span></span><br><span class="line"><span class="language-javascript">        divLeftChild.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">tableFixedLeft</span>.<span class="property">children</span>[<span class="number">0</span>])</span></span><br><span class="line"><span class="language-javascript">        divLeftPar.<span class="title function_">append</span>(divLeftChild)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">tableFixedLeft</span>.<span class="title function_">append</span>(divLeftPar)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">divLeftPar</span> = divLeftPar</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// right改造</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">tableFixedRight</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> divRightPar = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        divRightPar.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> divRightChild = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        divRightChild.<span class="property">className</span> = <span class="string">&#x27;fix-right&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">tableFixedRight</span> &amp;&amp;</span></span><br><span class="line"><span class="language-javascript">        divRightChild.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">tableFixedRight</span>.<span class="property">children</span>[<span class="number">0</span>])</span></span><br><span class="line"><span class="language-javascript">        divRightPar.<span class="title function_">append</span>(divRightChild)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">tableFixedRight</span>.<span class="title function_">append</span>(divRightPar)</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">divRightPar</span> = divRightPar</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 被设置的transform元素</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableWarp</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;.el-table .el-table__body-wrapper .fix-warp&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">fixLeft</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;.el-table .el-table__fixed .el-table__fixed-body-wrapper .fix-left&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">fixRight</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;.el-table .el-table__fixed-right .el-table__fixed-body-wrapper .fix-right&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      )</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">init</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">setIndex</span>(<span class="variable language_">this</span>.<span class="property">data</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">calcTree</span>(<span class="variable language_">this</span>.<span class="property">start</span>, <span class="variable language_">this</span>.<span class="property">end</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onScroll</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">isBindScroll</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">scrollTop</span> = <span class="variable language_">this</span>.<span class="property">tableRef</span>.<span class="property">scrollTop</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">num</span> = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="variable language_">this</span>.<span class="property">scrollTop</span> / (<span class="variable language_">this</span>.<span class="property">itemHeight</span> * <span class="variable language_">this</span>.<span class="property">pageList</span>))</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setIndex</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> queue = [...data]</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">expendArrs</span> = []</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">len</span> = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      queue.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        item.<span class="property">pid</span> = <span class="string">&#x27;0&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">while</span> (queue.<span class="property">length</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> row = queue.<span class="title function_">shift</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">len</span>++</span></span><br><span class="line"><span class="language-javascript">        row.<span class="property">customIndex</span> = <span class="variable language_">this</span>.<span class="property">len</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> children = row.<span class="property">children</span> || []</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> ci = <span class="number">0</span>; ci &lt; children.<span class="property">length</span>; ci++) &#123;</span></span><br><span class="line"><span class="language-javascript">          children[ci].<span class="property">pid</span> = row[<span class="variable language_">this</span>.<span class="property">rowKey</span>]</span></span><br><span class="line"><span class="language-javascript">          children[ci].<span class="property">loop</span> = row.<span class="property">loop</span> + <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        queue.<span class="title function_">unshift</span>(...children)</span></span><br><span class="line"><span class="language-javascript">        row.<span class="property">expended</span> = row.<span class="property">expended</span> || <span class="string">&#x27;true&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (row.<span class="property">expended</span> === <span class="string">&#x27;true&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">expendArrs</span>.<span class="title function_">push</span>(row[<span class="variable language_">this</span>.<span class="property">rowKey</span>])</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">calcTree</span>(<span class="params">start, end</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> count = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">tableData</span> = []</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&#x27;aa&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params">arr</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span></span><br><span class="line"><span class="language-javascript">          count++</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (count &gt;= start &amp;&amp; count &lt;= end) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">combineArr</span>(<span class="title function_">cloneDeep</span>(arr[i]))</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          arr[i].<span class="property">children</span> &amp;&amp; arr[i].<span class="property">expended</span> === <span class="string">&#x27;true&#x27;</span> &amp;&amp; <span class="title function_">fn</span>(arr[i].<span class="property">children</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">data</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">selectionEcho</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&#x27;aa&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">combineArr</span>(<span class="params">node</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> flag = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">      node.<span class="property">children</span> = []</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params">arr</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (node.<span class="property">pid</span> === v[<span class="variable language_">this</span>.<span class="property">rowKey</span>]) &#123;</span></span><br><span class="line"><span class="language-javascript">            v.<span class="property">children</span>.<span class="title function_">push</span>(node)</span></span><br><span class="line"><span class="language-javascript">            flag = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          v.<span class="property">children</span> &amp;&amp; <span class="title function_">fn</span>(v.<span class="property">children</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">fn</span>(<span class="variable language_">this</span>.<span class="property">tableData</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!flag) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">tableData</span>.<span class="title function_">push</span>(node)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 选中回显</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="title function_">selectionEcho</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">await</span> <span class="variable language_">this</span>.$nextTick()</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">dfs</span>(<span class="variable language_">this</span>.<span class="property">tableData</span>, <span class="function"><span class="params">row</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> selected = <span class="variable language_">this</span>.<span class="property">selection</span>.<span class="title function_">find</span>(<span class="function"><span class="params">item</span> =&gt;</span> item[<span class="variable language_">this</span>.<span class="property">rowKey</span>] === row[<span class="variable language_">this</span>.<span class="property">rowKey</span>])</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">toggleRowSelection</span>(row, !!selected)</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">calcHeight</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">divWarpPar</span>) <span class="variable language_">this</span>.<span class="property">divWarpPar</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">divLeftPar</span>) <span class="variable language_">this</span>.<span class="property">divLeftPar</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">divRightPar</span>) <span class="variable language_">this</span>.<span class="property">divRightPar</span>.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">len</span> * <span class="variable language_">this</span>.<span class="property">itemHeight</span> + <span class="string">&#x27;px&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">expandRow</span>(<span class="params">rows, expended</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 重新计算总高度</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> count = <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">dfs</span>([rows], <span class="function">(<span class="params">v</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        v.<span class="property">expended</span> = <span class="title class_">String</span>(expended)</span></span><br><span class="line"><span class="language-javascript">        count++</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">      count--</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">len</span> = expended ? <span class="variable language_">this</span>.<span class="property">len</span> + count : <span class="variable language_">this</span>.<span class="property">len</span> - count</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!expended) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> index = <span class="variable language_">this</span>.<span class="property">expendArrs</span>.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">id</span>) =&gt;</span> id === rows[<span class="variable language_">this</span>.<span class="property">rowKey</span>])</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">expendArrs</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">expendArrs</span>.<span class="title function_">push</span>(rows[<span class="variable language_">this</span>.<span class="property">rowKey</span>])</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">calcHeight</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">doLayout</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="title function_">doLayout</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">setCurrentRow</span>(<span class="params">row</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="title function_">setCurrentRow</span>(row)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">toggleRowSelection</span>(<span class="params">row, status</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="title function_">toggleRowSelection</span>(row, status)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">clearSelection</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="title function_">clearSelection</span>()</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">selection</span> = []</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 编辑 弹窗消失</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">visibleChange</span>(<span class="params">value, props, val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!props.<span class="property">mutliple</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!val) <span class="variable language_">this</span>.<span class="property">currentCell</span> = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (!val &amp;&amp; value.<span class="property">length</span>) <span class="variable language_">this</span>.<span class="property">currentCell</span> = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 取消编辑</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">cancelEdit</span>(<span class="params">type</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (type === <span class="string">&#x27;el-select&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">currentCell</span> = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 下拉框改变值</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">targetOptionsChange</span>(<span class="params">row, column, value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">changeFun</span>(value, column, row)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 修改表单元素的值</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">changeFun</span>(<span class="params">value, column, row</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 去空格</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>) value = value.<span class="title function_">replace</span>(<span class="regexp">/^\s+|\s*$/g</span>, <span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 设置值</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> ro = row</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">dfs</span>(<span class="variable language_">this</span>.<span class="property">data</span>, <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (item[<span class="variable language_">this</span>.<span class="property">rowKey</span>] === row[<span class="variable language_">this</span>.<span class="property">rowKey</span>]) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.$set(item, <span class="variable language_">this</span>.<span class="title function_">cModelProp</span>(column), value)</span></span><br><span class="line"><span class="language-javascript">          ro = item</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 隐藏输入框</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!column.<span class="property">editMode</span>.<span class="property">config</span>.<span class="property">mutliple</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">currentCell</span> = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;editChange&#x27;</span>, &#123; <span class="attr">prop</span>: column.<span class="property">prop</span>, <span class="attr">row</span>: ro, value &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleSelectChange</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this.calc--&gt;&gt;&gt;&gt;&#x27;</span>, <span class="variable language_">this</span>.<span class="property">selection</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;selection-change&#x27;</span>, <span class="variable language_">this</span>.<span class="property">cSelection</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleSelectionAllChange</span>(<span class="params">val</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;select-all--&gt;&gt;&gt;&gt;&#x27;</span>, val)</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">selection</span> = val</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;select-all&#x27;</span>, <span class="variable language_">this</span>.<span class="property">cSelection</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleSelect</span>(<span class="params">val, row</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">hasSelection</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">multiple</span>) &#123; <span class="comment">// 如果是多选的情况</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">selection</span> = val</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果是单选的情况</span></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;单选--&gt;&gt;&gt;&gt;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="title function_">clearSelection</span>()</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (val.<span class="property">length</span> === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">selection</span> = []</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">tableRef</span>.<span class="title function_">toggleRowSelection</span>(row, <span class="literal">true</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">selection</span> = [row]</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;select&#x27;</span>, <span class="variable language_">this</span>.<span class="property">cSelection</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 单元格是否可编辑</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">canEdit</span>(<span class="params">column</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> column.<span class="property">editMode</span> &amp;&amp; column.<span class="property">editMode</span>.<span class="property">edit</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 点击单元格</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">async</span> <span class="title function_">cellClick</span>(<span class="params">row, column, cell, event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> currentIndex = <span class="variable language_">this</span>.<span class="property">tableData</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">v</span> =&gt;</span> v[<span class="variable language_">this</span>.<span class="property">rowKey</span>] === row[<span class="variable language_">this</span>.<span class="property">rowKey</span>])</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">currentState</span> = &#123;</span></span><br><span class="line"><span class="language-javascript">        row,</span></span><br><span class="line"><span class="language-javascript">        column,</span></span><br><span class="line"><span class="language-javascript">        currentIndex</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;cell-click&#x27;</span>, row, column, cell, event)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> col = &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">dfs</span>(<span class="variable language_">this</span>.<span class="property">columnData</span>, <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (column.<span class="property">property</span> === item.<span class="property">prop</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          col = item</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">beforeEdit</span>(&#123; row, column, cell, event &#125;)) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">canEdit</span>(col)) <span class="keyword">return</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 记录当前点击的单元格 property - id</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">currentCell</span> = &#123; [column.<span class="property">property</span>]: row[<span class="variable language_">this</span>.<span class="property">rowKey</span>] &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">await</span> <span class="variable language_">this</span>.$nextTick()</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> components = <span class="variable language_">this</span>.<span class="property">$refs</span>[<span class="string">`comp<span class="subst">$&#123;row[<span class="variable language_">this</span>.rowKey]&#125;</span>`</span>]</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> id = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> c = <span class="title class_">Array</span>.<span class="title function_">isArray</span>(components) ? components[<span class="number">0</span>] : components</span></span><br><span class="line"><span class="language-javascript">        c.<span class="property">focus</span> &amp;&amp; c.<span class="title function_">focus</span>()</span></span><br><span class="line"><span class="language-javascript">        c.<span class="property">doShow</span> &amp;&amp; c.<span class="title function_">doShow</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">clearTimeout</span>(id)</span></span><br><span class="line"><span class="language-javascript">      &#125;, <span class="number">0</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getLabel</span>(<span class="params">options, value, props = &#123; key: <span class="string">&#x27;value&#x27;</span>, label: <span class="string">&#x27;label&#x27;</span> &#125;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// return</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!options || options.<span class="property">length</span> === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> target = options.<span class="title function_">find</span>(<span class="function"><span class="params">v</span> =&gt;</span> v[props.<span class="property">key</span>] === value) || &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> target[props.<span class="property">label</span>] || <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">getValueText</span>(<span class="params">row, column</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> label = row[<span class="variable language_">this</span>.<span class="title function_">cModelProp</span>(column)]</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (column.<span class="property">format</span> &amp;&amp; <span class="keyword">typeof</span> column.<span class="property">format</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> column.<span class="title function_">format</span>(row, column, label)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> canEdit = <span class="variable language_">this</span>.<span class="title function_">canEdit</span>(column)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!canEdit) <span class="keyword">return</span> label</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (column.<span class="property">editMode</span>.<span class="property">editType</span> === <span class="string">&#x27;el-select&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        label = <span class="variable language_">this</span>.<span class="title function_">getLabel</span>(column.<span class="property">options</span>, label)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (column.<span class="property">editMode</span>.<span class="property">editType</span> === <span class="string">&#x27;portalSelectTree&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        label = label &amp;&amp; label.<span class="property">length</span> ? label.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">nodeName</span>).<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>) : <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (column.<span class="property">editMode</span>.<span class="property">editType</span> === <span class="string">&#x27;ScrollSelect&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        label = label &amp;&amp; label.<span class="property">length</span> ? label.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">aliasName</span>).<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>) : <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> label</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">/deep/ <span class="selector-class">.text-ellipsis</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-overflow</span>: ellipsis;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">white-space</span>: nowrap;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">/deep/ <span class="selector-class">.flex-align-center</span> <span class="selector-class">.cell</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">/deep/ <span class="selector-class">.flex-just-left</span> <span class="selector-class">.cell</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: left;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">/deep/ <span class="selector-class">.flex-just-center</span> <span class="selector-class">.cell</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">/deep/ <span class="selector-class">.flex-just-right</span> <span class="selector-class">.cell</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: right;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>使用</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 不支持多表头 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ElVirtualTable</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">&quot;singleTable&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:data</span>=<span class="string">&quot;tableData&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:column-data</span>=<span class="string">&quot;columns&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:row-class-name</span>=<span class="string">&quot;tableRowClassName&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:before-edit</span>=<span class="string">&quot;beforeEdit&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:height</span>=<span class="string">&quot;tableHeight&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">border</span></span></span><br><span class="line"><span class="tag">      <span class="attr">has-selection</span></span></span><br><span class="line"><span class="tag">      <span class="attr">row-key</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">selection-change</span>=<span class="string">&quot;handleSelectionChange&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">current-change</span>=<span class="string">&quot;currentObj&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">row-click</span>=<span class="string">&quot;clickTableRow&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">editChange</span>=<span class="string">&quot;columnChange&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;status !== &#x27;find&#x27;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-for</span>=<span class="string">&quot;col in columns&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:slot</span>=<span class="string">&quot;col.prop + &#x27;-header&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:key</span>=<span class="string">&quot;col.prop&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;col.required&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          &#123;&#123; col.label &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 右键菜单 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;menu&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-for</span>=<span class="string">&quot;(item, index7) in menus&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">:key</span>=<span class="string">&quot;index7&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;menu&quot;</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">click.stop</span>=<span class="string">&quot;infoClick(item)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          &#123;&#123; item &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ElVirtualTable</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="colomns"><a href="#colomns" class="headerlink" title="colomns"></a>colomns</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历树</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">dfs</span>(<span class="params">arr, fn</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> stack = [...arr]</span><br><span class="line">  <span class="keyword">while</span> (stack.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> item = stack.<span class="title function_">shift</span>()</span><br><span class="line">    <span class="keyword">if</span> (fn &amp;&amp; <span class="title function_">fn</span>(item)) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">children</span> &amp;&amp; item.<span class="property">children</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      stack.<span class="title function_">unshift</span>(...item.<span class="property">children</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取组件编辑模式 设置了常用的几个组件属性，可通过config传入修改</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; type: input/select/date/selectPerson/workOrderType/preCondition</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; config: 组件 prop</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> <span class="variable">editMode</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getEditMode</span>(<span class="params">type, config = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> modeMap = &#123;</span><br><span class="line">    <span class="attr">input</span>: &#123;</span><br><span class="line">      <span class="attr">edit</span>: <span class="literal">true</span>, <span class="comment">// 必须为true 才能编辑</span></span><br><span class="line">      <span class="attr">editType</span>: <span class="string">&#x27;el-input&#x27;</span>,</span><br><span class="line">      <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="attr">size</span>: <span class="string">&#x27;mini&#x27;</span>,</span><br><span class="line">        <span class="attr">mutliple</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">placeholder</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">select</span>: &#123;</span><br><span class="line">      <span class="attr">edit</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">editType</span>: <span class="string">&#x27;el-select&#x27;</span>,</span><br><span class="line">      <span class="attr">regList</span>: [</span><br><span class="line">        &#123; <span class="attr">pattern</span>: <span class="string">&#x27;required&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;不能为空！&#x27;</span> &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">editMethods</span>: <span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">      <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="attr">size</span>: <span class="string">&#x27;mini&#x27;</span>,</span><br><span class="line">        <span class="attr">clearable</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">placeholder</span>: <span class="string">&#x27;请选择结算类型&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">date</span>: &#123;</span><br><span class="line">      <span class="attr">edit</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">editType</span>: <span class="string">&#x27;el-date-picker&#x27;</span>,</span><br><span class="line">      <span class="attr">editMethods</span>: <span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">      <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="attr">size</span>: <span class="string">&#x27;mini&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">        <span class="attr">clearable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">placeholder</span>: <span class="string">&#x27;选择日期&#x27;</span>,</span><br><span class="line">        <span class="attr">format</span>: <span class="string">&#x27;yyyy-MM-dd&#x27;</span>,</span><br><span class="line">        <span class="attr">valueFormat</span>: <span class="string">&#x27;yyyy-MM-dd&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">selectPerson</span>: &#123;</span><br><span class="line">      <span class="attr">edit</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">editType</span>: <span class="string">&#x27;ScrollSelect&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>: [],</span><br><span class="line">      <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="attr">size</span>: <span class="string">&#x27;mini&#x27;</span>,</span><br><span class="line">        <span class="attr">clearable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">mutliple</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">placeholder</span>: <span class="string">&#x27;请输入相关负责人工号&#x27;</span>,</span><br><span class="line">        <span class="attr">getDataApi</span>: getFindUserDO</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">workOrderType</span>: &#123;</span><br><span class="line">      <span class="attr">edit</span>: <span class="literal">true</span>, <span class="comment">// 能否编辑</span></span><br><span class="line">      <span class="attr">editType</span>: <span class="string">&#x27;portalSelectTree&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: [],</span><br><span class="line">      <span class="attr">editMethods</span>: <span class="string">&#x27;click&#x27;</span>,</span><br><span class="line">      <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="attr">size</span>: <span class="string">&#x27;mini&#x27;</span>,</span><br><span class="line">        <span class="attr">clearable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">placeholder</span>: <span class="string">&#x27;工单类型&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">preCondition</span>: &#123;</span><br><span class="line">      <span class="attr">edit</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">editType</span>: <span class="string">&#x27;PreCondition&#x27;</span>,</span><br><span class="line">      <span class="attr">config</span>: &#123;</span><br><span class="line">        <span class="attr">planId</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> mode = modeMap[type]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!mode) <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  mode.<span class="property">config</span> = &#123;</span><br><span class="line">    ...mode.<span class="property">config</span>,</span><br><span class="line">    ...config</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> mode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> columns = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;工单名称&#x27;</span>,</span><br><span class="line">    <span class="attr">prop</span>: <span class="string">&#x27;taskName&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;250&#x27;</span>,</span><br><span class="line">    <span class="attr">tooltip</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">fixed</span>: <span class="string">&#x27;fixed&#x27;</span>,</span><br><span class="line">    <span class="attr">align</span>: <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">    <span class="attr">editMode</span>: <span class="title function_">getEditMode</span>(<span class="string">&#x27;input&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;工单类型&#x27;</span>,</span><br><span class="line">    <span class="attr">prop</span>: <span class="string">&#x27;workOrderType&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;200&#x27;</span>,</span><br><span class="line">    <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">tooltip</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">model</span>: <span class="string">&#x27;workOrderTypeList&#x27;</span>,</span><br><span class="line">    <span class="attr">editMode</span>: <span class="title function_">getEditMode</span>(<span class="string">&#x27;workOrderType&#x27;</span>),</span><br><span class="line">    <span class="title function_">format</span>(<span class="params">row, column</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = column.<span class="property">editMode</span>.<span class="property">config</span>.<span class="property">data</span> || []</span><br><span class="line">      <span class="keyword">let</span> label = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">if</span> (row.<span class="property">workOrderType</span>) &#123;</span><br><span class="line">        <span class="title function_">dfs</span>(data, <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (item.<span class="property">nodeId</span> === row.<span class="property">workOrderType</span>) &#123;</span><br><span class="line">            label = item.<span class="property">nodeName</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> label</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;结算类型&#x27;</span>,</span><br><span class="line">    <span class="attr">prop</span>: <span class="string">&#x27;settlementType&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;120&#x27;</span>,</span><br><span class="line">    <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">tooltip</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">editMode</span>: <span class="title function_">getEditMode</span>(<span class="string">&#x27;select&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;前置条件&#x27;</span>,</span><br><span class="line">    <span class="attr">prop</span>: <span class="string">&#x27;workPreconditionRecordList&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;200&#x27;</span>,</span><br><span class="line">    <span class="attr">tooltip</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">editMode</span>: <span class="title function_">getEditMode</span>(<span class="string">&#x27;preCondition&#x27;</span>),</span><br><span class="line">    <span class="attr">format</span>: <span class="keyword">function</span> (<span class="params">row, column, value</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> label = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">if</span> (!value || !value.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      value.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        label +=</span><br><span class="line">          item.<span class="property">preconditionName</span> +</span><br><span class="line">          <span class="string">&#x27; &#x27;</span> +</span><br><span class="line">          <span class="string">&#x27;完成 延期&#x27;</span> +</span><br><span class="line">          item.<span class="property">day</span> +</span><br><span class="line">          <span class="string">&#x27;天则开始 &#x27;</span> +</span><br><span class="line">          item.<span class="property">preconditionRelation</span> +</span><br><span class="line">          <span class="string">&#x27; &#x27;</span> +</span><br><span class="line">          item.<span class="property">otherPreconditionRelation</span> +</span><br><span class="line">          <span class="string">&#x27; &#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> label</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;责任人&#x27;</span>,</span><br><span class="line">    <span class="attr">prop</span>: <span class="string">&#x27;executorName&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;120&#x27;</span>,</span><br><span class="line">    <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">model</span>: <span class="string">&#x27;executorNameList&#x27;</span>,</span><br><span class="line">    <span class="attr">editMode</span>: <span class="title function_">getEditMode</span>(<span class="string">&#x27;selectPerson&#x27;</span>),</span><br><span class="line">    <span class="attr">format</span>: <span class="function">(<span class="params">row</span>) =&gt;</span> row.<span class="property">executorName</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">label</span>: <span class="string">&#x27;计划开始时间&#x27;</span>,</span><br><span class="line">    <span class="attr">prop</span>: <span class="string">&#x27;beginTime&#x27;</span>,</span><br><span class="line">    <span class="attr">width</span>: <span class="string">&#x27;160&#x27;</span>,</span><br><span class="line">    <span class="attr">editMode</span>: <span class="title function_">getEditMode</span>(<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue UI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> element UI </tag>
            
            <tag> el-table </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uni-app的基本使用</title>
      <link href="/hisai3.github.io/2023/01/14/uniapp/"/>
      <url>/hisai3.github.io/2023/01/14/uniapp/</url>
      
        <content type="html"><![CDATA[<h5 id="uni-app介绍-官方网页"><a href="#uni-app介绍-官方网页" class="headerlink" title="uni-app介绍 官方网页"></a>uni-app介绍 <a href="https://uniapp.dcloud.io/resource">官方网页</a></h5><p><code>uni-app</code> 是一个使用 <a href="https://vuejs.org/">Vue.js</a> 开发所有前端应用的框架，开发者编写一套代码，可发布到iOS、Android、H5、以及各种小程序（微信&#x2F;支付宝&#x2F;百度&#x2F;头条&#x2F;QQ&#x2F;钉钉）等多个平台。</p><p>即使不跨端，<code>uni-app</code>同时也是更好的小程序开发框架。</p><p>具有vue和微信小程序的开发经验，可快速上手uni-app</p><h5 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h5><p>安装编辑器HbuilderX  <a href="https://www.dcloud.io/hbuilderx.html">下载地址</a></p><p>HBuilderX是通用的前端开发工具，但为<code>uni-app</code>做了特别强化。</p><p>下载App开发版，可开箱即用</p><p>安装微信开发者工具 <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">下载地址</a></p><h5 id="利用HbuilderX初始化项目"><a href="#利用HbuilderX初始化项目" class="headerlink" title="利用HbuilderX初始化项目"></a>利用HbuilderX初始化项目</h5><p><a href="https://uniapp.dcloud.net.cn/quickstart-hx.html">项目创建</a></p><ul><li><p>点击HbuilderX菜单栏文件&gt;项目&gt;新建</p></li><li><p>选择uni-app,填写项目名称，项目创建的目录</p></li></ul><h5 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h5><p>在菜单栏中点击运行，运行到浏览器，选择浏览器即可运行</p><p>在微信开发者工具里运行：进入hello-uniapp项目，点击工具栏的运行 -&gt; 运行到小程序模拟器 -&gt; 微信开发者工具，即可在微信开发者工具里面体验uni-app</p><p>在微信开发者工具里运行：进入hello-uniapp项目，点击工具栏的运行 -&gt; 运行到手机或模拟器 -&gt; 选择调式的手机</p><p><strong>注意：</strong></p><ul><li>如果是第一次使用，需要先配置小程序ide的相关路径，才能运行成功</li><li>微信开发者工具在设置中安全设置，服务端口开启</li></ul><h5 id="介绍项目目录和文件作用"><a href="#介绍项目目录和文件作用" class="headerlink" title="介绍项目目录和文件作用"></a>介绍项目目录和文件作用</h5><p><code>pages.json</code> 文件用来对 uni-app 进行全局配置，决定页面文件的路径、窗口样式、原生的导航栏、底部的原生tabbar 等</p><p><code>manifest.json</code> 文件是应用的配置文件，用于指定应用的名称、图标、权限等。</p><p><code>App.vue</code>是我们的跟组件，所有页面都是在<code>App.vue</code>下进行切换的，是页面入口文件，可以调用应用的生命周期函数。</p><p><code>main.js</code>是我们的项目入口文件，主要作用是初始化<code>vue</code>实例并使用需要的插件。</p><p><code>uni.scss</code>文件的用途是为了方便整体控制应用的风格。比如按钮颜色、边框风格，<code>uni.scss</code>文件里预置了一批scss变量预置。</p><figure class="highlight plaintext"><figcaption><span>就是打包目录，在这里有各个平台的打包文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```pages``` 所有的页面存放目录</span><br><span class="line"></span><br><span class="line">```static``` 静态资源目录，例如图片等</span><br><span class="line"></span><br><span class="line">```components``` 组件存放目录</span><br><span class="line"></span><br><span class="line">为了实现多端兼容，综合考虑编译速度、运行性能等因素，`uni-app` 约定了如下开发规范：</span><br><span class="line"></span><br><span class="line">- 页面文件遵循 [Vue 单文件组件 (SFC) 规范](https://vue-loader.vuejs.org/zh/spec.html)</span><br><span class="line">- 组件标签靠近小程序规范，详见[uni-app 组件规范](https://uniapp.dcloud.io/component/README)</span><br><span class="line">- 接口能力（JS API）靠近微信小程序规范，但需将前缀 `wx` 替换为 `uni`，详见[uni-app接口规范](https://uniapp.dcloud.io/api/README)</span><br><span class="line">- 数据绑定及事件处理同 `Vue.js` 规范，同时补充了App及页面的生命周期</span><br><span class="line">- 为兼容多端运行，建议使用flex布局进行开发</span><br><span class="line"></span><br><span class="line">#### 全局配置和页面配置</span><br><span class="line"></span><br><span class="line">##### 通过globalStyle进行全局配置</span><br><span class="line"></span><br><span class="line">用于设置应用的状态栏、导航条、标题、窗口背景色等。[详细文档](https://uniapp.dcloud.io/collocation/pages?id=globalstyle)</span><br><span class="line"></span><br><span class="line">| 属性                           | 类型       | 默认值     | 描述                                       |</span><br><span class="line">| ---------------------------- | -------- | ------- | ---------------------------------------- |</span><br><span class="line">| navigationBarBackgroundColor | HexColor | #F7F7F7 | 导航栏背景颜色（同状态栏背景色）                         |</span><br><span class="line">| navigationBarTextStyle       | String   | white   | 导航栏标题颜色及状态栏前景颜色，仅支持 black/white          |</span><br><span class="line">| navigationBarTitleText       | String   |         | 导航栏标题文字内容                                |</span><br><span class="line">| backgroundColor              | HexColor | #ffffff | 窗口的背景色                                   |</span><br><span class="line">| backgroundTextStyle          | String   | dark    | 下拉 loading 的样式，仅支持 dark / light          |</span><br><span class="line">| enablePullDownRefresh        | Boolean  | false   | 是否开启下拉刷新，详见[页面生命周期](https://uniapp.dcloud.io/use?id=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f)。 |</span><br><span class="line">| onReachBottomDistance        | Number   | 50      | 页面上拉触底事件触发时距页面底部距离，单位只支持px，详见[页面生命周期](https://uniapp.dcloud.io/use?id=%e9%a1%b5%e9%9d%a2%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f) |</span><br><span class="line"></span><br><span class="line">##### 创建新的message页面</span><br><span class="line"></span><br><span class="line">右键pages新建message目录，在message目录下右键新建.vue文件,并选择基本模板</span><br><span class="line"></span><br><span class="line">```html</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;view&gt;</span><br><span class="line">这是信息页面</span><br><span class="line">&lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h5 id="通过pages来配置页面"><a href="#通过pages来配置页面" class="headerlink" title="通过pages来配置页面"></a>通过pages来配置页面</h5><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>path</td><td>String</td><td></td><td>配置页面路径</td></tr><tr><td>style</td><td>Object</td><td></td><td>配置页面窗口表现，配置项参考 <a href="https://uniapp.dcloud.io/collocation/pages?id=style">pageStyle</a></td></tr></tbody></table><p>pages数组数组中第一项表示应用启动页</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;pages&quot;: [ 、</span><br><span class="line">&#123;</span><br><span class="line">&quot;path&quot;:&quot;pages/message/message&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;path&quot;: &quot;pages/index/index&quot;,</span><br><span class="line">&quot;style&quot;: &#123;</span><br><span class="line">&quot;navigationBarTitleText&quot;: &quot;uni-app&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>通过style修改页面的标题和导航栏背景色，并且设置h5下拉刷新的特有样式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;pages&quot;</span>: [ <span class="comment">//pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;path&quot;</span>:<span class="string">&quot;pages/message/message&quot;</span>,</span><br><span class="line"><span class="string">&quot;style&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#007AFF&quot;</span>,</span><br><span class="line"><span class="string">&quot;navigationBarTextStyle&quot;</span>: <span class="string">&quot;white&quot;</span>,</span><br><span class="line"><span class="string">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;disableScroll&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;h5&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;pullToRefresh&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;color&quot;</span>: <span class="string">&quot;#007AFF&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h5 id="配置tabbar"><a href="#配置tabbar" class="headerlink" title="配置tabbar"></a>配置tabbar</h5><p>如果应用是一个多 tab 应用，可以通过 tabBar 配置项指定 tab 栏的表现，以及 tab 切换时显示的对应页。</p><p><strong>Tips</strong></p><ul><li>当设置 position 为 top 时，将不会显示 icon</li><li>tabBar 中的 list 是一个数组，只能配置最少2个、最多5个 tab，tab 按数组的顺序排序。</li></ul><p><strong>属性说明：</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>默认值</th><th>描述</th><th>平台差异说明</th></tr></thead><tbody><tr><td>color</td><td>HexColor</td><td>是</td><td></td><td>tab 上的文字默认颜色</td><td></td></tr><tr><td>selectedColor</td><td>HexColor</td><td>是</td><td></td><td>tab 上的文字选中时的颜色</td><td></td></tr><tr><td>backgroundColor</td><td>HexColor</td><td>是</td><td></td><td>tab 的背景色</td><td></td></tr><tr><td>borderStyle</td><td>String</td><td>否</td><td>black</td><td>tabbar 上边框的颜色，仅支持 black&#x2F;white</td><td>App 2.3.4+ 支持其他颜色值</td></tr><tr><td>list</td><td>Array</td><td>是</td><td></td><td>tab 的列表，详见 list 属性说明，最少2个、最多5个 tab</td><td></td></tr><tr><td>position</td><td>String</td><td>否</td><td>bottom</td><td>可选值 bottom、top</td><td>top 值仅微信小程序支持</td></tr></tbody></table><p>其中 list 接收一个数组，数组中的每个项都是一个对象，其属性值如下：</p><table><thead><tr><th>属性</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>pagePath</td><td>String</td><td>是</td><td>页面路径，必须在 pages 中先定义</td></tr><tr><td>text</td><td>String</td><td>是</td><td>tab 上按钮文字，在 5+APP 和 H5 平台为非必填。例如中间可放一个没有文字的+号图标</td></tr><tr><td>iconPath</td><td>String</td><td>否</td><td>图片路径，icon 大小限制为40kb，建议尺寸为 81px * 81px，当 postion 为 top 时，此参数无效，不支持网络图片，不支持字体图标</td></tr><tr><td>selectedIconPath</td><td>String</td><td>否</td><td>选中时的图片路径，icon 大小限制为40kb，建议尺寸为 81px * 81px ，当 postion 为 top 时，此参数无效</td></tr></tbody></table><p>案例代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;tabBar&quot;</span>: &#123;</span><br><span class="line"><span class="string">&quot;list&quot;</span>: [</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;text&quot;</span>: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line"><span class="string">&quot;pagePath&quot;</span>:<span class="string">&quot;pages/index/index&quot;</span>,</span><br><span class="line"><span class="string">&quot;iconPath&quot;</span>:<span class="string">&quot;static/tabs/home.png&quot;</span>,</span><br><span class="line"><span class="string">&quot;selectedIconPath&quot;</span>:<span class="string">&quot;static/tabs/home-active.png&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;text&quot;</span>: <span class="string">&quot;信息&quot;</span>,</span><br><span class="line"><span class="string">&quot;pagePath&quot;</span>:<span class="string">&quot;pages/message/message&quot;</span>,</span><br><span class="line"><span class="string">&quot;iconPath&quot;</span>:<span class="string">&quot;static/tabs/message.png&quot;</span>,</span><br><span class="line"><span class="string">&quot;selectedIconPath&quot;</span>:<span class="string">&quot;static/tabs/message-active.png&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;text&quot;</span>: <span class="string">&quot;我们&quot;</span>,</span><br><span class="line"><span class="string">&quot;pagePath&quot;</span>:<span class="string">&quot;pages/contact/contact&quot;</span>,</span><br><span class="line"><span class="string">&quot;iconPath&quot;</span>:<span class="string">&quot;static/tabs/contact.png&quot;</span>,</span><br><span class="line"><span class="string">&quot;selectedIconPath&quot;</span>:<span class="string">&quot;static/tabs/contact-active.png&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="condition启动模式配置"><a href="#condition启动模式配置" class="headerlink" title="condition启动模式配置"></a>condition启动模式配置</h5><p>启动模式配置，仅开发期间生效，用于模拟直达页面的场景，如：小程序转发后，用户点击所打开的页面。</p><p><strong>属性说明：</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>是否必填</th><th>描述</th></tr></thead><tbody><tr><td>current</td><td>Number</td><td>是</td><td>当前激活的模式，list节点的索引值</td></tr><tr><td>list</td><td>Array</td><td>是</td><td>启动模式列表</td></tr></tbody></table><p><strong>list说明：</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>是否必填</th><th>描述</th></tr></thead><tbody><tr><td>name</td><td>String</td><td>是</td><td>启动模式名称</td></tr><tr><td>path</td><td>String</td><td>是</td><td>启动页面路径</td></tr><tr><td>query</td><td>String</td><td>否</td><td>启动参数，可在页面的 <a href="https://uniapp.dcloud.io/use?id=%E9%A1%B5%E9%9D%A2%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">onLoad</a> 函数里获得</td></tr></tbody></table><h4 id="组件的基本使用"><a href="#组件的基本使用" class="headerlink" title="组件的基本使用"></a>组件的基本使用</h4><p>uni-app提供了丰富的基础组件给开发者，开发者可以像搭积木一样，组合各种组件拼接称自己的应用</p><p>uni-app中的组件，就像 <code>HTML</code> 中的 <code>div</code> 、<code>p</code>、<code>span</code> 等标签的作用一样，用于搭建页面的基础结构</p><h5 id="text文本组件的用法"><a href="#text文本组件的用法" class="headerlink" title="text文本组件的用法"></a>text文本组件的用法</h5><h6 id="001-text-组件的属性"><a href="#001-text-组件的属性" class="headerlink" title="001 - text 组件的属性"></a>001 - text 组件的属性</h6><table><thead><tr><th align="center">属性</th><th align="center">类型</th><th align="center">默认值</th><th align="center">必填</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">selectable</td><td align="center">boolean</td><td align="center">false</td><td align="center">否</td><td align="center">文本是否可选</td></tr><tr><td align="center">space</td><td align="center">string</td><td align="center">.</td><td align="center">否</td><td align="center">显示连续空格，可选参数：<code>ensp</code>、<code>emsp</code>、<code>nbsp</code></td></tr><tr><td align="center">decode</td><td align="center">boolean</td><td align="center">false</td><td align="center">否</td><td align="center">是否解码</td></tr></tbody></table><ul><li><code>text</code> 组件相当于行内标签、在同一行显示</li><li>除了文本节点以外的其他节点都无法长按选中</li></ul><h6 id="002-代码案例"><a href="#002-代码案例" class="headerlink" title="002 - 代码案例"></a>002 - 代码案例</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 长按文本是否可选 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">selectable</span>=<span class="string">&#x27;true&#x27;</span>&gt;</span>来了老弟<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 显示连续空格的方式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&#x27;ensp&#x27;</span>&gt;</span>来了  老弟<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&#x27;emsp&#x27;</span>&gt;</span>来了  老弟<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&#x27;nbsp&#x27;</span>&gt;</span>来了  老弟<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>skyblue<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 是否解码 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">decode</span>=<span class="string">&#x27;true&#x27;</span>&gt;</span><span class="symbol">&amp;nbsp;</span> <span class="symbol">&amp;lt;</span> <span class="symbol">&amp;gt;</span> <span class="symbol">&amp;amp;</span> <span class="symbol">&amp;apos;</span> <span class="symbol">&amp;ensp;</span> <span class="symbol">&amp;emsp;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="view视图容器组件的用法"><a href="#view视图容器组件的用法" class="headerlink" title="view视图容器组件的用法"></a>view视图容器组件的用法</h5><blockquote><p>View 视图容器， 类似于 HTML 中的 div</p></blockquote><h6 id="001-组件的属性"><a href="#001-组件的属性" class="headerlink" title="001 - 组件的属性"></a>001 - 组件的属性</h6><p><img src="/hisai3.github.io/./images/2view.png"></p><h6 id="002-代码案例-1"><a href="#002-代码案例-1" class="headerlink" title="002 - 代码案例"></a>002 - 代码案例</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;box2_active&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&#x27;box1&#x27;</span> <span class="attr">hover-class</span>=<span class="string">&#x27;active&#x27;</span> <span class="attr">hover-stop-propagation</span> <span class="attr">:hover-start-time</span>=<span class="string">&quot;2000&quot;</span> <span class="attr">:hover-stay-time</span>=<span class="string">&#x27;2000&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="button按钮组件的用法"><a href="#button按钮组件的用法" class="headerlink" title="button按钮组件的用法"></a>button按钮组件的用法</h5><h6 id="001-组件的属性-1"><a href="#001-组件的属性-1" class="headerlink" title="001 - 组件的属性"></a>001 - 组件的属性</h6><table><thead><tr><th align="center">属性名</th><th align="center">类型</th><th align="center">默认值</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">size</td><td align="center">String</td><td align="center">default</td><td align="center">按钮的大小</td></tr><tr><td align="center">type</td><td align="center">String</td><td align="center">default</td><td align="center">按钮的样式类型</td></tr><tr><td align="center">plain</td><td align="center">Boolean</td><td align="center">false</td><td align="center">按钮是否镂空，背景色透明</td></tr><tr><td align="center">disabled</td><td align="center">Boolean</td><td align="center">false</td><td align="center">是否按钮</td></tr><tr><td align="center">loading</td><td align="center">Boolean</td><td align="center">false</td><td align="center">名称是否带 loading t图标</td></tr></tbody></table><ul><li><code>button</code> 组件默认独占一行，设置 <code>size</code> 为 <code>mini</code> 时可以在一行显示多个</li></ul><h6 id="002-案例代码"><a href="#002-案例代码" class="headerlink" title="002 - 案例代码"></a>002 - 案例代码</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">size</span>=<span class="string">&#x27;mini&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;primary&#x27;</span>&gt;</span>前端<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">size</span>=<span class="string">&#x27;mini&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;default&#x27;</span> <span class="attr">disabled</span>=<span class="string">&#x27;true&#x27;</span>&gt;</span>前端<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">size</span>=<span class="string">&#x27;mini&#x27;</span> <span class="attr">type</span>=<span class="string">&#x27;warn&#x27;</span> <span class="attr">loading</span>=<span class="string">&#x27;true&#x27;</span>&gt;</span>前端<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="image组件的使用"><a href="#image组件的使用" class="headerlink" title="image组件的使用"></a>image组件的使用</h5><h6 id="image"><a href="#image" class="headerlink" title="image"></a><a href="https://uniapp.dcloud.io/component/image?id=image">image</a></h6><p>图片。</p><table><thead><tr><th>属性名</th><th>类型</th><th>默认值</th><th>说明</th><th>平台差异说明</th></tr></thead><tbody><tr><td>src</td><td>String</td><td></td><td>图片资源地址</td><td></td></tr><tr><td>mode</td><td>String</td><td>‘scaleToFill’</td><td>图片裁剪、缩放的模式</td><td></td></tr></tbody></table><p><strong>Tips</strong></p><ul><li><code>&lt;image&gt;</code> 组件默认宽度 300px、高度 225px；</li><li><code>src</code> 仅支持相对路径、绝对路径，支持 base64 码；</li><li>页面结构复杂，css样式太多的情况，使用 image 可能导致样式生效较慢，出现 “闪一下” 的情况，此时设置 <code>image&#123;will-change: transform&#125;</code> ,可优化此问题。</li></ul><h4 id="uni-app中的样式"><a href="#uni-app中的样式" class="headerlink" title="uni-app中的样式"></a>uni-app中的样式</h4><ul><li><p>rpx 即响应式px，一种根据屏幕宽度自适应的动态单位。以750宽的屏幕为基准，750rpx恰好为屏幕宽度。屏幕变宽，rpx 实际显示效果会等比放大。</p></li><li><p>使用<code>@import</code>语句可以导入外联样式表，<code>@import</code>后跟需要导入的外联样式表的相对路径，用<code>;</code>表示语句结束</p></li><li><p>支持基本常用的选择器class、id、element等</p></li><li><p>在 <code>uni-app</code> 中不能使用 <code>*</code> 选择器。</p></li><li><p><code>page</code> 相当于 <code>body</code> 节点</p></li><li><p>定义在 App.vue 中的样式为全局样式，作用于每一个页面。在 pages 目录下 的 vue 文件中定义的样式为局部样式，只作用在对应的页面，并会覆盖 App.vue 中相同的选择器。</p></li><li><p><code>uni-app</code> 支持使用字体图标，使用方式与普通 <code>web</code> 项目相同，需要注意以下几点：</p><ul><li><p>字体文件小于 40kb，<code>uni-app</code> 会自动将其转化为 base64 格式；</p></li><li><p>字体文件大于等于 40kb， 需开发者自己转换，否则使用将不生效；</p></li><li><p>字体文件的引用路径推荐使用以 ~@ 开头的绝对路径。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@font-face &#123;</span><br><span class="line">    font-family: test1-icon;</span><br><span class="line">    src: url(&#x27;~@/static/iconfont.ttf&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>如何使用scss或者less</p></li></ul><h4 id="uni-app中的数据绑定"><a href="#uni-app中的数据绑定" class="headerlink" title="uni-app中的数据绑定"></a>uni-app中的数据绑定</h4><p>在页面中需要定义数据，和我们之前的vue一摸一样，直接在data中定义数据即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;hello-uni&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="插值表达式的使用"><a href="#插值表达式的使用" class="headerlink" title="插值表达式的使用"></a>插值表达式的使用</h5><ul><li><p>利用插值表达式渲染基本数据</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在插值表达式中使用三元运算</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123; flag ? &#x27;我是真的&#x27;:&#x27;我是假的&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>基本运算</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;1+1&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="v-bind动态绑定属性"><a href="#v-bind动态绑定属性" class="headerlink" title="v-bind动态绑定属性"></a>v-bind动态绑定属性</h5><p>在data中定义了一张图片，我们希望把这张图片渲染到页面上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&#x27;http://destiny001.gitee.io/image/monkey_02.jpg&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>利用v-bind进行渲染</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">v-bind:src</span>=<span class="string">&quot;img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure><p>还可以缩写成:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">:src</span>=<span class="string">&quot;img&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="v-for的使用"><a href="#v-for的使用" class="headerlink" title="v-for的使用"></a>v-for的使用</h5><p>data中定以一个数组，最终将数组渲染到页面上</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">arr</span>: [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;刘能&#x27;</span>, <span class="attr">age</span>: <span class="number">29</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;赵四&#x27;</span>, <span class="attr">age</span>: <span class="number">39</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;宋小宝&#x27;</span>, <span class="attr">age</span>: <span class="number">49</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;小沈阳&#x27;</span>, <span class="attr">age</span>: <span class="number">59</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>利用v-for进行循环</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;view v-<span class="keyword">for</span>=<span class="string">&quot;(item,i) in arr&quot;</span> :key=<span class="string">&quot;i&quot;</span>&gt;名字：&#123;&#123;item.<span class="property">name</span>&#125;&#125;---年龄：&#123;&#123;item.<span class="property">age</span>&#125;&#125;&lt;/view&gt;</span><br></pre></td></tr></table></figure><h4 id="uni中的事件"><a href="#uni中的事件" class="headerlink" title="uni中的事件"></a>uni中的事件</h4><h5 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h5><p>在uni中事件绑定和vue中是一样的，通过v-on进行事件的绑定，也可以简写为@</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;tapHandle&quot;</span>&gt;</span>点我啊<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>事件函数定义在methods中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  tapHandle () &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;真的点我了&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="事件传参"><a href="#事件传参" class="headerlink" title="事件传参"></a>事件传参</h5><ul><li><p>默认如果没有传递参数，事件函数第一个形参为事件对象</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// template</span><br><span class="line">&lt;button @click=&quot;tapHandle&quot;&gt;点我啊&lt;/button&gt;</span><br><span class="line">// script</span><br><span class="line">methods: &#123;</span><br><span class="line">  tapHandle (e) &#123;</span><br><span class="line">    console.log(e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如果给事件函数传递参数了，则对应的事件函数形参接收的则是传递过来的数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// template</span><br><span class="line">&lt;button @click=&quot;tapHandle(1)&quot;&gt;点我啊&lt;/button&gt;</span><br><span class="line">// script</span><br><span class="line">methods: &#123;</span><br><span class="line">  tapHandle (num) &#123;</span><br><span class="line">    console.log(num)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>如果获取事件对象也想传递参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// template</span><br><span class="line">&lt;button @click=&quot;tapHandle(1,$event)&quot;&gt;点我啊&lt;/button&gt;</span><br><span class="line">// script</span><br><span class="line">methods: &#123;</span><br><span class="line">  tapHandle (num,e) &#123;</span><br><span class="line">    console.log(num,e)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="uni的生命周期"><a href="#uni的生命周期" class="headerlink" title="uni的生命周期"></a>uni的生命周期</h4><h5 id="应用的生命周期"><a href="#应用的生命周期" class="headerlink" title="应用的生命周期"></a>应用的生命周期</h5><p>生命周期的概念：一个对象从创建、运行、销毁的整个过程被成为生命周期。</p><p>生命周期函数：在生命周期中每个阶段会伴随着每一个函数的触发，这些函数被称为生命周期函数</p><p><code>uni-app</code> 支持如下应用生命周期函数：</p><table><thead><tr><th>函数名</th><th>说明</th></tr></thead><tbody><tr><td>onLaunch</td><td>当<code>uni-app</code> 初始化完成时触发（全局只触发一次）</td></tr><tr><td>onShow</td><td>当 <code>uni-app</code> 启动，或从后台进入前台显示</td></tr><tr><td>onHide</td><td>当 <code>uni-app</code> 从前台进入后台</td></tr><tr><td>onError</td><td>当 <code>uni-app</code> 报错时触发</td></tr></tbody></table><h5 id="页面的生命周期"><a href="#页面的生命周期" class="headerlink" title="页面的生命周期"></a>页面的生命周期</h5><p><code>uni-app</code> 支持如下页面生命周期函数：</p><table><thead><tr><th>函数名</th><th>说明</th><th>平台差异说明</th><th>最低版本</th></tr></thead><tbody><tr><td>onLoad</td><td>监听页面加载，其参数为上个页面传递的数据，参数类型为Object（用于页面传参），参考<a href="https://uniapp.dcloud.io/api/router?id=navigateto">示例</a></td><td></td><td></td></tr><tr><td>onShow</td><td>监听页面显示。页面每次出现在屏幕上都触发，包括从下级页面点返回露出当前页面</td><td></td><td></td></tr><tr><td>onReady</td><td>监听页面初次渲染完成。</td><td></td><td></td></tr><tr><td>onHide</td><td>监听页面隐藏</td><td></td><td></td></tr><tr><td>onUnload</td><td>监听页面卸载</td><td></td><td></td></tr></tbody></table><h4 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h4><h5 id="开启下拉刷新"><a href="#开启下拉刷新" class="headerlink" title="开启下拉刷新"></a>开启下拉刷新</h5><p>在uni-app中有两种方式开启下拉刷新</p><ul><li>需要在 <code>pages.json</code> 里，找到的当前页面的pages节点，并在 <code>style</code> 选项中开启 <code>enablePullDownRefresh</code></li><li>通过调用uni.startPullDownRefresh方法来开启下拉刷新</li></ul><h6 id="通过配置文件开启"><a href="#通过配置文件开启" class="headerlink" title="通过配置文件开启"></a>通过配置文件开启</h6><p>创建list页面进行演示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">杭州学科</span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in arr&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">&#123;&#123;item&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">data () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">arr</span>: [<span class="string">&#x27;前端&#x27;</span>,<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;ui&#x27;</span>,<span class="string">&#x27;大数据&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过pages.json文件中找到当前页面的pages节点，并在 <code>style</code> 选项中开启 <code>enablePullDownRefresh</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;path&quot;</span>:<span class="string">&quot;pages/list/list&quot;</span>,</span><br><span class="line">    <span class="string">&quot;style&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;enablePullDownRefresh&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="通过API开启"><a href="#通过API开启" class="headerlink" title="通过API开启"></a>通过API开启</h6><p><a href="https://uniapp.dcloud.io/api/ui/pulldown">api文档</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uni.startPullDownRefresh()</span><br></pre></td></tr></table></figure><h5 id="监听下拉刷新"><a href="#监听下拉刷新" class="headerlink" title="监听下拉刷新"></a>监听下拉刷新</h5><p>通过onPullDownRefresh可以监听到下拉刷新的动作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">arr</span>: [<span class="string">&#x27;前端&#x27;</span>,<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;ui&#x27;</span>,<span class="string">&#x27;大数据&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    startPull () &#123;</span><br><span class="line">      uni.<span class="title function_">startPullDownRefresh</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  onPullDownRefresh () &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;触发下拉刷新了&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="关闭下拉刷新"><a href="#关闭下拉刷新" class="headerlink" title="关闭下拉刷新"></a>关闭下拉刷新</h5><p>uni.stopPullDownRefresh()</p><p>停止当前页面下拉刷新。</p><p>案例演示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;startPull&quot;</span>&gt;</span>开启下拉刷新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">杭州学科</span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in arr&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">&#123;&#123;item&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">data () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">arr</span>: [<span class="string">&#x27;前端&#x27;</span>,<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;ui&#x27;</span>,<span class="string">&#x27;大数据&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">startPull () &#123;</span></span><br><span class="line"><span class="language-javascript">uni.<span class="title function_">startPullDownRefresh</span>()</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">onPullDownRefresh () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">this</span>.<span class="property">arr</span> = []</span></span><br><span class="line"><span class="language-javascript"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">this</span>.<span class="property">arr</span> = [<span class="string">&#x27;前端&#x27;</span>,<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;ui&#x27;</span>,<span class="string">&#x27;大数据&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">uni.<span class="title function_">stopPullDownRefresh</span>()</span></span><br><span class="line"><span class="language-javascript">&#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="上拉加载"><a href="#上拉加载" class="headerlink" title="上拉加载"></a>上拉加载</h4><p>通过在pages.json文件中找到当前页面的pages节点下style中配置onReachBottomDistance可以设置距离底部开启加载的距离，默认为50px</p><p>通过onReachBottom监听到触底的行为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;startPull&quot;</span>&gt;</span>开启下拉刷新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">杭州学科</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in arr&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">&#123;&#123;item&#125;&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">data () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">arr</span>: [<span class="string">&#x27;前端&#x27;</span>,<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;ui&#x27;</span>,<span class="string">&#x27;大数据&#x27;</span>,<span class="string">&#x27;前端&#x27;</span>,<span class="string">&#x27;java&#x27;</span>,<span class="string">&#x27;ui&#x27;</span>,<span class="string">&#x27;大数据&#x27;</span>]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">onReachBottom () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;触底了&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">view&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="attribute">height</span>: <span class="number">100px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="attribute">line-height</span>: <span class="number">100px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h4 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h4><p>在uni中可以调用uni.request方法进行请求网络请求</p><p>需要注意的是：在小程序中网络相关的 API 在使用前需要配置域名白名单。</p><p><strong>发送get请求</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sendGet&quot;</span>&gt;</span>发送请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">sendGet () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">uni.<span class="title function_">request</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">url</span>: <span class="string">&#x27;http://localhost:8082/api/getlunbo&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">success</span>(<span class="params">res</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>发送post请求</strong></p><h4 id="数据缓存"><a href="#数据缓存" class="headerlink" title="数据缓存"></a>数据缓存</h4><h5 id="uni-setStorage"><a href="#uni-setStorage" class="headerlink" title="uni.setStorage"></a><strong>uni.setStorage</strong></h5><p><a href="https://uniapp.dcloud.io/api/storage/storage?id=setstorage">官方文档</a></p><p>将数据存储在本地缓存中指定的 key 中，会覆盖掉原来该 key 对应的内容，这是一个异步接口。</p><p>代码演示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;setStor&quot;</span>&gt;</span>存储数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">setStor () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">uni.<span class="title function_">setStorage</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="attr">key</span>: <span class="string">&#x27;id&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="attr">data</span>: <span class="number">100</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> success () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;存储成功&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h5 id="uni-setStorageSync"><a href="#uni-setStorageSync" class="headerlink" title="uni.setStorageSync"></a>uni.setStorageSync</h5><p>将 data 存储在本地缓存中指定的 key 中，会覆盖掉原来该 key 对应的内容，这是一个同步接口。</p><p>代码演示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;setStor&quot;</span>&gt;</span>存储数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">setStor () &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">uni.<span class="title function_">setStorageSync</span>(<span class="string">&#x27;id&#x27;</span>,<span class="number">100</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h5 id="uni-getStorage"><a href="#uni-getStorage" class="headerlink" title="uni.getStorage"></a>uni.getStorage</h5><p>从本地缓存中异步获取指定 key 对应的内容。</p><p>代码演示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;getStorage&quot;</span>&gt;</span>获取数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">data () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">id</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">getStorage () &#123;</span></span><br><span class="line"><span class="language-javascript">uni.<span class="title function_">getStorage</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">key</span>: <span class="string">&#x27;id&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">success</span>:  <span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">this</span>.<span class="property">id</span> = res.<span class="property">data</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="uni-getStorageSync"><a href="#uni-getStorageSync" class="headerlink" title="uni.getStorageSync"></a>uni.getStorageSync</h5><p>从本地缓存中同步获取指定 key 对应的内容。</p><p>代码演示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;getStorage&quot;</span>&gt;</span>获取数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">getStorage () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> id = uni.<span class="title function_">getStorageSync</span>(<span class="string">&#x27;id&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(id)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="uni-removeStorage"><a href="#uni-removeStorage" class="headerlink" title="uni.removeStorage"></a>uni.removeStorage</h5><p>从本地缓存中异步移除指定 key。</p><p>代码演示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;removeStorage&quot;</span>&gt;</span>删除数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">removeStorage () &#123;</span></span><br><span class="line"><span class="language-javascript">uni.<span class="title function_">removeStorage</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">key</span>: <span class="string">&#x27;id&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">success</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除成功&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="uni-removeStorageSync"><a href="#uni-removeStorageSync" class="headerlink" title="uni.removeStorageSync"></a>uni.removeStorageSync</h5><p>从本地缓存中同步移除指定 key。</p><p>代码演示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;removeStorage&quot;</span>&gt;</span>删除数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">removeStorage () &#123;</span></span><br><span class="line"><span class="language-javascript">uni.<span class="title function_">removeStorageSync</span>(<span class="string">&#x27;id&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="上传图片、预览图片"><a href="#上传图片、预览图片" class="headerlink" title="上传图片、预览图片"></a>上传图片、预览图片</h4><h5 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a>上传图片</h5><p>uni.chooseImage方法从本地相册选择图片或使用相机拍照。</p><p>案例代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;chooseImg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>上传图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">v-for</span>=<span class="string">&quot;item in imgArr&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;item&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">data () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">imgArr</span>: []</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">chooseImg () &#123;</span></span><br><span class="line"><span class="language-javascript">uni.<span class="title function_">chooseImage</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">count</span>: <span class="number">9</span>,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">success</span>: <span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">this</span>.<span class="property">imgArr</span> = res.<span class="property">tempFilePaths</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="预览图片"><a href="#预览图片" class="headerlink" title="预览图片"></a>预览图片</h5><p>结构</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">v-for</span>=<span class="string">&quot;item in imgArr&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;item&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;previewImg(item)&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>预览图片的方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">previewImg (current) &#123;</span><br><span class="line">  uni.<span class="title function_">previewImage</span>(&#123;</span><br><span class="line">    <span class="attr">urls</span>: <span class="variable language_">this</span>.<span class="property">imgArr</span>,</span><br><span class="line">    current</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="条件注释实现跨段兼容"><a href="#条件注释实现跨段兼容" class="headerlink" title="条件注释实现跨段兼容"></a>条件注释实现跨段兼容</h4><p>条件编译是用特殊的注释作为标记，在编译时根据这些特殊的注释，将注释里面的代码编译到不同平台。</p><p><strong>写法：</strong>以 #ifdef 加平台标识 开头，以 #endif 结尾。</p><p>平台标识</p><table><thead><tr><th>值</th><th>平台</th><th>参考文档</th></tr></thead><tbody><tr><td>APP-PLUS</td><td>5+App</td><td><a href="http://www.html5plus.org/doc/">HTML5+ 规范</a></td></tr><tr><td>H5</td><td>H5</td><td></td></tr><tr><td>MP-WEIXIN</td><td>微信小程序</td><td><a href="https://developers.weixin.qq.com/miniprogram/dev/api/">微信小程序</a></td></tr><tr><td>MP-ALIPAY</td><td>支付宝小程序</td><td><a href="https://docs.alipay.com/mini/developer/getting-started">支付宝小程序</a></td></tr><tr><td>MP-BAIDU</td><td>百度小程序</td><td><a href="https://smartprogram.baidu.com/docs/develop/tutorial/codedir/">百度小程序</a></td></tr><tr><td>MP-TOUTIAO</td><td>头条小程序</td><td><a href="https://developer.toutiao.com/dev/cn/mini-app/develop/framework/basic-reference/introduction">头条小程序</a></td></tr><tr><td>MP-QQ</td><td>QQ小程序</td><td>（目前仅cli版支持）</td></tr><tr><td>MP</td><td>微信小程序&#x2F;支付宝小程序&#x2F;百度小程序&#x2F;头条小程序&#x2F;QQ小程序</td><td></td></tr></tbody></table><h5 id="组件的条件注释"><a href="#组件的条件注释" class="headerlink" title="组件的条件注释"></a>组件的条件注释</h5><p>代码演示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- #ifdef H5 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  h5页面会显示</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- #endif --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- #ifdef MP-WEIXIN --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  微信小程序会显示</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- #endif --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- #ifdef APP-PLUS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">  app会显示</span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- #endif --&gt;</span></span><br></pre></td></tr></table></figure><h5 id="api的条件注释"><a href="#api的条件注释" class="headerlink" title="api的条件注释"></a>api的条件注释</h5><p>代码演示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">onLoad () &#123;</span><br><span class="line">  <span class="comment">//#ifdef MP-WEIXIN</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;微信小程序&#x27;</span>)</span><br><span class="line">  <span class="comment">//#endif</span></span><br><span class="line">  <span class="comment">//#ifdef H5</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;h5页面&#x27;</span>)</span><br><span class="line">  <span class="comment">//#endif</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>样式的条件注释</p><p>代码演示</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* #ifdef H5 */</span></span><br><span class="line">view&#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* #endif */</span></span><br><span class="line"><span class="comment">/* #ifdef MP-WEIXIN */</span></span><br><span class="line">view&#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* #endif */</span></span><br></pre></td></tr></table></figure><h4 id="uni中的导航跳转"><a href="#uni中的导航跳转" class="headerlink" title="uni中的导航跳转"></a>uni中的导航跳转</h4><h5 id="利用navigator进行跳转"><a href="#利用navigator进行跳转" class="headerlink" title="利用navigator进行跳转"></a>利用navigator进行跳转</h5><p>navigator详细文档：<a href="https://uniapp.dcloud.io/component/navigator">文档地址</a></p><p>跳转到普通页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;/pages/about/about&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;navigator-hover&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>跳转到关于页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure><p>跳转到tabbar页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;/pages/message/message&quot;</span> <span class="attr">open-type</span>=<span class="string">&quot;switchTab&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span>&gt;</span>跳转到message页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="利用编程式导航进行跳转"><a href="#利用编程式导航进行跳转" class="headerlink" title="利用编程式导航进行跳转"></a>利用编程式导航进行跳转</h5><p><a href="%5Buni.navigateTo%5D(https://uniapp.dcloud.io/api/router?id=navigateto)">导航跳转文档</a></p><p><strong>利用navigateTo进行导航跳转</strong></p><p>保留当前页面，跳转到应用内的某个页面，使用<code>uni.navigateBack</code>可以返回到原页面。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;goAbout&quot;</span>&gt;</span>跳转到关于页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过navigateTo方法进行跳转到普通页面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">goAbout () &#123;</span><br><span class="line">  uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pages/about/about&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>通过switchTab跳转到tabbar页面</strong></p><p>跳转到tabbar页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;goMessage&quot;</span>&gt;</span>跳转到message页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>通过switchTab方法进行跳转</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">goMessage () &#123;</span><br><span class="line">  uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pages/message/message&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>redirectTo进行跳转</strong> </p><p>关闭当前页面，跳转到应用内的某个页面。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- template --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;goMessage&quot;</span>&gt;</span>跳转到message页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- js --&gt;</span></span><br><span class="line">goMessage () &#123;</span><br><span class="line">  uni.switchTab(&#123;</span><br><span class="line">    url: &#x27;/pages/message/message&#x27;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过onUnload测试当前组件确实卸载</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onUnload () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;组件卸载了&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="导航跳转传递参数"><a href="#导航跳转传递参数" class="headerlink" title="导航跳转传递参数"></a>导航跳转传递参数</h5><p>在导航进行跳转到下一个页面的同时，可以给下一个页面传递相应的参数，接收参数的页面可以通过onLoad生命周期进行接收</p><p>传递参数的页面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">goAbout () &#123;</span><br><span class="line">  uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/pages/about/about?id=80&#x27;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接收参数的页面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">onLoad (options) &#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(options)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="uni-app中组件的创建"><a href="#uni-app中组件的创建" class="headerlink" title="uni-app中组件的创建"></a>uni-app中组件的创建</h4><p>在uni-app中，可以通过创建一个后缀名为vue的文件，即创建一个组件成功，其他组件可以将该组件通过impot的方式导入，在通过components进行注册即可</p><ul><li><p>创建login组件，在component中创建login目录，然后新建login.vue文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;view&gt;</span><br><span class="line">这是一个自定义组件</span><br><span class="line">&lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></li><li><p>在其他组件中导入该组件并注册</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import login from &quot;@/components/test/test.vue&quot;</span><br></pre></td></tr></table></figure></li><li><p>注册组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">components</span>: &#123;test&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;test&gt;&lt;/test&gt;</span><br></pre></td></tr></table></figure></li></ul><h5 id="组件的生命周期函数"><a href="#组件的生命周期函数" class="headerlink" title="组件的生命周期函数"></a>组件的生命周期函数</h5><table><thead><tr><th>beforeCreate</th><th>在实例初始化之后被调用。<a href="https://cn.vuejs.org/v2/api/#beforeCreate">详见</a></th><th></th><th></th></tr></thead><tbody><tr><td>created</td><td>在实例创建完成后被立即调用。<a href="https://cn.vuejs.org/v2/api/#created">详见</a></td><td></td><td></td></tr><tr><td>beforeMount</td><td>在挂载开始之前被调用。<a href="https://cn.vuejs.org/v2/api/#beforeMount">详见</a></td><td></td><td></td></tr><tr><td>mounted</td><td>挂载到实例上去之后调用。<a href="https://cn.vuejs.org/v2/api/#mounted">详见</a> 注意：此处并不能确定子组件被全部挂载，如果需要子组件完全挂载之后在执行操作可以使用<code>$nextTick</code><a href="https://cn.vuejs.org/v2/api/#Vue-nextTick">Vue官方文档</a></td><td></td><td></td></tr><tr><td>beforeUpdate</td><td>数据更新时调用，发生在虚拟 DOM 打补丁之前。<a href="https://cn.vuejs.org/v2/api/#beforeUpdate">详见</a></td><td>仅H5平台支持</td><td></td></tr><tr><td>updated</td><td>由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。<a href="https://cn.vuejs.org/v2/api/#updated">详见</a></td><td>仅H5平台支持</td><td></td></tr><tr><td>beforeDestroy</td><td>实例销毁之前调用。在这一步，实例仍然完全可用。<a href="https://cn.vuejs.org/v2/api/#beforeDestroy">详见</a></td><td></td><td></td></tr><tr><td>destroyed</td><td>Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。<a href="https://cn.vuejs.org/v2/api/#destroyed">详见</a></td><td></td><td></td></tr></tbody></table><h4 id="组件的通讯"><a href="#组件的通讯" class="headerlink" title="组件的通讯"></a>组件的通讯</h4><h5 id="父组件给子组件传值"><a href="#父组件给子组件传值" class="headerlink" title="父组件给子组件传值"></a>父组件给子组件传值</h5><p>通过props来接受外界传递到组件内部的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;view&gt;</span><br><span class="line">这是一个自定义组件 &#123;&#123;msg&#125;&#125;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">props: [&#x27;msg&#x27;]</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>其他组件在使用login组件的时候传递值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;view&gt;</span><br><span class="line">&lt;test :msg=&quot;msg&quot;&gt;&lt;/test&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import test from &quot;@/components/test/test.vue&quot;</span><br><span class="line">export default &#123;</span><br><span class="line">data () &#123;</span><br><span class="line">return &#123;</span><br><span class="line">msg: &#x27;hello&#x27;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">components: &#123;test&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h5 id="子组件给父组件传值"><a href="#子组件给父组件传值" class="headerlink" title="子组件给父组件传值"></a>子组件给父组件传值</h5><p>通过$emit触发事件进行传递参数</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">这是一个自定义组件 &#123;&#123;msg&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;sendMsg&quot;</span>&gt;</span>给父组件传值<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">data () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">status</span>: <span class="string">&#x27;打篮球&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">msg</span>: &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">value</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">sendMsg () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">this</span>.$emit(<span class="string">&#x27;myEvent&#x27;</span>,<span class="variable language_">this</span>.<span class="property">status</span>)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>父组件定义自定义事件并接收参数</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">test</span> <span class="attr">:msg</span>=<span class="string">&quot;msg&quot;</span> @<span class="attr">myEvent</span>=<span class="string">&quot;getMsg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> test <span class="keyword">from</span> <span class="string">&quot;@/components/test/test.vue&quot;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">data () &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">msg</span>: <span class="string">&#x27;hello&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">getMsg (res) &#123;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="attr">components</span>: &#123;test&#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="兄弟组件通讯"><a href="#兄弟组件通讯" class="headerlink" title="兄弟组件通讯"></a>兄弟组件通讯</h5><h4 id="uni-ui的使用"><a href="#uni-ui的使用" class="headerlink" title="uni-ui的使用"></a>uni-ui的使用</h4><p><a href="https://uniapp.dcloud.io/component/README?id=uniui">uni-ui文档</a></p><p>1、进入Grid宫格组件</p><p>2、使用HBuilderX导入该组件</p><p>3、导入该组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import uniGrid from &quot;@/components/uni-grid/uni-grid.vue&quot;</span><br><span class="line">import uniGridItem from &quot;@/components/uni-grid-item/uni-grid-item.vue&quot;</span><br></pre></td></tr></table></figure><p>4、注册组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">components: &#123;uniGrid,uniGridItem&#125;</span><br></pre></td></tr></table></figure><p>5、使用组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uni-grid</span> <span class="attr">:column</span>=<span class="string">&quot;3&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uni-grid-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">uni-grid-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uni-grid-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">uni-grid-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">uni-grid-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">uni-grid-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">uni-grid</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> uniApp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> uniApp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一大波JS开发工具函数</title>
      <link href="/hisai3.github.io/2023/01/14/%E4%B8%80%E5%A4%A7%E6%B3%A2JS%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0/"/>
      <url>/hisai3.github.io/2023/01/14/%E4%B8%80%E5%A4%A7%E6%B3%A2JS%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="正则校验check工具函数"><a href="#正则校验check工具函数" class="headerlink" title="正则校验check工具函数"></a>正则校验check工具函数</h2><p>这里的正则表达式主要参考了<a href="https://link.juejin.cn/?target=https://github.com/any86/any-rule">any-rule</a>。</p><h3 id="验证不能包含字母"><a href="#验证不能包含字母" class="headerlink" title="验证不能包含字母"></a>验证不能包含字母</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isNoWord</span> = value =&gt; <span class="regexp">/^[^A-Za-z]*$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"> </span><br></pre></td></tr></table></figure><h3 id="验证中文和数字"><a href="#验证中文和数字" class="headerlink" title="验证中文和数字"></a>验证中文和数字</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isCHNAndEN</span> = value =&gt; <span class="regexp">/^((?:[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0])|(\d))+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证邮政编码-中国"><a href="#验证邮政编码-中国" class="headerlink" title="验证邮政编码(中国)"></a>验证邮政编码(中国)</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isPostcode = value =&gt; /^(<span class="number">0</span><span class="selector-attr">[1-7]</span>|<span class="number">1</span><span class="selector-attr">[0-356]</span>|<span class="number">2</span><span class="selector-attr">[0-7]</span>|<span class="number">3</span><span class="selector-attr">[0-6]</span>|<span class="number">4</span><span class="selector-attr">[0-7]</span>|<span class="number">5</span><span class="selector-attr">[1-7]</span>|<span class="number">6</span><span class="selector-attr">[1-7]</span>|<span class="number">7</span><span class="selector-attr">[0-5]</span>|<span class="number">8</span><span class="selector-attr">[013-6]</span>)\d&#123;<span class="number">4</span>&#125;$/g<span class="selector-class">.test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证微信号，6至20位，以字母开头，字母，数字，减号，下划线"><a href="#验证微信号，6至20位，以字母开头，字母，数字，减号，下划线" class="headerlink" title="验证微信号，6至20位，以字母开头，字母，数字，减号，下划线"></a>验证微信号，6至20位，以字母开头，字母，数字，减号，下划线</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isWeChatNum</span> = value =&gt; <span class="regexp">/^[a-zA-Z][-_a-zA-Z0-9]&#123;5,19&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证16进制颜色"><a href="#验证16进制颜色" class="headerlink" title="验证16进制颜色"></a>验证16进制颜色</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isColor16</span> = value =&gt; <span class="regexp">/^#?([a-fA-F0-9]&#123;6&#125;|[a-fA-F0-9]&#123;3&#125;)$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证火车车次"><a href="#验证火车车次" class="headerlink" title="验证火车车次"></a>验证火车车次</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isTrainNum</span> = value =&gt; <span class="regexp">/^[GCDZTSPKXLY1-9]\d&#123;1,4&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证手机机身码-IMEI"><a href="#验证手机机身码-IMEI" class="headerlink" title="验证手机机身码(IMEI)"></a>验证手机机身码(IMEI)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isIMEI</span> = value =&gt; <span class="regexp">/^\d&#123;15,17&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证必须带端口号的网址-或ip"><a href="#验证必须带端口号的网址-或ip" class="headerlink" title="验证必须带端口号的网址(或ip)"></a>验证必须带端口号的网址(或ip)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isHttpAndPort</span> = value =&gt; <span class="regexp">/^((ht|f)tps?:\/\/)?[\w-]+(\.[\w-]+)+:\d&#123;1,5&#125;\/?$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证网址-支持端口和”-参数”和”-参数"><a href="#验证网址-支持端口和”-参数”和”-参数" class="headerlink" title="验证网址(支持端口和”?+参数”和”#+参数)"></a>验证网址(支持端口和”?+参数”和”#+参数)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isRightWebsite</span> = value =&gt; <span class="regexp">/^(((ht|f)tps?):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:/~+#-]*[\w@?^=%&amp;/~+#-])?$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证统一社会信用代码"><a href="#验证统一社会信用代码" class="headerlink" title="验证统一社会信用代码"></a>验证统一社会信用代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isCreditCode</span> = value =&gt; <span class="regexp">/^[0-9A-HJ-NPQRTUWXY]&#123;2&#125;\d&#123;6&#125;[0-9A-HJ-NPQRTUWXY]&#123;10&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证迅雷链接"><a href="#验证迅雷链接" class="headerlink" title="验证迅雷链接"></a>验证迅雷链接</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isThunderLink</span> = value =&gt; <span class="regexp">/^thunderx?:\/\/[a-zA-Z\d]+=$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="验证ed2k链接-宽松匹配"><a href="#验证ed2k链接-宽松匹配" class="headerlink" title="验证ed2k链接(宽松匹配)"></a>验证ed2k链接(宽松匹配)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">ised2k</span> = value =&gt; <span class="regexp">/^ed2k:\/\/\|file\|.+\|\/$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证磁力链接-宽松匹配"><a href="#验证磁力链接-宽松匹配" class="headerlink" title="验证磁力链接(宽松匹配)"></a>验证磁力链接(宽松匹配)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isMagnet</span> = value =&gt; <span class="regexp">/^magnet:\?xt=urn:btih:[0-9a-fA-F]&#123;40,&#125;.*$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证子网掩码"><a href="#验证子网掩码" class="headerlink" title="验证子网掩码"></a>验证子网掩码</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isSubnetMask = value =&gt; /^(?:\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;|<span class="number">1</span>\d\d|<span class="number">2</span><span class="selector-attr">[0-4]</span>\d|<span class="number">25</span><span class="selector-attr">[0-5]</span>)(?:\.(?:\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;|<span class="number">1</span>\d\d|<span class="number">2</span><span class="selector-attr">[0-4]</span>\d|<span class="number">25</span><span class="selector-attr">[0-5]</span>))&#123;<span class="number">3</span>&#125;$/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证linux”文件夹”路径"><a href="#验证linux”文件夹”路径" class="headerlink" title="验证linux”文件夹”路径"></a>验证linux”文件夹”路径</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isLinuxFolderPath</span> = value =&gt; <span class="regexp">/^(\/[^/]+)+\/?$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证linux”文件”路径"><a href="#验证linux”文件”路径" class="headerlink" title="验证linux”文件”路径"></a>验证linux”文件”路径</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isLinuxFilePath</span> = value =&gt; <span class="regexp">/^(\/[^/]+)+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证window”文件夹”路径"><a href="#验证window”文件夹”路径" class="headerlink" title="验证window”文件夹”路径"></a>验证window”文件夹”路径</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isWindowsFolderPath</span> = value =&gt; <span class="regexp">/^[a-zA-Z]:\\(?:\w+\\?)*$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证window下”文件”路径"><a href="#验证window下”文件”路径" class="headerlink" title="验证window下”文件”路径"></a>验证window下”文件”路径</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isWindowsFilePath</span> = value =&gt; <span class="regexp">/^[a-zA-Z]:\\(?:\w+\\)*\w+\.\w+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证股票代码-A股"><a href="#验证股票代码-A股" class="headerlink" title="验证股票代码(A股)"></a>验证股票代码(A股)</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isAShare = value =&gt; /^(s<span class="selector-attr">[hz]</span>|S<span class="selector-attr">[HZ]</span>)(<span class="number">000</span><span class="selector-attr">[\d]</span>&#123;<span class="number">3</span>&#125;|<span class="number">002</span><span class="selector-attr">[\d]</span>&#123;<span class="number">3</span>&#125;|<span class="number">300</span><span class="selector-attr">[\d]</span>&#123;<span class="number">3</span>&#125;|<span class="number">600</span><span class="selector-attr">[\d]</span>&#123;<span class="number">3</span>&#125;|<span class="number">60</span><span class="selector-attr">[\d]</span>&#123;<span class="number">4</span>&#125;)$/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证版本号格式必须为X-Y-Z"><a href="#验证版本号格式必须为X-Y-Z" class="headerlink" title="验证版本号格式必须为X.Y.Z"></a>验证版本号格式必须为X.Y.Z</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isVersion</span> = value =&gt; <span class="regexp">/^\d+(?:\.\d+)&#123;2&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证视频链接地址（视频格式可按需增删）"><a href="#验证视频链接地址（视频格式可按需增删）" class="headerlink" title="验证视频链接地址（视频格式可按需增删）"></a>验证视频链接地址（视频格式可按需增删）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isVideoUrl</span> = value =&gt; <span class="regexp">/^https?:\/\/(.+\/)+.+(\.(swf|avi|flv|mpg|rm|mov|wav|asf|3gp|mkv|rmvb|mp4))$/i</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证图片链接地址（图片格式可按需增删）"><a href="#验证图片链接地址（图片格式可按需增删）" class="headerlink" title="验证图片链接地址（图片格式可按需增删）"></a>验证图片链接地址（图片格式可按需增删）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isImageUrl</span> = value =&gt; <span class="regexp">/^https?:\/\/(.+\/)+.+(\.(gif|png|jpg|jpeg|webp|svg|psd|bmp|tif))$/i</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证银行卡号（10到30位-覆盖对公-x2F-私账户-参考微信支付）"><a href="#验证银行卡号（10到30位-覆盖对公-x2F-私账户-参考微信支付）" class="headerlink" title="验证银行卡号（10到30位, 覆盖对公&#x2F;私账户, 参考微信支付）"></a>验证银行卡号（10到30位, 覆盖对公&#x2F;私账户, 参考微信支付）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isAccountNumber</span> = value =&gt; <span class="regexp">/^[1-9]\d&#123;9,29&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证中文姓名"><a href="#验证中文姓名" class="headerlink" title="验证中文姓名"></a>验证中文姓名</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isChineseName</span> = value =&gt; <span class="regexp">/^(?:[\u4e00-\u9fa5·]&#123;2,16&#125;)$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证英文姓名"><a href="#验证英文姓名" class="headerlink" title="验证英文姓名"></a>验证英文姓名</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isEnglishName</span> = value =&gt; <span class="regexp">/(^[a-zA-Z]&#123;1&#125;[a-zA-Z\s]&#123;0,20&#125;[a-zA-Z]&#123;1&#125;$)/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证车牌号-新能源"><a href="#验证车牌号-新能源" class="headerlink" title="验证车牌号(新能源)"></a>验证车牌号(新能源)</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isLicensePlateNumberNER = value =&gt; /<span class="selector-attr">[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]</span>&#123;<span class="number">1</span>&#125;<span class="selector-attr">[A-HJ-NP-Z]</span>&#123;<span class="number">1</span>&#125;((<span class="selector-attr">[0-9]</span>&#123;<span class="number">5</span>&#125;<span class="selector-attr">[DF]</span>)|(<span class="selector-attr">[DF]</span><span class="selector-attr">[A-HJ-NP-Z0-9]</span><span class="selector-attr">[0-9]</span>&#123;<span class="number">4</span>&#125;))$/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证车牌号-非新能源"><a href="#验证车牌号-非新能源" class="headerlink" title="验证车牌号(非新能源)"></a>验证车牌号(非新能源)</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isLicensePlateNumberNNER = value =&gt; /^<span class="selector-attr">[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]</span>&#123;<span class="number">1</span>&#125;<span class="selector-attr">[A-HJ-NP-Z]</span>&#123;<span class="number">1</span>&#125;<span class="selector-attr">[A-Z0-9]</span>&#123;<span class="number">4</span>&#125;<span class="selector-attr">[A-Z0-9挂学警港澳]</span>&#123;<span class="number">1</span>&#125;$/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证车牌号-新能源-非新能源"><a href="#验证车牌号-新能源-非新能源" class="headerlink" title="验证车牌号(新能源+非新能源)"></a>验证车牌号(新能源+非新能源)</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isLicensePlateNumber = value =&gt; /^(?:[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]&#123;<span class="number">1</span>&#125;<span class="selector-attr">[A-HJ-NP-Z]</span>&#123;<span class="number">1</span>&#125;(?:(?:[<span class="number">0</span>-<span class="number">9</span>]&#123;<span class="number">5</span>&#125;<span class="selector-attr">[DF]</span>)|(?:[DF](?:[A-HJ-NP-Z0-<span class="number">9</span>])[<span class="number">0</span>-<span class="number">9</span>]&#123;<span class="number">4</span>&#125;)))|(?:[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领 A-Z]&#123;<span class="number">1</span>&#125;<span class="selector-attr">[A-Z]</span>&#123;<span class="number">1</span>&#125;<span class="selector-attr">[A-HJ-NP-Z0-9]</span>&#123;<span class="number">4</span>&#125;<span class="selector-attr">[A-HJ-NP-Z0-9 挂学警港澳]</span>&#123;<span class="number">1</span>&#125;)$/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证手机号中国-严谨-根据工信部2019年最新公布的手机号段"><a href="#验证手机号中国-严谨-根据工信部2019年最新公布的手机号段" class="headerlink" title="验证手机号中国(严谨), 根据工信部2019年最新公布的手机号段"></a>验证手机号中国(严谨), 根据工信部2019年最新公布的手机号段</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isMPStrict = value =&gt; /^(?:(?:\+|<span class="number">00</span>)<span class="number">86</span>)?<span class="number">1</span>(?:(?:<span class="number">3</span>[\d])|(?:<span class="number">4</span>[<span class="number">5</span>-<span class="number">7</span>|<span class="number">9</span>])|(?:<span class="number">5</span>[<span class="number">0</span>-<span class="number">3</span>|<span class="number">5</span>-<span class="number">9</span>])|(?:<span class="number">6</span>[<span class="number">5</span>-<span class="number">7</span>])|(?:<span class="number">7</span>[<span class="number">0</span>-<span class="number">8</span>])|(?:<span class="number">8</span>[\d])|(?:<span class="number">9</span>[<span class="number">1</span>|<span class="number">8</span>|<span class="number">9</span>]))\d&#123;<span class="number">8</span>&#125;$/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证手机号中国-宽松-只要是13-14-15-16-17-18-19开头即可"><a href="#验证手机号中国-宽松-只要是13-14-15-16-17-18-19开头即可" class="headerlink" title="验证手机号中国(宽松), 只要是13,14,15,16,17,18,19开头即可"></a>验证手机号中国(宽松), 只要是13,14,15,16,17,18,19开头即可</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isMPRelaxed</span> = value =&gt; <span class="regexp">/^(?:(?:\+|00)86)?1[3-9]\d&#123;9&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证email-邮箱"><a href="#验证email-邮箱" class="headerlink" title="验证email(邮箱)"></a>验证email(邮箱)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isEmail</span> = value =&gt; <span class="regexp">/^[a-zA-Z0-9.!#$%&amp;&#x27;*+/=?^_`&#123;|&#125;~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]&#123;0,61&#125;[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]&#123;0,61&#125;[a-zA-Z0-9])?)*$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证座机电话-国内-如-0341-86091234"><a href="#验证座机电话-国内-如-0341-86091234" class="headerlink" title="验证座机电话(国内),如: 0341-86091234"></a>验证座机电话(国内),如: 0341-86091234</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isLandlineTelephone</span> = value =&gt; <span class="regexp">/\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证身份证号-1代-15位数字"><a href="#验证身份证号-1代-15位数字" class="headerlink" title="验证身份证号(1代,15位数字)"></a>验证身份证号(1代,15位数字)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isIDCardOld</span> = value =&gt; <span class="regexp">/^\d&#123;8&#125;(0\d|10|11|12)([0-2]\d|30|31)\d&#123;3&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证身份证号-2代-18位数字-最后一位是校验位-可能为数字或字符X"><a href="#验证身份证号-2代-18位数字-最后一位是校验位-可能为数字或字符X" class="headerlink" title="验证身份证号(2代,18位数字),最后一位是校验位,可能为数字或字符X"></a>验证身份证号(2代,18位数字),最后一位是校验位,可能为数字或字符X</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isIDCardNew = value =&gt; /^\d&#123;<span class="number">6</span>&#125;(<span class="number">18</span>|<span class="number">19</span>|<span class="number">20</span>)\d&#123;<span class="number">2</span>&#125;(<span class="number">0</span>\d|<span class="number">10</span>|<span class="number">11</span>|<span class="number">12</span>)([<span class="number">0</span>-<span class="number">2</span>]\d|<span class="number">30</span>|<span class="number">31</span>)\d&#123;<span class="number">3</span>&#125;<span class="selector-attr">[\dXx]</span>$/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证身份证号-支持1-x2F-2代-15位-x2F-18位数字"><a href="#验证身份证号-支持1-x2F-2代-15位-x2F-18位数字" class="headerlink" title="验证身份证号, 支持1&#x2F;2代(15位&#x2F;18位数字)"></a>验证身份证号, 支持1&#x2F;2代(15位&#x2F;18位数字)</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isIDCard = value =&gt; /(^\d&#123;<span class="number">8</span>&#125;(<span class="number">0</span>\d|<span class="number">10</span>|<span class="number">11</span>|<span class="number">12</span>)([<span class="number">0</span>-<span class="number">2</span>]\d|<span class="number">30</span>|<span class="number">31</span>)\d&#123;<span class="number">3</span>&#125;$)|(^\d&#123;<span class="number">6</span>&#125;(<span class="number">18</span>|<span class="number">19</span>|<span class="number">20</span>)\d&#123;<span class="number">2</span>&#125;(<span class="number">0</span>\d|<span class="number">10</span>|<span class="number">11</span>|<span class="number">12</span>)([<span class="number">0</span>-<span class="number">2</span>]\d|<span class="number">30</span>|<span class="number">31</span>)\d&#123;<span class="number">3</span>&#125;(\d|X|x)$)/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证护照（包含香港、澳门）"><a href="#验证护照（包含香港、澳门）" class="headerlink" title="验证护照（包含香港、澳门）"></a>验证护照（包含香港、澳门）</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; string &#125; value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export const isPassport = value =&gt; /(^<span class="selector-attr">[EeKkGgDdSsPpHh]</span>\d&#123;<span class="number">8</span>&#125;$)|(^((<span class="selector-attr">[Ee]</span><span class="selector-attr">[a-fA-F]</span>)|(<span class="selector-attr">[DdSsPp]</span><span class="selector-attr">[Ee]</span>)|(<span class="selector-attr">[Kk]</span><span class="selector-attr">[Jj]</span>)|(<span class="selector-attr">[Mm]</span><span class="selector-attr">[Aa]</span>)|(<span class="number">1</span><span class="selector-attr">[45]</span>))\d&#123;<span class="number">7</span>&#125;$)/g<span class="selector-class">.test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证帐号是否合法-字母开头，允许5-16字节，允许字母数字下划线组合"><a href="#验证帐号是否合法-字母开头，允许5-16字节，允许字母数字下划线组合" class="headerlink" title="验证帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线组合"></a>验证帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线组合</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isWebAccount</span> = value =&gt; <span class="regexp">/^[a-zA-Z]\w&#123;4,15&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证中文-x2F-汉字"><a href="#验证中文-x2F-汉字" class="headerlink" title="验证中文&#x2F;汉字"></a>验证中文&#x2F;汉字</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isChineseCharacter</span> = value =&gt; <span class="regexp">/^(?:[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0])+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证小数"><a href="#验证小数" class="headerlink" title="验证小数"></a>验证小数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isDecimal</span> = value =&gt; <span class="regexp">/^\d+\.\d+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证数字"><a href="#验证数字" class="headerlink" title="验证数字"></a>验证数字</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isNumber</span> = value =&gt; <span class="regexp">/^\d&#123;1,&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证qq号格式"><a href="#验证qq号格式" class="headerlink" title="验证qq号格式"></a>验证qq号格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isQQNum</span> = value =&gt; <span class="regexp">/^[1-9][0-9]&#123;4,10&#125;$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证数字和字母组成"><a href="#验证数字和字母组成" class="headerlink" title="验证数字和字母组成"></a>验证数字和字母组成</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isNumAndStr</span> = value =&gt; <span class="regexp">/^[A-Za-z0-9]+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证英文字母"><a href="#验证英文字母" class="headerlink" title="验证英文字母"></a>验证英文字母</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isEnglish</span> = value =&gt; <span class="regexp">/^[a-zA-Z]+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证大写英文字母"><a href="#验证大写英文字母" class="headerlink" title="验证大写英文字母"></a>验证大写英文字母</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isCapital</span> = value =&gt; <span class="regexp">/^[A-Z]+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="验证小写英文字母"><a href="#验证小写英文字母" class="headerlink" title="验证小写英文字母"></a>验证小写英文字母</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">isLowercase</span> = value =&gt; <span class="regexp">/^[a-z]+$/g</span>.<span class="title function_">test</span>(value);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="浏览器操作相关browser工具函数"><a href="#浏览器操作相关browser工具函数" class="headerlink" title="浏览器操作相关browser工具函数"></a>浏览器操作相关browser工具函数</h2><h3 id="返回当前url"><a href="#返回当前url" class="headerlink" title="返回当前url"></a>返回当前url</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">currentURL</span> = (<span class="params"></span>) =&gt; <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取url参数（第一种）"><a href="#获取url参数（第一种）" class="headerlink" title="获取url参数（第一种）"></a>获取url参数（第一种）</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;*&#125; name</span><br><span class="line"> * @param &#123;*&#125; origin</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">export function getUrlParam(name, <span class="attr">origin</span> = null) &#123;</span><br><span class="line">    let <span class="attr">reg</span> = new RegExp(<span class="string">&quot;(^|&amp;)&quot;</span> + name + <span class="string">&quot;=([^&amp;]*)(&amp;|$)&quot;</span>)<span class="comment">;</span></span><br><span class="line">    let <span class="attr">r</span> = null<span class="comment">;</span></span><br><span class="line">    if (<span class="attr">origin</span> == null) &#123;</span><br><span class="line">        <span class="attr">r</span> = window.location.search.substr(<span class="number">1</span>).match(reg)<span class="comment">;</span></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        <span class="attr">r</span> = origin.substr(<span class="number">1</span>).match(reg)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    if (r != null) return decodeURIComponent(r<span class="section">[2]</span>)<span class="comment">;</span></span><br><span class="line">    return null<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取url参数（第二种）"><a href="#获取url参数（第二种）" class="headerlink" title="获取url参数（第二种）"></a>获取url参数（第二种）</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;*&#125; name</span><br><span class="line"> * @param &#123;*&#125; origin</span><br><span class="line"> */</span><br><span class="line">export function getUrlParams(name, <span class="attr">origin</span> = null) &#123;</span><br><span class="line">    let <span class="attr">url</span> = location.href<span class="comment">;</span></span><br><span class="line">    let <span class="attr">temp1</span> = url.split(<span class="string">&#x27;?&#x27;</span>)<span class="comment">;</span></span><br><span class="line">    let <span class="attr">pram</span> = temp1[<span class="number">1</span>]<span class="comment">;</span></span><br><span class="line">    let <span class="attr">keyValue</span> = pram.split(<span class="string">&#x27;&amp;&#x27;</span>)<span class="comment">;</span></span><br><span class="line">    let <span class="attr">obj</span> = &#123;&#125;<span class="comment">;</span></span><br><span class="line">    for (let <span class="attr">i</span> = <span class="number">0</span><span class="comment">; i &lt; keyValue.length; i++) &#123;</span></span><br><span class="line">        let <span class="attr">item</span> = keyValue[i].split(<span class="string">&#x27;=&#x27;</span>)<span class="comment">;</span></span><br><span class="line">        let <span class="attr">key</span> = item[<span class="number">0</span>]<span class="comment">;</span></span><br><span class="line">        let <span class="attr">value</span> = item[<span class="number">1</span>]<span class="comment">;</span></span><br><span class="line">        obj<span class="section">[key]</span> = value<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    return obj<span class="section">[name]</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="修改url中的参数"><a href="#修改url中的参数" class="headerlink" title="修改url中的参数"></a>修改url中的参数</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; string &#125; paramName</span><br><span class="line"> * @param &#123; string &#125; replaceWith</span><br><span class="line"> */</span><br><span class="line">export function replaceParamVal(paramName,replaceWith) &#123;</span><br><span class="line">    var <span class="attr">oUrl</span> = location.href.toString()<span class="comment">;</span></span><br><span class="line">    var <span class="attr">re</span>=eval(<span class="string">&#x27;/(&#x27;</span>+ paramName+<span class="string">&#x27;=)([^&amp;]*)/gi&#x27;</span>)<span class="comment">;</span></span><br><span class="line">    <span class="attr">location.href</span> = oUrl.replace(re,paramName+<span class="string">&#x27;=&#x27;</span>+replaceWith)<span class="comment">;</span></span><br><span class="line">    return location.href<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="删除url中指定的参数"><a href="#删除url中指定的参数" class="headerlink" title="删除url中指定的参数"></a>删除url中指定的参数</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; string &#125; name</span><br><span class="line"> */</span><br><span class="line">export function funcUrlDel(name)&#123;</span><br><span class="line">    var <span class="attr">loca</span> =location<span class="comment">;</span></span><br><span class="line">    var <span class="attr">baseUrl</span> = loca.origin + loca.pathname + <span class="string">&quot;?&quot;</span><span class="comment">;</span></span><br><span class="line">    var <span class="attr">query</span> = loca.search.substr(<span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">    if (query.indexOf(name)&gt;-1) &#123;</span><br><span class="line">        var <span class="attr">obj</span> = &#123;&#125;<span class="comment">;</span></span><br><span class="line">        var <span class="attr">arr</span> = query.split(<span class="string">&quot;&amp;&quot;</span>)<span class="comment">;</span></span><br><span class="line">        for (var <span class="attr">i</span> = <span class="number">0</span><span class="comment">; i &lt; arr.length; i++) &#123;</span></span><br><span class="line">            arr<span class="section">[i]</span> = arr<span class="section">[i]</span>.split(&quot;=&quot;)<span class="comment">;</span></span><br><span class="line">            obj<span class="section">[arr[i]</span><span class="section">[0]]</span> = arr<span class="section">[i]</span><span class="section">[1]</span><span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        delete obj<span class="section">[name]</span><span class="comment">;</span></span><br><span class="line">        var <span class="attr">url</span> = baseUrl + JSON.stringify(obj).replace(/[\<span class="string">&quot;\&#123;\&#125;]/g,&quot;</span><span class="string">&quot;).replace(/\:/g,&quot;</span>=<span class="string">&quot;).replace(/\,/g,&quot;</span>&amp;<span class="string">&quot;);</span></span><br><span class="line"><span class="string">        return url</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h3 id="获取窗口可视范围的高度"><a href="#获取窗口可视范围的高度" class="headerlink" title="获取窗口可视范围的高度"></a>获取窗口可视范围的高度</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getClientHeight</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> clientHeight = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> &amp;&amp; <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>) &#123;</span><br><span class="line">        clientHeight = (<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> &lt; <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>) ? <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> : <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        clientHeight = (<span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> &gt; <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>) ? <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> : <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clientHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取窗口可视范围宽度"><a href="#获取窗口可视范围宽度" class="headerlink" title="获取窗口可视范围宽度"></a>获取窗口可视范围宽度</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export function getPageViewWidth() &#123;</span><br><span class="line">    let <span class="attr">d</span> = document,</span><br><span class="line">        <span class="attr">a</span> = d.compatMode == <span class="string">&quot;BackCompat&quot;</span> ? d.body : d.documentElement<span class="comment">;</span></span><br><span class="line">    return a.clientWidth<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取窗口宽度"><a href="#获取窗口宽度" class="headerlink" title="获取窗口宽度"></a>获取窗口宽度</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export function getPageWidth() &#123;</span><br><span class="line">    let <span class="attr">g</span> = document,</span><br><span class="line">        <span class="attr">a</span> = g.body,</span><br><span class="line">        <span class="attr">f</span> = g.documentElement,</span><br><span class="line">        <span class="attr">d</span> = g.compatMode == <span class="string">&quot;BackCompat&quot;</span> ? a : g.documentElement<span class="comment">;</span></span><br><span class="line">    return Math.max(f.scrollWidth, a.scrollWidth, d.clientWidth)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取窗口尺寸"><a href="#获取窗口尺寸" class="headerlink" title="获取窗口尺寸"></a>获取窗口尺寸</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getViewportOffset</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">innerWidth</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">w</span>: <span class="variable language_">window</span>.<span class="property">innerWidth</span>,</span><br><span class="line">            <span class="attr">h</span>: <span class="variable language_">window</span>.<span class="property">innerHeight</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ie8及其以下</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">compatMode</span> === <span class="string">&quot;BackCompat&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">// 怪异模式</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">w</span>: <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientWidth</span>,</span><br><span class="line">                <span class="attr">h</span>: <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 标准模式</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">w</span>: <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>,</span><br><span class="line">                <span class="attr">h</span>: <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取滚动条距顶部高度"><a href="#获取滚动条距顶部高度" class="headerlink" title="获取滚动条距顶部高度"></a>获取滚动条距顶部高度</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getPageScrollTop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="variable language_">document</span>;</span><br><span class="line">    <span class="keyword">return</span> a.<span class="property">documentElement</span>.<span class="property">scrollTop</span> || a.<span class="property">body</span>.<span class="property">scrollTop</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取滚动条距左边的高度"><a href="#获取滚动条距左边的高度" class="headerlink" title="获取滚动条距左边的高度"></a>获取滚动条距左边的高度</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getPageScrollLeft</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="variable language_">document</span>;</span><br><span class="line">    <span class="keyword">return</span> a.<span class="property">documentElement</span>.<span class="property">scrollLeft</span> || a.<span class="property">body</span>.<span class="property">scrollLeft</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="开启全屏"><a href="#开启全屏" class="headerlink" title="开启全屏"></a>开启全屏</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; element</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export function <span class="built_in">launchFullscreen</span>(element) &#123;</span><br><span class="line">    if (element.requestFullscreen) &#123;</span><br><span class="line">        element<span class="selector-class">.requestFullscreen</span>()</span><br><span class="line">    &#125; else if (element.mozRequestFullScreen) &#123;</span><br><span class="line">        element<span class="selector-class">.mozRequestFullScreen</span>()</span><br><span class="line">    &#125; else if (element.msRequestFullscreen) &#123;</span><br><span class="line">        element<span class="selector-class">.msRequestFullscreen</span>()</span><br><span class="line">    &#125; else if (element.webkitRequestFullscreen) &#123;</span><br><span class="line">        element<span class="selector-class">.webkitRequestFullScreen</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="关闭全屏"><a href="#关闭全屏" class="headerlink" title="关闭全屏"></a>关闭全屏</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">exitFullscreen</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">exitFullscreen</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">exitFullscreen</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">msExitFullscreen</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">msExitFullscreen</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">mozCancelFullScreen</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">mozCancelFullScreen</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">webkitExitFullscreen</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">webkitExitFullscreen</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="返回当前滚动条位置"><a href="#返回当前滚动条位置" class="headerlink" title="返回当前滚动条位置"></a>返回当前滚动条位置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getScrollPosition</span> = (<span class="params">el = <span class="variable language_">window</span></span>) =&gt; (&#123;</span><br><span class="line">    <span class="attr">x</span>: el.<span class="property">pageXOffset</span> !== <span class="literal">undefined</span> ? el.<span class="property">pageXOffset</span> : el.<span class="property">scrollLeft</span>,</span><br><span class="line">    <span class="attr">y</span>: el.<span class="property">pageYOffset</span> !== <span class="literal">undefined</span> ? el.<span class="property">pageYOffset</span> : el.<span class="property">scrollTop</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="滚动到指定元素区域"><a href="#滚动到指定元素区域" class="headerlink" title="滚动到指定元素区域"></a>滚动到指定元素区域</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> smoothScroll = element =&gt;&#123;</span><br><span class="line">    <span class="built_in">document</span>.<span class="built_in">querySelector</span>(element).scrollIntoView(&#123;</span><br><span class="line">        behavior: <span class="string">&#x27;smooth&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="平滑滚动到页面顶部"><a href="#平滑滚动到页面顶部" class="headerlink" title="平滑滚动到页面顶部"></a>平滑滚动到页面顶部</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export const <span class="attr">scrollToTop</span> = () =&gt; &#123;</span><br><span class="line">    const <span class="attr">c</span> = document.documentElement.scrollTop || document.body.scrollTop<span class="comment">;</span></span><br><span class="line">    if (c &gt; 0) &#123;</span><br><span class="line">        window.requestAnimationFrame(scrollToTop)<span class="comment">;</span></span><br><span class="line">        window.scrollTo(0, c - c / 8)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="http跳转https"><a href="#http跳转https" class="headerlink" title="http跳转https"></a>http跳转https</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">httpsRedirect</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (location.<span class="property">protocol</span> !== <span class="string">&#x27;https:&#x27;</span>) location.<span class="title function_">replace</span>(<span class="string">&#x27;https://&#x27;</span> + location.<span class="property">href</span>.<span class="title function_">split</span>(<span class="string">&#x27;//&#x27;</span>)[<span class="number">1</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="检查页面底部是否可见"><a href="#检查页面底部是否可见" class="headerlink" title="检查页面底部是否可见"></a>检查页面底部是否可见</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">bottomVisible</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span> + <span class="variable language_">window</span>.<span class="property">scrollY</span> &gt;=</span><br><span class="line">        (<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollHeight</span> || <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="打开一个窗口"><a href="#打开一个窗口" class="headerlink" title="打开一个窗口"></a>打开一个窗口</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; string &#125; url</span><br><span class="line"> * @param &#123; string &#125; windowName</span><br><span class="line"> * @param &#123; number &#125; width</span><br><span class="line"> * @param &#123; number &#125; height</span><br><span class="line"> */</span><br><span class="line">export function openWindow(url, windowName, width, height) &#123;</span><br><span class="line">    var <span class="attr">x</span> = parseInt(screen.width / <span class="number">2.0</span>) - width / <span class="number">2.0</span><span class="comment">;</span></span><br><span class="line">    var <span class="attr">y</span> = parseInt(screen.height / <span class="number">2.0</span>) - height / <span class="number">2.0</span><span class="comment">;</span></span><br><span class="line">    var <span class="attr">isMSIE</span> = navigator.appName == <span class="string">&quot;Microsoft Internet Explorer&quot;</span><span class="comment">;</span></span><br><span class="line">    if (isMSIE) &#123;</span><br><span class="line">        var <span class="attr">p</span> = <span class="string">&quot;resizable=1,location=no,scrollbars=no,width=&quot;</span><span class="comment">;</span></span><br><span class="line">        <span class="attr">p</span> = p + width<span class="comment">;</span></span><br><span class="line">        <span class="attr">p</span> = p + <span class="string">&quot;,height=&quot;</span><span class="comment">;</span></span><br><span class="line">        <span class="attr">p</span> = p + height<span class="comment">;</span></span><br><span class="line">        <span class="attr">p</span> = p + <span class="string">&quot;,left=&quot;</span><span class="comment">;</span></span><br><span class="line">        <span class="attr">p</span> = p + x<span class="comment">;</span></span><br><span class="line">        <span class="attr">p</span> = p + <span class="string">&quot;,top=&quot;</span><span class="comment">;</span></span><br><span class="line">        <span class="attr">p</span> = p + y<span class="comment">;</span></span><br><span class="line">        window.open(url, windowName, p)<span class="comment">;</span></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        var <span class="attr">win</span> = window.open(</span><br><span class="line">            url,</span><br><span class="line">            &quot;ZyiisPopup&quot;,</span><br><span class="line">            &quot;<span class="attr">top</span>=<span class="string">&quot; +</span></span><br><span class="line"><span class="string">            y +</span></span><br><span class="line"><span class="string">            &quot;</span>,left=<span class="string">&quot; +</span></span><br><span class="line"><span class="string">            x +</span></span><br><span class="line"><span class="string">            &quot;</span>,scrollbars=<span class="string">&quot; +</span></span><br><span class="line"><span class="string">            scrollbars +</span></span><br><span class="line"><span class="string">            &quot;</span>,dialog=<span class="literal">yes</span>,modal=<span class="literal">yes</span>,width=<span class="string">&quot; +</span></span><br><span class="line"><span class="string">            width +</span></span><br><span class="line"><span class="string">            &quot;</span>,height=<span class="string">&quot; +</span></span><br><span class="line"><span class="string">            height +</span></span><br><span class="line"><span class="string">            &quot;</span>,resizable=<span class="literal">no</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        );</span></span><br><span class="line"><span class="string">        eval(&quot;</span>try &#123; win.resizeTo(width, height)<span class="comment">; &#125; catch(e) &#123; &#125;&quot;);</span></span><br><span class="line">        win.focus()<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="自适应页面（rem）"><a href="#自适应页面（rem）" class="headerlink" title="自适应页面（rem）"></a>自适应页面（rem）</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; number &#125; width</span><br><span class="line"> */</span><br><span class="line">export function AutoResponse(<span class="attr">width</span> = <span class="number">750</span>) &#123;</span><br><span class="line">    const <span class="attr">target</span> = document.documentElement<span class="comment">;</span></span><br><span class="line">    target.clientWidth &gt;= 600</span><br><span class="line">        ? (<span class="attr">target.style.fontSize</span> = <span class="string">&quot;80px&quot;</span>)</span><br><span class="line">        : (<span class="attr">target.style.fontSize</span> = target.clientWidth / width * <span class="number">100</span> + <span class="string">&quot;px&quot;</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="日期工具date工具函数"><a href="#日期工具date工具函数" class="headerlink" title="日期工具date工具函数"></a>日期工具date工具函数</h2><p>可以参考我的另一篇文章《<a href="https://juejin.cn/post/6844904046076100622">前端的各种日期操作</a>》，或者直接到我的<a href="https://link.juejin.cn/?target=https://github.com/XmanLin/MyUtils">GitHub</a>查看</p><h2 id="浏览器存储相关storage工具函数"><a href="#浏览器存储相关storage工具函数" class="headerlink" title="浏览器存储相关storage工具函数"></a>浏览器存储相关storage工具函数</h2><p>主要为浏览器存储方面的工具函数，大部分搬运自大神<a href="https://juejin.cn/post/6844904009594044423">火狼1</a></p><h3 id="localStorage-存贮"><a href="#localStorage-存贮" class="headerlink" title="localStorage 存贮"></a>localStorage 存贮</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 目前对象值如果是函数 、RegExp等特殊对象存贮会被忽略</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> String </span>&#125; key  属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; value 值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">localStorageSet</span> = (<span class="params">key, value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (value) === <span class="string">&#x27;object&#x27;</span>) value = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value);</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, value)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="localStorage-获取"><a href="#localStorage-获取" class="headerlink" title="localStorage 获取"></a>localStorage 获取</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; key  属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">localStorageGet</span> = (<span class="params">key</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="localStorage-移除"><a href="#localStorage-移除" class="headerlink" title="localStorage 移除"></a>localStorage 移除</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; key  属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">localStorageRemove</span> = (<span class="params">key</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="localStorage-存贮某一段时间失效"><a href="#localStorage-存贮某一段时间失效" class="headerlink" title="localStorage 存贮某一段时间失效"></a>localStorage 存贮某一段时间失效</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; key  属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; value 存贮值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> number </span>&#125; expire 过期时间,毫秒数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">localStorageSetExpire</span> = (<span class="params">key, value, expire</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (value) === <span class="string">&#x27;object&#x27;</span>) value = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value);</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, value);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">    &#125;, expire)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="sessionStorage-存贮"><a href="#sessionStorage-存贮" class="headerlink" title="sessionStorage 存贮"></a>sessionStorage 存贮</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; key  属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; value 值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">sessionStorageSet</span> = (<span class="params">key, value</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (value) === <span class="string">&#x27;object&#x27;</span>) value = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value);</span><br><span class="line">    sessionStorage.<span class="title function_">setItem</span>(key, value)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="sessionStorage-获取"><a href="#sessionStorage-获取" class="headerlink" title="sessionStorage 获取"></a>sessionStorage 获取</h3><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;<span class="type">String</span>&#125; <span class="keyword">key</span>  属性</span><br><span class="line"> */</span><br><span class="line">export <span class="keyword">const</span> sessionStorageGet = (<span class="keyword">key</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> sessionStorage.getItem(<span class="keyword">key</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="sessionStorage-删除"><a href="#sessionStorage-删除" class="headerlink" title="sessionStorage 删除"></a>sessionStorage 删除</h3><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;<span class="type">String</span>&#125; <span class="keyword">key</span>  属性</span><br><span class="line"> */</span><br><span class="line">export <span class="keyword">const</span> sessionStorageRemove = (<span class="keyword">key</span>) =&gt; &#123;</span><br><span class="line">    sessionStorage.removeItem(<span class="keyword">key</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="sessionStorage-存贮某一段时间失效"><a href="#sessionStorage-存贮某一段时间失效" class="headerlink" title="sessionStorage 存贮某一段时间失效"></a>sessionStorage 存贮某一段时间失效</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; key  属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; value 存贮值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; expire 过期时间,毫秒数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">sessionStorageSetExpire</span> = (<span class="params">key, value, expire</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (value) === <span class="string">&#x27;object&#x27;</span>) value = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value);</span><br><span class="line">    sessionStorage.<span class="title function_">setItem</span>(key, value);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        sessionStorage.<span class="title function_">removeItem</span>(key)</span><br><span class="line">    &#125;, expire)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="cookie-存贮"><a href="#cookie-存贮" class="headerlink" title="cookie 存贮"></a>cookie 存贮</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; key  属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; value  值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> String </span>&#125; expire  过期时间,单位天</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">cookieSet</span> = (<span class="params">key, value, expire</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> d = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    d.<span class="title function_">setDate</span>(d.<span class="title function_">getDate</span>() + expire);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>;expires=<span class="subst">$&#123;d.toUTCString()&#125;</span>`</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="cookie-获取"><a href="#cookie-获取" class="headerlink" title="cookie 获取"></a>cookie 获取</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;String&#125; key  属性</span><br><span class="line"> */</span><br><span class="line">export const <span class="attr">cookieGet</span> = (key) =&gt; &#123;</span><br><span class="line">    const <span class="attr">cookieStr</span> = unescape(document.cookie)<span class="comment">;</span></span><br><span class="line">    const <span class="attr">arr</span> = cookieStr.split(<span class="string">&#x27;; &#x27;</span>)<span class="comment">;</span></span><br><span class="line">    let <span class="attr">cookieValue</span> = <span class="string">&#x27;&#x27;</span><span class="comment">;</span></span><br><span class="line">    for (let <span class="attr">i</span> = <span class="number">0</span><span class="comment">; i &lt; arr.length; i++) &#123;</span></span><br><span class="line">        const <span class="attr">temp</span> = arr[i].split(<span class="string">&#x27;=&#x27;</span>)<span class="comment">;</span></span><br><span class="line">        if (temp<span class="section">[0]</span> === key) &#123;</span><br><span class="line">            <span class="attr">cookieValue</span> = temp[<span class="number">1</span>]<span class="comment">;</span></span><br><span class="line">            break</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return cookieValue</span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="cookie-删除"><a href="#cookie-删除" class="headerlink" title="cookie 删除"></a>cookie 删除</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; key  属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">cookieRemove</span> = (<span class="params">key</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">`<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(key)&#125;</span>=;expires=<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>()&#125;</span>`</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="更多的工具函数"><a href="#更多的工具函数" class="headerlink" title="更多的工具函数"></a>更多的工具函数</h2><p>这里包含了平时可能常用的工具函数，包含数字，字符串，数组和对象等等操作。</p><h3 id="金钱格式化，三位加逗号"><a href="#金钱格式化，三位加逗号" class="headerlink" title="金钱格式化，三位加逗号"></a>金钱格式化，三位加逗号</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> number </span>&#125; <span class="variable">num</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">formatMoney</span> = num =&gt; num.<span class="title function_">toString</span>().<span class="title function_">replace</span>(<span class="regexp">/\B(?=(\d&#123;3&#125;)+(?!\d))/g</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="截取字符串并加身略号"><a href="#截取字符串并加身略号" class="headerlink" title="截取字符串并加身略号"></a>截取字符串并加身略号</h3><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export <span class="function"><span class="keyword">function</span> <span class="title">subText</span><span class="params">(str, length)</span> &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (str.<span class="built_in">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (str.<span class="built_in">length</span> &gt; <span class="built_in">length</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> str.substr(<span class="number">0</span>, <span class="built_in">length</span>) + <span class="string">&quot;...&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取文件base64编码"><a href="#获取文件base64编码" class="headerlink" title="获取文件base64编码"></a>获取文件base64编码</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param file</span><br><span class="line"> * @param format  指定文件格式</span><br><span class="line"> * @param size  指定文件大小(字节)</span><br><span class="line"> * @param formatMsg 格式错误提示</span><br><span class="line"> * @param sizeMsg   大小超出限制提示</span><br><span class="line"> * @returns &#123;Promise&lt;any&gt;&#125;</span><br><span class="line"> */</span><br><span class="line">export function fileToBase64String(file, <span class="attr">format</span> = [<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>], size = <span class="number">20</span> * <span class="number">1024</span> * <span class="number">1024</span>, formatMsg = <span class="string">&#x27;文件格式不正确&#x27;</span>, sizeMsg = <span class="string">&#x27;文件大小超出限制&#x27;</span>) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        // 格式过滤</span><br><span class="line">        let <span class="attr">suffix</span> = file.type.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>].toLowerCase()<span class="comment">;</span></span><br><span class="line">        let <span class="attr">inFormat</span> = <span class="literal">false</span><span class="comment">;</span></span><br><span class="line">        for (let <span class="attr">i</span> = <span class="number">0</span><span class="comment">; i &lt; format.length; i++) &#123;</span></span><br><span class="line">            if (<span class="attr">suffix</span> === format[i]) &#123;</span><br><span class="line">                <span class="attr">inFormat</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">                break<span class="comment">;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!inFormat) &#123;</span><br><span class="line">            reject(formatMsg)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        // 大小过滤</span><br><span class="line">        if (file.size &gt; size) &#123;</span><br><span class="line">            reject(sizeMsg)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        // 转base64字符串</span><br><span class="line">        let <span class="attr">fileReader</span> = new FileReader()<span class="comment">;</span></span><br><span class="line">        fileReader.readAsDataURL(file)<span class="comment">;</span></span><br><span class="line">        <span class="attr">fileReader.onload</span> = () =&gt; &#123;</span><br><span class="line">            let <span class="attr">res</span> = fileReader.result<span class="comment">;</span></span><br><span class="line">            resolve(&#123;base64String: res, suffix: suffix&#125;)<span class="comment">;</span></span><br><span class="line">            reject(&#x27;异常文件，请重新选择&#x27;)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="B转换到KB-MB-GB并保留两位小数"><a href="#B转换到KB-MB-GB并保留两位小数" class="headerlink" title="B转换到KB,MB,GB并保留两位小数"></a>B转换到KB,MB,GB并保留两位小数</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; number &#125; fileSize</span><br><span class="line"> */</span><br><span class="line">export function formatFileSize(fileSize) &#123;</span><br><span class="line">    let temp<span class="comment">;</span></span><br><span class="line">    if (fileSize &lt; 1024) &#123;</span><br><span class="line">        return fileSize + &#x27;B&#x27;<span class="comment">;</span></span><br><span class="line">    &#125; else if (fileSize &lt; (1024 * 1024)) &#123;</span><br><span class="line">        <span class="attr">temp</span> = fileSize / <span class="number">1024</span><span class="comment">;</span></span><br><span class="line">        <span class="attr">temp</span> = temp.toFixed(<span class="number">2</span>)<span class="comment">;</span></span><br><span class="line">        return temp + &#x27;KB&#x27;<span class="comment">;</span></span><br><span class="line">    &#125; else if (fileSize &lt; (1024 * 1024 * 1024)) &#123;</span><br><span class="line">        <span class="attr">temp</span> = fileSize / (<span class="number">1024</span> * <span class="number">1024</span>)<span class="comment">;</span></span><br><span class="line">        <span class="attr">temp</span> = temp.toFixed(<span class="number">2</span>)<span class="comment">;</span></span><br><span class="line">        return temp + &#x27;MB&#x27;<span class="comment">;</span></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        <span class="attr">temp</span> = fileSize / (<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1024</span>)<span class="comment">;</span></span><br><span class="line">        <span class="attr">temp</span> = temp.toFixed(<span class="number">2</span>)<span class="comment">;</span></span><br><span class="line">        return temp + &#x27;GB&#x27;<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="base64转file"><a href="#base64转file" class="headerlink" title="base64转file"></a>base64转file</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  @param &#123; base64 &#125; base64</span><br><span class="line"> *  @param &#123; string &#125; filename 转换后的文件名</span><br><span class="line"> */</span><br><span class="line">export const <span class="attr">base64ToFile</span> = (base64, filename )=&gt; &#123;</span><br><span class="line">    let <span class="attr">arr</span> = base64.split(<span class="string">&#x27;,&#x27;</span>)<span class="comment">;</span></span><br><span class="line">    let <span class="attr">mime</span> = arr[<span class="number">0</span>].match(/:(.*?)<span class="comment">;/)[1];</span></span><br><span class="line">    let <span class="attr">suffix</span> = mime.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>] <span class="comment">;// 图片后缀</span></span><br><span class="line">    let <span class="attr">bstr</span> = atob(arr[<span class="number">1</span>])<span class="comment">;</span></span><br><span class="line">    let <span class="attr">n</span> = bstr.length<span class="comment">;</span></span><br><span class="line">    let <span class="attr">u8arr</span> = new Uint8Array(n)<span class="comment">;</span></span><br><span class="line">    while (n--) &#123;</span><br><span class="line">        u8arr<span class="section">[n]</span> = bstr.charCodeAt(n)</span><br><span class="line">    &#125;</span><br><span class="line">    return new File(<span class="section">[u8arr]</span>, `$&#123;filename&#125;.$&#123;suffix&#125;`, &#123; type: mime &#125;)</span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="base64转blob"><a href="#base64转blob" class="headerlink" title="base64转blob"></a>base64转blob</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  @param &#123; base64 &#125; base64</span><br><span class="line"> */</span><br><span class="line">export const <span class="attr">base64ToBlob</span> = base64 =&gt; &#123;</span><br><span class="line">    let <span class="attr">arr</span> = base64.split(<span class="string">&#x27;,&#x27;</span>),</span><br><span class="line">        <span class="attr">mime</span> = arr[<span class="number">0</span>].match(/:(.*?)<span class="comment">;/)[1],</span></span><br><span class="line">        <span class="attr">bstr</span> = atob(arr[<span class="number">1</span>]),</span><br><span class="line">        <span class="attr">n</span> = bstr.length,</span><br><span class="line">        <span class="attr">u8arr</span> = new Uint8Array(n)<span class="comment">;</span></span><br><span class="line">    while (n--) &#123;</span><br><span class="line">        u8arr<span class="section">[n]</span> = bstr.charCodeAt(n)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    return new Blob(<span class="section">[u8arr]</span>, &#123; type: mime &#125;)<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="blob转file"><a href="#blob转file" class="headerlink" title="blob转file"></a>blob转file</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  @param &#123; blob &#125; blob</span><br><span class="line"> *  @param &#123; string &#125; fileName</span><br><span class="line"> */</span><br><span class="line">export const <span class="attr">blobToFile</span> = (blob, fileName) =&gt; &#123;</span><br><span class="line">    <span class="attr">blob.lastModifiedDate</span> = new Date()<span class="comment">;</span></span><br><span class="line">    <span class="attr">blob.name</span> = fileName<span class="comment">;</span></span><br><span class="line">    return blob<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="file转base64"><a href="#file转base64" class="headerlink" title="file转base64"></a>file转base64</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; * &#125; file 图片文件</span><br><span class="line"> */</span><br><span class="line">export const <span class="attr">fileToBase64</span> = file =&gt; &#123;</span><br><span class="line">    let <span class="attr">reader</span> = new FileReader()<span class="comment">;</span></span><br><span class="line">    reader.readAsDataURL(file)<span class="comment">;</span></span><br><span class="line">    <span class="attr">reader.onload</span> = function (e) &#123;</span><br><span class="line">        return e.target.result</span><br><span class="line">    &#125;<span class="comment">;</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="递归生成树形结构"><a href="#递归生成树形结构" class="headerlink" title="递归生成树形结构"></a>递归生成树形结构</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">export function getTreeData(data, pid, <span class="attr">pidName</span> = <span class="string">&#x27;parentId&#x27;</span>, idName = <span class="string">&#x27;id&#x27;</span>, childrenName = <span class="string">&#x27;children&#x27;</span>, key) &#123;</span><br><span class="line">    let <span class="attr">arr</span> = []<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    for (let <span class="attr">i</span> = <span class="number">0</span><span class="comment">; i &lt; data.length; i++) &#123;</span></span><br><span class="line">        if (data<span class="section">[i]</span><span class="section">[pidName]</span> == pid) &#123;</span><br><span class="line">            data<span class="section">[i]</span>.<span class="attr">key</span> = data[i][idName]<span class="comment">;</span></span><br><span class="line">            data<span class="section">[i]</span><span class="section">[childrenName]</span> = getTreeData(data, data<span class="section">[i]</span><span class="section">[idName]</span>, pidName, idName, childrenName)<span class="comment">;</span></span><br><span class="line">            arr.push(data<span class="section">[i]</span>)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return arr<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="遍历树节点"><a href="#遍历树节点" class="headerlink" title="遍历树节点"></a>遍历树节点</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export function foreachTree(data, <span class="attr">childrenName</span> = <span class="string">&#x27;children&#x27;</span>, callback) &#123;</span><br><span class="line">    for (let <span class="attr">i</span> = <span class="number">0</span><span class="comment">; i &lt; data.length; i++) &#123;</span></span><br><span class="line">        callback(data<span class="section">[i]</span>)<span class="comment">;</span></span><br><span class="line">        if (data<span class="section">[i]</span><span class="section">[childrenName]</span> &amp;&amp; data<span class="section">[i]</span><span class="section">[childrenName]</span>.length &gt; 0) &#123;</span><br><span class="line">            foreachTree(data<span class="section">[i]</span><span class="section">[childrenName]</span>, childrenName, callback)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="追溯父节点"><a href="#追溯父节点" class="headerlink" title="追溯父节点"></a>追溯父节点</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">export function traceParentNode(pid, data, rootPid, <span class="attr">pidName</span> = <span class="string">&#x27;parentId&#x27;</span>, idName = <span class="string">&#x27;id&#x27;</span>, childrenName = <span class="string">&#x27;children&#x27;</span>) &#123;</span><br><span class="line">    let <span class="attr">arr</span> = []<span class="comment">;</span></span><br><span class="line">    foreachTree(data, childrenName, (node) =&gt; &#123;</span><br><span class="line">        if (node<span class="section">[idName]</span> == pid) &#123;</span><br><span class="line">            arr.push(node)<span class="comment">;</span></span><br><span class="line">            if (node<span class="section">[pidName]</span> != rootPid) &#123;</span><br><span class="line">                <span class="attr">arr</span> = arr.concat(traceParentNode(node[pidName], data, rootPid, pidName, idName))<span class="comment">;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">    return arr<span class="comment">; </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="寻找所有子节点"><a href="#寻找所有子节点" class="headerlink" title="寻找所有子节点"></a>寻找所有子节点</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">export function traceChildNode(id, data, <span class="attr">pidName</span> = <span class="string">&#x27;parentId&#x27;</span>, idName = <span class="string">&#x27;id&#x27;</span>, childrenName = <span class="string">&#x27;children&#x27;</span>) &#123;</span><br><span class="line">    let <span class="attr">arr</span> = []<span class="comment">;</span></span><br><span class="line">    foreachTree(data, childrenName, (node) =&gt; &#123;</span><br><span class="line">        if (node<span class="section">[pidName]</span> == id) &#123;</span><br><span class="line">            arr.push(node)<span class="comment">;</span></span><br><span class="line">            <span class="attr">arr</span> = arr.concat(traceChildNode(node[idName], data, pidName, idName, childrenName))<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)<span class="comment">;</span></span><br><span class="line">    return arr<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="根据pid生成树形结构"><a href="#根据pid生成树形结构" class="headerlink" title="根据pid生成树形结构"></a>根据pid生成树形结构</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> object </span>&#125; items 后台获取的数据</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> * </span>&#125; id 数据中的id</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> &#123;<span class="type"> * </span>&#125; link 生成树形结构的依据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">createTree</span> = (<span class="params">items, id = <span class="literal">null</span>, link = <span class="string">&#x27;pid&#x27;</span></span>) =&gt;&#123;</span><br><span class="line">    items.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item[link] === id).<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123; ...item, <span class="attr">children</span>: <span class="title function_">createTree</span>(items, item.<span class="property">id</span>) &#125;));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="查询数组中是否存在某个元素并返回元素第一次出现的下标"><a href="#查询数组中是否存在某个元素并返回元素第一次出现的下标" class="headerlink" title="查询数组中是否存在某个元素并返回元素第一次出现的下标"></a>查询数组中是否存在某个元素并返回元素第一次出现的下标</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;*&#125; item </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123; array &#125; data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export function inArray(item, <span class="keyword">data</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (let i = <span class="number">0</span>; i &lt; <span class="keyword">data</span>.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (item === <span class="keyword">data</span>[i]) &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Windows根据详细版本号判断当前系统名称"><a href="#Windows根据详细版本号判断当前系统名称" class="headerlink" title="Windows根据详细版本号判断当前系统名称"></a>Windows根据详细版本号判断当前系统名称</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123; string &#125; osVersion </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export function OutOsName(osVersion) &#123;</span><br><span class="line">    <span class="keyword">if</span>(!osVersion)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    let str = osVersion.substr(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span> (str === <span class="string">&quot;5.0&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win 2000&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str === <span class="string">&quot;5.1&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win XP&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str === <span class="string">&quot;5.2&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win XP64&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str === <span class="string">&quot;6.0&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win Vista&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str === <span class="string">&quot;6.1&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win 7&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str === <span class="string">&quot;6.2&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win 8&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str === <span class="string">&quot;6.3&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win 8.1&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str === <span class="string">&quot;10.&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win 10&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Win&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="判断手机是Andoird还是IOS"><a href="#判断手机是Andoird还是IOS" class="headerlink" title="判断手机是Andoird还是IOS"></a>判断手机是Andoird还是IOS</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  0: ios</span><br><span class="line"> *  1: android</span><br><span class="line"> *  2: 其它</span><br><span class="line"> */</span><br><span class="line">export function getOSType() &#123;</span><br><span class="line">    let <span class="attr">u</span> = navigator.userAgent, app = navigator.appVersion<span class="comment">;</span></span><br><span class="line">    let <span class="attr">isAndroid</span> = u.indexOf(<span class="string">&#x27;Android&#x27;</span>) &gt; -<span class="number">1</span> || u.indexOf(<span class="string">&#x27;Linux&#x27;</span>) &gt; -<span class="number">1</span><span class="comment">;</span></span><br><span class="line">    let <span class="attr">isIOS</span> = !!u.match(/\(i[^<span class="comment">;]+;( U;)? CPU.+Mac OS X/);</span></span><br><span class="line">    if (isIOS) &#123;</span><br><span class="line">        return <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    if (isAndroid) &#123;</span><br><span class="line">        return <span class="number">1</span><span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    return <span class="number">2</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="函数防抖"><a href="#函数防抖" class="headerlink" title="函数防抖"></a>函数防抖</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; <span class="keyword">function</span> &#125; func</span><br><span class="line"> * @param &#123; number &#125; <span class="built_in">wait</span> 延迟执行毫秒数</span><br><span class="line"> * @param &#123; boolean &#125; immediate  <span class="literal">true</span> 表立即执行，<span class="literal">false</span> 表非立即执行</span><br><span class="line"> */</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> debounce(func,<span class="built_in">wait</span>,immediate) &#123;</span><br><span class="line">    <span class="built_in">let</span> <span class="built_in">timeout</span>;</span><br><span class="line">    <span class="built_in">return</span> <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">        <span class="built_in">let</span> context = this;</span><br><span class="line">        <span class="built_in">let</span> args = arguments;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">timeout</span>) clearTimeout(<span class="built_in">timeout</span>);</span><br><span class="line">        <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">            <span class="built_in">let</span> callNow = !<span class="built_in">timeout</span>;</span><br><span class="line">            <span class="built_in">timeout</span> = setTimeout(() =&gt; &#123;</span><br><span class="line">                <span class="built_in">timeout</span> = null;</span><br><span class="line">            &#125;, <span class="built_in">wait</span>);</span><br><span class="line">            <span class="keyword">if</span> (callNow) func.apply(context, args)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">timeout</span> = setTimeout(() =&gt; &#123;</span><br><span class="line">                func.apply(context, args)</span><br><span class="line">            &#125;, <span class="built_in">wait</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="函数节流"><a href="#函数节流" class="headerlink" title="函数节流"></a>函数节流</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; function &#125; func 函数</span><br><span class="line"> * @param &#123; number &#125; wait 延迟执行毫秒数</span><br><span class="line"> * @param &#123; number &#125; type 1 表时间戳版，2 表定时器版</span><br><span class="line"> */</span><br><span class="line">export function throttle(func, wait ,type) &#123;</span><br><span class="line">    let previous, timeout<span class="comment">;</span></span><br><span class="line">    if(<span class="attr">type</span>===<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="attr">previous</span> = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    &#125;else if(<span class="attr">type</span>===<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="attr">timeout</span> = null<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    return function() &#123;</span><br><span class="line">        let <span class="attr">context</span> = this<span class="comment">;</span></span><br><span class="line">        let <span class="attr">args</span> = arguments<span class="comment">;</span></span><br><span class="line">        if(<span class="attr">type</span>===<span class="number">1</span>)&#123;</span><br><span class="line">            let <span class="attr">now</span> = Date.now()<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">            if (now - previous &gt; wait) &#123;</span><br><span class="line">                func.apply(context, args)<span class="comment">;</span></span><br><span class="line">                <span class="attr">previous</span> = now<span class="comment">;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else if(<span class="attr">type</span>===<span class="number">2</span>)&#123;</span><br><span class="line">            if (!timeout) &#123;</span><br><span class="line">                <span class="attr">timeout</span> = setTimeout(() =&gt; &#123;</span><br><span class="line">                    <span class="attr">timeout</span> = null<span class="comment">;</span></span><br><span class="line">                    func.apply(context, args)</span><br><span class="line">                &#125;, wait)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="判断数据类型"><a href="#判断数据类型" class="headerlink" title="判断数据类型"></a>判断数据类型</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; target </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">type</span>(<span class="params">target</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> ret = <span class="title function_">typeof</span>(target);</span><br><span class="line">    <span class="keyword">let</span> template = &#123;</span><br><span class="line">        <span class="string">&quot;[object Array]&quot;</span>: <span class="string">&quot;array&quot;</span>,</span><br><span class="line">        <span class="string">&quot;[object Object]&quot;</span>:<span class="string">&quot;object&quot;</span>,</span><br><span class="line">        <span class="string">&quot;[object Number]&quot;</span>:<span class="string">&quot;number - object&quot;</span>,</span><br><span class="line">        <span class="string">&quot;[object Boolean]&quot;</span>:<span class="string">&quot;boolean - object&quot;</span>,</span><br><span class="line">        <span class="string">&quot;[object String]&quot;</span>:<span class="string">&#x27;string-object&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(target === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;null&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ret == <span class="string">&quot;object&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> str = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(target);</span><br><span class="line">        <span class="keyword">return</span> template[str];</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="生成指定范围随机数"><a href="#生成指定范围随机数" class="headerlink" title="生成指定范围随机数"></a>生成指定范围随机数</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @param &#123; number &#125; min </span></span><br><span class="line"><span class="comment"> * @param &#123; number &#125; max </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="type">const</span> RandomNum = (min, max) =&gt; Math.<span class="built_in">floor</span>(Math.<span class="built_in">random</span>() * (max - min + <span class="number">1</span>)) + min;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="数组乱序"><a href="#数组乱序" class="headerlink" title="数组乱序"></a>数组乱序</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123;array&#125; arr</span><br><span class="line"> */</span><br><span class="line">export function arrScrambling(arr) &#123;</span><br><span class="line">    let <span class="attr">array</span> = arr<span class="comment">;</span></span><br><span class="line">    let <span class="attr">index</span> = array.length<span class="comment">;</span></span><br><span class="line">    while (index) &#123;</span><br><span class="line">        index <span class="attr">-</span>= <span class="number">1</span><span class="comment">;</span></span><br><span class="line">        let <span class="attr">randomIndex</span> = Math.floor(Math.random() * index)<span class="comment">;</span></span><br><span class="line">        let <span class="attr">middleware</span> = array[index]<span class="comment">;</span></span><br><span class="line">        array<span class="section">[index]</span> = array<span class="section">[randomIndex]</span><span class="comment">;</span></span><br><span class="line">        array<span class="section">[randomIndex]</span> = middleware</span><br><span class="line">    &#125;</span><br><span class="line">    return array</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="数组交集"><a href="#数组交集" class="headerlink" title="数组交集"></a>数组交集</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> array</span>&#125; <span class="variable">arr1</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> array </span>&#125; <span class="variable">arr2</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">similarity</span> = (<span class="params">arr1, arr2</span>) =&gt; arr1.<span class="title function_">filter</span>(<span class="function"><span class="params">v</span> =&gt;</span> arr2.<span class="title function_">includes</span>(v));</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="数组中某元素出现的次数"><a href="#数组中某元素出现的次数" class="headerlink" title="数组中某元素出现的次数"></a>数组中某元素出现的次数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> array </span>&#125; <span class="variable">arr</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">countOccurrences</span>(<span class="params">arr, value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, v</span>) =&gt;</span> v === value ? a + <span class="number">1</span> : a + <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="加法函数（精度丢失问题）"><a href="#加法函数（精度丢失问题）" class="headerlink" title="加法函数（精度丢失问题）"></a>加法函数（精度丢失问题）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> number </span>&#125; <span class="variable">arg1</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> number </span>&#125; <span class="variable">arg2</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">arg1, arg2</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> r1, r2, m;</span><br><span class="line">    <span class="keyword">try</span> &#123; r1 = arg1.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>].<span class="property">length</span> &#125; <span class="keyword">catch</span> (e) &#123; r1 = <span class="number">0</span> &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123; r2 = arg2.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>].<span class="property">length</span> &#125; <span class="keyword">catch</span> (e) &#123; r2 = <span class="number">0</span> &#125;</span><br><span class="line">    m = <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, <span class="title class_">Math</span>.<span class="title function_">max</span>(r1, r2));</span><br><span class="line">    <span class="keyword">return</span> (arg1 * m + arg2 * m) / m</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="减法函数（精度丢失问题）"><a href="#减法函数（精度丢失问题）" class="headerlink" title="减法函数（精度丢失问题）"></a>减法函数（精度丢失问题）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> number </span>&#125; <span class="variable">arg1</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> number </span>&#125; <span class="variable">arg2</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">sub</span>(<span class="params">arg1, arg2</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> r1, r2, m, n;</span><br><span class="line">    <span class="keyword">try</span> &#123; r1 = arg1.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>].<span class="property">length</span> &#125; <span class="keyword">catch</span> (e) &#123; r1 = <span class="number">0</span> &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123; r2 = arg2.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>].<span class="property">length</span> &#125; <span class="keyword">catch</span> (e) &#123; r2 = <span class="number">0</span> &#125;</span><br><span class="line">    m = <span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>, <span class="title class_">Math</span>.<span class="title function_">max</span>(r1, r2));</span><br><span class="line">    n = (r1 &gt;= r2) ? r1 : r2;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Number</span>(((arg1 * m - arg2 * m) / m).<span class="title function_">toFixed</span>(n));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="除法函数（精度丢失问题）"><a href="#除法函数（精度丢失问题）" class="headerlink" title="除法函数（精度丢失问题）"></a>除法函数（精度丢失问题）</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; number &#125; num1</span><br><span class="line"> * @param &#123; number &#125; num2</span><br><span class="line"> */</span><br><span class="line">export function division(num1,num2)&#123;</span><br><span class="line">    let t1,t2,r1,r2<span class="comment">;</span></span><br><span class="line">    try&#123;</span><br><span class="line">        <span class="attr">t1</span> = num1.toString().split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">1</span>].length<span class="comment">;</span></span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        <span class="attr">t1</span> = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    try&#123;</span><br><span class="line">        <span class="attr">t2</span>=num2.toString().split(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>].length<span class="comment">;</span></span><br><span class="line">    &#125;catch(e)&#123;</span><br><span class="line">        <span class="attr">t2</span>=<span class="number">0</span><span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">r1</span>=Number(num1.toString().replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;&quot;</span>))<span class="comment">;</span></span><br><span class="line">    <span class="attr">r2</span>=Number(num2.toString().replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;&quot;</span>))<span class="comment">;</span></span><br><span class="line">    return (r1/r2)*Math.pow(10,t2-t1)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="乘法函数（精度丢失问题）"><a href="#乘法函数（精度丢失问题）" class="headerlink" title="乘法函数（精度丢失问题）"></a>乘法函数（精度丢失问题）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> number </span>&#125; <span class="variable">num1</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> number </span>&#125; <span class="variable">num2</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mcl</span>(<span class="params">num1,num2</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> m=<span class="number">0</span>,s1=num1.<span class="title function_">toString</span>(),s2=num2.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">try</span>&#123;m+=s1.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>].<span class="property">length</span>&#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br><span class="line">    <span class="keyword">try</span>&#123;m+=s2.<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>].<span class="property">length</span>&#125;<span class="keyword">catch</span>(e)&#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Number</span>(s1.<span class="title function_">replace</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;&quot;</span>))*<span class="title class_">Number</span>(s2.<span class="title function_">replace</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;&quot;</span>))/<span class="title class_">Math</span>.<span class="title function_">pow</span>(<span class="number">10</span>,m);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="递归优化（尾递归）"><a href="#递归优化（尾递归）" class="headerlink" title="递归优化（尾递归）"></a>递归优化（尾递归）</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; function &#125; f</span><br><span class="line"> */</span><br><span class="line">export function tco(f) &#123;</span><br><span class="line">    let value<span class="comment">;</span></span><br><span class="line">    let <span class="attr">active</span> = <span class="literal">false</span><span class="comment">;</span></span><br><span class="line">    let <span class="attr">accumulated</span> = []<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    return function accumulator() &#123;</span><br><span class="line">        accumulated.push(arguments)<span class="comment">;</span></span><br><span class="line">        if (!active) &#123;</span><br><span class="line">            <span class="attr">active</span> = <span class="literal">true</span><span class="comment">;</span></span><br><span class="line">            while (accumulated.length) &#123;</span><br><span class="line">                <span class="attr">value</span> = f.apply(this, accumulated.shift())<span class="comment">;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="attr">active</span> = <span class="literal">false</span><span class="comment">;</span></span><br><span class="line">            return value<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="生成随机整数"><a href="#生成随机整数" class="headerlink" title="生成随机整数"></a>生成随机整数</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">export</span> function <span class="title">randomNumInteger</span><span class="params">(min, max)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (arguments.length) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">parseInt</span>(Math.<span class="built_in">random</span>() * min + <span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">parseInt</span>(Math.<span class="built_in">random</span>() * (max - min + <span class="number">1</span>) + min, <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="去除空格"><a href="#去除空格" class="headerlink" title="去除空格"></a>去除空格</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; str 待处理字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type"> number </span>&#125; type 去除空格类型 1-所有空格  2-前后空格  3-前空格 4-后空格 默认为1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">trim</span>(<span class="params">str, <span class="keyword">type</span> = <span class="number">1</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">type</span> &amp;&amp; <span class="keyword">type</span> !== <span class="number">1</span> &amp;&amp; <span class="keyword">type</span> !== <span class="number">2</span> &amp;&amp; <span class="keyword">type</span> !== <span class="number">3</span> &amp;&amp; <span class="keyword">type</span> !== <span class="number">4</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/\s/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/(^\s)|(\s*$)/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/(^\s)/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/(\s$)/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="大小写转换"><a href="#大小写转换" class="headerlink" title="大小写转换"></a>大小写转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @param &#123; string &#125; <span class="built_in">str</span> 待转换的字符串</span><br><span class="line"> * @param &#123; number &#125; <span class="built_in">type</span> <span class="number">1</span>-全大写 <span class="number">2</span>-全小写 <span class="number">3</span>-首字母大写 其他-不转换</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">export function turnCase(<span class="built_in">str</span>, <span class="built_in">type</span>) &#123;</span><br><span class="line">    switch (<span class="built_in">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>.toUpperCase();</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>.toLowerCase();</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>[<span class="number">0</span>].toUpperCase() + <span class="built_in">str</span>.substr(<span class="number">1</span>).toLowerCase();</span><br><span class="line">        default:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="随机16进制颜色-hexColor"><a href="#随机16进制颜色-hexColor" class="headerlink" title="随机16进制颜色 hexColor"></a>随机16进制颜色 hexColor</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 方法一</span><br><span class="line"> */</span><br><span class="line">export function hexColor() &#123;</span><br><span class="line"></span><br><span class="line">    let <span class="attr">str</span> = <span class="string">&#x27;#&#x27;</span><span class="comment">;</span></span><br><span class="line">    let <span class="attr">arr</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>]<span class="comment">;</span></span><br><span class="line">    for (let <span class="attr">i</span> = <span class="number">0</span><span class="comment">; i &lt; 6; i++) &#123;</span></span><br><span class="line">        let <span class="attr">index</span> = Number.parseInt((Math.random() * <span class="number">16</span>).toString())<span class="comment">;</span></span><br><span class="line">        str += arr<span class="section">[index]</span></span><br><span class="line">    &#125;</span><br><span class="line">    return str<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="随机16进制颜色-randomHexColorCode"><a href="#随机16进制颜色-randomHexColorCode" class="headerlink" title="随机16进制颜色 randomHexColorCode"></a>随机16进制颜色 randomHexColorCode</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 方法二</span><br><span class="line"> */</span><br><span class="line">export const <span class="attr">randomHexColorCode</span> = () =&gt; &#123;</span><br><span class="line">    let <span class="attr">n</span> = (Math.random() * <span class="number">0</span>xfffff * <span class="number">1000000</span>).toString(<span class="number">16</span>)<span class="comment">;</span></span><br><span class="line">    return &#x27;<span class="comment">#&#x27; + n.slice(0, 6);</span></span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="转义html-防XSS攻击"><a href="#转义html-防XSS攻击" class="headerlink" title="转义html(防XSS攻击)"></a>转义html(防XSS攻击)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">escapeHTML</span> = str =&gt;&#123;</span><br><span class="line">    str.<span class="title function_">replace</span>(</span><br><span class="line">        <span class="regexp">/[&amp;&lt;&gt;&#x27;&quot;]/g</span>,</span><br><span class="line">        <span class="function"><span class="params">tag</span> =&gt;</span></span><br><span class="line">            (&#123;</span><br><span class="line">                <span class="string">&#x27;&amp;&#x27;</span>: <span class="string">&#x27;&amp;amp;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;&lt;&#x27;</span>: <span class="string">&#x27;&amp;lt;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;&gt;&#x27;</span>: <span class="string">&#x27;&amp;gt;&#x27;</span>,</span><br><span class="line">                <span class="string">&quot;&#x27;&quot;</span>: <span class="string">&#x27;&amp;#39;&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;&quot;&#x27;</span>: <span class="string">&#x27;&amp;quot;&#x27;</span></span><br><span class="line">            &#125;[tag] || tag)</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="检测移动-x2F-PC设备"><a href="#检测移动-x2F-PC设备" class="headerlink" title="检测移动&#x2F;PC设备"></a>检测移动&#x2F;PC设备</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">detectDeviceType</span> = (<span class="params"></span>) =&gt; &#123; <span class="keyword">return</span> <span class="regexp">/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>) ? <span class="string">&#x27;Mobile&#x27;</span> : <span class="string">&#x27;Desktop&#x27;</span>; &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="隐藏所有指定标签"><a href="#隐藏所有指定标签" class="headerlink" title="隐藏所有指定标签"></a>隐藏所有指定标签</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 例: hide(document.querySelectorAll(&#x27;img&#x27;))</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="type">const</span> hideTag = (...el) =&gt; [...el].forEach(e =&gt; (e.style.display = <span class="string">&#x27;none&#x27;</span>));</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="返回指定元素的生效样式"><a href="#返回指定元素的生效样式" class="headerlink" title="返回指定元素的生效样式"></a>返回指定元素的生效样式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> element</span>&#125; el  元素节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type"> string </span>&#125; ruleName  指定元素的名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">getStyle</span> = (<span class="params">el, ruleName</span>) =&gt; <span class="title function_">getComputedStyle</span>(el)[ruleName];</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="检查是否包含子元素"><a href="#检查是否包含子元素" class="headerlink" title="检查是否包含子元素"></a>检查是否包含子元素</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * <span class="variable">@param</span> &#123; element &#125; parent</span><br><span class="line"> * <span class="variable">@param</span> &#123; element &#125; child</span><br><span class="line"> * 例：elementContains(document.querySelector(<span class="string">&#x27;head&#x27;</span>), document.querySelector(<span class="string">&#x27;title&#x27;</span>)); <span class="regexp">//</span> <span class="literal">true</span></span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">export const elementContains = (parent, child) =&gt; parent !== child &amp;&amp; parent.contains(child);</span></span><br><span class="line"><span class="regexp">   </span></span><br></pre></td></tr></table></figure><h3 id="数字超过规定大小加上加号“-”，如数字超过99显示99"><a href="#数字超过规定大小加上加号“-”，如数字超过99显示99" class="headerlink" title="数字超过规定大小加上加号“+”，如数字超过99显示99+"></a>数字超过规定大小加上加号“+”，如数字超过99显示99+</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123; number &#125; val 输入的数字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123; number &#125; maxNum 数字规定界限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export <span class="keyword">const</span> outOfNum = (<span class="keyword">val</span>, maxNum) =&gt;&#123;</span><br><span class="line">    <span class="keyword">val</span> = <span class="keyword">val</span> ? <span class="keyword">val</span>-<span class="number">0</span> :<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">val</span> &gt; maxNum ) &#123;</span><br><span class="line">        <span class="keyword">return</span> `$&#123;maxNum&#125;+`</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">val</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JS常用工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大文件上传</title>
      <link href="/hisai3.github.io/2023/01/14/%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/hisai3.github.io/2023/01/14/%E5%A4%A7%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/yeyan1996/file-upload">源码</a></p><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><p>服务端需要负责接受这些切片，并在接收到所有切片后<code>合并</code>切片</p><p>这里又引伸出两个问题</p><ol><li>何时合并切片，即切片什么时候传输完成</li><li>如何合并切片</li></ol><p>第一个问题需要前端进行配合，前端在每个切片中都携带切片最大数量的信息，当服务端接受到这个数量的切片时自动合并，也可以额外发一个请求主动通知服务端进行切片的合并</p><p>第二个问题，具体如何合并切片呢？这里可以使用 nodejs 的 读写流（readStream&#x2F;writeStream），将所有切片的流传输到最终文件的流里</p><p><code>talk is cheap,show me the code</code>，接着我们用代码实现上面的思路</p><h2 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h2><p>前端使用 Vue 作为开发框架，对界面没有太大要求，原生也可以，考虑到美观使用 element-ui 作为 UI 框架</p><h3 id="上传控件"><a href="#上传控件" class="headerlink" title="上传控件"></a>上传控件</h3><p>首先创建选择文件的控件，监听 change 事件以及上传按钮</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">   <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;handleFileChange&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handleUpload&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">container</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">file</span>: <span class="literal">null</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">     <span class="title function_">handleFileChange</span>(<span class="params">e</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> [file] = e.<span class="property">target</span>.<span class="property">files</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title class_">Object</span>.<span class="title function_">assign</span>(<span class="variable language_">this</span>.<span class="property">$data</span>, <span class="variable language_">this</span>.<span class="property">$options</span>.<span class="title function_">data</span>());</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span> = file;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params"></span>) &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2020/1/7/16f7ff98adb6bcdd?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><h3 id="请求逻辑"><a href="#请求逻辑" class="headerlink" title="请求逻辑"></a>请求逻辑</h3><p>考虑到通用性，这里没有用第三方的请求库，而是用原生 XMLHttpRequest 做一层简单的封装来发请求</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">      url,</span></span><br><span class="line"><span class="params">      method = <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="params">      data,</span></span><br><span class="line"><span class="params">      headers = &#123;&#125;,</span></span><br><span class="line"><span class="params">      requestList</span></span><br><span class="line"><span class="params">    &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">        xhr.<span class="title function_">open</span>(method, url);</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">          xhr.<span class="title function_">setRequestHeader</span>(key, headers[key])</span><br><span class="line">        );</span><br><span class="line">        xhr.<span class="title function_">send</span>(data);</span><br><span class="line">        xhr.<span class="property">onload</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(&#123;</span><br><span class="line">            <span class="attr">data</span>: e.<span class="property">target</span>.<span class="property">response</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="上传切片"><a href="#上传切片" class="headerlink" title="上传切片"></a>上传切片</h3><p>接着实现比较重要的上传功能，上传需要做两件事</p><ul><li>对文件进行切片</li><li>将切片传输给服务端</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;handleFileChange&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handleUpload&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+ <span class="keyword">const</span> <span class="variable constant_">SIZE</span> = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>; <span class="comment">// 切片大小</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">container</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">file</span>: <span class="literal">null</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;，</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+   <span class="attr">data</span>: []</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">request</span>(<span class="params"></span>) &#123;&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">handleFileChange</span>(<span class="params"></span>) &#123;&#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+    <span class="comment">// 生成文件切片</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+    <span class="title function_">createFileChunk</span>(<span class="params">file, size = SIZE</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+     <span class="keyword">const</span> fileChunkList = [];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="keyword">let</span> cur = <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="keyword">while</span> (cur &lt; file.<span class="property">size</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+        fileChunkList.<span class="title function_">push</span>(&#123; <span class="attr">file</span>: file.<span class="title function_">slice</span>(cur, cur + size) &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+        cur += size;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="keyword">return</span> fileChunkList;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+   <span class="comment">// 上传切片</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+    <span class="keyword">async</span> <span class="title function_">uploadChunks</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="keyword">const</span> requestList = <span class="variable language_">this</span>.<span class="property">data</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+        .<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; chunk，hash &#125;</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+          <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+          formData.<span class="title function_">append</span>(<span class="string">&quot;chunk&quot;</span>, chunk);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+          formData.<span class="title function_">append</span>(<span class="string">&quot;hash&quot;</span>, hash);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+          formData.<span class="title function_">append</span>(<span class="string">&quot;filename&quot;</span>, <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+          <span class="keyword">return</span> &#123; formData &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+        &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+        .<span class="title function_">map</span>(<span class="keyword">async</span> (&#123; formData &#125;) =&gt;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+          <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+            <span class="attr">url</span>: <span class="string">&quot;http://localhost:3000&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+            <span class="attr">data</span>: formData</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+          &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+        );</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(requestList); <span class="comment">// 并发切片</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+    <span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>) <span class="keyword">return</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="keyword">const</span> fileChunkList = <span class="variable language_">this</span>.<span class="title function_">createFileChunk</span>(<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="variable language_">this</span>.<span class="property">data</span> = fileChunkList.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; file &#125;，index</span>) =&gt;</span> (&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+        <span class="attr">chunk</span>: file,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+        <span class="attr">hash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span> + <span class="string">&quot;-&quot;</span> + index <span class="comment">// 文件名 + 数组下标</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      &#125;));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadChunks</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">+    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>当点击上传按钮时，调用 <code>createFileChunk</code> 将文件切片，切片数量通过文件大小控制，这里设置 10MB，也就是说 100 MB 的文件会被分成 10 个切片</p><p>createFileChunk 内使用 while 循环和 slice 方法将切片放入 <code>fileChunkList</code> 数组中返回</p><p>在生成文件切片时，需要给每个切片一个标识作为 hash，这里暂时使用<code>文件名 + 下标</code>，这样后端可以知道当前切片是第几个切片，用于之后的合并切片</p><p>随后调用 <code>uploadChunks</code> 上传所有的文件切片，将文件切片，切片 hash，以及文件名放入 FormData 中，再调用上一步的 <code>request</code> 函数返回一个 proimise，最后调用 Promise.all 并发上传所有的切片</p><h3 id="发送合并请求"><a href="#发送合并请求" class="headerlink" title="发送合并请求"></a>发送合并请求</h3><p>这里使用整体思路中提到的第二种合并切片的方式，即前端主动通知服务端进行合并，所以前端还需要额外发请求，服务端接受到这个请求时主动合并切片</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; @change=&quot;handleFileChange&quot; /&gt;</span><br><span class="line">    &lt;el-button @click=&quot;handleUpload&quot;&gt;上传&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data: () =&gt; (&#123;</span><br><span class="line">    container: &#123;</span><br><span class="line">      file: null</span><br><span class="line">    &#125;,</span><br><span class="line">    data: []</span><br><span class="line">  &#125;),</span><br><span class="line">  methods: &#123;</span><br><span class="line">    request() &#123;&#125;,</span><br><span class="line">    handleFileChange() &#123;&#125;,</span><br><span class="line">    createFileChunk() &#123;&#125;,</span><br><span class="line">    // 上传切片，同时过滤已上传的切片</span><br><span class="line">    async uploadChunks() &#123;</span><br><span class="line">      const requestList = this.data</span><br><span class="line">        .map((&#123; chunk，hash &#125;) =&gt; &#123;</span><br><span class="line">          const formData = new FormData();</span><br><span class="line">          formData.append(&quot;chunk&quot;, chunk);</span><br><span class="line">          formData.append(&quot;hash&quot;, hash);</span><br><span class="line">          formData.append(&quot;filename&quot;, this.container.file.name);</span><br><span class="line">          return &#123; formData &#125;;</span><br><span class="line">        &#125;)</span><br><span class="line">        .map(async (&#123; formData &#125;) =&gt;</span><br><span class="line">          this.request(&#123;</span><br><span class="line">            url: &quot;http://localhost:3000&quot;,</span><br><span class="line">            data: formData</span><br><span class="line">          &#125;)</span><br><span class="line">        );</span><br><span class="line">      await Promise.all(requestList);</span><br><span class="line">+      // 合并切片</span><br><span class="line">+     await this.mergeRequest();</span><br><span class="line">    &#125;,</span><br><span class="line">+    async mergeRequest() &#123;</span><br><span class="line">+      await this.request(&#123;</span><br><span class="line">+        url: &quot;http://localhost:3000/merge&quot;,</span><br><span class="line">+        headers: &#123;</span><br><span class="line">+          &quot;content-type&quot;: &quot;application/json&quot;</span><br><span class="line">+        &#125;,</span><br><span class="line">+        data: JSON.stringify(&#123;</span><br><span class="line">+          filename: this.container.file.name</span><br><span class="line">+        &#125;)</span><br><span class="line">+      &#125;);</span><br><span class="line">+    &#125;,    </span><br><span class="line">    async handleUpload() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="服务端部分"><a href="#服务端部分" class="headerlink" title="服务端部分"></a>服务端部分</h2><p>简单使用 http 模块搭建服务端</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&quot;http&quot;);</span><br><span class="line">const server = http.createServer();</span><br><span class="line"></span><br><span class="line">server.on(&quot;request&quot;, async (req, res) =&gt; &#123;</span><br><span class="line">  res.setHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class="line">  res.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;);</span><br><span class="line">  if (req.method === &quot;OPTIONS&quot;) &#123;</span><br><span class="line">    res.status = 200;</span><br><span class="line">    res.end();</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(3000, () =&gt; console.log(&quot;正在监听 3000 端口&quot;));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="接受切片"><a href="#接受切片" class="headerlink" title="接受切片"></a>接受切片</h3><p>使用 <code>multiparty</code> 包处理前端传来的 FormData</p><p>在 multiparty.parse 的回调中，files 参数保存了 FormData 中文件，fields 参数保存了 FormData 中非文件的字段</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fse = <span class="built_in">require</span>(<span class="string">&quot;fs-extra&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> multiparty = <span class="built_in">require</span>(<span class="string">&quot;multiparty&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line">+ <span class="keyword">const</span> <span class="variable constant_">UPLOAD_DIR</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;..&quot;</span>, <span class="string">&quot;target&quot;</span>); <span class="comment">// 大文件存储目录</span></span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;OPTIONS&quot;</span>) &#123;</span><br><span class="line">    res.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">+  <span class="keyword">const</span> multipart = <span class="keyword">new</span> multiparty.<span class="title class_">Form</span>();</span><br><span class="line"></span><br><span class="line">+  multipart.<span class="title function_">parse</span>(req, <span class="keyword">async</span> (err, fields, files) =&gt; &#123;</span><br><span class="line">+    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">+      <span class="keyword">return</span>;</span><br><span class="line">+    &#125;</span><br><span class="line">+    <span class="keyword">const</span> [chunk] = files.<span class="property">chunk</span>;</span><br><span class="line">+    <span class="keyword">const</span> [hash] = fields.<span class="property">hash</span>;</span><br><span class="line">+    <span class="keyword">const</span> [filename] = fields.<span class="property">filename</span>;</span><br><span class="line">+    <span class="keyword">const</span> chunkDir = path.<span class="title function_">resolve</span>(<span class="variable constant_">UPLOAD_DIR</span>, filename);</span><br><span class="line"></span><br><span class="line">+   <span class="comment">// 切片目录不存在，创建切片目录</span></span><br><span class="line">+    <span class="keyword">if</span> (!fse.<span class="title function_">existsSync</span>(chunkDir)) &#123;</span><br><span class="line">+      <span class="keyword">await</span> fse.<span class="title function_">mkdirs</span>(chunkDir);</span><br><span class="line">+    &#125;</span><br><span class="line"></span><br><span class="line">+      <span class="comment">// fs-extra 专用方法，类似 fs.rename 并且跨平台</span></span><br><span class="line">+      <span class="comment">// fs-extra 的 rename 方法 windows 平台会有权限问题</span></span><br><span class="line">+      <span class="comment">// https://github.com/meteor/meteor/issues/7852#issuecomment-255767835</span></span><br><span class="line">+      <span class="keyword">await</span> fse.<span class="title function_">move</span>(chunk.<span class="property">path</span>, <span class="string">`<span class="subst">$&#123;chunkDir&#125;</span>/<span class="subst">$&#123;hash&#125;</span>`</span>);</span><br><span class="line">+    res.<span class="title function_">end</span>(<span class="string">&quot;received file chunk&quot;</span>);</span><br><span class="line">+  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听 3000 端口&quot;</span>));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2020/1/11/16f905fb6a626f47?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image-20200110215559194"></p><p>查看 multiparty 处理后的 chunk 对象，path 是存储临时文件的路径，size 是临时文件大小，在 multiparty 文档中提到可以使用 fs.rename(由于我用的是 fs-extra，它的 rename 方法 windows 平台权限问题，所以换成了 fse.move) 移动临时文件，即移动文件切片</p><p>在接受文件切片时，需要先创建存储切片的文件夹，由于前端在发送每个切片时额外携带了唯一值 hash，所以以 hash 作为文件名，将切片从临时路径移动切片文件夹中，最后的结果如下</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f83c3caac8eb65?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><h3 id="合并切片"><a href="#合并切片" class="headerlink" title="合并切片"></a>合并切片</h3><p>在接收到前端发送的合并请求后，服务端将文件夹下的所有切片进行合并</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fse = <span class="built_in">require</span>(<span class="string">&quot;fs-extra&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">UPLOAD_DIR</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;..&quot;</span>, <span class="string">&quot;target&quot;</span>); <span class="comment">// 大文件存储目录</span></span><br><span class="line"></span><br><span class="line">+ <span class="keyword">const</span> <span class="title function_">resolvePost</span> = req =&gt;</span><br><span class="line">+   <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">+     <span class="keyword">let</span> chunk = <span class="string">&quot;&quot;</span>;</span><br><span class="line">+     req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">+       chunk += data;</span><br><span class="line">+     &#125;);</span><br><span class="line">+     req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">+       <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(chunk));</span><br><span class="line">+     &#125;);</span><br><span class="line">+   &#125;);</span><br><span class="line"></span><br><span class="line">+ <span class="keyword">const</span> <span class="title function_">pipeStream</span> = (<span class="params">path, writeStream</span>) =&gt;</span><br><span class="line">+  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">+    <span class="keyword">const</span> readStream = fse.<span class="title function_">createReadStream</span>(path);</span><br><span class="line">+    readStream.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">+      fse.<span class="title function_">unlinkSync</span>(path);</span><br><span class="line">+      <span class="title function_">resolve</span>();</span><br><span class="line">+    &#125;);</span><br><span class="line">+    readStream.<span class="title function_">pipe</span>(writeStream);</span><br><span class="line">+  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并切片</span></span><br><span class="line">+ <span class="keyword">const</span> <span class="title function_">mergeFileChunk</span> = <span class="keyword">async</span> (<span class="params">filePath, filename, size</span>) =&gt; &#123;</span><br><span class="line">+  <span class="keyword">const</span> chunkDir = path.<span class="title function_">resolve</span>(<span class="variable constant_">UPLOAD_DIR</span>, filename);</span><br><span class="line">+  <span class="keyword">const</span> chunkPaths = <span class="keyword">await</span> fse.<span class="title function_">readdir</span>(chunkDir);</span><br><span class="line">+  <span class="comment">// 根据切片下标进行排序</span></span><br><span class="line">+  <span class="comment">// 否则直接读取目录的获得的顺序可能会错乱</span></span><br><span class="line">+  chunkPaths.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="title function_">split</span>(<span class="string">&quot;-&quot;</span>)[<span class="number">1</span>] - b.<span class="title function_">split</span>(<span class="string">&quot;-&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">+  <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">+    chunkPaths.<span class="title function_">map</span>(<span class="function">(<span class="params">chunkPath, index</span>) =&gt;</span></span><br><span class="line">+      <span class="title function_">pipeStream</span>(</span><br><span class="line">+        path.<span class="title function_">resolve</span>(chunkDir, chunkPath),</span><br><span class="line">+        <span class="comment">// 指定位置创建可写流</span></span><br><span class="line">+        fse.<span class="title function_">createWriteStream</span>(filePath, &#123;</span><br><span class="line">+          <span class="attr">start</span>: index * size,</span><br><span class="line">+          <span class="attr">end</span>: (index + <span class="number">1</span>) * size</span><br><span class="line">+        &#125;)</span><br><span class="line">+      )</span><br><span class="line">+    )</span><br><span class="line">+  );</span><br><span class="line">+  fse.<span class="title function_">rmdirSync</span>(chunkDir); <span class="comment">// 合并后删除保存切片的目录</span></span><br><span class="line">+&#125;;</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&quot;OPTIONS&quot;</span>) &#123;</span><br><span class="line">    res.<span class="property">status</span> = <span class="number">200</span>;</span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">+   <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&quot;/merge&quot;</span>) &#123;</span><br><span class="line">+     <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">resolvePost</span>(req);</span><br><span class="line">+     <span class="keyword">const</span> &#123; filename,size &#125; = data;</span><br><span class="line">+     <span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(<span class="variable constant_">UPLOAD_DIR</span>, <span class="string">`<span class="subst">$&#123;filename&#125;</span>`</span>);</span><br><span class="line">+     <span class="keyword">await</span> <span class="title function_">mergeFileChunk</span>(filePath, filename);</span><br><span class="line">+     res.<span class="title function_">end</span>(</span><br><span class="line">+       <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">+         <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">+         <span class="attr">message</span>: <span class="string">&quot;file merged success&quot;</span></span><br><span class="line">+       &#125;)</span><br><span class="line">+     );</span><br><span class="line">+   &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听 3000 端口&quot;</span>));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>由于前端在发送合并请求时会携带文件名，服务端根据文件名可以找到上一步创建的切片文件夹</p><p>接着使用 fs.createWriteStream 创建一个可写流，可写流文件名就是<strong>切片文件夹名 + 后缀名</strong>组合而成</p><p>随后遍历整个切片文件夹，将切片通过 fs.createReadStream 创建可读流，传输合并到目标文件中</p><p>值得注意的是每次可读流都会传输到可写流的指定位置，这是通过 createWriteStream 的第二个参数 start&#x2F;end 控制的，目的是能够并发合并多个可读流到可写流中，这样即使流的顺序不同也能传输到正确的位置，所以这里还需要让前端在请求的时候多提供一个 size 参数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">async</span> <span class="title function_">mergeRequest</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:3000/merge&quot;</span>,</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">          <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">+         <span class="attr">size</span>: <span class="variable constant_">SIZE</span>,</span><br><span class="line">          <span class="attr">filename</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2020/1/22/16fccc5d950c2275?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>其实也可以等上一个切片合并完后再合并下个切片，这样就不需要指定位置，但传输速度会降低，所以使用了并发合并的手段，接着只要保证每次合并完成后删除这个切片，等所有切片都合并完毕后最后删除切片文件夹即可</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f8414c7fae1c1f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>至此一个简单的大文件上传就完成了，接下来我们再此基础上扩展一些额外的功能</p><h2 id="显示上传进度条"><a href="#显示上传进度条" class="headerlink" title="显示上传进度条"></a>显示上传进度条</h2><p>上传进度分两种，一个是每个切片的上传进度，另一个是整个文件的上传进度，而整个文件的上传进度是基于每个切片上传进度计算而来，所以我们先实现切片的上传进度</p><h3 id="切片进度条"><a href="#切片进度条" class="headerlink" title="切片进度条"></a>切片进度条</h3><p>XMLHttpRequest 原生支持上传进度的监听，只需要监听 upload.onprogress 即可，我们在原来的 request 基础上传入 onProgress 参数，给 XMLHttpRequest 注册监听事件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// xhr</span></span><br><span class="line">    <span class="title function_">request</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">      url,</span></span><br><span class="line"><span class="params">      method = <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="params">      data,</span></span><br><span class="line"><span class="params">      headers = &#123;&#125;,</span></span><br><span class="line"><span class="params">+      onProgress = e =&gt; e,</span></span><br><span class="line"><span class="params">      requestList</span></span><br><span class="line"><span class="params">    &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">+       xhr.<span class="property">upload</span>.<span class="property">onprogress</span> = onProgress;</span><br><span class="line">        xhr.<span class="title function_">open</span>(method, url);</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">          xhr.<span class="title function_">setRequestHeader</span>(key, headers[key])</span><br><span class="line">        );</span><br><span class="line">        xhr.<span class="title function_">send</span>(data);</span><br><span class="line">        xhr.<span class="property">onload</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(&#123;</span><br><span class="line">            <span class="attr">data</span>: e.<span class="property">target</span>.<span class="property">response</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>由于每个切片都需要触发独立的监听事件，所以还需要一个工厂函数，根据传入的切片返回不同的监听函数</p><p>在原先的前端上传逻辑中新增监听函数部分</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 上传切片，同时过滤已上传的切片</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">uploadChunks</span>(<span class="params">uploadedList = []</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> requestList = <span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">+       .<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; chunk,hash,index &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">          formData.<span class="title function_">append</span>(<span class="string">&quot;chunk&quot;</span>, chunk);</span><br><span class="line">          formData.<span class="title function_">append</span>(<span class="string">&quot;hash&quot;</span>, hash);</span><br><span class="line">          formData.<span class="title function_">append</span>(<span class="string">&quot;filename&quot;</span>, <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span>);</span><br><span class="line">+         <span class="keyword">return</span> &#123; formData,index &#125;;</span><br><span class="line">        &#125;)</span><br><span class="line">+       .<span class="title function_">map</span>(<span class="keyword">async</span> (&#123; formData,index &#125;) =&gt;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://localhost:3000&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: formData，</span><br><span class="line">+           <span class="attr">onProgress</span>: <span class="variable language_">this</span>.<span class="title function_">createProgressHandler</span>(<span class="variable language_">this</span>.<span class="property">data</span>[index]),</span><br><span class="line">          &#125;)</span><br><span class="line">        );</span><br><span class="line">      <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(requestList);</span><br><span class="line">       <span class="comment">// 合并切片</span></span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">mergeRequest</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">const</span> fileChunkList = <span class="variable language_">this</span>.<span class="title function_">createFileChunk</span>(<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">data</span> = fileChunkList.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; file &#125;，index</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">chunk</span>: file,</span><br><span class="line">+       index,</span><br><span class="line">        <span class="attr">hash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span> + <span class="string">&quot;-&quot;</span> + index</span><br><span class="line">+       <span class="attr">percentage</span>:<span class="number">0</span></span><br><span class="line">      &#125;));</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadChunks</span>();</span><br><span class="line">    &#125;    </span><br><span class="line">+   <span class="title function_">createProgressHandler</span>(<span class="params">item</span>) &#123;</span><br><span class="line">+      <span class="keyword">return</span> <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">+        item.<span class="property">percentage</span> = <span class="built_in">parseInt</span>(<span class="title class_">String</span>((e.<span class="property">loaded</span> / e.<span class="property">total</span>) * <span class="number">100</span>));</span><br><span class="line">+      &#125;;</span><br><span class="line">+    &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>每个切片在上传时都会通过监听函数更新 data 数组对应元素的 percentage 属性，之后把将 data 数组放到视图中展示即可</p><h3 id="文件进度条"><a href="#文件进度条" class="headerlink" title="文件进度条"></a>文件进度条</h3><p>将每个切片已上传的部分累加，除以整个文件的大小，就能得出当前文件的上传进度，所以这里使用 Vue 计算属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">       <span class="title function_">uploadPercentage</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span> || !<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">length</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">const</span> loaded = <span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">            .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">size</span> * item.<span class="property">percentage</span>)</span><br><span class="line">            .<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> acc + cur);</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">parseInt</span>((loaded / <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">size</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>最终视图如下</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f84ad6b4848423?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><h1 id="断点续传"><a href="#断点续传" class="headerlink" title="断点续传"></a>断点续传</h1><p>断点续传的原理在于前端&#x2F;服务端需要<code>记住</code>已上传的切片，这样下次上传就可以跳过之前已上传的部分，有两种方案实现记忆的功能</p><ul><li>前端使用 localStorage 记录已上传的切片 hash</li><li>服务端保存已上传的切片 hash，前端每次上传前向服务端获取已上传的切片</li></ul><p>第一种是前端的解决方案，第二种是服务端，而前端方案有一个缺陷，如果换了个浏览器就失去了记忆的效果，所以这里选取后者</p><h2 id="生成-hash"><a href="#生成-hash" class="headerlink" title="生成 hash"></a>生成 hash</h2><p>无论是前端还是服务端，都必须要生成文件和切片的 hash，<code>之前我们使用文件名 + 切片下标作为切片 hash</code>，这样做文件名一旦修改就失去了效果，而事实上只要文件内容不变，hash 就不应该变化，所以正确的做法是<code>根据文件内容生成 hash</code>，所以我们修改一下 hash 的生成规则</p><p>这里用到另一个库 <code>spark-md5</code>，它可以根据文件内容计算出文件的 hash 值，另外考虑到如果上传一个超大文件，读取文件内容计算 hash 是非常耗费时间的，并且会<code>引起 UI 的阻塞</code>，导致页面假死状态，所以我们使用 web-worker 在 worker 线程计算 hash，这样用户仍可以在主界面正常的交互</p><p>由于实例化 web-worker 时，参数是一个 js 文件路径且不能跨域，所以我们单独创建一个 hash.js 文件放在 public 目录下，另外在 worker 中也是不允许访问 dom 的，但它提供了<code>importScripts</code> 函数用于导入外部脚本，通过它导入 spark-md5</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /public/hash.js</span></span><br><span class="line">self.<span class="title function_">importScripts</span>(<span class="string">&quot;/spark-md5.min.js&quot;</span>); <span class="comment">// 导入脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成文件 hash</span></span><br><span class="line">self.<span class="property">onmessage</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; fileChunkList &#125; = e.<span class="property">data</span>;</span><br><span class="line">  <span class="keyword">const</span> spark = <span class="keyword">new</span> self.<span class="property">SparkMD5</span>.<span class="title class_">ArrayBuffer</span>();</span><br><span class="line">  <span class="keyword">let</span> percentage = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">loadNext</span> = index =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">    reader.<span class="title function_">readAsArrayBuffer</span>(fileChunkList[index].<span class="property">file</span>);</span><br><span class="line">    reader.<span class="property">onload</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">      count++;</span><br><span class="line">      spark.<span class="title function_">append</span>(e.<span class="property">target</span>.<span class="property">result</span>);</span><br><span class="line">      <span class="keyword">if</span> (count === fileChunkList.<span class="property">length</span>) &#123;</span><br><span class="line">        self.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          <span class="attr">percentage</span>: <span class="number">100</span>,</span><br><span class="line">          <span class="attr">hash</span>: spark.<span class="title function_">end</span>()</span><br><span class="line">        &#125;);</span><br><span class="line">        self.<span class="title function_">close</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        percentage += <span class="number">100</span> / fileChunkList.<span class="property">length</span>;</span><br><span class="line">        self.<span class="title function_">postMessage</span>(&#123;</span><br><span class="line">          percentage</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 递归计算下一个切片</span></span><br><span class="line">        <span class="title function_">loadNext</span>(count);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">loadNext</span>(<span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在 worker 线程中，接受文件切片 fileChunkList，利用 FileReader 读取每个切片的 ArrayBuffer 并不断传入 spark-md5 中，每计算完一个切片通过 postMessage 向主线程发送一个进度事件，全部完成后将最终的 hash 发送给主线程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-md5 需要根据所有切片才能算出一个 hash 值，不能直接将整个文件放入计算，否则即使不同文件也会有相同的 hash，具体可以看官方文档</span><br></pre></td></tr></table></figure><p><a href="https://www.npmjs.com/package/spark-md5">spark-md5</a></p><p>接着编写主线程与 worker 线程通讯的逻辑</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+   <span class="comment">// 生成文件 hash（web-worker）</span></span><br><span class="line">+    <span class="title function_">calculateHash</span>(<span class="params">fileChunkList</span>) &#123;</span><br><span class="line">+      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">+       <span class="comment">// 添加 worker 属性</span></span><br><span class="line">+        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">worker</span> = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&quot;/hash.js&quot;</span>);</span><br><span class="line">+        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">worker</span>.<span class="title function_">postMessage</span>(&#123; fileChunkList &#125;);</span><br><span class="line">+        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">worker</span>.<span class="property">onmessage</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">+          <span class="keyword">const</span> &#123; percentage, hash &#125; = e.<span class="property">data</span>;</span><br><span class="line">+          <span class="variable language_">this</span>.<span class="property">hashPercentage</span> = percentage;</span><br><span class="line">+          <span class="keyword">if</span> (hash) &#123;</span><br><span class="line">+            <span class="title function_">resolve</span>(hash);</span><br><span class="line">+          &#125;</span><br><span class="line">+        &#125;;</span><br><span class="line">+      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">const</span> fileChunkList = <span class="variable language_">this</span>.<span class="title function_">createFileChunk</span>(<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>);</span><br><span class="line">+     <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">calculateHash</span>(fileChunkList);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">data</span> = fileChunkList.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; file &#125;，index</span>) =&gt;</span> (&#123;</span><br><span class="line">+       <span class="attr">fileHash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span>,</span><br><span class="line">        <span class="attr">chunk</span>: file,</span><br><span class="line">        <span class="attr">hash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span> + <span class="string">&quot;-&quot;</span> + index, <span class="comment">// 文件名 + 数组下标</span></span><br><span class="line">        <span class="attr">percentage</span>:<span class="number">0</span></span><br><span class="line">      &#125;));</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadChunks</span>();</span><br><span class="line">    &#125;   </span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>主线程使用 <code>postMessage</code> 给 worker 线程传入所有切片 fileChunkList，并监听 worker 线程发出的 postMessage 事件拿到文件 hash</p><p>加上显示计算 hash 的进度条，看起来像这样</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f84ae4f233e891?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>至此前端需要将之前用文件名作为 hash 的地方改写为 workder 返回的这个 hash</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f84b3bba953304?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>服务端则使用 hash 作为切片文件夹名，hash + 下标作为切片名，hash + 扩展名作为文件名，没有新增的逻辑</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f84b50117e4db2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f84b33bbceaa48?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><h2 id="文件秒传"><a href="#文件秒传" class="headerlink" title="文件秒传"></a>文件秒传</h2><p>在实现断点续传前先简单介绍一下文件秒传</p><p>所谓的文件秒传，即在服务端已经存在了上传的资源，所以当用户<code>再次上传</code>时会直接提示上传成功</p><p>文件秒传需要依赖上一步生成的 hash，即在<code>上传前</code>，先计算出文件 hash，并把 hash 发送给服务端进行验证，由于 hash 的唯一性，所以一旦服务端能找到 hash 相同的文件，则直接返回上传成功的信息即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">+    <span class="keyword">async</span> <span class="title function_">verifyUpload</span>(<span class="params">filename, fileHash</span>) &#123;</span><br><span class="line">+       <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">+         <span class="attr">url</span>: <span class="string">&quot;http://localhost:3000/verify&quot;</span>,</span><br><span class="line">+         <span class="attr">headers</span>: &#123;</span><br><span class="line">+           <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">+         &#125;,</span><br><span class="line">+         <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">+           filename,</span><br><span class="line">+           fileHash</span><br><span class="line">+         &#125;)</span><br><span class="line">+       &#125;);</span><br><span class="line">+       <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data);</span><br><span class="line">+     &#125;,</span><br><span class="line">   <span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">const</span> fileChunkList = <span class="variable language_">this</span>.<span class="title function_">createFileChunk</span>(<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">calculateHash</span>(fileChunkList);</span><br><span class="line">+     <span class="keyword">const</span> &#123; shouldUpload &#125; = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">verifyUpload</span>(</span><br><span class="line">+       <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span>,</span><br><span class="line">+       <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span></span><br><span class="line">+     );</span><br><span class="line">+     <span class="keyword">if</span> (!shouldUpload) &#123;</span><br><span class="line">+       <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;秒传：上传成功&quot;</span>);</span><br><span class="line">+       <span class="keyword">return</span>;</span><br><span class="line">+    &#125;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">data</span> = fileChunkList.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; file &#125;, index</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">fileHash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span>,</span><br><span class="line">        index,</span><br><span class="line">        <span class="attr">hash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span> + <span class="string">&quot;-&quot;</span> + index,</span><br><span class="line">        <span class="attr">chunk</span>: file,</span><br><span class="line">        <span class="attr">percentage</span>: <span class="number">0</span></span><br><span class="line">      &#125;));</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadChunks</span>();</span><br><span class="line">    &#125;   </span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>秒传其实就是给用户看的障眼法，实质上根本没有上传</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f890e5967106c6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image-20200109143511277"></p><p>:)</p><p>服务端的逻辑非常简单，新增一个验证接口，验证文件是否存在即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">const</span> <span class="title function_">extractExt</span> = filename =&gt;</span><br><span class="line">+  filename.<span class="title function_">slice</span>(filename.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>), filename.<span class="property">length</span>); <span class="comment">// 提取后缀名</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">UPLOAD_DIR</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;..&quot;</span>, <span class="string">&quot;target&quot;</span>); <span class="comment">// 大文件存储目录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resolvePost</span> = req =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> chunk = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      chunk += data;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(chunk));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&quot;/verify&quot;</span>) &#123;</span><br><span class="line">+    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">resolvePost</span>(req);</span><br><span class="line">+    <span class="keyword">const</span> &#123; fileHash, filename &#125; = data;</span><br><span class="line">+    <span class="keyword">const</span> ext = <span class="title function_">extractExt</span>(filename);</span><br><span class="line">+    <span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(<span class="variable constant_">UPLOAD_DIR</span>, <span class="string">`<span class="subst">$&#123;fileHash&#125;</span><span class="subst">$&#123;ext&#125;</span>`</span>);</span><br><span class="line">+    <span class="keyword">if</span> (fse.<span class="title function_">existsSync</span>(filePath)) &#123;</span><br><span class="line">+      res.<span class="title function_">end</span>(</span><br><span class="line">+        <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">+          <span class="attr">shouldUpload</span>: <span class="literal">false</span></span><br><span class="line">+        &#125;)</span><br><span class="line">+      );</span><br><span class="line">+    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">+      res.<span class="title function_">end</span>(</span><br><span class="line">+        <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">+          <span class="attr">shouldUpload</span>: <span class="literal">true</span></span><br><span class="line">+        &#125;)</span><br><span class="line">+      );</span><br><span class="line">+    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听 3000 端口&quot;</span>));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="暂停上传"><a href="#暂停上传" class="headerlink" title="暂停上传"></a>暂停上传</h2><p>讲完了生成 hash 和文件秒传，回到断点续传</p><p>断点续传顾名思义即断点 + 续传，所以我们第一步先实现“断点”，也就是暂停上传</p><p>原理是使用 XMLHttpRequest 的 <code>abort</code> 方法，可以取消一个 xhr 请求的发送，为此我们需要将上传每个切片的 xhr 对象保存起来，我们再改造一下 request 方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">   <span class="title function_">request</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">      url,</span></span><br><span class="line"><span class="params">      method = <span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="params">      data,</span></span><br><span class="line"><span class="params">      headers = &#123;&#125;,</span></span><br><span class="line"><span class="params">      onProgress = e =&gt; e,</span></span><br><span class="line"><span class="params">+     requestList</span></span><br><span class="line"><span class="params">    &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">        xhr.<span class="property">upload</span>.<span class="property">onprogress</span> = onProgress;</span><br><span class="line">        xhr.<span class="title function_">open</span>(method, url);</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(headers).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">          xhr.<span class="title function_">setRequestHeader</span>(key, headers[key])</span><br><span class="line">        );</span><br><span class="line">        xhr.<span class="title function_">send</span>(data);</span><br><span class="line">        xhr.<span class="property">onload</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">+          <span class="comment">// 将请求成功的 xhr 从列表中删除</span></span><br><span class="line">+          <span class="keyword">if</span> (requestList) &#123;</span><br><span class="line">+            <span class="keyword">const</span> xhrIndex = requestList.<span class="title function_">findIndex</span>(<span class="function"><span class="params">item</span> =&gt;</span> item === xhr);</span><br><span class="line">+            requestList.<span class="title function_">splice</span>(xhrIndex, <span class="number">1</span>);</span><br><span class="line">+          &#125;</span><br><span class="line">          <span class="title function_">resolve</span>(&#123;</span><br><span class="line">            <span class="attr">data</span>: e.<span class="property">target</span>.<span class="property">response</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">+        <span class="comment">// 暴露当前 xhr 给外部</span></span><br><span class="line">+        requestList?.<span class="title function_">push</span>(xhr);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这样在上传切片时传入 requestList 数组作为参数，request 方法就会将所有的 xhr 保存在数组中了</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f8563491ea7793?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>每当一个切片上传成功时，将对应的 xhr 从 requestList 中删除，所以 requestList 中只保存<code>正在上传切片的 xhr</code></p><p>之后新建一个暂停按钮，当点击按钮时，调用保存在 requestList 中 xhr 的 abort 方法，即取消并清空所有正在上传的切片</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="title function_">handlePause</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">requestList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">xhr</span> =&gt;</span> xhr?.<span class="title function_">abort</span>());</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">requestList</span> = [];</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f890e598dd6afb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image-20200109143737924"></p><p>点击暂停按钮可以看到 xhr 都被取消了</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/8/16f85644dc27459e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><h2 id="恢复上传"><a href="#恢复上传" class="headerlink" title="恢复上传"></a>恢复上传</h2><p>之前在介绍断点续传的时提到使用第二种服务端存储的方式实现续传</p><p>由于当文件切片上传后，服务端会建立一个文件夹存储所有上传的切片，所以每次前端上传前可以调用一个接口，服务端将已上传的切片的切片名返回，前端再跳过这些已经上传切片，这样就实现了“续传”的效果</p><p>而这个接口可以和之前秒传的验证接口合并，前端每次上传前发送一个验证的请求，返回两种结果</p><ul><li>服务端已存在该文件，不需要再次上传</li><li>服务端不存在该文件或者已上传部分文件切片，通知前端进行上传，并把<strong>已上传</strong>的文件切片返回给前端</li></ul><p>所以我们改造一下之前文件秒传的服务端验证接口</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">extractExt</span> = filename =&gt;</span><br><span class="line">  filename.<span class="title function_">slice</span>(filename.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>), filename.<span class="property">length</span>); <span class="comment">// 提取后缀名</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">UPLOAD_DIR</span> = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;..&quot;</span>, <span class="string">&quot;target&quot;</span>); <span class="comment">// 大文件存储目录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resolvePost</span> = req =&gt;</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> chunk = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      chunk += data;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(chunk));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">+  <span class="comment">// 返回已经上传切片名列表</span></span><br><span class="line">+ <span class="keyword">const</span> <span class="title function_">createUploadedList</span> = <span class="keyword">async</span> fileHash =&gt;</span><br><span class="line">+   fse.<span class="title function_">existsSync</span>(path.<span class="title function_">resolve</span>(<span class="variable constant_">UPLOAD_DIR</span>, fileHash))</span><br><span class="line">+    ? <span class="keyword">await</span> fse.<span class="title function_">readdir</span>(path.<span class="title function_">resolve</span>(<span class="variable constant_">UPLOAD_DIR</span>, fileHash))</span><br><span class="line">+    : [];</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&quot;/verify&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">resolvePost</span>(req);</span><br><span class="line">    <span class="keyword">const</span> &#123; fileHash, filename &#125; = data;</span><br><span class="line">    <span class="keyword">const</span> ext = <span class="title function_">extractExt</span>(filename);</span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(<span class="variable constant_">UPLOAD_DIR</span>, <span class="string">`<span class="subst">$&#123;fileHash&#125;</span><span class="subst">$&#123;ext&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (fse.<span class="title function_">existsSync</span>(filePath)) &#123;</span><br><span class="line">      res.<span class="title function_">end</span>(</span><br><span class="line">        <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">          <span class="attr">shouldUpload</span>: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="title function_">end</span>(</span><br><span class="line">        <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">          <span class="attr">shouldUpload</span>: <span class="literal">true</span>，</span><br><span class="line">+         <span class="attr">uploadedList</span>: <span class="keyword">await</span> <span class="title function_">createUploadedList</span>(fileHash)</span><br><span class="line">        &#125;)</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听 3000 端口&quot;</span>));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>接着回到前端，前端有两个地方需要调用验证的接口</p><ul><li>点击上传时，检查是否需要上传和已上传的切片</li><li>点击暂停后的恢复上传，返回已上传的切片</li></ul><p>新增恢复按钮并改造原来上传切片的逻辑</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">type</span>=<span class="string">&quot;file&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        @<span class="attr">change</span>=<span class="string">&quot;handleFileChange&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handleUpload&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handlePause&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;isPaused&quot;</span>&gt;</span>暂停<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">+      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handleResume&quot;</span> <span class="attr">v-else</span>&gt;</span>恢复<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      //...</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">+   <span class="keyword">async</span> <span class="title function_">handleResume</span>(<span class="params"></span>) &#123;</span><br><span class="line">+      <span class="keyword">const</span> &#123; uploadedList &#125; = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">verifyUpload</span>(</span><br><span class="line">+        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span>,</span><br><span class="line">+        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span></span><br><span class="line">+      );</span><br><span class="line">+      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadChunks</span>(uploadedList);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">const</span> fileChunkList = <span class="variable language_">this</span>.<span class="title function_">createFileChunk</span>(<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">calculateHash</span>(fileChunkList);</span><br><span class="line"></span><br><span class="line">+     <span class="keyword">const</span> &#123; shouldUpload, uploadedList &#125; = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">verifyUpload</span>(</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span>,</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (!shouldUpload) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;秒传：上传成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">data</span> = fileChunkList.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; file &#125;, index</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">fileHash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span>,</span><br><span class="line">        index,</span><br><span class="line">        <span class="attr">hash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span> + <span class="string">&quot;-&quot;</span> + index,</span><br><span class="line">        <span class="attr">chunk</span>: file，</span><br><span class="line">        <span class="attr">percentage</span>: <span class="number">0</span></span><br><span class="line">      &#125;));</span><br><span class="line"></span><br><span class="line">+      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadChunks</span>(uploadedList);</span><br><span class="line">    &#125;,</span><br><span class="line">   <span class="comment">// 上传切片，同时过滤已上传的切片</span></span><br><span class="line">+   <span class="keyword">async</span> <span class="title function_">uploadChunks</span>(<span class="params">uploadedList = []</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> requestList = <span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">+        .<span class="title function_">filter</span>(<span class="function">(<span class="params">&#123; hash &#125;</span>) =&gt;</span> !uploadedList.<span class="title function_">includes</span>(hash))</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; chunk, hash, index &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">          formData.<span class="title function_">append</span>(<span class="string">&quot;chunk&quot;</span>, chunk);</span><br><span class="line">          formData.<span class="title function_">append</span>(<span class="string">&quot;hash&quot;</span>, hash);</span><br><span class="line">          formData.<span class="title function_">append</span>(<span class="string">&quot;filename&quot;</span>, <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span>);</span><br><span class="line">          formData.<span class="title function_">append</span>(<span class="string">&quot;fileHash&quot;</span>, <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span>);</span><br><span class="line">          <span class="keyword">return</span> &#123; formData, index &#125;;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">map</span>(<span class="keyword">async</span> (&#123; formData, index &#125;) =&gt;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">request</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&quot;http://localhost:3000&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: formData,</span><br><span class="line">            <span class="attr">onProgress</span>: <span class="variable language_">this</span>.<span class="title function_">createProgressHandler</span>(<span class="variable language_">this</span>.<span class="property">data</span>[index]),</span><br><span class="line">            <span class="attr">requestList</span>: <span class="variable language_">this</span>.<span class="property">requestList</span></span><br><span class="line">          &#125;)</span><br><span class="line">        );</span><br><span class="line">      <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(requestList);</span><br><span class="line">      <span class="comment">// 之前上传的切片数量 + 本次上传的切片数量 = 所有切片数量时</span></span><br><span class="line">      <span class="comment">// 合并切片</span></span><br><span class="line">+      <span class="keyword">if</span> (uploadedList.<span class="property">length</span> + requestList.<span class="property">length</span> === <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">length</span>) &#123;</span><br><span class="line">         <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">mergeRequest</span>();</span><br><span class="line">+      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f890e598de0946?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image-20200109144331326"></p><p>这里给原来上传切片的函数新增 uploadedList 参数，即上图中服务端返回的切片名列表，通过 filter 过滤掉已上传的切片，并且由于新增了已上传的部分，所以之前合并接口的触发条件做了一些改动</p><p>到这里断点续传的功能基本完成了</p><h2 id="进度条改进"><a href="#进度条改进" class="headerlink" title="进度条改进"></a>进度条改进</h2><p>虽然实现了断点续传，但还需要修改一下进度条的显示规则，否则在暂停上传&#x2F;接收到已上传切片时的进度条会出现偏差</p><h3 id="切片进度条-1"><a href="#切片进度条-1" class="headerlink" title="切片进度条"></a>切片进度条</h3><p>由于在点击上传&#x2F;恢复上传时，会调用验证接口返回已上传的切片，所以需要将已上传切片的进度变成 100%</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">async</span> <span class="title function_">handleUpload</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">const</span> fileChunkList = <span class="variable language_">this</span>.<span class="title function_">createFileChunk</span>(<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">calculateHash</span>(fileChunkList);</span><br><span class="line">      <span class="keyword">const</span> &#123; shouldUpload, uploadedList &#125; = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">verifyUpload</span>(</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">name</span>,</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (!shouldUpload) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&quot;秒传：上传成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">data</span> = fileChunkList.<span class="title function_">map</span>(<span class="function">(<span class="params">&#123; file &#125;, index</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">fileHash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span>,</span><br><span class="line">        index,</span><br><span class="line">        <span class="attr">hash</span>: <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">hash</span> + <span class="string">&quot;-&quot;</span> + index,</span><br><span class="line">        <span class="attr">chunk</span>: file,</span><br><span class="line">+       <span class="attr">percentage</span>: uploadedList.<span class="title function_">includes</span>(index) ? <span class="number">100</span> : <span class="number">0</span></span><br><span class="line">      &#125;));</span><br><span class="line">      <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadChunks</span>(uploadedList);</span><br><span class="line">    &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>uploadedList 会返回已上传的切片，在遍历所有切片时判断当前切片是否在已上传列表里即可</p><h3 id="文件进度条-1"><a href="#文件进度条-1" class="headerlink" title="文件进度条"></a>文件进度条</h3><p>之前说到文件进度条是一个计算属性，根据所有切片的上传进度计算而来，这就遇到了一个问题</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f8845dcca1427c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>点击暂停会取消并清空切片的 xhr 请求，此时如果已经上传了一部分，就会发现文件进度条有<code>倒退</code>的现象</p><p><img src="https://user-gold-cdn.xitu.io/2020/1/9/16f884633f3acfd9?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><p>当点击恢复时，由于重新创建了 xhr 导致切片进度清零，所以总进度条就会倒退</p><p>解决方案是创建一个“假”的进度条，这个假进度条基于文件进度条，但只会停止和增加，然后给用户展示这个假的进度条</p><p>这里我们使用 Vue 的监听属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">data</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">+    <span class="attr">fakeUploadPercentage</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">uploadPercentage</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span> || !<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">length</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">const</span> loaded = <span class="variable language_">this</span>.<span class="property">data</span></span><br><span class="line">        .<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">size</span> * item.<span class="property">percentage</span>)</span><br><span class="line">        .<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> acc + cur);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">parseInt</span>((loaded / <span class="variable language_">this</span>.<span class="property">container</span>.<span class="property">file</span>.<span class="property">size</span>).<span class="title function_">toFixed</span>(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,  </span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">+    <span class="title function_">uploadPercentage</span>(<span class="params">now</span>) &#123;</span><br><span class="line">+      <span class="keyword">if</span> (now &gt; <span class="variable language_">this</span>.<span class="property">fakeUploadPercentage</span>) &#123;</span><br><span class="line">+        <span class="variable language_">this</span>.<span class="property">fakeUploadPercentage</span> = now;</span><br><span class="line">+      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>当 uploadPercentage 即真的文件进度条增加时，fakeUploadPercentage 也增加，一旦文件进度条后退，假的进度条只需停止即可</p><p>至此一个大文件上传 + 断点续传的解决方案就完成了</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>大文件上传</p><ul><li>前端上传大文件时使用 Blob.prototype.slice 将文件切片，并发上传多个切片，最后发送一个合并的请求通知服务端合并切片</li><li>服务端接收切片并存储，收到合并请求后使用流将切片合并到最终文件</li><li>原生 XMLHttpRequest 的 upload.onprogress 对切片上传进度的监听</li><li>使用 Vue 计算属性根据每个切片的进度算出整个文件的上传进度</li></ul><p>断点续传</p><ul><li>使用 spark-md5 根据文件内容算出文件 hash</li><li>通过 hash 可以判断服务端是否已经上传该文件，从而直接提示用户上传成功（秒传）</li><li>通过 XMLHttpRequest 的 abort 方法暂停切片的上传</li><li>上传前服务端返回已经上传的切片名，前端跳过这些切片的上传</li></ul>]]></content>
      
      
      <categories>
          
          <category> 小功能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack</title>
      <link href="/hisai3.github.io/2023/01/14/webpack/"/>
      <url>/hisai3.github.io/2023/01/14/webpack/</url>
      
        <content type="html"><![CDATA[<h1 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>首先我们创建一个项目<code>webpack-demo</code>，然后初始化<code>npm</code>，然后在本地安装<code>webpack</code>和<code>webpack-cli</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir webpack-demo</span><br><span class="line">cd webpack-demo</span><br><span class="line">npm init -y</span><br><span class="line">npm install webpack webpack-cli --save-dev</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>安装的<code>webpack包</code>则是webpack的核心功能包，<code>webpack-cli</code>则是webpack的命令行工具，可以在终端中使用webpack命令启动项目和打包项目。</p><p>然后我们在项目的根目录下创建一个文件夹<code>webpack</code>，在这个文件夹中创建三个文件用以区分环境：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">webpack.<span class="property">common</span>.<span class="property">js</span> <span class="comment">// 公用配置</span></span><br><span class="line"></span><br><span class="line">webpack.<span class="property">dev</span>.<span class="property">js</span> <span class="comment">// 开发时的配置</span></span><br><span class="line"></span><br><span class="line">webpack.<span class="property">prod</span>.<span class="property">js</span> <span class="comment">// 打包构建时的配置</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa039631b78d45adb0d7ee3548987ad7~tplv-k3u1fbpfcp-watermark.awebp" alt="1637049449030.jpg"></p><p>然后在根目录创建src文件夹，在src文件夹下面创建index.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">el.<span class="property">innerHTML</span> = <span class="string">&#x27;hello webpack5&#x27;</span>;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><p>我们在<code>webpack</code>文件夹下的<code>webpack.common.js</code>中来写基本的配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack/webpack.common.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">webpackEnv</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isEnvDevelopment = webpackEnv === <span class="string">&#x27;development&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> isEnvProduction = webpackEnv === <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">mode</span>: webpackEnv, </span><br><span class="line">      <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;main.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">module</span>: &#123;</span><br><span class="line">          <span class="attr">rules</span>: []</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">plugins</span>: [],</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这里我们导出了一个函数，函数中返回了webpack的配置信息。当这个函数被调用时，会传入当前运行的环境标识<code>webpackEnv</code>，它的值是<code>development</code>或者<code>production</code>，并将<code>webpackEnv</code>赋值给了<code>mode</code>，用于根据不同模式开启相应的内置优化，还有个作用则是根据不同环境自定义开启不同的配置，在后续配置中会用到。</p><p>在配置信息中是webpack的5大基本模块：</p><ol><li><code>mode</code>：模式，通过选择：<code>development，production，none</code>这三个参数来告诉webpack使用相应模式的内置优化。</li><li><code>entry</code>：设置入口文件。</li><li><code>output</code>：告诉wenpack打包出的文件存放在哪里</li><li><code>module.rules</code>：loader（加载器），webpack本身只支持处理js，json文件，要想能够处理其它类型的文件，如：css，jsx，ts，vue等，则需要相应的loader将这些文件转换成有效的模块。</li><li><code>plugins</code>：插件，loader用于处理不支持的类型的文件，而plugin则可以用于执行范围更广的任务，如：压缩代码(<code>new TerserWebpackPlugin()</code>)，资源管理(<code>new HtmlWebPackPlugin()</code>)，注入环境变量（<code>new webpack.DefinePlugin(&#123;...&#125;)</code>)等。</li></ol><h3 id="配置webpack-dev-server"><a href="#配置webpack-dev-server" class="headerlink" title="配置webpack-dev-server"></a>配置webpack-dev-server</h3><p>基本配置完成了，我们现在想要让代码运行起来，并且当代码修改后可以自动刷新页面。</p><p>首先先安装<code>webpack-dev-server</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-dev-server</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>安装完成后，我们进入webpack.dev.js中来添加开发时的配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpackCommonConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common.js&#x27;</span>)(<span class="string">&#x27;development&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>, <span class="comment">// 指定host，，改为0.0.0.0可以被外部访问</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">8081</span>, <span class="comment">// 指定端口号</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>, <span class="comment">// 服务启动后自动打开默认浏览器</span></span><br><span class="line">    <span class="attr">historyApiFallback</span>: <span class="literal">true</span>, <span class="comment">// 当找不到页面时，会返回index.html</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>, <span class="comment">// 启用模块热替换HMR，在修改模块时不会重新加载整个页面，只会更新改变的内容</span></span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>, <span class="comment">// 启动GZip压缩</span></span><br><span class="line">    <span class="attr">https</span>: <span class="literal">false</span>, <span class="comment">// 是否启用https协议</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123; <span class="comment">// 启用请求代理，可以解决前端跨域请求的问题</span></span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;www.baidu.com&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  ...webpackCommonConfig,</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在这里我们首先引入了<code>webpack.common.js</code>，上面我们介绍了这个文件导出一个函数，接收环境标识作为参数，这里我们传入的是<code>development</code>，然后将返回的配置对象<code>webpackCommonConfig</code>，与开发时的配置进行了合并。</p><h3 id="配置html-webpack-plugin"><a href="#配置html-webpack-plugin" class="headerlink" title="配置html-webpack-plugin"></a>配置html-webpack-plugin</h3><p><code>html-webpack-plugin</code>的作用是生成一个html文件，并且会将webpack构建好的文件自动引用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>安装完成后，在<code>webpack.common.js</code>中添加该插件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack/webpack.common.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">webpackEnv</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isEnvDevelopment = webpackEnv === <span class="string">&#x27;development&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> isEnvProduction = webpackEnv === <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">mode</span>: webpackEnv, </span><br><span class="line">      <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;main.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">module</span>: &#123;</span><br><span class="line">          <span class="attr">rules</span>: []</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">plugins</span>: [</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(),</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><code>html-webpack-plugin</code>还可以添加一个模板文件，让<code>html-webpack-plugin</code>根据模板文件生成html文件。</p><p>我们在根目录下创建一个<code>public</code>文件夹，在文件夹下创建一个<code>index.ejs</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// public/index.ejs</span></span><br><span class="line"></span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;theme-color&quot;</span> <span class="attr">content</span>=<span class="string">&quot;#000000&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Web site created using create-react-app&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Webpack5<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>然后在插件中引入模板：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack/webpack.common.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">webpackEnv</span>) =&gt;</span> &#123;</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="attr">plugins</span>: [</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">              <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../public/index.ejs&#x27;</span>)</span><br><span class="line">          &#125;),</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><code>注意：</code>：这里我引用<code>.html</code>后缀的模板，<code>html-webpack-plugin</code>始终无法正常的生成html，然后改为了<code>.ejs</code>后就正常了。</p><h3 id="在package-json中配置启动，打包命令"><a href="#在package-json中配置启动，打包命令" class="headerlink" title="在package.json中配置启动，打包命令"></a>在package.json中配置启动，打包命令</h3><p>然后我们在package.js中来配置启动和打包的命令：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;fcc-template-typescript&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config ./webpack/webpack.prod.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack server --config ./webpack/webpack.dev.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们在<code>scripts</code>中添加了build和start命令，build用于打包发布，start用以开发时启动项目。</p><p>然后我们命令行中进入到项目的更目录下，运行：<code>npm start</code> 或者 <code>yarn start</code>命令来启动项目。</p><h3 id="加载CSS"><a href="#加载CSS" class="headerlink" title="加载CSS"></a>加载CSS</h3><p>我们知道webpack本身只支持处理<code>js和json</code>类型的文件，如果我们想处理其它类型的文件，则需要使用相应的<code>loader</code>。</p><p>提前列出需要使用到的loader：</p><ol><li><code>style-loader</code></li><li><code>css-loader</code></li><li><code>postcss-loader</code></li></ol><p>安装：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev style-loader css-loader postcss-loader postcss postcss-preset-env</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>对于css文件，则需要添加：<code>css-loader</code>：</p><p><strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack/webpack.common.js</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">webpackEnv</span>) =&gt;</span> &#123;</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="attr">module</span>: &#123;</span><br><span class="line">            <span class="attr">rules</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/.css$/i</span>,</span><br><span class="line">                    <span class="attr">use</span>: [<span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><strong>index.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span>;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><strong>index.css</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#root &#123;</span><br><span class="line">  <span class="attr">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>此时我们运行发现文字并没有添加颜色，这是为什么？</p><p>因为<code>css-loader</code>只负责解析css文件，解析完成后会返回一个包含了css样式的js对象：</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48d0a4036982462391912de58741ea12~tplv-k3u1fbpfcp-watermark.awebp" alt="1637054164915.jpg"></p><p>我们需要css样式生效，则需要将css样式插入到dom中，那么又需要安装自动插入样式的loader：<code>style-loader</code>。</p><p><strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack/webpack.common.js</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">webpackEnv</span>) =&gt;</span> &#123;</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="attr">module</span>: &#123;</span><br><span class="line">            <span class="attr">rules</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/.css$/i</span>,</span><br><span class="line">                    <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这里需要注意，loader的执行顺序是<code>倒序执行</code>（从右向左或者说从下向上），我们需要先使用<code>css-loader</code>解析css生成js对象后，将css对象交给<code>style-loader</code>，<code>style-loader</code>会创建style标签，将css样式抽取出来放在style标签中，然后插入到head中。</p><p>在不同浏览器上css的支持是不一样的，所以我们需要使用<code>postcss-loader</code>来做css的兼容： <strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/.css$/i</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                <span class="string">&quot;style-loader&quot;</span>, </span><br><span class="line">                <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">                 &#123;</span><br><span class="line">                    <span class="comment">// css兼容性处理</span></span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                      <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">                        <span class="attr">plugins</span>: [</span><br><span class="line">                          [</span><br><span class="line">                            <span class="string">&#x27;postcss-preset-env&#x27;</span>,</span><br><span class="line">                            &#123;</span><br><span class="line">                              <span class="attr">autoprefixer</span>: &#123;</span><br><span class="line">                                <span class="attr">flexbox</span>: <span class="string">&#x27;no-2009&#x27;</span>,</span><br><span class="line">                              &#125;,</span><br><span class="line">                              <span class="attr">stage</span>: <span class="number">3</span>,</span><br><span class="line">                            &#125;,</span><br><span class="line">                          ],</span><br><span class="line">                        ],</span><br><span class="line">                      &#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在postcss中使用了<code>postcss-preset-env</code>插件来自动添加前缀。</p><h3 id="加载image图像"><a href="#加载image图像" class="headerlink" title="加载image图像"></a>加载image图像</h3><p>在webpack5之前我们使用<code>url-loader</code>来加载图片，在webpack5中我们使用内置的<a href="https://link.juejin.cn/?target=https://webpack.docschina.org/guides/asset-modules/">Asset Modules</a>来加载图像资源。</p><p>在 webpack 5 之前，通常使用：</p><ul><li><a href="https://link.juejin.cn/?target=https://v4.webpack.js.org/loaders/raw-loader/"><code>raw-loader</code></a> 将文件导入为字符串</li><li><a href="https://link.juejin.cn/?target=https://v4.webpack.js.org/loaders/url-loader/"><code>url-loader</code></a> 将文件作为 data URI 内联到 bundle 中</li><li><a href="https://link.juejin.cn/?target=https://v4.webpack.js.org/loaders/file-loader/"><code>file-loader</code></a> 将文件发送到输出目录</li></ul><p>资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</p><ul><li><code>asset/resource</code> 发送一个单独的文件并导出 URL。之前通过使用 <code>file-loader</code> 实现。</li><li><code>asset/inline</code> 导出一个资源的 data URI。之前通过使用 <code>url-loader</code> 实现。</li><li><code>asset/source</code> 导出资源的源代码。之前通过使用 <code>raw-loader</code> 实现。</li><li><code>asset</code> 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 <code>url-loader</code>，并且配置资源体积限制实现。</li></ul><p><strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">module</span>: &#123;</span><br><span class="line">   <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|jpeg|gif)$/</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span>, </span><br><span class="line">      <span class="attr">generator</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;image/[name].[contenthash:8][ext][query]&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">   ]</span><br><span class="line">  &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>添加<code>generator</code>属性自定义文件名与文件存放位置。</p><p>也可以在<code>output</code>中定义<code>assetModuleFilename</code>设置默认存放位置与文件名格式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">  <span class="attr">assetModuleFilename</span>: <span class="string">&#x27;asset/[name].[contenthash:8][ext][query]&#x27;</span>, </span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="加载fonts字体或者其他资源"><a href="#加载fonts字体或者其他资源" class="headerlink" title="加载fonts字体或者其他资源"></a>加载fonts字体或者其他资源</h3><p><strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">module</span>: &#123;</span><br><span class="line">   <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">exclude</span>: <span class="regexp">/\.(js|mjs|ejs|jsx|ts|tsx|css|scss|sass|png|svg|jpg|jpeg|gif)$/i</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>, </span><br><span class="line">    &#125;,</span><br><span class="line">   ]</span><br><span class="line">  &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们通过排除其他资源的后缀名来加载其他资源。</p><h3 id="兼容js：将es6语法转换为es5"><a href="#兼容js：将es6语法转换为es5" class="headerlink" title="兼容js：将es6语法转换为es5"></a>兼容js：将es6语法转换为es5</h3><p>需要使用到的loader：</p><ol><li><code>babel-loader</code></li></ol><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-loader @babel/core @babel/preset-env</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>需要用到的babel插件：</p><ol><li><code>@babel/plugin-transform-runtime</code></li><li><code>@babel/runtime</code></li></ol><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/plugin-transform-runtime</span><br><span class="line">复制代码</span><br><span class="line">npm install --save @babel/runtime</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">module</span>: &#123;</span><br><span class="line">   <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">presets</span>: [</span><br><span class="line">                [</span><br><span class="line">                    <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;useBuiltIns&quot;</span>: <span class="string">&quot;usage&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;corejs&quot;</span>: <span class="number">3</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">              ],</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">   ]</span><br><span class="line">  &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这里我们会使用babel的插件：<code>@babel/preset-env</code>，它是转译插件的集合。</p><p>比如说我们使用了箭头函数，浏览器是不识别的需要转译成普通函数，那么我们就需要添加babel插件：<code>@babel/plugin-transform-arrow-functions</code>来处理箭头函数，如果我们使用了很多es6的api，都需要手动添加插件，这样会非常麻烦，babel为了简便开发者的使用，将所有需要转换的es6特性的插件都集合到了<code>@babel/preset-env</code>中。</p><p>在使用<code>@babel/preset-env</code>我们需要配置<code>corejs</code>属性，什么是corejs？</p><p>babel只支持最新语法的转换，比如：<code>extends</code>，但是它没办法支持最新的Api，比如：Map，Set，Promise等，需要在不兼容的环境中也支持最新的Api那么则需要通过Polyfill的方式在目标环境中添加缺失的Api，这时我们就需要引入<code>core-js</code>来实现polyfill。</p><p><code>useBuiltIns</code>则是告诉babel怎么引入polyfill。</p><p>当选择<code>entry</code>时，babel不会引入polyfill，需要我们手动全量引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Promise</span>();</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>当选择<code>usage</code>时，babel会根据当前的代码自动引入需要的polyfill：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;core-js/modules/es.promise&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Promise</span>();</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>但是我们发现这样使用polyfill，会污染全局对象，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;foobar&quot;</span>.<span class="title function_">includes</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line"></span><br><span class="line">使用polyfill后，会在<span class="title class_">String</span>的原型对象上添加includes方法：</span><br><span class="line"></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">includes</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>如果我们使用了其它插件也在原型对象上添加了同名方法的，那就会导致出现问题。</p><p>这时我们则可以使用<code>@babel/plugin-transform-runtime</code>插件，通过引入模块的方式来实现polyfill：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">module</span>: &#123;</span><br><span class="line">   <span class="attr">rules</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">presets</span>: [</span><br><span class="line">                <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">              ],</span><br><span class="line">              <span class="attr">plugins</span>: [</span><br><span class="line">                [</span><br><span class="line">                  <span class="string">&#x27;@babel/plugin-transform-runtime&#x27;</span>,</span><br><span class="line">                  &#123;</span><br><span class="line">                    <span class="string">&quot;helpers&quot;</span>: <span class="literal">true</span>, </span><br><span class="line">                    <span class="string">&quot;corejs&quot;</span>: <span class="number">3</span>,</span><br><span class="line">                    <span class="string">&quot;regenerator&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                  &#125;</span><br><span class="line">                ]</span><br><span class="line">              ],</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">   ]</span><br><span class="line">  &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们来看下效果：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;foobar&quot;</span>.<span class="title function_">includes</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>转译后：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _babel_runtime_corejs3_core_js_stable_instance_includes__WEBPACK_IMPORTED_MODULE_1___default = __webpack_require__.<span class="title function_">n</span>(_babel_runtime_corejs3_core_js_stable_instance_includes__WEBPACK_IMPORTED_MODULE_1__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">_babel_runtime_corejs3_core_js_stable_instance_includes__WEBPACK_IMPORTED_MODULE_1___default</span>()(_context = <span class="string">&quot;foobar&quot;</span>).<span class="title function_">call</span>(_context, <span class="string">&quot;foo&quot;</span>);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>可以看到转译后<code>includes</code>的实现是通过调用了<code>runtime—corejs3</code>中的<code>includes</code>方法。</p><p>通过上面我们知道了<code>@babel/plugin-transform-runtime</code>的作用，我们再来看看它常用的配置属性。</p><p><code>helpers</code>，我们将helpers先设置为false来看看编译后的效果。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>转译后：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_classCallCheck</span>(<span class="params">instance, Constructor</span>) &#123; <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> <span class="title class_">Constructor</span>)) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Cannot call a class as a function&quot;</span>); &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Test</span> = <span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, <span class="title class_">Test</span>);</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们看到在转译后，在顶部添加了一个<code>_classCallCheck</code>工具函数，如果打包后有多个文件，每个文件中都是用了<code>class</code>，那么在顶部都会生成同样的<code>_classCallCheck</code>工具函数，这会使我们最后打包出来的文件体积变大。</p><p>我们将<code>helpers</code>设置为true，再来看转译后的效果：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _babel_runtime_corejs3_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0__ = <span class="title function_">__webpack_require__</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Test</span> = <span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  (<span class="number">0</span>,_babel_runtime_corejs3_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0__[<span class="string">&quot;default&quot;</span>])(<span class="variable language_">this</span>, <span class="title class_">Test</span>);</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们看到<code>_classCallCheck</code>函数通过模块的方式被引入，这样就使babel通用的工具函数能够被复用，从而减小文件打包后的体积。</p><p><code>corejs</code>：指定依赖corejs的版本进行polyfill。</p><p><code>regenerator</code>：在我们使用generate时，会在全局环境上注入generate的实现函数，这样会造成全局污染，将regenerator设置true，通过模块引入的方式来调用generate，避免全局污染：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p><code>regenerator</code>设置为false时：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> regeneratorRuntime.<span class="title function_">wrap</span>(<span class="keyword">function</span> <span class="title function_">test$</span>(<span class="params">_context</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (_context.<span class="property">prev</span> = _context.<span class="property">next</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">          _context.<span class="property">next</span> = <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;end&quot;</span>:</span><br><span class="line">          <span class="keyword">return</span> _context.<span class="title function_">stop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>可以看到<code>regeneratorRuntime</code>这个对象是直接使用的，并没有引入，那么它肯定就是存在于全局环境上。</p><p><code>regenerator</code>设置为true时：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">_babel_runtime_corejs3_regenerator__WEBPACK_IMPORTED_MODULE_0___default</span>().<span class="title function_">wrap</span>(<span class="keyword">function</span> <span class="title function_">test$</span>(<span class="params">_context</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (_context.<span class="property">prev</span> = _context.<span class="property">next</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">          _context.<span class="property">next</span> = <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;end&quot;</span>:</span><br><span class="line">          <span class="keyword">return</span> _context.<span class="title function_">stop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, _marked);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>可以看到，这次使用的<code>generate</code>函数是从<code>runtime-corejs3</code>中导出引用的。</p><p><strong>注意</strong>：还需要在<code>package.json</code>中配置目标浏览器，告诉babel我们要为哪些浏览器进行<code>polyfill</code>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;webpack5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">&quot;browserslist&quot;</span>: &#123;</span><br><span class="line">   <span class="comment">// 开发时配置，针对较少的浏览器，使polyfill的代码更少，编译更快</span></span><br><span class="line">    <span class="string">&quot;development&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;last 1 chrome version&quot;</span>,</span><br><span class="line">      <span class="string">&quot;last 1 firefox version&quot;</span>,</span><br><span class="line">      <span class="string">&quot;last 1 safari version&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 生产的配置，需要考虑所有支持的浏览器，支持的浏览器越多，polyfill的代码也就越多</span></span><br><span class="line">    <span class="string">&quot;production&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;&gt;0.2%&quot;</span>,</span><br><span class="line">      <span class="string">&quot;not dead&quot;</span>,</span><br><span class="line">      <span class="string">&quot;not op_mini all&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="进阶配置"><a href="#进阶配置" class="headerlink" title="进阶配置"></a>进阶配置</h2><p>完成了webpack的基本配置后，我们再来配置一些更高级的。</p><h3 id="加载css-modules"><a href="#加载css-modules" class="headerlink" title="加载css modules"></a>加载css modules</h3><p>什么是css modules？</p><p>我是这么理解的：<strong>每个css文件都有自己的作用域，css文件中的属性在该作用域下都是唯一的</strong>。</p><p>在我们有多个组件时，每个组件都有相对应的css文件，其中的属性名称难免会有重名的，我们直接使用的话，后者则会覆盖前者，只会有一个样式生效。我们通过css modules对属性名通过hash值或者路径字符串的形式进行重命名，保证每个属性名都是唯一的，只会作用在本身的组件上，而不会影响到其它组件。</p><p>直接在<code>css-loader</code>中添加<code>modules</code>属性：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.module\.css$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">        ...</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">modules</span>: &#123;</span><br><span class="line">                  <span class="attr">localIdentName</span>: <span class="string">&#x27;[hash:base64:8]&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="加载sass"><a href="#加载sass" class="headerlink" title="加载sass"></a>加载sass</h3><p>sass是一款强化css的辅助工具，它在css基础上增加了变量，嵌套，混合，导入等功能，能够使我们更好的管理样式文件，更高效的开发项目。</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install sass-loader sass --save-dev</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在webpack中需要添加<code>sass-loader</code>，来对sass文件进行处理，将sass文件转化为css文件。</p><p><strong>注意:</strong> 需要放在 <code>css-loader</code> 后面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.(scss|sass)$/</span>,</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">&#x27;sass-loader&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">&#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="配置React"><a href="#配置React" class="headerlink" title="配置React"></a>配置React</h3><p>我们在写react代码的时候，使用了jsx语法，但是浏览器并不认识jsx语法，我们需要先对jsx语法进行转换为浏览器认识的语法<code>React.createElement(...)</code>。</p><p>需要的babel插件：</p><ol><li><code>@babel/preset-react</code></li></ol><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/preset-react</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">presets</span>: [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&quot;@babel/preset-react&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">runtime</span>: <span class="string">&#x27;automatic&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在以前旧版本中，我们在使用jsx语法时，必须要引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在最新的版本中，我们将<code>runtime</code>设置为<code>automatic</code>，就可以省略这一步，babel会自动为我们导入jsx的转换函数。</p><h3 id="配置Typescript"><a href="#配置Typescript" class="headerlink" title="配置Typescript"></a>配置Typescript</h3><p>浏览器是不支持ts的语法的，我们需要先将ts文件进行编译，转换为js后浏览器才能够识别。</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/preset-typescript typescript</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">presets</span>: [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      [</span><br><span class="line">        <span class="string">&quot;@babel/preset-react&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">runtime</span>: <span class="string">&#x27;automatic&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@babel/preset-typescript&quot;</span>,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>还需要在项目根目录下添加<code>tsconfig.json</code>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lib&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;dom&quot;</span>,</span><br><span class="line">      <span class="string">&quot;dom.iterable&quot;</span>,</span><br><span class="line">      <span class="string">&quot;esnext&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;allowJs&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;skipLibCheck&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;allowSyntheticDefaultImports&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;strict&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;forceConsistentCasingInFileNames&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;noFallthroughCasesInSwitch&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;module&quot;</span>: <span class="string">&quot;esnext&quot;</span>,</span><br><span class="line">    <span class="string">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="string">&quot;resolveJsonModule&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;isolatedModules&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;noEmit&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;jsx&quot;</span>: <span class="string">&quot;react-jsx&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;include&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;src&quot;</span>,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>具体配置可以查看ts官网。</p><h3 id="配置ESLint"><a href="#配置ESLint" class="headerlink" title="配置ESLint"></a>配置ESLint</h3><p>多人开发时，我们希望每个人写的代码风格都是统一的，那么则需要ESLint来帮助我们实现。</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D eslint eslint-webpack-plugin</span><br><span class="line">yarn add -D @typescript-eslint/eslint-plugin @typescript-eslint/parser</span><br><span class="line">yarn add -D eslint-config-airbnb eslint-config-airbnb-typescript</span><br><span class="line">yarn add -D eslint-plugin-<span class="keyword">import</span> eslint-plugin-jsx-a11y</span><br><span class="line">yarn add -D eslint-config-prettier eslint-plugin-react eslint-plugin-react-hooks</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这里我们选用的是 eslint-config-airbnb 配置，它对 JSX、Hooks、TypeScript 及 A11y 无障碍化都有良好的支持，可能也是目前最流行、最严格的 ESLint 校验之一。</p><p>接下来，创建 ESLint 配置文件 .eslintrc.js：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有问题</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">parser</span>: <span class="string">&#x27;@typescript-eslint/parser&#x27;</span>,</span><br><span class="line">  <span class="attr">extends</span>: [</span><br><span class="line">    <span class="string">&#x27;airbnb&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;airbnb-typescript&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;airbnb/hooks&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;plugin:@typescript-eslint/recommended&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;plugin:@typescript-eslint/recommended-requiring-type-checking&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;plugin:react/jsx-runtime&#x27;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">project</span>: <span class="string">&#x27;./tsconfig.json&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">ignorePatterns</span>: [<span class="string">&quot;.*&quot;</span>, <span class="string">&quot;webpack&quot;</span>, <span class="string">&quot;public&quot;</span>, <span class="string">&quot;node_modules&quot;</span>, <span class="string">&quot;dist&quot;</span>], <span class="comment">// 忽略指定文件夹或文件</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="comment">// 在这里添加需要覆盖的规则</span></span><br><span class="line">    <span class="string">&quot;react/function-component-definition&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;quotes&quot;</span>: [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;single&quot;</span>],</span><br><span class="line">    <span class="string">&quot;jsx-quotes&quot;</span>: [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;prefer-single&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础设置</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"><span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">env</span>: &#123;</span><br><span class="line"><span class="attr">node</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">browser</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">es6</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">extends</span>: <span class="string">&quot;airbnb-base&quot;</span>,</span><br><span class="line"><span class="attr">rules</span>: &#123;</span><br><span class="line"><span class="string">&#x27;no-console&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;warn&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;no-debugger&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;warn&#x27;</span> : <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 稍微完整</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">parser</span>: <span class="string">&#x27;babel-eslint&#x27;</span>,</span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">    <span class="attr">ecmaFeatures</span>:&#123;</span><br><span class="line">      <span class="comment">// 支持装饰器</span></span><br><span class="line">      <span class="attr">legacyDecorators</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">browser</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">node</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">es6</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">extends</span>: [<span class="string">&#x27;airbnb&#x27;</span>],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add your custom rules here</span></span><br><span class="line">  <span class="comment">//it is base on https://github.com/vuejs/eslint-config-vue</span></span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;accessor-pairs&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;arrow-spacing&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;before&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&#x27;after&#x27;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;block-spacing&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;always&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;brace-style&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;1tbs&#x27;</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;allowSingleLine&#x27;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;camelcase&#x27;</span>: [<span class="number">0</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;properties&#x27;</span>: <span class="string">&#x27;always&#x27;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;comma-dangle&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;comma-spacing&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;before&#x27;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&#x27;after&#x27;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;comma-style&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;last&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;constructor-super&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;curly&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;multi-line&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;dot-location&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;property&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;eol-last&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;eqeqeq&#x27;</span>: [<span class="string">&quot;error&quot;</span>, <span class="string">&quot;always&quot;</span>, &#123;<span class="string">&quot;null&quot;</span>: <span class="string">&quot;ignore&quot;</span>&#125;],</span><br><span class="line">    <span class="string">&#x27;generator-star-spacing&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;before&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&#x27;after&#x27;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;handle-callback-err&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;^(err|error)$&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;indent&#x27;</span>: [<span class="number">2</span>, <span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;SwitchCase&#x27;</span>: <span class="number">1</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;jsx-quotes&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;prefer-single&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;key-spacing&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;beforeColon&#x27;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&#x27;afterColon&#x27;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;keyword-spacing&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;before&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&#x27;after&#x27;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;new-cap&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;newIsCap&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&#x27;capIsNew&#x27;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;new-parens&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-array-constructor&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-caller&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-console&#x27;</span>: <span class="string">&#x27;off&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;no-class-assign&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-cond-assign&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-const-assign&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-control-regex&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;no-delete-var&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-dupe-args&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-dupe-class-members&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-dupe-keys&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-duplicate-case&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-empty-character-class&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-empty-pattern&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-eval&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-ex-assign&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-extend-native&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-extra-bind&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-extra-boolean-cast&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-extra-parens&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;functions&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;no-fallthrough&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-floating-decimal&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-func-assign&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-implied-eval&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-inner-declarations&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;functions&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;no-invalid-regexp&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-irregular-whitespace&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-iterator&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-label-var&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-labels&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;allowLoop&#x27;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&#x27;allowSwitch&#x27;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;no-lone-blocks&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-mixed-spaces-and-tabs&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-multi-spaces&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-multi-str&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-multiple-empty-lines&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;max&#x27;</span>: <span class="number">1</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;no-native-reassign&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-negated-in-lhs&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-new-object&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-new-require&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-new-symbol&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-new-wrappers&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-obj-calls&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-octal&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-octal-escape&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-path-concat&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-proto&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-redeclare&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-regex-spaces&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-return-assign&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;except-parens&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;no-self-assign&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-self-compare&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-sequences&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-shadow-restricted-names&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-spaced-func&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-sparse-arrays&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-this-before-super&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-throw-literal&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-trailing-spaces&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-undef&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-undef-init&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-unexpected-multiline&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-unmodified-loop-condition&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-unneeded-ternary&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;defaultAssignment&#x27;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;no-unreachable&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-unsafe-finally&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-unused-vars&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;vars&#x27;</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;args&#x27;</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;no-useless-call&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-useless-computed-key&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-useless-constructor&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-useless-escape&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;no-whitespace-before-property&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-with&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;one-var&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;initialized&#x27;</span>: <span class="string">&#x27;never&#x27;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;operator-linebreak&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;after&#x27;</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;overrides&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;?&#x27;</span>: <span class="string">&#x27;before&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;:&#x27;</span>: <span class="string">&#x27;before&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;padded-blocks&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;quotes&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;single&#x27;</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;avoidEscape&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&#x27;allowTemplateLiterals&#x27;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;semi&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;semi-spacing&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;before&#x27;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">&#x27;after&#x27;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;space-before-blocks&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;always&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;space-before-function-paren&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;space-in-parens&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;space-infix-ops&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;space-unary-ops&#x27;</span>: [<span class="number">2</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;words&#x27;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">&#x27;nonwords&#x27;</span>: <span class="literal">false</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;spaced-comment&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;always&#x27;</span>, &#123;</span><br><span class="line">      <span class="string">&#x27;markers&#x27;</span>: [<span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;globals&#x27;</span>, <span class="string">&#x27;eslint&#x27;</span>, <span class="string">&#x27;eslint-disable&#x27;</span>, <span class="string">&#x27;*package&#x27;</span>, <span class="string">&#x27;!&#x27;</span>, <span class="string">&#x27;,&#x27;</span>]</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;template-curly-spacing&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;use-isnan&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;valid-typeof&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;wrap-iife&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;any&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;yield-star-spacing&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;both&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;yoda&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;prefer-const&#x27;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">&#x27;no-debugger&#x27;</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="number">2</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="string">&#x27;object-curly-spacing&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;always&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">objectsInObjects</span>: <span class="literal">false</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;array-bracket-spacing&#x27;</span>: [<span class="number">2</span>, <span class="string">&#x27;never&#x27;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>到这里eslin配置完成，但是需要我们每次都运行命令去检查和修复代码的问题，这样比较麻烦，所以我们使用webpack的插件：<code>eslint-webpack-plugin</code>来自动查找和修复代码中的问题：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ESLintPlugin</span>(&#123;</span><br><span class="line">          <span class="attr">extensions</span>: [<span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>],</span><br><span class="line">          <span class="attr">fix</span>: <span class="literal">true</span>, <span class="comment">// 自动修复错误代码</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="在命令行中提示ts的错误"><a href="#在命令行中提示ts的错误" class="headerlink" title="在命令行中提示ts的错误"></a>在命令行中提示ts的错误</h3><p>在打包的过程中我们发现，代码中提示ts的错误依然能打包成功，这不是我们期望的结果。我们期望的是当ts在代码中显示错误，那么打包时也应该报错。</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev fork-ts-checker-webpack-plugin</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ForkTsCheckerWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;fork-ts-checker-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ForkTsCheckerWebpackPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">typescript</span>: &#123;</span><br><span class="line">             <span class="attr">configFile</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../tsconfig.json&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">]</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h3 id="配置别名和扩展名"><a href="#配置别名和扩展名" class="headerlink" title="配置别名和扩展名"></a>配置别名和扩展名</h3><p>在引入文件的时候会这样写:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> demo <span class="keyword">from</span> <span class="string">&#x27;demo.js&#x27;</span>;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们可以在webpack中配置扩展名，之后再引入文件则可以省略文件的后缀名：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&#x27;.tsx&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>],</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>当我们在引入一些文件时，它的路径比较长，写起来非常麻烦，而且不易阅读， 比如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> demo <span class="keyword">from</span> <span class="string">&#x27;./src/xxx/xx/components/demo&#x27;</span>;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们则可以在webpack中配置别名，来达到缩短文件路径的目的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;components&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src/xxx/xx/components/&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>之后我们就可以这样引入文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> demo <span class="keyword">from</span> <span class="string">&#x27;components/demo&#x27;</span>;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>我们优化可以分为两个方面，一个是开发是的优化，一个是打包时的优化。</p><h3 id="开发时的优化"><a href="#开发时的优化" class="headerlink" title="开发时的优化"></a>开发时的优化</h3><h4 id="sourcemap"><a href="#sourcemap" class="headerlink" title="sourcemap"></a>sourcemap</h4><p>在开发时，我们需要对代码进行调式和错误定位，希望能够准确的定位到源码的位置上，那么我们则需要配置<code>sourcemap</code>：</p><p><strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devtool</span>: <span class="string">&#x27;cheap-module-source-map&#x27;</span>,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>配置好后，当代码报错，浏览器中就会显示报错的代码的准确信息。</p><h4 id="配置缓存"><a href="#配置缓存" class="headerlink" title="配置缓存"></a>配置缓存</h4><p>当我们启动项目时，每次都会重新构建所有的文件，但是有的文件是长期不变的，比如说在node_modules中的文件，并不需要每次都重新构建。</p><p>那么我们就讲这些长期不变的文件进行缓存：</p><p><strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cache</span>: &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;filesystem&quot;</span>, <span class="comment">// 使用文件缓存</span></span><br><span class="line">&#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在下一次启动的时候，webpack首先会去读取缓存中的文件，以此来提高构建的速度。</p><p><code>babel的缓存</code>：babel的缓存特性也是和webpack是一样的，在构建时，首先回去读取缓存，以此提高构建的速度：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">cacheDirectory</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>缓存的文件默认会在<code>node_modules</code>下的<code>.cache</code>文件夹下。</p><h4 id="开启HRM模块热替换"><a href="#开启HRM模块热替换" class="headerlink" title="开启HRM模块热替换"></a>开启HRM模块热替换</h4><p>什么是HRM？简单说就是当有模块被修改了，那么则会立即刷新这个模块，但是其他的模块不会刷新。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="property">js</span> -&gt; b.<span class="property">js</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>a文件中引用了b文件，在没有开启HRM的情况下，我们修改了b文件，那么整个页面都会刷新。</p><p>在开启了HRM后，修改了b文件，b文件会马上刷新，但是a文件是不会刷新的。</p><p>使用：</p><p><strong>webapck.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在需要热更新的文件中添加以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable language_">module</span> &amp;&amp; <span class="variable language_">module</span>.<span class="property">hot</span>) &#123;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>() <span class="comment">// 接受自更新</span></span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>但是在我们开发过程中不可能每个文件手动添加，而且在打包上线的时候是不需要热更新的代码的。</p><p>所以出现了一些自动添加热更新函数的插件：</p><ul><li><a href="https://link.juejin.cn/?target=https://github.com/gaearon/react-hot-loader">React Hot Loader</a>: 实时调整 react 组件。</li><li><a href="https://link.juejin.cn/?target=https://github.com/vuejs/vue-loader">Vue Loader</a>: 此 loader 支持 vue 组件的 HMR，提供开箱即用体验。</li><li><a href="https://link.juejin.cn/?target=https://github.com/klazuka/elm-hot-webpack-loader">Elm Hot webpack Loader</a>: 支持 Elm 编程语言的 HMR。</li><li><a href="https://link.juejin.cn/?target=https://github.com/gdi2290/angular-hmr">Angular HMR</a>: 没有必要使用 loader！直接修改 NgModule 主文件就够了，它可以完全控制 HMR API。</li><li><a href="https://link.juejin.cn/?target=https://github.com/sveltejs/svelte-loader">Svelte Loader</a>: 此 loader 开箱即用地支持 Svelte 组件的热更新。</li></ul><p>对于React来说，已经不使用<code>React Hot Loader</code>这个loader，而是使用<code>react-refresh</code>.</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D @pmmmwh/react-refresh-webpack-plugin react-refresh</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">ReactRefreshWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;@pmmmwh/react-refresh-webpack-plugin&#x27;</span>); <span class="comment">// react热更新</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">test</span>: <span class="regexp">/\.(js|jsx|ts|tsx)$/</span>,</span><br><span class="line">              <span class="attr">include</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src&#x27;</span>),</span><br><span class="line">              <span class="attr">use</span>: [</span><br><span class="line">                  &#123;</span><br><span class="line">                  <span class="attr">loader</span>: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                  <span class="attr">options</span>: &#123;</span><br><span class="line">                    <span class="attr">plugins</span>: [</span><br><span class="line">                      isEnvDevelopment &amp;&amp; <span class="string">&#x27;react-refresh/babel&#x27;</span>,</span><br><span class="line">                    ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>),</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        isEnvDevelopment &amp;&amp; <span class="keyword">new</span> <span class="title class_">ReactRefreshWebpackPlugin</span>(),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在<code>babel-load</code>的<code>plugins</code>中添加<code>react-refresh/babel</code>，然后在webpack的plugins中添加<code>@pmmmwh/react-refresh-webpack-plugin</code>。有一点需要注意，热更新只在开发环境开启，如果在生产环境开启了，会将热更新的代码一起打包，但是它对于我们生产环境的代码来说没有任何作用。</p><p>对于css的热更新来说，在我们使用的<code>style-loader</code>的内部已经实现了HRM。</p><h3 id="打包时的优化"><a href="#打包时的优化" class="headerlink" title="打包时的优化"></a>打包时的优化</h3><h4 id="抽离css"><a href="#抽离css" class="headerlink" title="抽离css"></a>抽离css</h4><p><code>mini-css-extract-plugin</code>插件会将js中的css提取到单独的css文件中，并且支持css和sourcemaps的按需加载。</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>); <span class="comment">// 将css从js中分离为单独的css文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                isEnvProduction ? </span><br><span class="line">                <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>: </span><br><span class="line">                <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">       ]</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(),</span><br><span class="line">  ]</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>通过环境区别，在开发环境使用<code>style-loader</code>，在生产环境使用<code>mini-css-extract-plugin</code>。</p><h4 id="代码分离"><a href="#代码分离" class="headerlink" title="代码分离"></a>代码分离</h4><p>在开发过程中，同一个文件难免会被多个文件引用，在打包后，这个被引用的文件会重复存在于引用了它的文件当中，我们需要将它打包成独立的文件来达到复用的目的。</p><p>使用splitChunks：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="最小化入口chunk的体积"><a href="#最小化入口chunk的体积" class="headerlink" title="最小化入口chunk的体积"></a>最小化入口chunk的体积</h4><p>通过配置<code>optimization.runtimeChunk</code>，将入口文件中运行时的代码提出来单独创建一个chunk，减小入口chunk的体积。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">runtimeChunk</span>: <span class="string">&#x27;single&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="压缩js"><a href="#压缩js" class="headerlink" title="压缩js"></a>压缩js</h4><p>通常压缩js代码我们会使用<code>terser-webpack-plugin</code>，在webpack5中已经内置了该插件，当<code>mode</code>为<code>production</code>时会自动启用。</p><p>如果我们想自定义的话：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">TerserPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TerserPlugin</span>(&#123;...&#125;);</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><h4 id="压缩css"><a href="#压缩css" class="headerlink" title="压缩css"></a>压缩css</h4><p>我们会使用<code>css-minimizer-webpack-plugin</code>插件。</p><p>它与<a href="https://link.juejin.cn/?target=https://github.com/NMFR/optimize-css-assets-webpack-plugin">optimize-css-assets-webpack-plugin</a> 相比，在 source maps 和 assets 中使用查询字符串会更加准确，支持缓存和并发模式下运行。</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install css-minimizer-webpack-plugin --save-dev</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">CssMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>();</span><br><span class="line">        <span class="string">&#x27;...&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这里注意一点，如果我们只想添加额外的插件与默认插件一起使用，需要添加<code>&#39;...&#39;</code>，表示添加默认插件。</p><h4 id="dll"><a href="#dll" class="headerlink" title="dll"></a>dll</h4><p>使用DllPlugin将不会频繁更改的代码单独打包生成一个文件，可以提高打包时的构建速度。</p><p>使用： 首先我们新建一个<code>webapck.dll.js</code>文件，将会不频繁更改的包添加在入口：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> paths = <span class="built_in">require</span>(<span class="string">&#x27;./paths&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">vendor</span>: [</span><br><span class="line">      <span class="string">&#x27;react&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: paths.<span class="property">dllPath</span>,</span><br><span class="line">    <span class="attr">filename</span>: paths.<span class="property">dllFilename</span>,</span><br><span class="line">    <span class="attr">library</span>: <span class="string">&#x27;[name]_dll_library&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 使用DllPlugin插件编译上面配置的NPM包</span></span><br><span class="line">    <span class="comment">// 会生成一个json文件，里面是关于dll.js的一些配置信息</span></span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DllPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">path</span>: paths.<span class="property">dllJsonPath</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;[name]_dll_library&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>然后我们在<code>package.json</code>处添加打包命令：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;webpack5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dll&quot;</span>: <span class="string">&quot;webpack --config ./webpack/webpack.dll.js&quot;</span></span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>然后我们运行：<code>npm run dll</code></p><p>最后会在项目根目录生成一个<code>dll</code>文件夹，其中会生成一个js文件，包含了我们需要单独打包的模块：<code>react</code>，<code>react-dom</code>，并且还需生成一个包含被打包模块信息的json文件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- dll</span><br><span class="line">  - vendor.<span class="property">dll</span>.<span class="property">js</span></span><br><span class="line">  - dll.<span class="property">manifest</span>.<span class="property">json</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>然后我们还需要干两件事：</p><ol><li>在上线打包时告诉webpack，不要将我们dll的模块进行打包</li><li>在打包成功后的js文件中是不会包含我们dll的模块，所以我们需要将dll出来的js文件引入。</li></ol><p><strong>webpack.common.js</strong></p><p>我们使用<code>DllReferencePlugin</code>来排除dll的模块：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.<span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">  <span class="attr">manifest</span>: paths.<span class="property">dllJsonPath</span></span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们需要将dll出来的json文件引入，json文件中包含了已经被打包的模块的信息，在webpack打包时就会排除这些模块。</p><p>然后我们使用<code>add-asset-html-webpack-plugin</code>来将dll出来的文件引入：</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add  -D add-asset-html-webpack-plugin</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;add-asset-html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span>(&#123;</span><br><span class="line">  <span class="attr">filepath</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../dll/vendor.dll.js&#x27;</span>),</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>这里需要注意一点，在我引入js文件后，进行了打包运行，但是发现在运行时找不到<code>vendor.dll.js</code>，查看了路径发现多了一层：<code>auto</code>，需要设置<code>publicPath</code>为空字符串解决。</p><h4 id="tree-shaking-树摇"><a href="#tree-shaking-树摇" class="headerlink" title="tree shaking - 树摇"></a>tree shaking - 树摇</h4><p>关于树摇，简单的理解的话就是再打包的时候将没有使用的js代码排除掉。</p><p><strong>开启树摇</strong>：只需要将<code>mode</code>设置为<code>production</code>，tree shaking就会自动开启。</p><p>有些时候我们会开发一些插件，里面会有很多方法是提供给别人使用的，在插件内部是没有使用，在打包的时候就会被tree shaking掉。这时我们需要在<code>package.js</code>中声明一下<code>sideEffects</code>属性：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;webpack5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;sideEffects&quot;</span>: [<span class="string">&quot;*.js&quot;</span>, <span class="string">&quot;*.css&quot;</span>]</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>通过<code>sideEffects</code>告诉webpack在我声明的文件中是有副作用的，不要进行tree shaking。</p><h4 id="清除未使用的css"><a href="#清除未使用的css" class="headerlink" title="清除未使用的css"></a>清除未使用的css</h4><p>清除未使用的css，可以理解为<code>css</code>的<code>tree shaking</code>，我们使用<code>purgecss</code>来实现。</p><p>因为我们经常会使用css模块，所以需要安装<code>@fullhuman/postcss-purgecss</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn add -D @fullhuman/postcss-purgecss</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">    <span class="attr">loader</span>: <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">    <span class="attr">options</span>: &#123;</span><br><span class="line">      <span class="attr">postcssOptions</span>: &#123;</span><br><span class="line">        <span class="attr">plugins</span>: [</span><br><span class="line">          ...</span><br><span class="line">          isEnvProduction &amp;&amp; </span><br><span class="line">          [</span><br><span class="line">            <span class="string">&#x27;@fullhuman/postcss-purgecss&#x27;</span>, <span class="comment">// 删除未使用的css</span></span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">content</span>: [ paths.<span class="property">appHtml</span>, ...glob.<span class="title function_">sync</span>(path.<span class="title function_">join</span>(paths.<span class="property">appSrc</span>, <span class="string">&#x27;/**/*.&#123;tsx,ts,js,jsx&#125;&#x27;</span>), &#123; <span class="attr">nodir</span>: <span class="literal">true</span> &#125;) ],</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在<code>postcss-loader</code>添加该插件就可以了。</p><h4 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h4><p>我们可以在工作比较繁重，花费时间比较久的操作中，使用<code>thread-loader</code>开启多线程构建，能够提高构建速度。</p><p>安装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev thread-loader</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="regexp">/\.(js|jsx|ts|tsx)$/</span>,</span><br><span class="line">  <span class="attr">include</span>: paths.<span class="property">appSrc</span>,</span><br><span class="line">  <span class="attr">use</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>: <span class="string">&quot;thread-loader&quot;</span>, </span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">workers</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">workerParallelJobs</span>: <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://link.juejin.cn/?target=https://link.segmentfault.com/?enc=I7DkyzUEj55w6+aCIJaJ9g==.saRp0LiKWJTN6fc9OqSZm28DvcNc0XYcfhoLH9t8AYBR3NvdorYwgCXETVE9cJkaQsxJKkxcs5hdQeaYn3I+Ow==">webpack 官网</a> 提到 <code>node-sass</code> 中有个来自 Node.js 线程池的阻塞线程的 bug。 当使用  <code>thread-loader</code> 时，需要设置  <code>workerParallelJobs: 2</code>。</p></blockquote><h4 id="打包前清空输出文件夹"><a href="#打包前清空输出文件夹" class="headerlink" title="打包前清空输出文件夹"></a>打包前清空输出文件夹</h4><p>在webpack5之前我们使用<code>clean-webpack-plugin</code>来清除输出文件夹，在webpack5自带了清除功能。</p><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>在<code>output</code>中配置<code>clean</code>属性为<code>true</code></p><h4 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h4><p>懒加载也可以叫做按需加载，本质是将文件中的不会立即使用到的模块进行分离，当在使用到的时候才会去加载该模块，这样的做法会大大的减小入口文件的体积，让加载速度更快。</p><p>使用方式则是用import动态导入的方式实现懒加载。</p><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">import</span>(<span class="string">&#x27;demo.js&#x27;</span>)</span><br><span class="line"> .<span class="title function_">then</span>(&#123;<span class="attr">default</span>: res&#125; =&gt; &#123;</span><br><span class="line">     ...</span><br><span class="line"> &#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>当webpack打包时，就会将demo文件单独打包成一个文件，当被使用时才会去加载。</p><p>可以使用魔法注释去指定chunk的名称与文件的加载方式。</p><p>指定chunk名称：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">import</span>(<span class="comment">/* webpackChunkName: &quot;demo_chunk&quot; */</span> <span class="string">&#x27;demo.js&#x27;</span>)</span><br><span class="line"> .<span class="title function_">then</span>(&#123;<span class="attr">default</span>: res&#125; =&gt; &#123;</span><br><span class="line">     ...</span><br><span class="line"> &#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>指定加载方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">import</span>(</span><br><span class="line">   <span class="comment">/* webpackPreload: &quot;demo_chunk&quot;, webpackPrefetch: true */</span></span><br><span class="line">   <span class="string">&#x27;demo.js&#x27;</span></span><br><span class="line">)</span><br><span class="line"> .<span class="title function_">then</span>(&#123;<span class="attr">default</span>: res&#125; =&gt; &#123;</span><br><span class="line">     ...</span><br><span class="line"> &#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>我们来看下两种加载方式的区别：</p><ol><li>prefetch：会在浏览器空闲时提前加载文件</li><li>preload：会立即加载文件</li></ol><h4 id="使用CDN"><a href="#使用CDN" class="headerlink" title="使用CDN"></a>使用CDN</h4><p>打包完成后，可以将静态资源上传到CDN，通过CDN加速来提升资源的加载速度。</p><p><strong>webpack.common.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">publicPath</span>: isEnvProduction ? <span class="string">&#x27;https://CDNxxx.com&#x27;</span> : <span class="string">&#x27;&#x27;</span>, </span><br><span class="line">&#125;,</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>通过配置<code>publicPath</code>来设置cdn域名。</p><h4 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h4><p>浏览器缓存，就是在第一次加载页面后，会加载相应的资源，在下一次进入页面时会从浏览器缓存中去读取资源，加载速度更快。</p><p>webpack能够根据文件的内容生成相应的hash值，当内容变化hash才会改变。</p><p>使用：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: isEnvProduction</span><br><span class="line">      ? <span class="string">&quot;[name].[contenthash].bundle.js&quot;</span></span><br><span class="line">      : <span class="string">&quot;[name].bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>只在生产环境开启hash值，在开发环境会影响构建效率。</p><h2 id="优化工具"><a href="#优化工具" class="headerlink" title="优化工具"></a>优化工具</h2><p>这里简单介绍一下：</p><ol><li><code>progress-bar-webpack-plugin</code>：打包时显示进度，但是会影响打包速度，需要斟酌使用，如果打包时间过长可以使用，否则不需要使用。</li><li><code>speed-measure-webpack-plugin</code>：查看loader和plugin的耗时，可以对耗时较长的loader和plugin针对性优化。</li><li><code>webpack-bundle-analyzer</code>：可以查看打包后各个文件的占比，来针对性的优化。</li></ol><p>注：以上都是webpack的plugin</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="使用的loader"><a href="#使用的loader" class="headerlink" title="使用的loader"></a>使用的loader</h3><p><strong>处理css的loader：</strong></p><ol><li><p><code>style-loader</code>：插入css样式到dom中</p></li><li><p><code>css-loader</code>：解析css文件生成js对象</p></li><li><pre><code>postcss-loader</code></pre><p>： 处理css兼容问题</p><ul><li><code>postcss-preset-env</code>：postcss预置插件，处理css兼容性，自动添加浏览器内核前缀</li><li><code>@fullhuman/postcss-purgecss</code>: 清除未使用的css样式</li></ul></li><li><p><code>sass-loader</code>：处理sass文件</p></li><li><p><code>less-loader</code>：处理less文件</p></li><li><p><code>mini-css-extract-plugin</code>: 使用该插件内部的loader，将css独立打包成一个文件，还需要添加该插件到<code>plugins</code>中。</p></li></ol><p><strong>处理js|ts的loader:</strong></p><p>1.<code>babel-loader</code>: 处理js兼容，将es6转es5，对新Api进行polyfill。</p><p>presets - babel预置插件：</p><ul><li><code>@babel/preset-env</code>：bebal预置es6转es5的插件</li><li><code>@babel/preset-react</code>：jsx语法转换</li><li><code>@/babel/preset-typescript</code>： ts语法转js</li></ul><p>plugins - babel插件</p><ul><li><code>@babel/plugin-transform-runtime</code>：将babel的工具函数以模块的方式引用以达到重复使用的目的。将polyfill的方法以模块的方式引用，来处理polyfill污染全局变量的问题。将genarate以模块的方式引用，来处理generate污染全局变量的问题。</li><li><code>react-refresh/babel</code>：react组件热更新（HRM）</li></ul><p><strong>处理资源文件：图片，字体文件等的loader</strong></p><ol><li><code>url-loader</code>：处理图片，设置options.limite属性，小于该属性值的图片转为base64（内联），大于则将图片发送至输出目录。（内置file-loader）</li><li><code>file-loader</code>：处理文件，将文件发送至输出目录</li><li><code>raw-loader</code>：将文件导出为字符串</li></ol><p>webpack5中使用内置的<code>Asset Module</code>：</p><ol><li><code>asset/resource</code>替代<code>file-loader</code></li><li><code>asset/inline</code>替代<code>url-loader</code></li><li><code>asset/source</code>替代<code>raw-loader</code></li><li><code>asset</code>通过配置<code>parser.dataUrlCondition.maxSize</code>，来自动选择使用<code>asset/resource</code>(大于MaxSize)和<code>asset/inline</code>（小于maxSize）。</li></ol><h3 id="使用的webpack-plugin"><a href="#使用的webpack-plugin" class="headerlink" title="使用的webpack plugin"></a>使用的webpack plugin</h3><ol><li><code>html-webpack-plugin</code>: 自动生成html文件，并且自动引用webpack构建好的文件。</li><li><code>mini-css-extract-plugin</code>: 分离css单独打包成一个文件。</li><li><code>clean-webapck-plugin</code>: 自动清除输出文件目录，被<code>output.clean</code>替代</li><li><code>copy-webpack-plugin</code>: 复制文件到另外一个文件夹</li><li><code>compression-webpack-plugin</code>: 压缩文件</li><li><code>webpack.DefinePlugin</code>：注入全局变量</li><li><code>webpack.DllPlugin</code>：生成打包一个含有打包模块信息的json文件</li><li><code>webpack.DllReferancePlugin</code>：使用Dllplugin生成的json文件使webpack在打包时排除json文件中包含的模块。</li><li><code>add-asset-html-webpack-plugin</code>：自定义添加bundle文件到html中，本文中是将dll生成的js文件，使用该插件添加到了html中。</li><li><code>eslint-webpack-plugin</code>：代码格式校验</li><li><code>fork-ts-checker-webpack-plugin</code>：在命令行中显示ts错误</li><li><code>@pmmmwh/react-refresh-webpack-plugin</code>：react组件热更新（HRM）</li></ol><p>作者：ArnoSu<br>链接：<a href="https://juejin.cn/post/7031813766098452493">https://juejin.cn/post/7031813766098452493</a><br>来源：稀土掘金<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>]]></content>
      
      
      <categories>
          
          <category> webpack </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Webstrom 常用快捷配置</title>
      <link href="/hisai3.github.io/2023/01/14/webstrom/"/>
      <url>/hisai3.github.io/2023/01/14/webstrom/</url>
      
        <content type="html"><![CDATA[<p>Webstrom 常用快捷配置</p><h4 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h4><p><code>String Manipulation</code> 字符串处理 驼峰、下划线。。。</p><h4 id="常用快捷"><a href="#常用快捷" class="headerlink" title="常用快捷"></a>常用快捷</h4><blockquote><p>（修改html注释样式 code style –&gt; html –&gt; code generation 想的勾选都去除）<br>ctrl + &#x2F; : 单行注释</p></blockquote><p>ctrl + shift + &#x2F; : 多行注释</p><p>ctrl + alt + s  打开设置</p><p>ctrl + d  : </p><ol><li><p>光标处于文件内容中，复制选择内容 或者 复制当前行</p></li><li><p>鼠标选中文件，选择对比文件</p></li></ol><p>shift + f6  重命名</p><p>alt + f7 ： 选中文件，查找有引入选中文件的文件  </p><p>alt + click ： 选中多个位置同时编辑  </p><p>ctrl + shift + v ： 剪贴板</p><p>f4 : 在git下选择文件后定位到文件位置</p><h4 id="自定义快捷方式"><a href="#自定义快捷方式" class="headerlink" title="自定义快捷方式"></a>自定义快捷方式</h4><p>File Path  文件本地目录结构（edit–复制文件绝对路径ctrl+shift+c  nav–查看项目本地文件夹 f7）</p><p>alt + shift + f : Reformat Code  格式化<br>(将js 双引转单引 ‘Code Style - javascript - Punctuation’ 全部设置always， 第一个设置don’t use)</p><p>ctrl + h : Show History 对比当前文件的上一次历史修改（右键 – local history）</p><p>Show History From Selection 对比当前选择中的上一次历史修改（右键 – local history） ctrl + h</p><p>ctrl + 1 : 文件结构 File Structure</p><p>crtl + shift + b : 选中分支比较文件 compare with branch</p><p>crtl + shift + k : git push</p><p>alt + shift + v : 选中commit比较文件 compare with version</p><p>alt + shift + p : git pull</p><p>alt + shift + m : git merge</p><p>alt + shift + c : git stash</p><p>alt + shift + u : git stash apply</p><p>alt + shift + r : git reset</p><p>ctrl + w : close 关闭当前tag</p><p>alt + w : close 关闭所有tag</p><p>alt + o : close 关闭其他tag</p><h5 id="Tool-Windows"><a href="#Tool-Windows" class="headerlink" title="Tool Windows"></a>Tool Windows</h5><p>Find </p><p>npm</p><p>Commit</p><p>Favorites</p><p>Terminal</p><p>Editor — Code Style 文件格式化（缩进）</p><h4 id="编译less文件"><a href="#编译less文件" class="headerlink" title="编译less文件"></a>编译less文件</h4><p><img src="http://hisai.gitee.io/image-bed/webstrom-less-conf.png" alt="image-20201130150725652"></p><h4 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h4><p>live template</p><p><strong>$ var_name $</strong> 可以定义一个变量</p><ol><li>添加变量后，点击edit variables 设置 方法 和 默认值</li></ol><h4 id="Vue项目-引入跳转问题"><a href="#Vue项目-引入跳转问题" class="headerlink" title="Vue项目@引入跳转问题"></a>Vue项目@引入跳转问题</h4><p>setting 搜索webpack 选择language..下的添加<code>webpack.config.js</code>(可以直接选择项目的)</p><blockquote><p>最好将 webpack 按项目的走（设置automatically）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;..&#x27;</span>, dir)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">context</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./&#x27;</span>),</span><br><span class="line">    <span class="attr">resolve</span>: &#123;</span><br><span class="line">        <span class="attr">extensions</span>: [<span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.ts&#x27;</span>, <span class="string">&#x27;.vue&#x27;</span>, <span class="string">&#x27;.json&#x27;</span>, <span class="string">&#x27;.css&#x27;</span>, <span class="string">&#x27;.node&#x27;</span>, <span class="string">&#x27;.sass&#x27;</span>],</span><br><span class="line">        <span class="attr">alias</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;@&#x27;</span>: <span class="title function_">resolve</span>(<span class="string">&#x27;src&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;vue$&#x27;</span>: <span class="string">&#x27;vue/dist/vue.esm.js&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="关于webstorm打开Vue项目时，无法通过Ctrl-鼠标左键快速定位的解决方法，解决打开-vue文件时打开一直卡在Analyzing的状态"><a href="#关于webstorm打开Vue项目时，无法通过Ctrl-鼠标左键快速定位的解决方法，解决打开-vue文件时打开一直卡在Analyzing的状态" class="headerlink" title="关于webstorm打开Vue项目时，无法通过Ctrl+鼠标左键快速定位的解决方法，解决打开.vue文件时打开一直卡在Analyzing的状态"></a>关于webstorm打开Vue项目时，无法通过Ctrl+鼠标左键快速定位的解决方法，解决打开.vue文件时打开一直卡在Analyzing的状态</h4><p>原因: node_module太多文件<br>解决：file types忽略node_module</p><p><img src="https://gitee.com/hisai/image-bed/raw/master/webstorm-vue-analyzing.png" alt="webstorm-vue-analyzing"></p><h4 id="SVN配置"><a href="#SVN配置" class="headerlink" title="SVN配置"></a>SVN配置</h4><ol><li>安装svn时<br><img src="https://gitee.com/hisai/image-bed/raw/master/webstorm/svn-install.png" alt="svn-install"></li><li>webstorm配置<br><img src="https://gitee.com/hisai/image-bed/raw/master/webstorm/svn.png" alt="svn-install"></li></ol><p>添加svn远程仓库 设置中填写仓库地址即可<br><img src="https://gitee.com/hisai/image-bed/raw/master/webstorm/svn-cangku.png" alt="svn-cangku"></p><p><strong>svn与git一些区别</strong></p><table><thead><tr><th>操作</th><th>svn</th><th>git</th></tr></thead><tbody><tr><td>忽略提交</td><td>右键文件(夹) -&gt; tortoiseSvn -&gt; showlog -&gt; add to ignore list</td><td>新分支</td></tr><tr><td>初次下载项目</td><td>tortoiseSvn -&gt; export -&gt; 填入仓库地址 -&gt; 点击…预览文件 -&gt; 点击选择项目 -&gt; ok (<strong>注意：这样下载只会下载选中文件夹下的文件, 所以要先在本地新建一个跟项目名一样的文件夹</strong>)</td><td>clone</td></tr><tr><td>提交代码</td><td>commit</td><td>push</td></tr><tr><td>分支</td><td>相当于复制文件夹 tortoiseSvn -&gt; branch&#x2F;tag</td><td>check -b</td></tr><tr><td>回退</td><td>tortoiseSvn -&gt; showlog -&gt; 右键revert…</td><td>checkout&#x2F;reset&#x2F;revert</td></tr><tr><td>暂存</td><td>create patch(将修改的文件生成.pacth文件, 使用apply patch恢复, <strong>注意：生成之后原代码中还是会有修改的代码</strong>)</td><td>stash (恢复: apply 恢复并删除：pop)</td></tr></tbody></table><h4 id="MarkDown-语法快捷方式"><a href="#MarkDown-语法快捷方式" class="headerlink" title="MarkDown 语法快捷方式"></a>MarkDown 语法快捷方式</h4><h5 id="常用"><a href="#常用" class="headerlink" title="常用"></a>常用</h5><blockquote><p>以下都是<code>webstorm</code>自带的, 选中文字就会出现提示</p></blockquote><ul><li><p><strong>加粗</strong> ctrl + b</p></li><li><p><em>倾斜</em> ctrl + i</p></li><li><p><del>删除线</del> ctrl + shit + s</p></li></ul><p><code>代码块</code> ctrl + shit + c</p><ul><li>插入表格、图片等(右键) alt + Inset<ul><li><a href="#">链接</a> ctrl + shit + u</li><li><img src="#" alt="图片"> ctrl + u</li></ul></li></ul><h5 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h5><ul><li><p>插入表格 ctrl + t</p></li><li><p><font color="red">不同颜色的文字</font> mfr + tab</p></li><li><p><span style='padding: 1px 4px; color:#26c6da; background-color:rgba(77,208,225,.08); border-radius:4px'>绿色单行代码块</span> mgc + tab</p></li><li><p><span style='padding: 1px 4px;color:#ff502c;background-color: #fff5f5;border-radius:4px'>红色单行代码块</span> mrc + tab</p></li></ul><h6 id="HEXO-语法快捷键"><a href="#HEXO-语法快捷键" class="headerlink" title="HEXO 语法快捷键"></a>HEXO 语法快捷键</h6><ul><li><p>hexo 文章信息  hh + tab</p></li><li><p>hexo 选项卡  htab + tab</p></li></ul><div class="tabs" id="选项卡"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#选项卡-1">选项卡 1</button></li><li class="tab active"><button type="button" data-href="#选项卡-2">选项卡 2</button></li><li class="tab"><button type="button" data-href="#选项卡-3">选项卡 3</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="选项卡-1"><p><strong>这是选项卡 1</strong> 呵呵哈哈哈哈哈哈</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="选项卡-2"><p><strong>这是选项卡 2</strong> 额。。。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="选项卡-3"><p><strong>这是选项卡 3</strong> 哇，你找到我了！</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><ul><li>hexo 彩色引用  hpqoute + tab</li></ul><div class="note class_name flat"><p>文字内容 (md class_name supported) </p></div><div class="note primary flat"><p>文字内容 (md primary supported) </p></div><div class="note default flat"><p>文字内容 (md default supported) </p></div><div class="note success flat"><p>文字内容 (md success supported) </p></div><div class="note info flat"><p>文字内容 (md info supported) </p></div><div class="note warning flat"><p>文字内容 (md warning supported) </p></div><div class="note danger flat"><p>文字内容 (md danger supported) </p></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Canvas</title>
      <link href="/hisai3.github.io/2023/01/14/Canvas/"/>
      <url>/hisai3.github.io/2023/01/14/Canvas/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- canvas最好不要使用style设置宽高,失真 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">var canvas = document.getElementById(&#x27;canvas&#x27;)</span><br></pre></td></tr></table></figure><h4 id="canvas属性宽高和style宽高"><a href="#canvas属性宽高和style宽高" class="headerlink" title="canvas属性宽高和style宽高"></a>canvas属性宽高和style宽高</h4><p><a href="https://www.runoob.com/try/try.php?filename=tryhtml5_canvas_rect">复制代码在线测试</a></p><p><code>canvas</code> 默认是 300 * 150</p><ol><li>canvas宽高 –&gt; 画布</li><li>style宽高 –&gt; 画板</li><li>canvas绘制的内容是以画布为参照，画板的宽高与画布的不一致会导致拉伸，原因是画布会强行撑满画板（类似于背景图的cover）</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">drawDiagonal</span>(<span class="params">id</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> canvas=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(id);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> context=canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    context.<span class="title function_">beginPath</span>();</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    context.<span class="title function_">moveTo</span>(<span class="number">0</span>,<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    context.<span class="title function_">lineTo</span>(<span class="number">100</span>,<span class="number">100</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    context.<span class="title function_">stroke</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">drawDiagonal</span>(<span class="string">&quot;diagonal1&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">drawDiagonal</span>(<span class="string">&quot;diagonal2&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">drawDiagonal</span>(<span class="string">&quot;diagonal3&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;diagonal1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:1px solid;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;diagonal2&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:1px solid;width:200px;height:200px;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;diagonal3&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border:1px solid;width:200px;height:200px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="获取上下文-getContext"><a href="#获取上下文-getContext" class="headerlink" title="获取上下文 getContext"></a>获取上下文 <code>getContext</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2d || 3d</span></span><br><span class="line"><span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br></pre></td></tr></table></figure><h4 id="清除"><a href="#清除" class="headerlink" title="清除"></a>清除</h4><p><code>clearRect</code> : <strong>清除</strong> 指定矩形区域，让清除部分完全透明。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">clearRect</span>(x, y, width, height)</span><br></pre></td></tr></table></figure><h4 id="绘制-填充-x2F-线条"><a href="#绘制-填充-x2F-线条" class="headerlink" title="绘制 (填充&#x2F;线条)"></a>绘制 (填充&#x2F;线条)</h4><h5 id="fill-填充"><a href="#fill-填充" class="headerlink" title="fill 填充"></a>fill 填充</h5><p><code>fill </code> : 直接填充， 配合路径使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">fill</span>() </span><br></pre></td></tr></table></figure><p><code>fillRect </code> : 绘制一个填充的矩形</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">fillRect</span>(x, y, width, height)</span><br></pre></td></tr></table></figure><h5 id="stroke-线条"><a href="#stroke-线条" class="headerlink" title="stroke 线条"></a>stroke 线条</h5><p><code>stroke</code> : 通过线条来绘制图形轮廓， 配合路径使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">stroke</span>() </span><br></pre></td></tr></table></figure><p><code>strokeRect</code> : 绘制一个矩形的边框</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">strokeRect</span>(x, y, width, height)</span><br></pre></td></tr></table></figure><h4 id="路径"><a href="#路径" class="headerlink" title="路径"></a>路径</h4><blockquote><p>路径是隐藏的 需要调用绘制api才能显示处理</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">beginPath</span>() <span class="comment">// 新建一条路径，生成之后，图形绘制命令被指向到路径上生成路径。</span></span><br><span class="line">ctx.<span class="title function_">moveTo</span>(x, y); <span class="comment">// 路径起始点</span></span><br><span class="line">ctx.<span class="title function_">lineTo</span>(x, y); <span class="comment">// 可多个（最后一个为结束点）</span></span><br><span class="line">ctx.<span class="title function_">closePath</span>() <span class="comment">// 闭合路径之后图形绘制命令又重新指向到上下文中。</span></span><br><span class="line">ctx.<span class="title function_">stroke</span>() <span class="comment">// 通过线条来绘制图形轮廓, 如果没有 closepath 最终图形不会闭合（即: 三点可以确定一个三角形，如果没有closepath, 则只是一个角）</span></span><br><span class="line">ctx.<span class="title function_">fill</span>() <span class="comment">// 通过填充路径的内容区域生成实心的图形</span></span><br></pre></td></tr></table></figure><h4 id="移动笔触"><a href="#移动笔触" class="headerlink" title="移动笔触"></a>移动笔触</h4><p><code>moveTo</code> : 这个函数实际上并不能画出任何东西 , 仅控制 <strong>起始点</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">moveTo</span>(x, y) <span class="comment">// 将笔触移动到指定的坐标x以及y上。</span></span><br></pre></td></tr></table></figure><h4 id="线"><a href="#线" class="headerlink" title="线"></a>线</h4><p><code>lineTo</code> : 最后一个为<strong>结束点</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">lineTo</span>(x, y)</span><br></pre></td></tr></table></figure><h4 id="圆弧"><a href="#圆弧" class="headerlink" title="圆弧"></a>圆弧</h4><p><code>arc</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">arc</span><br><span class="line"><span class="comment">// 画一个以（x,y）为圆心的以radius为半径的圆弧（圆），从startAngle开始到endAngle结束，按照anticlockwise给定的方向（默认为顺时针）来生成。</span></span><br><span class="line"><span class="comment">// startAngle, endAngle是弧度, </span></span><br><span class="line"><span class="comment">// 角度与弧度的js表达式: 弧度=(Math.PI/180)*角度</span></span><br><span class="line">ctx.<span class="title function_">arc</span>(x, y, radius, startAngle, endAngle, anticlockwise)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个圆心在(100, 100), 半径40px的圆</span></span><br><span class="line">ctx.<span class="title function_">arc</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">40</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>)</span><br></pre></td></tr></table></figure><p><code>arcTo</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 控制点1 (x1,y1), 控制点2 (x2,y2) r弧的半径。</span></span><br><span class="line">ctx.<span class="title function_">arcTo</span>(x1,y1,x2,y2,r); <span class="comment">// 创建弧</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/hisai/image-bed/raw/master/canvas-arcTo.png" alt="arcto"></p><h4 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h4><p><code>rect</code> : 当该方法执行的时候，<code>moveTo()</code> 方法自动设置坐标参数（0,0）。也就是说，当前笔触自动重置回默认坐标。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绘制一个左上角坐标为（x,y），宽高为width以及height的矩形。</span></span><br><span class="line">ctx.<span class="title function_">rect</span>(x, y, w, h)</span><br></pre></td></tr></table></figure><p>封装的一个用于绘制 **圆角矩形 **的函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">roundedRect</span>(<span class="params">ctx, x, y, width, height, radius</span>)&#123;</span><br><span class="line">  ctx.<span class="title function_">beginPath</span>();</span><br><span class="line">  ctx.<span class="title function_">moveTo</span>(x, y + radius);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x, y + height - radius);</span><br><span class="line">  ctx.<span class="title function_">quadraticCurveTo</span>(x, y + height, x + radius, y + height);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + width - radius, y + height);</span><br><span class="line">  ctx.<span class="title function_">quadraticCurveTo</span>(x + width, y + height, x + width, y + height - radius);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + width, y + radius);</span><br><span class="line">  ctx.<span class="title function_">quadraticCurveTo</span>(x + width, y, x + width - radius, y);</span><br><span class="line">  ctx.<span class="title function_">lineTo</span>(x + radius, y);</span><br><span class="line">  ctx.<span class="title function_">quadraticCurveTo</span>(x, y, x, y + radius);</span><br><span class="line">  ctx.<span class="title function_">stroke</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="二次贝塞尔曲线及三次贝塞尔曲线-这是路径"><a href="#二次贝塞尔曲线及三次贝塞尔曲线-这是路径" class="headerlink" title="二次贝塞尔曲线及三次贝塞尔曲线 (这是路径)"></a>二次贝塞尔曲线及三次贝塞尔曲线 (这是路径)</h4><p><code>quadraticCurveTo</code> : 绘制二次贝塞尔曲线，<code>cp1x,cp1y</code> 为一个控制点，<code>x,y 为</code>结束点</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">quadraticCurveTo</span>(cp1x, cp1y, x, y)</span><br></pre></td></tr></table></figure><p><code>bezierCurveTo</code> : 绘制三次贝塞尔曲线，<code>cp1x,cp1y</code>为控制点一，<code>cp2x,cp2y</code>为控制点二，<code>x,y</code>为结束点。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">bezierCurveTo</span>(cp1x, cp1y, cp2x, cp2y, x, y)</span><br></pre></td></tr></table></figure><h4 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h4><blockquote><p>引入图像到canvas里需要以下两步基本操作：</p></blockquote><ol><li>获得一个指向<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLImageElement"><code>HTMLImageElement</code></a>的对象或者另一个canvas元素的引用作为源，也可以通过提供一个URL的方式来使用图片（参见<a href="https://www.html5canvastutorials.com/tutorials/html5-canvas-images/">例子</a>）</li><li>使用<code>drawImage()</code>函数将图片绘制到画布上</li></ol><ul><li>获取需要绘制的图片</li></ul><p><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLImageElement"><code>HTMLImageElement</code></a></strong></p><p>这些图片是由<code>Image()函数构造出来的，或者任何的&lt;img&gt;元素</code></p><p><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLVideoElement"><code>HTMLVideoElement</code></a></strong></p><p>用一个HTML的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/video">&#96;&#96;</a>元素作为你的图片源，可以从视频中抓取当前帧作为一个图像</p><p><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement"><code>HTMLCanvasElement</code></a></strong></p><p>可以使用另一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/canvas"><code>canvas</code></a> 元素作为你的图片源。</p><p><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ImageBitmap"><code>ImageBitmap</code></a></strong></p><p>这是一个高性能的位图，可以低延迟地绘制，它可以从上述的所有源以及其它几种源中生成。</p><ol><li>创建图像img</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();   <span class="comment">// 创建一个&lt;img&gt;元素</span></span><br><span class="line">img.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="comment">// 图片没装载完，那什么都不会发生（在一些旧的浏览器中可能会抛出异常）</span></span><br><span class="line">  <span class="comment">// 执行drawImage语句</span></span><br><span class="line">&#125;</span><br><span class="line">img.<span class="property">src</span> = <span class="string">&#x27;myImage.png&#x27;</span>; <span class="comment">// 设置图片源地址</span></span><br></pre></td></tr></table></figure><ol><li>使用视频帧</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getMyVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (canvas.<span class="property">getContext</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;myvideo&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="绘制图像"><a href="#绘制图像" class="headerlink" title="绘制图像"></a>绘制图像</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">drawImage` : 其中 `image` 是 image 或者 canvas 对象，`x` 和 `y 是其在目标 canvas 里的起始坐标。</span><br><span class="line">// 1. 将图片完整的绘制,起始点为(x, y) 相对于2，只能说后面的参数不传就默认是整张图，放置位置默认(0, 0)</span><br><span class="line">ctx.drawImage(image, x, y)</span><br><span class="line">// 2. 从图片的(x, y)点开始切宽高为w, h的切片,放置在(x1, y1),并重新设置其宽高为(w1, h1)</span><br><span class="line">ctx.drawImage(image, x, y, w, h, x1, y1, w1, h1)</span><br></pre></td></tr></table></figure><h4 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h4><p><code>fillText</code> : 在指定的(x,y)位置填充指定的文本，绘制的最大宽度是可选的.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">fillText</span>(text, x, y, [, maxWidth])</span><br></pre></td></tr></table></figure><p><code>strokeText</code> : 在指定的(x,y)位置绘制文本边框（空心文字），绘制的最大宽度是可选的.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">strokeText</span>(text, x, y, [, maxWidth])</span><br></pre></td></tr></table></figure><p>设置字体</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">font</span><br><span class="line">ctx.font = &quot;bold 48px serif&quot;;</span><br><span class="line">textAlign</span><br><span class="line">ctx.textAlign = start, end, left, right or center</span><br><span class="line">textBaseline</span><br><span class="line">ctx.textBaseline = top, hanging, middle, alphabetic(默认), ideographic, bottom</span><br><span class="line">direction</span><br><span class="line">ctx.direction = ltr, rtl, inherit(默认)</span><br></pre></td></tr></table></figure><p><strong><code>获取文本宽度</code></strong></p><p><code>measureText()</code> ：将返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/TextMetrics"><code>TextMetrics</code></a>对象的宽度、所在像素，这些体现文本特性的属性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text = ctx.<span class="title function_">measureText</span>(<span class="string">&quot;foo&quot;</span>); <span class="comment">// TextMetrics object</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(text.<span class="property">width</span>); <span class="comment">// 16;</span></span><br></pre></td></tr></table></figure><h4 id="样式和颜色"><a href="#样式和颜色" class="headerlink" title="样式和颜色"></a>样式和颜色</h4><p><code>fillStyle</code> ： 填充的颜色</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#000&#x27;</span> <span class="comment">// css3颜色标准值</span></span><br></pre></td></tr></table></figure><p><code>strokeStyle</code> ： 轮廓的颜色</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">strokeStyle</span> = <span class="string">&#x27;#000&#x27;</span> <span class="comment">// css3颜色标准值</span></span><br></pre></td></tr></table></figure><h4 id="透明度"><a href="#透明度" class="headerlink" title="透明度"></a>透明度</h4><p><code>globalAlpha</code> ： 全局设置影响到 canvas 里所有图形的透明度</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">globalAlpha</span> = <span class="number">0.2</span>;</span><br></pre></td></tr></table></figure><h4 id="线型"><a href="#线型" class="headerlink" title="线型"></a>线型</h4><p><code>lineWidth </code> ： 线条宽度。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">lineWidth</span>  = <span class="number">2</span>; <span class="comment">// number</span></span><br></pre></td></tr></table></figure><p><code>lineCap</code> ：线条末端样式。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">lineCap</span> = <span class="string">&#x27;butt&#x27;</span>;  <span class="comment">// &#x27;butt&#x27;,&#x27;round&#x27;,&#x27;square&#x27;</span></span><br></pre></td></tr></table></figure><p><code>lineJoin</code> ：线条与线条间接合处的样式。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">lineJoin</span> = <span class="string">&#x27;miter&#x27;</span>; <span class="comment">// &#x27;round&#x27;, &#x27;bevel&#x27;, &#x27;miter&#x27;</span></span><br></pre></td></tr></table></figure><p><code>miterLimit</code> ： 限制当两条线相交时交接处最大长度；所谓交接处长度（斜接长度）是指线条交接处内角顶点到外角顶点的长度。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">miterLimit</span> = <span class="number">0.2</span>;</span><br></pre></td></tr></table></figure><p><code>getLineDash</code> ： 返回一个包含当前虚线样式，长度为非负偶数的数组。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">getLineDash</span>()</span><br></pre></td></tr></table></figure><p><code>setLineDash</code> ： 设置当前虚线样式。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">setLineDash</span>(segments) <span class="comment">// segments: Array 指定线段与间隙的交替 例：[4, 2] 4：线长 2：间隔</span></span><br></pre></td></tr></table></figure><p><code>lineDashOffset</code> ： 设置虚线样式的起始偏移量（第一个虚线段距离起始位置的距离）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">lineDashOffset</span> = <span class="number">0.2</span>; <span class="comment">// number</span></span><br></pre></td></tr></table></figure><h4 id="渐变"><a href="#渐变" class="headerlink" title="渐变"></a>渐变</h4><p><code>createLinearGradient</code> ： 线性渐变，返回 <code>canvasGradient</code> 对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 表示渐变的起点 (x1,y1) 与终点 (x2,y2)</span></span><br><span class="line">ctx.<span class="title function_">createLinearGradient</span>(x1, y1, x2, y2);</span><br></pre></td></tr></table></figure><p><code>createRadialGradient</code> ： 径向渐变，返回 <code>canvasGradient</code> 对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前三个定义一个以 (x1,y1) 为原点，半径为 r1 的圆，后三个参数则定义另一个以 (x2,y2) 为原点，半径为 r2 的圆。</span></span><br><span class="line">ctx.<span class="title function_">createRadialGradient</span>(x1, y1, r1, x2, y2, r2);</span><br></pre></td></tr></table></figure><blockquote><p>创建出 <code>canvasGradient</code> 对象后，我们就可以用 <code>addColorStop</code> 方法给它上色了。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// position 参数必须是一个 0.0 与 1.0 之间的数值，表示渐变中颜色所在的相对位置 (设置不同位置段的颜色)</span></span><br><span class="line">canvasGradient.<span class="title function_">addColorStop</span>(position, color)</span><br></pre></td></tr></table></figure><h4 id="阴影"><a href="#阴影" class="headerlink" title="阴影"></a>阴影</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shadowOffsetX</span><br><span class="line">ctx.shadowOffsetX = 0.2;</span><br><span class="line">shadowOffsetY</span><br><span class="line">ctx.shadowOffsetY = 0.2;</span><br><span class="line">shadowBlur</span><br><span class="line">ctx.shadowBlur = 0.2;</span><br><span class="line">shadowColor</span><br><span class="line">ctx.shadowColor = &#x27;#eee&#x27;;</span><br></pre></td></tr></table></figure><h4 id="变形-Transformations"><a href="#变形-Transformations" class="headerlink" title="变形 Transformations"></a>变形 Transformations</h4><p><code>translate</code>: 移动, x,y 相对于画布 (<strong>相当于改变了画布的原点</strong>)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">translate</span>(x, y); </span><br></pre></td></tr></table></figure><p><code>rotate</code>: 旋转 顺时针方向的, 以<strong>弧度</strong>为单位的值, 旋转的<strong>原点</strong>是画布的原点</p><blockquote><p>x 和 y 坐标（<code>x = r*Math.cos(a); y = r*Math.sin(a)</code>）</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">rotate</span>(angle);</span><br><span class="line">scale<span class="string">`: 缩放 如果参数为负实数, 相当于以 `</span>x 或 y轴<span class="string">` 作为对称轴镜像反转（例如， 使用`</span><span class="title function_">translate</span>(<span class="number">0</span>,canvas.<span class="property">height</span>); <span class="title function_">scale</span>(<span class="number">1</span>,-<span class="number">1</span>);</span><br><span class="line">ctx.<span class="title function_">scale</span>(x, y);</span><br></pre></td></tr></table></figure><p><code>transform</code>: 允许对变形矩阵直接修改。</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a (m11) 水平方向的缩放</span><br><span class="line">b(m12) 竖直方向的倾斜偏移</span><br><span class="line">c(m21) 水平方向的倾斜偏移</span><br><span class="line">d(m22) 竖直方向的缩放</span><br><span class="line">e(dx) 水平方向的移动</span><br><span class="line">f(dy) 竖直方向的移动</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">transform</span>(a, b, c, d, e, f);</span><br></pre></td></tr></table></figure><p><code>setTransform</code>: 这个方法会将当前的变形矩阵重置为单位矩阵，然后用相同的参数调用 <code>transform </code>方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">setTransform</span>(a, b, c, d, e, f);</span><br></pre></td></tr></table></figure><p><code>resetTransform</code>: 重置当前变形为单位矩阵</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">resetTransform</span>(); <span class="comment">// 相当于 ctx.setTransform(1, 0, 0, 1, 0, 0)</span></span><br></pre></td></tr></table></figure><h4 id="保存和恢复"><a href="#保存和恢复" class="headerlink" title="保存和恢复"></a>保存和恢复</h4><blockquote><p>状态的保存和恢复 Saving and restoring state</p></blockquote><p><code>save</code> : 保存画布(canvas)的所有状态，每当 <code>save()</code> 方法被调用后，当前的状态就被推送到栈中保存</p><blockquote><p>一个绘画状态包括：</p><ul><li>当前应用的变形（即移动，旋转和缩放，见下）</li><li>以及下面这些属性：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/strokeStyle"><code>strokeStyle</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/fillStyle"><code>fillStyle</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/globalAlpha"><code>globalAlpha</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineWidth"><code>lineWidth</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineCap"><code>lineCap</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineJoin"><code>lineJoin</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/miterLimit"><code>miterLimit</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/lineDashOffset"><code>lineDashOffset</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowOffsetX"><code>shadowOffsetX</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowOffsetY"><code>shadowOffsetY</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowBlur"><code>shadowBlur</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/shadowColor"><code>shadowColor</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation"><code>globalCompositeOperation</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/font"><code>font</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/textAlign"><code>textAlign</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/textBaseline"><code>textBaseline</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/direction"><code>direction</code></a>, <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/imageSmoothingEnabled"><code>imageSmoothingEnabled</code></a></li><li>当前的<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Compositing#clipping_paths">裁切路径（clipping path）</a></li></ul></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">save</span>();</span><br></pre></td></tr></table></figure><p><code>restore </code>: 恢复 canvas 状态, 每一次调用 <code>restore</code> 方法，上一个保存的状态就从栈中弹出，所有设定都恢复</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="title function_">restore</span>();</span><br></pre></td></tr></table></figure><p><strong>注意：</strong> 为了避免变形影响下次的绘制操作，应当先 <code>save()</code> ，变形绘制之后恢复 <code>restore()</code></p><h4 id="合成"><a href="#合成" class="headerlink" title="合成"></a>合成</h4><blockquote><p>canvas 绘制的会按顺序叠加（默认后画的在最上层）</p></blockquote><p><code>globalCompositeOperation</code> <strong>蒙版效果</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.<span class="property">globalCompositeOperation</span> = <span class="string">&#x27;source-over&#x27;</span>  <span class="comment">// 默认</span></span><br></pre></td></tr></table></figure><p> <strong>value</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.  `source-in`:  只显示图形重叠的区域，其余为透明</span><br><span class="line">2.  `source-out`:  只显示**新**图形与现有图形不重叠的区域 **(现有的和重叠区域会变为透明)**, 其余为透**(有点像清空画布，但是重复区域会变透明)**</span><br><span class="line">3.  `source-atop`:  与 `source-out` 相反 **(现有的和不重叠区域会变为透明)**</span><br><span class="line">4.  `xor`:  重叠区域变为透明</span><br><span class="line">5.  `destination-over`:  与**默认值相反**</span><br><span class="line">6.  `destination-in`:   **(现有的和不重叠区域会变为透明)**</span><br><span class="line">7.  `destination-out`:  **(现有的和重叠区域会变为透明)**</span><br><span class="line">8.  `copy`:  只显示新图形</span><br><span class="line">9.  `destination-over`:  。。。</span><br><span class="line">10.  `destination-over`:  。。。</span><br></pre></td></tr></table></figure><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><h4 id="canvas-填充图片模糊问题！！！"><a href="#canvas-填充图片模糊问题！！！" class="headerlink" title="canvas 填充图片模糊问题！！！"></a>canvas 填充图片模糊问题！！！</h4><ol><li>设置画布的 <code>width/height</code> 属性是 <code>css的width/height</code> 的两倍（效果只是稍微好一点, 或者再放大几倍。。。）</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px; height: 100px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>使用<code>hidpi-canvas-polyfill-master</code></li></ol><blockquote><p>原理跟第一中方法一样，只是换成 js 控制宽高</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.引入hidpi-canvas.min.js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./hidpi-canvas-polyfill-master/dist/hidpi-canvas.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://www.runoob.com/try/try.php?filename=tryhtml5_canvas_rect">复制代码在线测试</a></p><p>手动实现</p><ul><li>没有使用 <code>ctx.scale()</code>  设置的值需要根据dpr缩放</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>canvas绘制图片模糊<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;img&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;https://desk-fd.zol-img.com.cn/t_s960x600c5/g2/M00/09/0C/Cg-4WVV6jWmIczjzAAdzu1eYHzwAAFK1wD9poMAB3PT053.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">&quot;100px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">height</span>=<span class="string">&quot;100px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;visibility: hidden;&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;400px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;canvas2&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">&quot;800px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">height</span>=<span class="string">&quot;800px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;width: 400px; height: 400px;&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 定义 getPixelRatio 函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">setupCanvas</span>(<span class="params">canvas</span>) &#123; <span class="comment">// canvas: dom对象</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> dpr = (scale = <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span> || <span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 通过 getBoundingClientRect 宽高会是实际显示的宽高（即：使用transform 的scale缩放之后的宽高）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 最好用canvas的offsetWidth offsetHeight</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> rect = canvas.<span class="property">getBoundingClientRect</span> ();</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 必须先设置style的宽高</span></span></span><br><span class="line"><span class="language-javascript">      canvas.<span class="property">style</span>.<span class="property">width</span> = rect.<span class="property">width</span> + <span class="string">&quot;px&quot;</span></span></span><br><span class="line"><span class="language-javascript">      canvas.<span class="property">style</span>.<span class="property">height</span> = rect.<span class="property">height</span> + <span class="string">&quot;px&quot;</span></span></span><br><span class="line"><span class="language-javascript">      canvas.<span class="property">width</span> = rect.<span class="property">width</span> * dpr;</span></span><br><span class="line"><span class="language-javascript">      canvas.<span class="property">height</span> = rect.<span class="property">height</span> * dpr;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> getPixelRatio = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> backingStore = context.<span class="property">backingStorePixelRatio</span> ||</span></span><br><span class="line"><span class="language-javascript">            context.<span class="property">webkitBackingStorePixelRatio</span> ||</span></span><br><span class="line"><span class="language-javascript">            context.<span class="property">mozBackingStorePixelRatio</span> ||</span></span><br><span class="line"><span class="language-javascript">            context.<span class="property">msBackingStorePixelRatio</span> ||</span></span><br><span class="line"><span class="language-javascript">            context.<span class="property">oBackingStorePixelRatio</span> ||</span></span><br><span class="line"><span class="language-javascript">            context.<span class="property">backingStorePixelRatio</span> || <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> (<span class="variable language_">window</span>.<span class="property">devicePixelRatio</span> || <span class="number">1</span>) / backingStore;</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> img = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;img&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      context.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">400</span>);</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> canvas2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas2&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> context2 = <span class="title function_">setupCanvas</span>(canvas2)</span></span><br><span class="line"><span class="language-javascript">      context2.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">800</span>, <span class="number">800</span>); <span class="comment">// 需要画布本身没有使用 ctx.scale(), 设置的值也需要根据dpr缩放</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onload</span> = init;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>使用 <code>ctx.scale()</code>  设置的值不需要根据dpr缩放</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>canvas绘制图片模糊<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;img&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;https://desk-fd.zol-img.com.cn/t_s960x600c5/g2/M00/09/0C/Cg-4WVV6jWmIczjzAAdzu1eYHzwAAFK1wD9poMAB3PT053.jpg&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">&quot;100px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">height</span>=<span class="string">&quot;100px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;visibility: hidden;&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;400px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;canvas2&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">&quot;800px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">height</span>=<span class="string">&quot;800px&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">&quot;width: 400px; height: 400px;&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">setupCanvas</span>(<span class="params">canvas</span>) &#123; <span class="comment">// canvas: dom对象</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> dpr = <span class="number">2</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 通过 getBoundingClientRect 宽高会是实际显示的宽高（即：使用transform 的scale缩放之后的宽高）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 最好用canvas的offsetWidth offsetHeight</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> rect = canvas.<span class="title function_">getBoundingClientRect</span>();</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 必须先设置style的宽高</span></span></span><br><span class="line"><span class="language-javascript">      canvas.<span class="property">style</span>.<span class="property">width</span> = rect.<span class="property">width</span> + <span class="string">&quot;px&quot;</span></span></span><br><span class="line"><span class="language-javascript">      canvas.<span class="property">style</span>.<span class="property">height</span> = rect.<span class="property">height</span> + <span class="string">&quot;px&quot;</span></span></span><br><span class="line"><span class="language-javascript">      canvas.<span class="property">width</span> = rect.<span class="property">width</span> * dpr;</span></span><br><span class="line"><span class="language-javascript">      canvas.<span class="property">height</span> = rect.<span class="property">height</span> * dpr;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(canvas.<span class="property">width</span>)</span></span><br><span class="line"><span class="language-javascript">  context.<span class="title function_">scale</span>(dpr, dpr)</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> context;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1234</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> img = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;img&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      context.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">400</span>);</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> canvas2 = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas2&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> context2 = <span class="title function_">setupCanvas</span>(canvas2)</span></span><br><span class="line"><span class="language-javascript">      context2.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">400</span>);  <span class="comment">// 需要画布使用 ctx.scale(), 设置的值不需要根据dpr缩放</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onload</span> = init;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure><h4 id="暗水印"><a href="#暗水印" class="headerlink" title="暗水印"></a>暗水印</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;256&quot;</span> <span class="attr">height</span>=<span class="string">&quot;256&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>加密</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> textData;</span><br><span class="line"><span class="comment">// 这些canvas API，好久没用，需要查API文档了T_T</span></span><br><span class="line">ctx.<span class="property">font</span> = <span class="string">&#x27;30px Microsoft Yahei&#x27;</span>;</span><br><span class="line">ctx.<span class="title function_">fillText</span>(<span class="string">&#x27;广告位招租u&#x27;</span>, <span class="number">60</span>, <span class="number">130</span>);</span><br><span class="line">textData = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, ctx.<span class="property">canvas</span>.<span class="property">width</span>, ctx.<span class="property">canvas</span>.<span class="property">height</span>).<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接着将图片先绘制在画布上，然后获取其像素数据</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line"><span class="keyword">var</span> originalData;</span><br><span class="line">img.<span class="property">src</span> = <span class="string">&#x27;bg.jpg&#x27;</span>;</span><br><span class="line">img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 获取指定区域的canvas像素信息</span></span><br><span class="line">    originalData = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, ctx.<span class="property">canvas</span>.<span class="property">width</span>, ctx.<span class="property">canvas</span>.<span class="property">height</span>);</span><br><span class="line">    <span class="title function_">mergeData</span>(textData, <span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">    <span class="comment">// 打印出数据，会看到有一个非常大的数组。这个一维数组存储了所有的像素信息，一共有 256 * 256 * 4 = 262144 个值。其中 4 个值一组 大家熟知的rgba 值。 </span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(originalData); </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mergeData = <span class="keyword">function</span> (<span class="params">newData, color</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> oData = originalData.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">var</span> bit, offset;  <span class="comment">// offset的作用是找到alpha通道值，这里需要大家自己动动脑筋</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (color) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;R&#x27;</span>:</span><br><span class="line">            bit = <span class="number">0</span>;</span><br><span class="line">            offset = <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;G&#x27;</span>:</span><br><span class="line">            bit = <span class="number">1</span>;</span><br><span class="line">            offset = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;B&#x27;</span>:</span><br><span class="line">            bit = <span class="number">2</span>;</span><br><span class="line">            offset = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; oData.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">4</span> == bit) &#123;</span><br><span class="line">            <span class="comment">// 只处理目标通道</span></span><br><span class="line">            <span class="keyword">if</span> (newData[i + offset] === <span class="number">0</span> &amp;&amp; (oData[i] % <span class="number">2</span> === <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="comment">// 没有信息的像素，该通道最低位置0，但不要越界</span></span><br><span class="line">                <span class="keyword">if</span> (oData[i] === <span class="number">255</span>) &#123;</span><br><span class="line">                    oData[i]--;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    oData[i]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newData[i + offset] !== <span class="number">0</span> &amp;&amp; (oData[i] % <span class="number">2</span> === <span class="number">0</span>)) &#123;</span><br><span class="line">                <span class="comment">// // 有信息的像素，该通道最低位置1，可以想想上面的斑点效果是怎么实现的</span></span><br><span class="line">                <span class="keyword">if</span> (oData[i] === <span class="number">255</span>) &#123;</span><br><span class="line">                    oData[i]--;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    oData[i]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ctx.<span class="title function_">putImageData</span>(originalData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>解密</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ctx = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>).<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接着将图片先绘制在画布上，然后获取其像素数据</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line"><span class="keyword">var</span> originalData;</span><br><span class="line">img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 获取指定区域的canvas像素信息</span></span><br><span class="line">    originalData = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, ctx.<span class="property">canvas</span>.<span class="property">width</span>, ctx.<span class="property">canvas</span>.<span class="property">height</span>);</span><br><span class="line">    <span class="title function_">processData</span>(originalData)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(originalData); <span class="comment">// 打印出数据，会看到有一个非常大的数组。这个一维数组存储了所有的像素信息，一共有 256 * 256 * 4 = 262144 个值。其中 4 个值一组 大家熟知的 rgba 值。 </span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">img.<span class="property">src</span> = <span class="string">&#x27;Snipaste-encription.png&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> processData = <span class="keyword">function</span> (<span class="params">originalData</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> data = originalData.<span class="property">data</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">length</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">4</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 红色分量</span></span><br><span class="line">            <span class="keyword">if</span> (data[i] % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                data[i] = <span class="number">0</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                data[i] = <span class="number">255</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i % <span class="number">4</span> == <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="comment">// alpha通道不做处理</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭其他分量，不关闭也不影响答案，甚至更美观 o(^▽^)o</span></span><br><span class="line">            <span class="comment">// data[i] = 0;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将结果绘制到画布</span></span><br><span class="line">    ctx.<span class="title function_">putImageData</span>(originalData, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h4><p><a href="https://juejin.cn/post/7174251833773752350">原文</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        * &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;cancel()&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;save()&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 配置内容</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> config = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">width</span>: <span class="number">400</span>, <span class="comment">// 宽度</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">height</span>: <span class="number">200</span>, <span class="comment">// 高度</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">lineWidth</span>: <span class="number">5</span>, <span class="comment">// 线宽</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">strokeStyle</span>: <span class="string">&#x27;red&#x27;</span>, <span class="comment">// 线条颜色</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">lineCap</span>: <span class="string">&#x27;round&#x27;</span>, <span class="comment">// 设置线条两端圆角</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">lineJoin</span>: <span class="string">&#x27;round&#x27;</span>, <span class="comment">// 线条交汇处圆角</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取canvas 实例</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;canvas&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置宽高</span></span></span><br><span class="line"><span class="language-javascript">    canvas.<span class="property">width</span> = config.<span class="property">width</span></span></span><br><span class="line"><span class="language-javascript">    canvas.<span class="property">height</span> = config.<span class="property">height</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置一个边框</span></span></span><br><span class="line"><span class="language-javascript">    canvas.<span class="property">style</span>.<span class="property">border</span> = <span class="string">&#x27;1px solid #000&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 创建上下文</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置填充背景色</span></span></span><br><span class="line"><span class="language-javascript">    ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;transparent&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 绘制填充矩形</span></span></span><br><span class="line"><span class="language-javascript">    ctx.<span class="title function_">fillRect</span>(</span></span><br><span class="line"><span class="language-javascript">        <span class="number">0</span>, <span class="comment">// x 轴起始绘制位置</span></span></span><br><span class="line"><span class="language-javascript">        <span class="number">0</span>, <span class="comment">// y 轴起始绘制位置</span></span></span><br><span class="line"><span class="language-javascript">        config.<span class="property">width</span>, <span class="comment">// 宽度</span></span></span><br><span class="line"><span class="language-javascript">        config.<span class="property">height</span> <span class="comment">// 高度</span></span></span><br><span class="line"><span class="language-javascript">    );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 保存上次绘制的 坐标及偏移量</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> client = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// 偏移量</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">offsetY</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">endX</span>: <span class="number">0</span>, <span class="comment">// 坐标</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">endY</span>: <span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 判断是否为移动端</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> mobileStatus = (<span class="regexp">/Mobile|Android|iPhone/i</span>.<span class="title function_">test</span>(navigator.<span class="property">userAgent</span>))</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title function_">init</span> = event =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取偏移量及坐标</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> &#123; offsetX, offsetY, pageX, pageY &#125; = mobileStatus ? event.<span class="property">changedTouches</span>[<span class="number">0</span>] : event </span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 修改上次的偏移量及坐标</span></span></span><br><span class="line"><span class="language-javascript">        client.<span class="property">offsetX</span> = offsetX</span></span><br><span class="line"><span class="language-javascript">        client.<span class="property">offsetY</span> = offsetY</span></span><br><span class="line"><span class="language-javascript">        client.<span class="property">endX</span> = pageX</span></span><br><span class="line"><span class="language-javascript">        client.<span class="property">endY</span> = pageY</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 清除以上一次 beginPath 之后的所有路径，进行绘制</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">beginPath</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 根据配置文件设置相应配置</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="property">lineWidth</span> = config.<span class="property">lineWidth</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="property">strokeStyle</span> = config.<span class="property">strokeStyle</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="property">lineCap</span> = config.<span class="property">lineCap</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="property">lineJoin</span> = config.<span class="property">lineJoin</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 设置画线起始点位</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">moveTo</span>(client.<span class="property">endX</span>, client.<span class="property">endY</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 监听 鼠标移动或手势移动</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(mobileStatus ? <span class="string">&quot;touchmove&quot;</span> : <span class="string">&quot;mousemove&quot;</span>, draw)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 绘制</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title function_">draw</span> = event =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 获取当前坐标点位</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> &#123; pageX, pageY &#125; = mobileStatus ? event.<span class="property">changedTouches</span>[<span class="number">0</span>] : event</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 修改最后一次绘制的坐标点</span></span></span><br><span class="line"><span class="language-javascript">        client.<span class="property">endX</span> = pageX</span></span><br><span class="line"><span class="language-javascript">        client.<span class="property">endY</span> = pageY</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 根据坐标点位移动添加线条</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">lineTo</span>(pageX , pageY )</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 绘制</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">stroke</span>()</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 结束绘制</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title function_">cloaseDraw</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 结束绘制</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">closePath</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 移除鼠标移动或手势移动监听器</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;mousemove&quot;</span>, draw)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 创建鼠标/手势按下监听器</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(mobileStatus ? <span class="string">&quot;touchstart&quot;</span> : <span class="string">&quot;mousedown&quot;</span>, init)</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 创建鼠标/手势 弹起/离开 监听器</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(mobileStatus ? <span class="string">&quot;touchend&quot;</span> :<span class="string">&quot;mouseup&quot;</span>, cloaseDraw)</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 取消-清空画布</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title function_">cancel</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 清空当前画布上的所有绘制内容</span></span></span><br><span class="line"><span class="language-javascript">        ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, config.<span class="property">width</span>, config.<span class="property">height</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 保存-将画布内容保存为图片</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title function_">save</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 将canvas上的内容转成blob流</span></span></span><br><span class="line"><span class="language-javascript">        canvas.<span class="title function_">toBlob</span>(<span class="function"><span class="params">blob</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 获取当前时间并转成字符串，用来当做文件名</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> date = <span class="title class_">Date</span>.<span class="title function_">now</span>().<span class="title function_">toString</span>()</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 创建一个 a 标签</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 设置 a 标签的下载文件名</span></span></span><br><span class="line"><span class="language-javascript">            a.<span class="property">download</span> = <span class="string">`<span class="subst">$&#123;date&#125;</span>.png`</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 设置 a 标签的跳转路径为 文件流地址</span></span></span><br><span class="line"><span class="language-javascript">            a.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob)</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 手动触发 a 标签的点击事件</span></span></span><br><span class="line"><span class="language-javascript">            a.<span class="title function_">click</span>()</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 移除 a 标签</span></span></span><br><span class="line"><span class="language-javascript">            a.<span class="title function_">remove</span>()</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> canvas </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
